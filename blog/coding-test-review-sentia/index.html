<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Coding Test Review: Sentia | Floor and Varnish</title> <meta name="description" content="A long SQL query in a database far, far away…."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Coding Test Review: Sentia"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/coding-test-review-sentia/"> <meta property="og:description" content="A long SQL query in a database far, far away…."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2021-05-09/jedi-archives.png"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Coding Test Review: Sentia"> <meta name="twitter:description" content="A long SQL query in a database far, far away…."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/coding-test-review-sentia/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2021-05-09/jedi-archives.png"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2021-05-09T17:50:00+10:00"> <meta property="article:modified_time" content="2023-07-24T14:30:00+10:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url('/assets/images/2021-05-09/jedi-archives.png');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Coding Test Review: Sentia </h1> <p class="page__lead">A long SQL query in a database far, far away…. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-05-09T17:50:00+10:00">May 9, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 23 minute read </span> </p> </div> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://instagram.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/@paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Coding Test Review: Sentia"> <meta itemprop="description" content="A long SQL query in a database far, far away…."> <meta itemprop="datePublished" content="2021-05-09T17:50:00+10:00"> <meta itemprop="dateModified" content="2023-07-24T14:30:00+10:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>I actually quite like coding tests.</p> <p>Not whiteboard coding tests, or generic algorithm tests that read more like math problems (usually set by “tech recruiting platforms”, and performed under exam-like conditions), but “take-home” tests where you get to build something practical in a specific technology stack.</p> <p>They can be fun and stimulating in the same way as answering questions on <a href="https://stackoverflow.com/users/567863/paul-fioravanti">Stack Overflow</a>, or solving problems on learning platforms like <a href="https://exercism.io/profiles/paulfioravanti">Exercism</a>, and can also be good fodder for your <a href="https://github.com/paulfioravanti">online coding portfolio</a>. I find I nearly always learn something new, or a different way of doing something I may already know, that makes me re-think the way I have solved a problem.</p> <p>In this instance, a friend sent me <a href="https://www.sentia.com.au/">Sentia</a>’s coding test to check out, and simply because I felt like I had not begun a <a href="http://rubyonrails.org/">Ruby on Rails</a> application from scratch in a long time, I decided to take a crack at it. So, here is my review (and <a href="https://github.com/paulfioravanti/sentia-coding-test">the codebase</a>) of that attempt.</p> <blockquote> <p>Disclaimer: I am not, nor have ever been, an employee of Sentia, nor have I ever applied for employment there, nor is this post some kind of attempt to get them to employ me; I just did their coding test for my own definition of “fun”.</p> <p>If you are applying there, or plan to in the future, you may want to stop reading, and consider pretending that this blog post (and <a href="https://github.com/search?l=Ruby&amp;p=1&amp;q=sentia&amp;type=Repositories">all the other solutions people have posted</a>) does not exist, so you can greet their coding test with fresh eyes (assuming this one is still being used…)</p> </blockquote> <h2 id="original-requirements">Original Requirements</h2> <p>You will be required to create a Ruby on Rails application with the following features below. The sample CSV data required for the test can be found <a href="https://github.com/paulfioravanti/sentia-coding-test/blob/main/test/fixtures/files/SentiaCodingTestData.csv">here</a>. This application can be built in 1 hour.</p> <p>Below is a list of user stories and requirements for each section of this application.</p> <h3 id="part-1">PART 1</h3> <p>As a user, I should be able to upload this sample CSV and import the data into a database.</p> <p>IMPORTER REQUIREMENTS</p> <ol> <li>The data needs to load into 3 tables. <strong>People</strong>, <strong>Locations</strong> and <strong>Affiliations</strong><br> </li> <li>A <strong>Person</strong> can belong to many <strong>Locations</strong><br> </li> <li>A <strong>Person</strong> can belong to many <strong>Affiliations</strong><br> </li> <li>A <strong>Person</strong> without an <strong>Affiliation</strong> should be skipped<br> </li> <li>A <strong>Person</strong> should have both a <em>first_name</em> and <em>last_name</em>. All fields need to be validated except for <em>last_name</em>, <em>weapon</em> and <em>vehicle</em> which are optional.<br> </li> <li>Names and Locations should all be titlecased</li> </ol> <h3 id="part-2">PART 2</h3> <ol> <li>As a user, I should be able to view these results from the importer in a table.</li> <li>As a user, I should be able to paginate through the results so that I can see a maximum of 10 results at a time.</li> <li>As a user, I want to type in a search box so that I can filter the results I want to see.</li> <li>As a user, I want to be able to click on a table column heading to reorder the visible results.</li> </ol> <p>Once the test has been completed. Please upload to Git Repo/Google Drive/DropBox or zip and email over back to <em>&lt;person&gt;</em> at <em>&lt;person’s email&gt;</em>. ∎</p> <p>The sample <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> file contains the following data from a galaxy far, far away….</p> <table> <thead> <tr> <th>Name</th> <th>Location</th> <th>Species</th> <th>Gender</th> <th>Affiliations</th> <th>Weapon</th> <th>Vehicle</th> </tr> </thead> <tbody> <tr> <td>Darth Vader</td> <td>Death Star, Tatooine</td> <td>Human</td> <td>Male</td> <td>Sith</td> <td>Lightsaber</td> <td>Tiefighter</td> </tr> <tr> <td>Chewbacca</td> <td>kashyyk</td> <td>Wookie</td> <td>m</td> <td>Rebel Alliance</td> <td>Bowcaster</td> <td>Millennium Falcon</td> </tr> <tr> <td>yoda</td> <td>Yoda’s Hutt</td> <td>Unknown</td> <td>Male</td> <td>Jedi Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Sheev Palpatine</td> <td>Naboo</td> <td>Human</td> <td>Male</td> <td>Galactic Republic</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Princess Leia</td> <td>Alderaan</td> <td>Human</td> <td>Female</td> <td>Rebel Alliance, Galactic Republic</td> <td>Blaster Pistol</td> <td> </td> </tr> <tr> <td>jabba the Hutt</td> <td>Tatooine</td> <td>Hutt</td> <td>Male</td> <td>Hutt Clan</td> <td> </td> <td>Jabba’s Sale Barge</td> </tr> <tr> <td>Kylo Ren</td> <td>chandrila</td> <td>Human</td> <td>Male</td> <td>First Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Obi-Wan Kenobi</td> <td>Stewjon</td> <td>Human</td> <td>M</td> <td>Jedi Order</td> <td>Lightsaber</td> <td>Jedi Starfighter</td> </tr> <tr> <td>luke skywalker</td> <td>Tatooine</td> <td>Human</td> <td>M</td> <td>Rebel Alliance, Jedi Order</td> <td>Lightsaber~!@@@</td> <td>X-wing Starfighter</td> </tr> <tr> <td>Jar Jar Binks</td> <td>Naboo</td> <td>Gungan</td> <td>Male</td> <td>Galactic Republic, Gungan Grand Army</td> <td>Energy Ball</td> <td>Gungan Bongo Submarine</td> </tr> <tr> <td>R2-D2</td> <td>Naboo</td> <td>Astromech Droid</td> <td>Other</td> <td>Rebel Alliance, Galactic Republic</td> <td> </td> <td>X-wing Starfighter</td> </tr> <tr> <td>Han Solo</td> <td>Corellia</td> <td>Human</td> <td>Male</td> <td>Rebel Alliance</td> <td>Blaster Pistol</td> <td>Millennium Falcon</td> </tr> <tr> <td>Boba Fett</td> <td>Kamino</td> <td>Human</td> <td>m</td> <td> </td> <td>Blaster</td> <td>Slave 1</td> </tr> <tr> <td>Rey</td> <td>Jakku</td> <td>Human</td> <td>f</td> <td>Jedi Order</td> <td>Lightsaber</td> <td>Rey’s Speeder</td> </tr> <tr> <td>padme amidala</td> <td>naboo</td> <td>Human</td> <td>Female</td> <td>Galactic Republic</td> <td> </td> <td>Naboo N-1 Starfigher</td> </tr> <tr> <td>C-3PO</td> <td>Tatooine</td> <td>Protocol Droid</td> <td>Other</td> <td>The Resistance</td> <td> </td> <td>-1</td> </tr> <tr> <td>Mace Windu</td> <td>Haruun Kal</td> <td>Human</td> <td>Male</td> <td>Jedi Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Lando calrissian</td> <td>Cloud City</td> <td>Human</td> <td>Male</td> <td>Rebel Alliance</td> <td>Blaster Pistol</td> <td>Millennium Falcon</td> </tr> </tbody> </table> <h2 id="elephant"><img class="emoji" title=":elephant:" alt=":elephant:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f418.png" height="20" width="20"></h2> <p>First thing’s first: let’s address the <a href="https://en.wikipedia.org/wiki/Elephant_in_the_room">elephant in the requirements</a>:</p> <blockquote> <p>This application can be built in 1 hour.</p> </blockquote> <p>If this is true, then I am a <strong><em>terrible</em></strong> developer.</p> <p>It took me a fair bit longer than that to write working code as-per requirements, debug the requirements (more on that later…), get it deployed somewhere on the internet, and refactor the code to a state where I would be happy to submit it for public consumption and criticism (I was <em>still</em> refactoring it while writing this post).</p> <p>If the intention is for someone to complete as many of the requirements as they can <em>within</em> that fixed 1 hour time frame, with the end result considered through the lens of that artificial constraint, then that should be made explicit.</p> <p>Regardless, I think it would probably be for the best to just remove that line, and allow candidates attempting this test to just focus on submitting their best attempt, and keep <a href="https://en.wikipedia.org/wiki/Impostor_syndrome">imposter syndrome</a> at bay for that little bit longer.</p> <h2 id="general-approach">General Approach</h2> <p>Since the requirements around this application focus on it being a Ruby on Rails application, I decided to go as “vanilla” as possible with Rails.</p> <p>This meant no explicit addition by me of any custom <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript</a>, or any front-end frameworks that use it, to help out with things like filtering or sorting information.</p> <p>I also tried to add the least amount of third-party non-Rails-default gems as possible, only using:</p> <ul> <li> <a href="https://github.com/alassek/activerecord-pg_enum">ActiveRecord::PGEnum</a>, due to its nice developer ergonomics in dealing with <a href="https://www.postgresql.org/docs/current/datatype-enum.html">Postgres Enumerated Types</a> (more about why they were even needed later…)</li> <li> <a href="https://github.com/drapergem/draper">Draper</a> for <a href="https://en.wikipedia.org/wiki/Decorator_pattern">decorators</a>: I really do not like using <a href="https://api.rubyonrails.org/classes/ActionController/Helpers.html">Rails helpers</a> for <a href="https://en.wikipedia.org/wiki/Presentation_logic">presentation logic</a>, preferring instead to keep it attached to the object being rendered; raw data can come from the <a href="https://guides.rubyonrails.org/active_record_basics.html">Rails model</a> class, while transforming that data for display in a <a href="https://guides.rubyonrails.org/action_view_overview.html">Rails view</a> can come from a decorator</li> <li> <a href="https://github.com/kaminari/kaminari">Kaminari</a> for <a href="https://en.wikipedia.org/wiki/Pagination">pagination</a>, as I think it is currently the best gem for it</li> </ul> <h2 id="user-interface">User Interface</h2> <p>Since interface design and making things pretty in general is a weak-point for me, I used this test as an excuse to give <a href="https://tailwindcss.com/">Tailwind CSS</a> a try in order to style everything on the page (I have used <a href="https://tachyons.io/">Tachyons</a> before on other toy projects, so I am generally positive to the <a href="https://tailwindcss.com/docs/utility-first">utility-first CSS</a> concept), as well as use <a href="https://tailwindui.com/">Tailwind UI</a> to (hopefully) grab ready-made code for certain types of components.</p> <p><img src="/assets/images/2021-05-09/screenshot.png" alt="Screenshot"></p> <p>For the most part, this was true for the following parts of the app:</p> <ul> <li>data table</li> <li>upload button</li> <li>search bar</li> <li>pagination widget</li> </ul> <p>But, as would be expected, it was not all quite as simple as <a href="https://en.wikipedia.org/wiki/Plug_and_play">plug and play</a>. Integrating Tailwind into the Kaminari-generated pagination views probably took the most amount of time. But, I got there in the end, and am generally pleased with how it looks for the time spent on it.</p> <p>For the most part, I left any long Tailwind-mnemonic-filled class strings as they were in the Rails view files. However, when those strings became too long, and generally difficult to read, I extracted them into separate <a href="https://sass-lang.com/documentation/syntax">SCSS</a> files using Tailwind’s <a href="https://tailwindcss.com/docs/functions-and-directives#apply"><code class="language-plaintext highlighter-rouge">@apply</code></a> directive (see files under the <a href="https://github.com/paulfioravanti/sentia-coding-test/tree/main/app/javascript/stylesheets"><code class="language-plaintext highlighter-rouge">app/javascript/stylesheets/</code></a> directory). I think I will likely continue to use this kind of strategy in the future with Tailwind class strings.</p> <p>Overall, I am happy to have been able to stand on the Tailwind ecosystem’s shoulders to build out the user interface, and will definitely consider using it again in future projects.</p> <h2 id="data-issues">Data Issues</h2> <p>Turning our gaze towards the provided dataset that the application must be able to import, there is no doubt that the CSV file deliberately contains some corrupt/bad data that you are meant to be able to <a href="https://en.wikipedia.org/wiki/Defensive_programming">program defensively</a> against.</p> <p>My general intentions were to only <em>not</em> import an entry where the requirements specifically said not to (i.e. a person without an affiliation should be skipped), and where the data could not be <em>reasonably</em> <a href="https://en.wikipedia.org/wiki/Data_wrangling">munged</a> into an acceptable format.</p> <div style="margin: auto; text-align: center; width: 90%;"> <figure style="display: block"> <img src="/assets/images/2021-05-09/perhaps-archives-incomplete.jpg" alt="80sfy.com screenshot"> </figure> </div> <h3 id="mis-spellings">Mis-spellings</h3> <p>So, this meant that <code class="language-plaintext highlighter-rouge">Lightsaber~!@@@</code> could just be stripped of non-alphanumeric characters and become a valid <code class="language-plaintext highlighter-rouge">Lightsaber</code> weapon, but there were also issues around mis-spellings in the data, where I needed to give the application more knowledge around what kind of values it could expect to find in the CSV file, and what those values actually <em>should</em> be.</p> <p>This occurred in the form of a <a href="https://ruby-doc.org/core/Hash.html">Hash</a> that maps values known to be found in the CSV file to their correct values:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/services/data_importer/enum_field_parser.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">MISSPELLINGS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Yoda's Hutt"</span> <span class="o">=&gt;</span> <span class="s2">"Yoda's Hut"</span><span class="p">,</span>
  <span class="s2">"Naboo N-1 Starfigher"</span> <span class="o">=&gt;</span> <span class="s2">"Naboo N-1 Starfighter"</span><span class="p">,</span>
  <span class="s2">"Jabba's Sale Barge"</span> <span class="o">=&gt;</span> <span class="s2">"Jabba's Sail Barge"</span><span class="p">,</span>
  <span class="s2">"Tiefighter"</span> <span class="o">=&gt;</span> <span class="s2">"TIE Fighter"</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre></div></div> <p>I am pretty sure that <a href="https://en.wikipedia.org/wiki/Yoda">Yoda</a> does not own a pet <a href="https://en.wikipedia.org/wiki/Jabba_the_Hutt">Jabba</a>, nor is Jabba’s <a href="https://starwars.fandom.com/wiki/Sail_barge">mode of transport</a> a retail outlet.</p> <p>Anyway, it is not possible for me to tell whether the introduction of these mis-spellings was deliberate in order to see if a candidate picked up on them, but I am going to wager that these <em>were</em> actually just typos, and the necessity for this kind of handling was not intentional.</p> <h3 id="value-validity">Value Validity</h3> <p>Under <a href="https://en.wikipedia.org/wiki/C-3PO">C-3PO</a>’s entry, the value for the Vehicle is given as <code class="language-plaintext highlighter-rouge">-1</code>: an obvious ploy to make sure that you do not actually store this value in a Person’s vehicle field.</p> <p>However, if <code class="language-plaintext highlighter-rouge">-1</code> is not a valid entry, it then stands to reason that I cannot trust <em>any</em> of those values in the file, and, therefore, need to give the application advance knowledge on <em>what</em> vehicles it can accept as valid.</p> <p>This meant that for a Person entry, I ended up making <em>every value</em> provided for a non-name-related field an <a href="https://en.wikipedia.org/wiki/Enumerated_type">enumerated type</a>: both in the application, and at the database level.</p> <p>The fact that there was the spelling mistake for Yoda’s location also made me assign enumerated types for the names of Locations and Affiliations. The application really does have too much advance knowledge of the limited scope of valid values it could get from the CSV file, but I did not see any other way around this while still ensuring data correctness.</p> <h3 id="names">Names</h3> <p>The requirements assume that the name values in the CSV file can be split out into <em>first_name</em> and <em>last_name</em>, which, taken at face value, they certainly can.</p> <p>However, this leads to the issue of having a table that looks like this for some values:</p> <table> <thead> <tr> <th>First Name</th> <th>Last Name</th> </tr> </thead> <tbody> <tr> <td>Princess</td> <td>Leia</td> </tr> <tr> <td>Darth</td> <td>Vader</td> </tr> <tr> <td>Kylo</td> <td>Ren</td> </tr> <tr> <td>Jabba</td> <td>The Hutt</td> </tr> </tbody> </table> <p>Some nerds should have looked over this data before it went public because <em><a href="https://knowyourmeme.com/memes/ackchyually">ackchyually</a>…</em></p> <ul> <li>“Princess” is a title, not a name, and “Leia” is <a href="https://en.wikipedia.org/wiki/Princess_Leia">Leia Organa</a>’s first name</li> <li> <a href="https://starwars.fandom.com/wiki/Darth">“Darth” is a title</a>, not a name, and “<a href="https://en.wikipedia.org/wiki/Darth_Vader">Vader</a>” is more like a first name</li> <li>“Ren” is not a last name, but is from <a href="https://starwars.fandom.com/wiki/Knights_of_Ren">Knights of Ren</a>, and <a href="https://en.wikipedia.org/wiki/Kylo_Ren">Kylo Ren</a> used it more like a title once he became the inheritor of Ren’s Knights</li> <li>“The Hutt” is not a last name, but refers to the <a href="https://starwars.fandom.com/wiki/Hutt">Hutt species</a> </li> </ul> <p>So, although not part of the requirements, I figured that this meant the application really needed to deal with the concept of name prefixes (titles etc) and <a href="https://en.wikipedia.org/wiki/Suffix_(name)">suffixes</a> (you may have noticed their inclusion in the screenshot above).</p> <p>Also, for names like Jabba The Hutt and <a href="https://en.wikipedia.org/wiki/Jar_Jar_Binks">Jar Jar Binks</a>, without the application knowing in advance that “The Hutt” is a suffix, it would not be able to tell the which words in either of those names comprise the <em>first_name</em> or <em>last_name</em>.</p> <p>The ability to deal with the name situation was made a bit more straightforward thanks to Ruby 3.0’s <a href="https://docs.ruby-lang.org/en/master/syntax/pattern_matching_rdoc.html">pattern matching</a> capabilities. The <code class="language-plaintext highlighter-rouge">parse_name</code> method below returns an array containing <code class="language-plaintext highlighter-rouge">[prefix, first_name, last_name, suffix]</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/services/data_importer/person_parser.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">name_parts</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">split</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase_first</span><span class="p">)</span>

  <span class="k">case</span> <span class="n">name_parts</span>
  <span class="k">in</span> <span class="p">[</span><span class="nb">name</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="s2">"Darth"</span> <span class="o">|</span> <span class="s2">"Princess"</span> <span class="o">=&gt;</span> <span class="n">prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">]</span>
    <span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="s2">"Ren"</span> <span class="o">=&gt;</span> <span class="n">suffix</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">suffix</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="s2">"The"</span><span class="p">,</span> <span class="s2">"Hutt"</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"The Hutt"</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="n">name_parts</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="n">last_name</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Something like the method above is, of course, doable without pattern matching, but I think the terseness above really helps in understanding how specific data shapes are pin-pointed, and then transformed into the desired output.</p> <h2 id="application-code">Application Code</h2> <p>Having spent more time with <a href="https://en.wikipedia.org/wiki/Functional_programming">functional</a> languages like <a href="https://elixir-lang.org/">Elixir</a> and <a href="https://elm-lang.org/">Elm</a> recently, I definitely found their influence creeping into the way I want to write <a href="https://www.ruby-lang.org/en/">Ruby</a>.</p> <p>I definitely do not consider this a bad thing, nor do I (subjectively) think that the code reads less Ruby/Rails-like as a result (though I have, happily, challenged some Rails conventions). But, let’s have a look at some examples of main the <code class="language-plaintext highlighter-rouge">Person</code>-related controller and model of the application and you can judge for yourself.</p> <h3 id="controller">Controller</h3> <p><strong><code class="language-plaintext highlighter-rouge">app/controllers/people_controller.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PeopleController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@people</span> <span class="o">=</span>
      <span class="no">Person</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:search</span><span class="p">])</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:sort_people</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:paginate_people</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:decorate_people</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">sort_people</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
    <span class="no">PeopleSorter</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">sort_column</span><span class="p">,</span> <span class="n">sort_direction</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_column</span>
    <span class="vi">@sort_column</span> <span class="o">||=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">sort_column</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:sort</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_direction</span>
    <span class="vi">@sort_direction</span> <span class="o">||=</span> <span class="no">SortDirection</span><span class="p">.</span><span class="nf">determine</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:direction</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">paginate_people</span><span class="p">(</span><span class="n">sorted_people</span><span class="p">)</span>
    <span class="no">Paginator</span><span class="p">.</span><span class="nf">paginate_array</span><span class="p">(</span><span class="n">sorted_people</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">decorate_people</span><span class="p">(</span><span class="n">paginated_people</span><span class="p">)</span>
    <span class="no">PersonDecorator</span><span class="p">.</span><span class="nf">decorate_collection</span><span class="p">(</span>
      <span class="n">paginated_people</span><span class="p">,</span>
      <span class="ss">context: </span><span class="p">{</span>
        <span class="ss">sort_column: </span><span class="n">sort_column</span><span class="p">,</span>
        <span class="ss">sort_columns: </span><span class="no">Person</span><span class="p">.</span><span class="nf">sort_columns</span><span class="p">,</span>
        <span class="ss">sort_direction: </span><span class="n">sort_direction</span><span class="p">,</span>
        <span class="ss">params: </span><span class="n">params</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>A few notes about this code:</p> <ul> <li>The code that assigns to the <code class="language-plaintext highlighter-rouge">@people</code> instance variable is written in a style mimicking the <a href="https://elixir-lang.org/getting-started/enumerables-and-streams.html#the-pipe-operator">Elixir pipeline operator</a>, through the use of Ruby’s <a href="https://ruby-doc.org/core/Kernel.html#method-i-then"><code class="language-plaintext highlighter-rouge">Kernel#then</code></a> method (aka <a href="https://ruby-doc.org/core/Kernel.html#method-i-yield_self"><code class="language-plaintext highlighter-rouge">Kernel#yield_self</code></a>). The collection of people that originally gets fetched from the database goes through a series of transformations (filtered via search -&gt; sorted -&gt; paginated -&gt; decorated) before being handed off to the view, so I thought this way of writing the main controller code would indicate that most clearly and explicitly.</li> <li>I would have liked to have had the database do the sorting for me, rather than do it in Ruby-land, but the fact that sorting needed to happen on values contained in a <code class="language-plaintext highlighter-rouge">Person</code>’s associations (locations and affiliations), made it untenable.<br> <strong>UPDATE 3 August 2021</strong> <em>Narrator: <a href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/#update-3-august-2021-ordering-in-the-database">it wasn’t untenable</a></em> </li> <li>I originally had the implementation code for <code class="language-plaintext highlighter-rouge">sort_direction</code> up in the <code class="language-plaintext highlighter-rouge">ApplicationController</code>, since it is not specific to a <code class="language-plaintext highlighter-rouge">Person</code>; putting it there would, I think, be considered Rails convention for code of that nature. But, rather than counting on someone looking at a method call, which has no local definition, and then <em>implicitly knowing</em> that its definition could come from a <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)#Subclasses_and_superclasses">superclass</a>, I decided to extract it into a small, named service module (<code class="language-plaintext highlighter-rouge">SortDirection</code>), so there is an <em>explicit</em> call-out (<code class="language-plaintext highlighter-rouge">SortDirection.determine</code>). I do not generally like using <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">inheritance</a>, and will try and avoid it where I can.</li> <li>I created a small <code class="language-plaintext highlighter-rouge">Paginator</code> service module with the intention of keeping knowledge about <code class="language-plaintext highlighter-rouge">Kaminari</code> restricted to it. Who knows, maybe I might want to change over to something like <a href="https://github.com/mislav/will_paginate">will_paginate</a> one day, and organising the code like this, using the <a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter pattern</a>, will mean no changes will be required in the controller (yes, fine, guilty of <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it">YAGNI</a> since this just a coding test, but I have no regrets…).</li> <li>Both <code class="language-plaintext highlighter-rouge">sort_column</code> and <code class="language-plaintext highlighter-rouge">sort_direction</code> are needed in the view, as well as in the controller. I have seen many codebases use the <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">encapsulation</a>-busting <a href="https://api.rubyonrails.org/classes/AbstractController/Helpers/ClassMethods.html#method-i-helper_method"><code class="language-plaintext highlighter-rouge">helper_method</code></a> method to allow controllers and views to share methods (I even used it in earlier iterations of this code). However, since decorators are being used in this application, this can be avoided by explicitly passing in whatever extra controller information is needed in presentation logic via a <code class="language-plaintext highlighter-rouge">context</code> hash, that is only accessible within the confines of the decorator class.</li> </ul> <h3 id="model">Model</h3> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">PGEnum</span><span class="p">(</span>
    <span class="ss">species: </span><span class="no">Enum</span><span class="o">::</span><span class="no">SPECIES</span><span class="p">,</span>
    <span class="ss">gender: </span><span class="no">Enum</span><span class="o">::</span><span class="no">GENDERS</span><span class="p">,</span>
    <span class="ss">weapon: </span><span class="no">Enum</span><span class="o">::</span><span class="no">WEAPONS</span><span class="p">,</span>
    <span class="ss">vehicle: </span><span class="no">Enum</span><span class="o">::</span><span class="no">VEHICLES</span>
  <span class="p">)</span>

  <span class="n">has_many</span> <span class="ss">:loyalties</span>
  <span class="n">has_many</span> <span class="ss">:affiliations</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">},</span> <span class="ss">through: :loyalties</span>
  <span class="n">has_many</span> <span class="ss">:residences</span>
  <span class="n">has_many</span> <span class="ss">:locations</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">},</span> <span class="ss">through: :residences</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span>
      <span class="n">includes</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">references</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>

    <span class="n">search</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sort_column</span><span class="p">(</span><span class="n">sort_param</span><span class="p">)</span>
    <span class="no">Sort</span><span class="p">.</span><span class="nf">column</span><span class="p">(</span><span class="n">sort_param</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sort_columns</span>
    <span class="no">Sort</span><span class="o">::</span><span class="no">SORT_COLUMNS</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">first_affiliation_name</span>
    <span class="n">affiliations</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">affiliation_names</span>
    <span class="n">affiliations</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">first_location_name</span>
    <span class="n">locations</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">location_names</span>
    <span class="n">locations</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>A few notes about this code:</p> <ul> <li>All methods return data only. Nothing here is responsible for returning formatted strings, or anything else that is meant for display purposes: that is strictly the job of the decorators.</li> <li> <p>For functionality related to things like searching or sorting people, for the basic implementations I have done, it would probably be considered Rails convention to have that code live in <a href="https://api.rubyonrails.org/classes/ActiveSupport/Concern.html">Rails concerns</a>, and <code class="language-plaintext highlighter-rouge">include</code> those modules in the <code class="language-plaintext highlighter-rouge">Person</code> class to make their methods available.<br> Like inheritance, I really do not like using <a href="https://en.wikipedia.org/wiki/Object_composition">composition</a> in this way, as I feel that it is too implicit as well. Perhaps if Ruby had something akin to Elixir’s <a href="https://elixir-lang.org/getting-started/alias-require-and-import.html#import"><code class="language-plaintext highlighter-rouge">Kernel.SpecialForms.import/2</code></a>, where you could explicitly enumerate the methods to import (something like <code class="language-plaintext highlighter-rouge">include Search, only: :search_query</code>), then I would probably be more favourably inclined to them.<br> So, instead, I opted for what I would consider a more Ruby-ish than Rails-ish way of separating the code, through the use of what is apparently called <a href="https://en.wikipedia.org/wiki/Class_(computer_programming)#Partial">partial classes</a> to achieve <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>: essentially, re-opening the <code class="language-plaintext highlighter-rouge">Person</code> class in separate files, and putting code in small <code class="language-plaintext highlighter-rouge">private</code> modules for <code class="language-plaintext highlighter-rouge">Search</code>, and <code class="language-plaintext highlighter-rouge">Sort</code>, and then have the model explicitly call them (eg <code class="language-plaintext highlighter-rouge">Search.query</code>, <code class="language-plaintext highlighter-rouge">Sort.column</code>). For example:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/search.rb</code></strong></p> <div class="language-ruby highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Search</span>
    <span class="no">SEARCH_QUERY</span> <span class="o">=</span>
      <span class="o">&lt;&lt;~</span><span class="no">SQL</span><span class="p">.</span><span class="nf">squish</span><span class="sh">
        prefix ILIKE :search
        OR first_name ILIKE :search
        OR last_name ILIKE :search
        OR suffix ILIKE :search
        OR locations.name::text ILIKE :search
        OR species::text ILIKE :search
        OR gender::text ILIKE :search
        OR affiliations.name::text ILIKE :search
        OR weapon::text ILIKE :search
        OR vehicle::text ILIKE :search
</span><span class="no">      SQL</span>
    <span class="n">private_constant</span> <span class="ss">:SEARCH_QUERY</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>
      <span class="n">query</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="no">SEARCH_QUERY</span><span class="p">,</span> <span class="ss">search: </span><span class="s2">"%</span><span class="si">#{</span><span class="n">search</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Search</span>
<span class="k">end</span>
</code></pre></div> </div> <p>This <code class="language-plaintext highlighter-rouge">module</code> could easily be copy and pasted back into <code class="language-plaintext highlighter-rouge">app/models/person.rb</code>, but having it here “removes the clutter” from the model class itself, while still being encapsulated within it. And yes, <a href="https://ruby-doc.org/core/Module.html#method-i-private_constant"><code class="language-plaintext highlighter-rouge">private_constant</code></a> can be used with a <code class="language-plaintext highlighter-rouge">module</code> to make sure that code like <code class="language-plaintext highlighter-rouge">Person::Search</code> cannot be used outside the <code class="language-plaintext highlighter-rouge">Person</code> class.</p> <p>See the <a href="https://github.com/paulfioravanti/sentia-coding-test/tree/main/app/models/person"><code class="language-plaintext highlighter-rouge">app/models/person/</code></a> directory for the other examples.</p> </li> </ul> <h2 id="conclusion">Conclusion</h2> <p>Although I do think there are areas where the coding test requirements could be improved, particularly in the data set, overall, I am left with an overall positive impression of it since it was the catalyst for me to:</p> <ul> <li>play with Tailwind, which I will definitely use again in the future</li> <li>re-think some of the ways I have been writing Rails controller and model code</li> <li>generally learn me some new things</li> </ul> <p>So, if you are looking to up your coding game whilst padding your online portfolio, I can definitely recommend using coding tests as a way to do so!</p> <h2 id="update-3-august-2021-ordering-in-the-database">UPDATE 3 August 2021: Ordering in the Database</h2> <p>My friend <a href="https://twitter.com/aarondeadman">Aaron</a> left <a href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/#comment-5454123121">a comment</a> asking about my statement concerning ordering on associated records:</p> <blockquote> <p>“the fact that sorting needed to happen on values contained in a Person’s associations (locations and affiliations) made it [sorting using the database] untenable.”</p> <p><strong>Is this a limitation of ActiveRecord? It seems like Postgres should be able to handle this but I might be missing some of the nuance.</strong></p> </blockquote> <p>My rationale for not being able to sort the list of <code class="language-plaintext highlighter-rouge">Person</code> records based on values in their associations was that those values were essentially <em>unknowable</em> to the <code class="language-plaintext highlighter-rouge">Person</code> query: it would only be <em>after</em> its associations were fetched from the database that we would be able to loop over them, using Ruby in this case, to find out the exact values of the first affiliation and location names.</p> <p>But, was this rationale correct? I could not help myself, so I took the bait and dove down this rabbit hole to find out. First, though, a minor detour down a separate, but slightly shallower, rabbit hole.</p> <h3 id="ordering-was-broken-anyway">Ordering was broken anyway</h3> <p>On re-opening this codebase, I realised that in my haste to be done with it, I had failed to notice that the location and affiliation names were not <em>always</em> displaying in alphabetical order as expected.</p> <p>There did not seem to be an obvious reason as to why…until I went for a dive in Rails’ Github repo, where it became apparent that there is a <a href="https://github.com/rails/rails/issues/6769">very long-running issue</a> regarding ordering clauses on <code class="language-plaintext highlighter-rouge">has_many</code> relationships being ignored or lost when using an <a href="https://api.rubyonrails.org/classes/ActiveRecord/QueryMethods.html#method-i-includes"><code class="language-plaintext highlighter-rouge">includes</code></a> statement, which I definitely was in the <code class="language-plaintext highlighter-rouge">Person.search</code> method.</p> <p>Using <code class="language-plaintext highlighter-rouge">includes</code> would seem to <a href="https://stackoverflow.com/a/11947303/567863">delegate your query generation strategy to Rails itself</a> (ie let Rails decide whether to load association data in a separate query, or in one big join-based query), which is a probably a good rule-of-thumb, because who could just instinctively know that? (Not me). Anyway, it would seem that this ordering issue would require some manual intervention.</p> <p>Figuring out <a href="https://blog.arkency.com/2013/12/rails4-preloading/">which flavour of association preloading</a> would not cause an error, give me the output I expected, and not cause any N+1 issues, was mostly trial and error. I finally got to <a href="https://api.rubyonrails.org/classes/ActiveRecord/QueryMethods.html#method-i-preload"><code class="language-plaintext highlighter-rouge">preload</code></a>, and my house of cards gained a bit of stability with the following change:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">preload</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>
    <span class="n">search</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Great! Side quest over, and we are back to zero! Time to get back to the main mission!</p> <h3 id="lateral-support">Lateral Support</h3> <p>So, can <a href="https://www.postgresql.org/">Postgres</a> do something akin to what we have done with the current Ruby-based sorting code and essentially <a href="https://heap.io/blog/postgresqls-powerful-new-join-type-lateral">“loop over each entry in a result set and evaluate a subquery using that row as a parameter”</a>?</p> <p>It certainly can: with <a href="https://www.postgresql.org/docs/13/queries-table-expressions.html#QUERIES-LATERAL"><code class="language-plaintext highlighter-rouge">LATERAL</code> subqueries</a>, introduced back in Postgres version 9.3, so it seems like I have not been keeping up to date with improvements in the database world! Anyway, let’s see how we can leverage it to push more query logic out of Ruby-land and into database-land.</p> <h4 id="add-attributes">Add <code class="language-plaintext highlighter-rouge">attribute</code>s</h4> <p>First, though, since we are now planning for the database to give us a <code class="language-plaintext highlighter-rouge">Person</code>’s <code class="language-plaintext highlighter-rouge">first_affiliation_name</code> and <code class="language-plaintext highlighter-rouge">first_location_name</code>, we will be able to treat them just like any of <code class="language-plaintext highlighter-rouge">Person</code>’s other fields. Therefore, let’s add some virtual <a href="https://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute"><code class="language-plaintext highlighter-rouge">attribute</code></a>s to the <code class="language-plaintext highlighter-rouge">Person</code> model to hold that information for when we receive it, and remove the original <code class="language-plaintext highlighter-rouge">first_x_name</code> methods:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="n">attribute</span> <span class="ss">:first_affiliation_name</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:first_location_name</span><span class="p">,</span> <span class="ss">:string</span>
<span class="k">end</span>
</code></pre></div></div> <h4 id="create-association-queries">Create association queries</h4> <p>Now, let’s create some queries that intend to populate those <code class="language-plaintext highlighter-rouge">attribute</code>s. Since both the queries will be similar in nature, let’s give them the same name on each model: <code class="language-plaintext highlighter-rouge">Affiliation.first_name</code> and <code class="language-plaintext highlighter-rouge">Location.first_name</code>. We will start with the <code class="language-plaintext highlighter-rouge">Affiliation</code> query, build it out, and then replicate the logic across to the <code class="language-plaintext highlighter-rouge">Location</code> query.</p> <p>For the first affiliation name of any given person, we want to:</p> <ul> <li>join the people table on the given person’s ID</li> <li>order the affiliations by their name</li> <li>limit the number of affiliations to 1 to get only the first one</li> <li>select only that affiliation’s name</li> </ul> <p>Here is what a first cut of that method might look like:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/affiliation.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Affiliation</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:people</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"people.id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Let’s give it a try in a Rails console with a <code class="language-plaintext highlighter-rouge">Person</code> whom we know has multiple affiliations, Leia Organa:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">first_name: </span><span class="s2">"Leia"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Person:0x00007fd427581bc0</span>
<span class="o">...</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span><span class="p">(</span><span class="nb">p</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="c1">#&lt;Affiliation:0x00007fd3f70afcf8 id: nil, name: "Galactic Republic"&gt;]</span>
</code></pre></div></div> <p>Okay, this looks like the correct information is at least being returned and populated, so it is a good start.</p> <p>The problem now is that we cannot use this method as-is moving forward: the database is not going to be able to execute this Ruby-land method, passing in an <code class="language-plaintext highlighter-rouge">id</code> parameter. We need to have the database fill it in during the course of a lateral join (which will make it <em>unknowable</em> to Ruby). Also, since the join is over a <code class="language-plaintext highlighter-rouge">has_many :through</code> relationship, we will have to change the <code class="language-plaintext highlighter-rouge">joins</code> target to be the join-table (in this case <code class="language-plaintext highlighter-rouge">loyalties</code>).</p> <p>Here is how the method will need to change:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/affiliation.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Affiliation</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:loyalties</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"loyalties.person_id = people.id"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">Affiliation.first_name</code> method can now <em>not</em> be run in isolation in Ruby-land, as there is no context on where <code class="language-plaintext highlighter-rouge">people.id</code> comes from:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span>
<span class="p">(</span><span class="no">Object</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">support</span> <span class="c1">#inspect)</span>
<span class="o">=&gt;</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">people.id</code> essentially stands in for a database-land local loop variable that will be “passed in” from some other (as-yet unknown) outer query that will laterally join with it, and provide the context for a <code class="language-plaintext highlighter-rouge">people</code> table.</p> <p>The query in <code class="language-plaintext highlighter-rouge">Location</code> will change in a similar way:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Location</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:residences</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"residences.person_id = people.id"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h4 id="lateral-joining">Lateral Joining</h4> <p>Now that we have our association subqueries created, let’s see how the <code class="language-plaintext highlighter-rouge">Person.search</code> code will change when it uses them:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span>
      <span class="n">preload</span><span class="p">(</span><span class="ss">:affiliations</span><span class="p">,</span> <span class="ss">:locations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Lateral</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:join_first_association_names</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="n">column</span> <span class="o">=&gt;</span> <span class="n">direction</span><span class="p">,</span> <span class="no">Sort</span><span class="o">::</span><span class="no">DEFAULT_SORT_COLUMN</span> <span class="o">=&gt;</span> <span class="n">direction</span><span class="p">)</span>

      <span class="n">search</span><span class="p">.</span><span class="nf">present?</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>After the <code class="language-plaintext highlighter-rouge">:affiliations</code> and <code class="language-plaintext highlighter-rouge">:locations</code> have been <code class="language-plaintext highlighter-rouge">preload</code>ed, the query is piped into a new method, <code class="language-plaintext highlighter-rouge">join_first_association_names</code>, inside of a new <code class="language-plaintext highlighter-rouge">Lateral</code> module (naming things is hard…) that is <code class="language-plaintext highlighter-rouge">private</code> to the <code class="language-plaintext highlighter-rouge">Person</code> model:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/lateral.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Lateral</span>
    <span class="no">FIRST_ASSOCIATION_NAME</span> <span class="o">=</span>
      <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">query</span><span class="p">,</span> <span class="n">table_alias</span><span class="p">,</span> <span class="n">field</span><span class="o">|</span>
        <span class="o">&lt;&lt;~</span><span class="no">SQL</span><span class="p">.</span><span class="nf">squish</span><span class="sh">
          JOIN LATERAL (</span><span class="si">#{</span><span class="n">query</span><span class="p">.</span><span class="nf">to_sql</span><span class="si">}</span><span class="sh">)
          AS </span><span class="si">#{</span><span class="n">table_alias</span><span class="si">}</span><span class="sh">(</span><span class="si">#{</span><span class="n">field</span><span class="si">}</span><span class="sh">)
          ON true
</span><span class="no">        SQL</span>
      <span class="k">end</span>
    <span class="n">private_constant</span> <span class="ss">:FIRST_ASSOCIATION_NAME</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">join_first_association_names</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="n">query</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="n">first_affiliation_name</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="n">first_location_name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="nb">private_class_method</span> <span class="k">def</span> <span class="nf">first_affiliation_name</span>
      <span class="no">FIRST_ASSOCIATION_NAME</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
        <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span><span class="p">,</span>
        <span class="ss">:affiliation</span><span class="p">,</span>
        <span class="ss">:first_affiliation_name</span>
      <span class="p">)</span>
    <span class="k">end</span>

    <span class="nb">private_class_method</span> <span class="k">def</span> <span class="nf">first_location_name</span>
      <span class="no">FIRST_ASSOCIATION_NAME</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
        <span class="no">Location</span><span class="p">.</span><span class="nf">first_name</span><span class="p">,</span>
        <span class="ss">:location</span><span class="p">,</span>
        <span class="ss">:first_location_name</span>
      <span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Lateral</span>
<span class="k">end</span>
</code></pre></div></div> <p>There is currently no nice ActiveRecord database-agnostic API that wraps around lateral joins, so we need to resort to direct string interpolation in the <code class="language-plaintext highlighter-rouge">FIRST_ASSOCIATION_NAME</code> lambda, which generates the lateral join subquery. It does the following:</p> <ul> <li>Converts the <code class="language-plaintext highlighter-rouge">first_name</code> association queries we built earlier into SQL statements and marks it as the target for the lateral join</li> <li>Specifies the field name that the result of the query should be returned as. In this case, they have been named the same as the <code class="language-plaintext highlighter-rouge">attribute</code>s in the <code class="language-plaintext highlighter-rouge">Person</code> model where that information is intended to be stored: <code class="language-plaintext highlighter-rouge">first_affiliation_name</code> and <code class="language-plaintext highlighter-rouge">first_location_name</code> </li> <li>Specifies a <a href="https://www.postgresql.org/docs/current/rowtypes.html#ROWTYPES-USAGE">table alias</a>, needed by the join to extract the returned <code class="language-plaintext highlighter-rouge">first_x_name</code> (otherwise it looks like the <a href="https://stackoverflow.com/q/67047907/567863">“lateral join is returning a value with parenthesis”</a>). The names given in the methods for the <code class="language-plaintext highlighter-rouge">table_alias</code> parameter have no special meaning. They could have been named <code class="language-plaintext highlighter-rouge">t1</code> and <code class="language-plaintext highlighter-rouge">t2</code>: they just need to be unique</li> <li>Indicates via the <code class="language-plaintext highlighter-rouge">ON true</code> clause that there is no filtering condition, and that the full result of the lateral join should be returned, which in this case is only that single name value.</li> </ul> <h4 id="fixing-search">Fixing Search</h4> <p>The final major change that now needs to happen to make everything work as expected is to update the <code class="language-plaintext highlighter-rouge">Search.query</code> method in the <code class="language-plaintext highlighter-rouge">Person</code> class with a <code class="language-plaintext highlighter-rouge">joins</code> and <code class="language-plaintext highlighter-rouge">group</code> clause, so that it can still perform searches on associated data, and is aware of the <code class="language-plaintext highlighter-rouge">Person</code>’s new <code class="language-plaintext highlighter-rouge">attribute</code>s:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/search.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Search</span>
    <span class="no">SEARCH_QUERY</span> <span class="o">=</span>
      <span class="c1"># ...</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>
      <span class="n">query</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="ss">:affiliations</span><span class="p">,</span> <span class="ss">:locations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="no">SEARCH_QUERY</span><span class="p">,</span> <span class="ss">search: </span><span class="s2">"%</span><span class="si">#{</span><span class="n">search</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:first_affiliation_name</span><span class="p">,</span> <span class="ss">:first_location_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Search</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="code-clean-up">Code Clean Up</h3> <p>Now that the database is doing the heavy lifting on ordering associations, a swath of related Ruby code can now be confidently deleted:</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">PeopleSorter</code> module now has no reason to exist, so it can be removed</li> <li>Since we are now paginating a <code class="language-plaintext highlighter-rouge">Person::ActiveRecord_Relation</code> now, rather than an array that got returned by the <code class="language-plaintext highlighter-rouge">PeopleSorter</code>, the <code class="language-plaintext highlighter-rouge">Paginator</code> module that was created to wrap around the <code class="language-plaintext highlighter-rouge">Kaminari.paginate_array</code> method, can also be removed</li> </ul> <p>These two changes have now reduced the <code class="language-plaintext highlighter-rouge">index</code> code in the <code class="language-plaintext highlighter-rouge">PeopleController</code> to be just:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/controllers/people_controller.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PeopleController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@people</span> <span class="o">=</span>
      <span class="no">Person</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:search</span><span class="p">],</span> <span class="n">sort_column</span><span class="p">,</span> <span class="n">sort_direction</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">page</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">])</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:decorate_people</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p>Less code, less to maintain! All these changes have been pushed up to the <a href="https://github.com/paulfioravanti/sentia-coding-test">Sentia Coding Test codebase</a>, so feel free to have a browse or run the code for yourself.</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/coding-test" class="page__taxonomy-item" rel="tag">coding-test</a><span class="sep">, </span> <a href="/tags/data-parsing" class="page__taxonomy-item" rel="tag">data-parsing</a><span class="sep">, </span> <a href="/tags/draper" class="page__taxonomy-item" rel="tag">draper</a><span class="sep">, </span> <a href="/tags/enum" class="page__taxonomy-item" rel="tag">enum</a><span class="sep">, </span> <a href="/tags/kaminari" class="page__taxonomy-item" rel="tag">kaminari</a><span class="sep">, </span> <a href="/tags/lateral-join" class="page__taxonomy-item" rel="tag">lateral-join</a><span class="sep">, </span> <a href="/tags/pattern-matching" class="page__taxonomy-item" rel="tag">pattern-matching</a><span class="sep">, </span> <a href="/tags/preloading" class="page__taxonomy-item" rel="tag">preloading</a><span class="sep">, </span> <a href="/tags/rails" class="page__taxonomy-item" rel="tag">rails</a><span class="sep">, </span> <a href="/tags/ruby" class="page__taxonomy-item" rel="tag">ruby</a><span class="sep">, </span> <a href="/tags/star-wars" class="page__taxonomy-item" rel="tag">star-wars</a><span class="sep">, </span> <a href="/tags/tachyons" class="page__taxonomy-item" rel="tag">tachyons</a><span class="sep">, </span> <a href="/tags/tailwind" class="page__taxonomy-item" rel="tag">tailwind</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2023-07-24">July 24, 2023</time></p> </footer> <section class="page__share"> <h4 class="page__share-title">Share on</h4> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Coding+Test+Review%3A+Sentia%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcoding-test-review-sentia%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcoding-test-review-sentia%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcoding-test-review-sentia%2F&amp;title=Coding%20Test%20Review:%20Sentia" class="btn btn--reddit" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcoding-test-review-sentia%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/elmsthetics/" class="pagination--pager" title="░▒▓ＥＬＭＳＴＨＥＴＩＣＳ▓▒░ ">Previous</a> <a href="/blog/going-platinum/" class="pagination--pager" title="Going Platinum ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Leave a comment</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You may also enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-04-28/obama-medal.jpg" alt="Obama gives medal to himself meme"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/thanks-past-me/" rel="permalink">Thanks, Past-Me </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-04-28T15:30:00+10:00">April 28, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 19 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">Past-me wrote stuff down that benefited future-me. Present-me needs to keep paying that forward. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-07-05/sliced-apples.jpg" alt="Sliced red apples on a wooden board"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/sharing-applescript-handlers/" rel="permalink">Sharing AppleScript Handlers </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-07-05T08:30:00+10:00">July 5, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 6 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Navigating AppleScript’s awkward handshakes between files. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-07-03/working-late.jpg" alt="On the beers, working late in a hotel room"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/welcome-back-overwork/" rel="permalink">“Welcome back” </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-07-03T12:50:00+10:00">July 3, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 5 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">A short story of overwork from the software trenches of Tokyo. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-06-25/menu-with-furigana.jpg" alt="大和田鮨"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/flexbox-furigana/" rel="permalink">Flexbox Furigana </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-06-25T10:30:00+10:00">June 25, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 18 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Styling kanji readings is a big subject for such small text. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><strong>Follow:</strong></li> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2023 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q173829KF7"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q173829KF7",{anonymize_ip:!1});</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/coding-test-review-sentia/",this.page.identifier="/blog/coding-test-review-sentia"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>