<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Creating Plover Plugins with Python | Floor and Varnish</title> <meta name="description" content="Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Creating Plover Plugins with Python"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/creating-plover-plugins-python/"> <meta property="og:description" content="Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2024-02-04/doc-brown-cable-connect.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Creating Plover Plugins with Python"> <meta name="twitter:description" content="Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/creating-plover-plugins-python/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2024-02-04/doc-brown-cable-connect.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2024-02-04T21:35:00+11:00"> <meta property="article:modified_time" content="2024-02-08T15:18:00+11:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/creating-plover-plugins-python/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url('/assets/images/2024-02-04/doc-brown-cable-connect.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Creating Plover Plugins with Python </h1> <p class="page__lead">Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-02-04T21:35:00+11:00">February 4, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 39 minute read </span> </p> </div> <span class="page__hero-caption">Universal </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://instagram.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/@paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Creating Plover Plugins with Python"> <meta itemprop="description" content="Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes."> <meta itemprop="datePublished" content="2024-02-04T21:35:00+11:00"> <meta itemprop="dateModified" content="2024-02-08T15:18:00+11:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p><a href="https://www.openstenoproject.org/">Plover</a> stenography enables anyone to write text and perform <a href="https://en.wikipedia.org/wiki/Keyboard_shortcut">keyboard shortcuts</a> faster than they could on a traditional keyboard. Its open system architecture also allows you to tap into many of its core functionalities, expanding the possibilities of what you can do with steno, limited only by your imagination!</p> <p>It does this through the use of <a href="https://plover.readthedocs.io/en/latest/plugins.html">plugins</a>, created with <a href="https://www.python.org/">Python</a>, the programming language in which <a href="https://github.com/openstenoproject/plover">Plover itself</a> is written. There are a <a href="https://plover.readthedocs.io/en/latest/plugins.html#types-of-plugins">eight different types of plugins</a> that Plover currently supports, but this post will focus on three specific plugin types that can allow us to use Python to perform some kind of task:</p> <ul> <li> <a href="https://plover.readthedocs.io/en/latest/plugin-dev/commands.html">Commands</a> (<em>Our task: open a <a href="https://en.wikipedia.org/wiki/URL">URL</a> in a web browser</em>)</li> <li> <a href="https://plover.readthedocs.io/en/latest/plugin-dev/metas.html">Metas</a> (<em>Our task: output a random number between 1 and 10</em>)</li> <li> <a href="https://plover.readthedocs.io/en/latest/plugin-dev/extensions.html">Extensions</a> (<em>Our task: output, and keep a <a href="https://en.wikipedia.org/wiki/Cache_(computing)">cache</a> of, values contained in computer <a href="https://en.wikipedia.org/wiki/Environment_variable">environment variables</a></em>)</li> </ul> <p>One of the best things about creating plugins is being able to share them with fellow Plover users, so we will also go through the steps get them to appear inside everyone’s <a href="https://docs.stenokeyboards.com/customize/plover-plugins.html#plugins-manager">Plover Plugin Manager</a>.</p> <p>The final result will be the following codebase: <a href="https://github.com/paulfioravanti/plover-practice-plugin">Plover Practice Plugin</a>.</p> <p>Basically, this post is intended to be the Plover plugin development guide I wish existed when I first started, and hopefully it can be of some reference if you decide to build your own plugins. It is long, and fairly technical in nature, so a basic knowledge of Python or computer programming (or a desire to learn!), is recommended in order to follow along.</p> <h2 id="python-environment">Python Environment</h2> <p>Since we are building something that is meant to run inside Plover’s environment, in order to avoid any unexpected errors during development, we need to make sure the code we write is compatible with it.</p> <p>As of this writing, when you <a href="https://github.com/openstenoproject/plover/releases/latest">download the Plover application</a>, it comes bundled with Python version 3.9<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>. Therefore, in order to ensure maximum compatibility with Plover, a good choice would be to set your local Python version to use the latest <a href="https://en.wikipedia.org/wiki/Software_versioning#Semantic_versioning">patch version</a> of Python 3.9, which is currently <a href="https://www.python.org/downloads/release/python-3918/">Python 3.9.18</a><sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>.</p> <p>In order to change your Python version, I would recommend installing a <a href="https://github.com/bernardoduarte/awesome-version-managers?tab=readme-ov-file#python">version manager</a>. This will enable you to easily use Plover’s Python version while developing the plugin, but use the latest (or any other) Python version with other projects.</p> <p><a href="https://github.com/pyenv/pyenv">pyenv</a> would seem to be the most popular Python-specific choice, but I personally use <a href="https://github.com/asdf-vm/asdf">asdf</a> (<a href="https://asdf-vm.com/guide/getting-started.html">Getting Started documentation</a>, <a href="https://github.com/asdf-community/asdf-python">Python plugin</a>) as my one version manager to rule all programming languages<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>.</p> <p>When you have chosen, installed, and set up a version manager to work with Python (this may take a bit of time, but you will only do it once, and it is worth doing right), you will be ready to fire up your text editor and move on to some coding.</p> <h2 id="setup-plugin-project">Setup Plugin Project</h2> <p>We are going to create a plugin project called “Plover Practice Plugin”, using the <a href="https://plover.readthedocs.io/en/latest/plugin-dev/setup.html#initial-setup">Initial Setup</a> directions in the official <a href="https://plover.readthedocs.io/en/latest/plugins.html">Plover Plugin Guide</a> as our main reference.</p> <p>Create a directory on your computer called <code class="language-plaintext highlighter-rouge">plover-practice-plugin</code><sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>, and then add the following files underneath it (we will use a <a href="https://plover.readthedocs.io/en/latest/plugin-dev/setup.html#package-based-structure">package-based structure</a> for the files<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote" rel="footnote">5</a></sup>):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover-practice-plugin/
|-- plover_practice_plugin/
|   '-- __init__.py
|-- README.md
|-- setup.cfg
|-- setup.py
</span></code></pre></div></div> <p>The <a href="https://docs.python.org/3/reference/import.html#regular-packages"><code class="language-plaintext highlighter-rouge">__init__.py</code></a> file is blank, but it needs to be present within the <code class="language-plaintext highlighter-rouge">plover_practice_plugin</code> directory so we can use it like a <a href="https://docs.python.org/3/glossary.html#term-regular-package">regular package</a>.</p> <p><code class="language-plaintext highlighter-rouge">README.md</code> is a <a href="https://daringfireball.net/projects/markdown/">Markdown</a> document containing information about the plugin. We will get the Plover Plugin Manager to read in information from here and display it. For now, just give it the bare minimum of a simple heading:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/README.md</code></strong></p> <div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Plover Practice Plugin</span>
</code></pre></div></div> <p>The <a href="https://setuptools.pypa.io/en/latest/userguide/declarative_config.html"><code class="language-plaintext highlighter-rouge">setup.cfg</code></a> configuration file is used by <a href="https://setuptools.pypa.io/en/latest/index.html">Setuptools</a>, the packaging library that Plover’s plugin system is built on top of. It defines a package’s <a href="https://setuptools.pypa.io/en/latest/userguide/declarative_config.html#metadata">metadata</a>, including external library dependencies (which, in our case, include Plover itself). For now, we will specify just enough for our needs during development:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[metadata]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">plover_practice_plugin</span>
<span class="py">description</span> <span class="p">=</span> <span class="s">Plover practice plugin</span>
<span class="py">long_description</span> <span class="p">=</span> <span class="s">file: README.md</span>
<span class="py">long_description_content_type</span> <span class="p">=</span> <span class="s">text/markdown</span>
<span class="py">keywords</span> <span class="p">=</span> <span class="s">plover plover_plugin</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">0.0.1</span>

<span class="nn">[options]</span>
<span class="py">zip_safe</span> <span class="p">=</span> <span class="s">True</span>
<span class="py">install_requires</span> <span class="p">=</span>
    <span class="err">plover&gt;=4.0.0.dev12</span>
<span class="py">setup_requires</span> <span class="p">=</span>
    <span class="err">setuptools&gt;=69.0.0</span>
<span class="py">packages</span> <span class="p">=</span>
    <span class="err">plover_practice_plugin</span>

<span class="nn">[options.entry_points]</span>
</code></pre></div></div> <p>The final heading above refers to Setuptools’ concept of <a href="https://setuptools.pypa.io/en/latest/userguide/entry_point.html">entry points</a>, that “allow a package to open its functionalities for customization via plugins”. Many of Plover’s core functionalities are, themselves, <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/setup.cfg#L56">exposed as entry points</a>, and we will hook into them when we develop our own plugin types, and specify entry points for them under the <code class="language-plaintext highlighter-rouge">[options.entry_points]</code> heading.</p> <p>Finally, Plover needs a minimal <a href="https://packaging.python.org/en/latest/glossary/#term-setup.py"><code class="language-plaintext highlighter-rouge">setup.py</code></a> file in order to help read in the configuration we have in <code class="language-plaintext highlighter-rouge">setup.cfg</code>, run Setuptools for us when our plugin is installed, and consequently allow the plugin to be included properly in the Plugins Manager<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote" rel="footnote">6</a></sup>:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="n">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="nf">setup</span><span class="p">()</span>
</code></pre></div></div> <h3 id="initialise-git-repository">Initialise Git Repository</h3> <p>Initial setup is now complete, so this is probably a good time to put this project under version control with <a href="https://git-scm.com/">Git</a>. Once you have <a href="https://git-scm.com/downloads">installed</a> it, create a <code class="language-plaintext highlighter-rouge">.gitignore</code> file in the project to make sure no Python-generated files, or any other computer cruft, finds its way into your repository:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/.gitignore</code></strong></p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>Byte-compiled / optimized / DLL files
<span class="go">__pycache__/

</span><span class="gp">#</span><span class="w"> </span>Distribution / packaging
<span class="go">*.egg-info/
build/
dist/

</span><span class="gp">#</span><span class="w"> </span>macOS-specific
<span class="go">.DS_Store

</span><span class="gp">#</span><span class="w"> </span>Language versioning
<span class="go">.tool-versions
</span></code></pre></div></div> <blockquote> <p>Depending on your operating system, there may be other files you may wish to ignore and not track, so feel free to customise this list as needed.</p> </blockquote> <p>Then, run the following commands on your <a href="https://en.wikipedia.org/wiki/Terminal_emulator">terminal</a> of choice (or within your text editor, or however you like to use Git) inside the project directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git init
git add .
git commit --message="Initial commit"
</span></code></pre></div></div> <blockquote> <p>Since this code will eventually find its way to <a href="https://github.com/">GitHub</a>, it is definitely worth familarising yourself with some of the core commands of Git itself (if you are not already). Check out the <a href="https://git-scm.com/docs">Git reference documentation</a> when you come across an unfamiliar command.</p> </blockquote> <p>Okay, we are now ready to start coding our first plugin!</p> <h2 id="command-plugin">Command Plugin</h2> <p><a href="https://plover.readthedocs.io/en/latest/plugin-dev/commands.html">Commands</a> are “<a href="https://en.wiktionary.org/wiki/fire_and_forget">fire and forget</a>” functions that do not output any text, nor return any value. They enable you to:</p> <ul> <li>Interact with Plover to perform an action that is not possible, or easily doable, via its user interface<sup id="fnref:7" role="doc-noteref"><a href="#fn:7" class="footnote" rel="footnote">7</a></sup> </li> <li>Leverage Python to perform some action</li> </ul> <p>We are going to build a command plugin that opens a given <a href="https://en.wikipedia.org/wiki/URL">URL</a> in your default web browser, in the style of the <a href="https://github.com/nsmarkop/plover_open_url">Plover Open URL</a> plugin.</p> <p>In dictionary entries, the command will look like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"{:COMMAND:OPEN_URL:https://www.openstenoproject.org/}"</span><span class="w">
</span></code></pre></div></div> <p>Within curly parentheses, and separated by colons, we define the following:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">COMMAND</code> - The keyword that tells Plover the outline is a command<sup id="fnref:8" role="doc-noteref"><a href="#fn:8" class="footnote" rel="footnote">8</a></sup> </li> <li> <code class="language-plaintext highlighter-rouge">OPEN_URL</code> - The name of the command function to run</li> <li> <code class="language-plaintext highlighter-rouge">https://www.openstenoproject.org/</code> - The argument to pass to the command function. In this case, it is the <a href="https://www.openstenoproject.org/">Open Steno Project</a> URL we want to open, but we should be able to give the same command in other dictionary entries any URL we would like</li> </ul> <p>Now we know what the command should look like, we need to tell Plover where to find it when we invoke it. So, let’s add our first entry point to the <code class="language-plaintext highlighter-rouge">setup.cfg</code> file under the <code class="language-plaintext highlighter-rouge">[options.entry_points]</code> heading:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ...
</span><span class="nn">[options.entry_points]</span>
<span class="py">plover.command</span> <span class="p">=</span>
    <span class="c"># "{:COMMAND:OPEN_URL:https://www.openstenoproject.org/}"
</span>    <span class="py">open_url</span> <span class="p">=</span> <span class="s">plover_practice_plugin.command:open_url</span>
</code></pre></div></div> <p>This entry is saying:</p> <ul> <li>We are defining a command (<code class="language-plaintext highlighter-rouge">plover.command</code>)</li> <li>It is called <code class="language-plaintext highlighter-rouge">open_url</code> (<code class="language-plaintext highlighter-rouge">OPEN_URL</code> in the outline maps directly to this<sup id="fnref:9" role="doc-noteref"><a href="#fn:9" class="footnote" rel="footnote">9</a></sup>)</li> <li>It links to a function called <code class="language-plaintext highlighter-rouge">open_url</code>, which is found in a module called <code class="language-plaintext highlighter-rouge">command</code> within the <code class="language-plaintext highlighter-rouge">plover_practice_plugin</code> package<sup id="fnref:10" role="doc-noteref"><a href="#fn:10" class="footnote" rel="footnote">10</a></sup> </li> </ul> <p>We have not created the <code class="language-plaintext highlighter-rouge">open_url</code> function yet, so let’s do that now in a new <code class="language-plaintext highlighter-rouge">command.py</code> module file:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/command.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">webbrowser</span>

<span class="k">def</span> <span class="nf">open_url</span><span class="p">(</span><span class="n">_engine</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
    <span class="n">webbrowser</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
</code></pre></div></div> <p>Command functions are implemented as receiving two parameters:</p> <ul> <li>a <a href="https://plover.readthedocs.io/en/latest/api/engine.html">StenoEngine</a> <code class="language-plaintext highlighter-rouge">engine</code>, which is provided automatically by Plover. We have marked it with an underscore to signal that we are ignoring it, since we do not need it to open URLs</li> <li>an optional <code class="language-plaintext highlighter-rouge">argument</code>, which in this case contains the URL string that gets specified in the command outline</li> </ul> <p>We leverage Python’s <a href="https://docs.python.org/3/library/webbrowser.html"><code class="language-plaintext highlighter-rouge">webbrowser</code></a> library to do all the browser-related heavy lifting, and simply pass the URL <code class="language-plaintext highlighter-rouge">argument</code> to its <a href="https://docs.python.org/3/library/webbrowser.html#webbrowser.open"><code class="language-plaintext highlighter-rouge">open</code></a> function, effectively creating a <a href="https://en.wikipedia.org/wiki/Wrapper_function">wrapper function</a> around it.</p> <p>Now that our first plugin is complete, let’s deploy it to Plover! Open your terminal, and from inside your project directory, run the following command<sup id="fnref:11" role="doc-noteref"><a href="#fn:11" class="footnote" rel="footnote">11</a></sup>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <blockquote> <p>The <code class="language-plaintext highlighter-rouge">plover</code> command will likely error out for you if you are running it for the first time. Follow the instructions in the <a href="https://github.com/openstenoproject/plover/wiki/Invoke-Plover-from-the-command-line">Invoke Plover from the command line</a> wiki page for your operating system to get it working<sup id="fnref:12" role="doc-noteref"><a href="#fn:12" class="footnote" rel="footnote">12</a></sup>.</p> </blockquote> <p>You should see output that looks something like the following:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>plover <span class="nt">--script</span> plover_plugins <span class="nb">install</span> <span class="nt">--editable</span> <span class="nb">.</span>
<span class="go">Obtaining file:///path/to/plover-practice-plugin
  Preparing metadata (setup.py) ... done
</span><span class="gp">Requirement already satisfied: plover&gt;</span><span class="o">=</span>4.0.0.dev12 <span class="k">in</span> ...
<span class="c">...
</span><span class="go">Installing collected packages: plover-practice-plugin
  Running setup.py develop for plover-practice-plugin
Successfully installed plover-practice-plugin
</span></code></pre></div></div> <p>Now, restart your Plover application, open the Plugins Manager, and you should see the Practice Plugin in the list.</p> <div class="centered-image" style="width: 80%;"> <figure> <img src="/assets/images/2024-02-04/practice-plugin-installed.jpg" style="margin-bottom: 0;" alt="Plover Plugins Manager showing the newly-installed Practice Plugin"> <figcaption> Practice Plugin installed and ready to go! </figcaption> </figure> </div> <p>Great! Now, let’s test it out! Create a temporary entry in one of your steno dictionaries that looks something like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"*URL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{:COMMAND:OPEN_URL:https://www.openstenoproject.org/}"</span><span class="w">
</span></code></pre></div></div> <blockquote> <p>I have overridden Plover’s <code class="language-plaintext highlighter-rouge">*URL</code> outline here, but use whatever outline you would like.</p> </blockquote> <p>Now, try chording the outline with your keyboard, and your default web browser should open to the <a href="https://www.openstenoproject.org/">Open Steno Project</a> page!</p> <p>Want to see if it works for other web pages? We can use the <code class="language-plaintext highlighter-rouge">plover</code> command to to do just that, without needing to add another dictionary entry, by <a href="https://plover.readthedocs.io/en/latest/cli_reference.html#sending-commands">sending commands</a> directly to our Plover application. Run the following command in your terminal, and the <a href="https://github.com/openstenoproject/plover">Plover GitHub</a> page should open:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_send_command OPEN_URL:https://github.com/openstenoproject/plover
</span></code></pre></div></div> <p>Our first plugin is now complete. It is a very minimal implementation, but it works<sup id="fnref:13" role="doc-noteref"><a href="#fn:13" class="footnote" rel="footnote">13</a></sup>! Let’s make an entry for it in our git repository before moving forward:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Add command plugin"
</span></code></pre></div></div> <p>Now, let’s turn our focus to creating a plugin that will help us output some text that we could not just define in a steno dictionary entry.</p> <h2 id="meta-plugin">Meta Plugin</h2> <p><a href="https://plover.readthedocs.io/en/latest/plugin-dev/metas.html">Metas</a> are functions whose primary purpose is to output new text<sup id="fnref:14" role="doc-noteref"><a href="#fn:14" class="footnote" rel="footnote">14</a></sup>. You would likely be used to creating your own steno dictionary entries that output text of some kind, but we are going to justify needing a plugin by outputting text that we would be unable to specify in a standard dictionary entry.</p> <p>Specifically, we are going to build a meta plugin that outputs a random number between 1 and 100.</p> <p>In dictionary entries, the meta will look like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"{:RANDOM_NUMBER:1:100}"</span><span class="w">
</span></code></pre></div></div> <p>Here, we define the following:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">RANDOM_NUMBER</code> - The name of the meta function to run</li> <li> <code class="language-plaintext highlighter-rouge">1:100</code> - The argument to pass to the meta function. In this case, it actually represents two arguments: our low and high number boundaries. It seems to be Plover convention to have all arguments in outlines separated by colons, so we will maintain this for our own parameters as well</li> </ul> <p>Like with the command plugin, let’s first create a new <code class="language-plaintext highlighter-rouge">random_number</code> entry point in the <code class="language-plaintext highlighter-rouge">setup.cfg</code> file underneath the existing command entry:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ...
</span><span class="nn">[options.entry_points]</span>
<span class="py">plover.command</span> <span class="p">=</span>
    <span class="c"># "{:COMMAND:OPEN_URL:https://www.openstenoproject.org/}"
</span>    <span class="py">open_url</span> <span class="p">=</span> <span class="s">plover_practice_plugin.command:open_url</span>
<span class="py">plover.meta</span> <span class="p">=</span>
    <span class="c"># "{:RANDOM_NUMBER:1:100}"
</span>    <span class="py">random_number</span> <span class="p">=</span> <span class="s">plover_practice_plugin.meta:random_number</span>
</code></pre></div></div> <p>Now, let’s go and create the <code class="language-plaintext highlighter-rouge">random_number</code> function in a new <code class="language-plaintext highlighter-rouge">meta.py</code> module file:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/meta.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">random_number</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="p">[</span><span class="nf">int</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)]</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
    <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></div> <p>Meta functions are implemented as receiving two parameters:</p> <ul> <li>a Context <code class="language-plaintext highlighter-rouge">ctx</code>, which is provided automatically by Plover. We use it primarily to generate what Plover calls an “action”, which you can think of as a container for the text we want to output<sup id="fnref:15" role="doc-noteref"><a href="#fn:15" class="footnote" rel="footnote">15</a></sup> </li> <li>an optional <code class="language-plaintext highlighter-rouge">argument</code>, which in this case we <a href="https://docs.python.org/3/library/stdtypes.html#str.split"><code class="language-plaintext highlighter-rouge">split</code></a> in two, <a href="https://en.wikipedia.org/wiki/Type_conversion">converting</a> each into integers with <a href="https://docs.python.org/3/library/functions.html#int"><code class="language-plaintext highlighter-rouge">int()</code></a>, in order to get the low and high boundaries<sup id="fnref:16" role="doc-noteref"><a href="#fn:16" class="footnote" rel="footnote">16</a></sup> </li> </ul> <p>We leverage Python’s <a href="https://docs.python.org/3/library/random.html"><code class="language-plaintext highlighter-rouge">random</code></a> library to generate a random number<sup id="fnref:17" role="doc-noteref"><a href="#fn:17" class="footnote" rel="footnote">17</a></sup> by passing the boundary numbers into its <a href="https://docs.python.org/3/library/random.html#random.randint"><code class="language-plaintext highlighter-rouge">randint</code></a> function. From there, we generate a new <code class="language-plaintext highlighter-rouge">action</code> from the context provided by Plover, assign the random number to its <code class="language-plaintext highlighter-rouge">text</code> property after converting it to a string (using <a href="https://docs.python.org/3/library/stdtypes.html#str"><code class="language-plaintext highlighter-rouge">str()</code></a>), and return it.</p> <p>Since we have made some new changes, we need to let Plover know about them by running the Plover plugin install script again:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>Restart your Plover application, and then create a temporary entry in one of your steno dictionaries that looks something like this “rand” outline:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"RA*PBD"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{:RANDOM_NUMBER:1:100}"</span><span class="w">
</span></code></pre></div></div> <p>Now, try chording the outline, and you should see a different number between 1 and 100 output every time you stroke <code class="language-plaintext highlighter-rouge">RA*PBD</code>! Let’s celebrate the addition of this new plugin by making a repository entry for it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Add meta plugin"
</span></code></pre></div></div> <blockquote> <p>Since there is no equivalent of the <code class="language-plaintext highlighter-rouge">plover --script plover_send_command</code> command for testing metas, if you wanted to try using different boundary number parameters, just create some more temporary steno dictionary entries that do so.</p> </blockquote> <p>Next, let’s create our final plugin, that will give us maximum flexibility within Plover’s environment, and do more than just perform one-off actions.</p> <h2 id="extension-plugin">Extension Plugin</h2> <p><a href="https://plover.readthedocs.io/en/latest/plugin-dev/extensions.html">Extensions</a> are <a href="https://docs.python.org/3/tutorial/classes.html">classes</a> (as opposed to our other function-based plugins) that can:</p> <ul> <li>execute code in a long-running <a href="https://en.wikipedia.org/wiki/Concurrent_computing">concurrent process</a> to Plover</li> <li>keep their own <a href="https://en.wikipedia.org/wiki/State_(computer_science)">state</a> </li> <li>hook into the <a href="https://en.wikipedia.org/wiki/Object_lifetime">life-cycle events</a> of the <a href="https://plover.readthedocs.io/en/latest/api/engine.html">StenoEngine</a>, and execute code when they occur</li> </ul> <p>These features can seem a bit obtuse or abstract, especially if you are not overly familiar with computer programming, and it can initially seem difficult to understand what benefits an extension plugin can provide over, say, a command or meta plugin.</p> <p>So, we are going to start with the creation of a new meta plugin, surface some of the pain points around it, and then migrate it over to be an extension plugin to relieve the pain.</p> <h3 id="initial-meta-plugin">Initial Meta Plugin</h3> <p>Our new plugin will enable us to read in and output values stored in <a href="https://en.wikipedia.org/wiki/Environment_variable">environment variables</a> on our computer, in the style of the <a href="https://github.com/paulfioravanti/plover-local-env-var">Plover Local Env Var</a> plugin.</p> <blockquote> <p>Note that the incantations we will use to get the environment variables are macOS/Linux-focused. If you are following along using Windows, you will likely need to make small changes to your code around <code class="language-plaintext highlighter-rouge">$VAR</code>/<code class="language-plaintext highlighter-rouge">$Env:VAR</code>/<code class="language-plaintext highlighter-rouge">%VAR%</code> usage, as well as the <code class="language-plaintext highlighter-rouge">echo</code> shell command that gets executed. I’m sorry…computers are hard, and I do not have a Windows machine to test on…</p> </blockquote> <p>In dictionary entries, the meta will look like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"{:GET_ENV_VAR:$USER}"</span><span class="w">
</span></code></pre></div></div> <p>Like the previous plugin, let’s start with the definition of a new meta plugin entry point:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ...
</span><span class="nn">[options.entry_points]</span>
<span class="c"># ...
</span><span class="py">plover.meta</span> <span class="p">=</span>
    <span class="c"># "{:RANDOM_NUMBER:1:100}"
</span>    <span class="py">random_number</span> <span class="p">=</span> <span class="s">plover_practice_plugin.meta:random_number</span>
    <span class="c"># "{:GET_ENV_VAR:$USER}"
</span>    <span class="py">get_env_var</span> <span class="p">=</span> <span class="s">plover_practice_plugin.meta:get_env_var</span>
</code></pre></div></div> <p>Now, let’s go and add the <code class="language-plaintext highlighter-rouge">get_env_var</code> function to the existing <code class="language-plaintext highlighter-rouge">meta.py</code> module file:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/meta.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">def</span> <span class="nf">random_number</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
    <span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">get_env_var</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
    <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">SHELL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash</span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">env_var</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s"> -ic </span><span class="sh">'</span><span class="s">echo </span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="sh">'"</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>

    <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
    <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">env_var</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></div> <p>We leverage Python’s <a href="https://docs.python.org/3/library/os.html"><code class="language-plaintext highlighter-rouge">os</code></a> module to do the following:</p> <ul> <li>get Plover’s <code class="language-plaintext highlighter-rouge">$SHELL</code> environment variable using <a href="https://docs.python.org/3/library/os.html#os.getenv"><code class="language-plaintext highlighter-rouge">getenv</code></a> </li> <li>get the <code class="language-plaintext highlighter-rouge">argument</code>’s environment variable value from the computer user’s environment using <a href="https://docs.python.org/3/library/os.html#os.popen"><code class="language-plaintext highlighter-rouge">popen</code></a><sup id="fnref:18" role="doc-noteref"><a href="#fn:18" class="footnote" rel="footnote">18</a></sup> </li> </ul> <p>Then, just like the random number meta plugin, we create a new <code class="language-plaintext highlighter-rouge">action</code> from the provided Plover context, assign the <code class="language-plaintext highlighter-rouge">env_var</code> value to its <code class="language-plaintext highlighter-rouge">text</code>, and then return it.</p> <p>Run the Plover plugin install script again to apply the changes in Plover:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>Restart your Plover application, and then create a temporary entry in one of your steno dictionaries that looks something like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"AO*URS"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{:GET_ENV_VAR:$USER}"</span><span class="w">
</span></code></pre></div></div> <blockquote> <p>I have overridden Plover’s <code class="language-plaintext highlighter-rouge">AO*URS</code> outline here, but use whatever outline you would like.</p> </blockquote> <p>Now, try chording the outline, and you should see your computer user name output! This working state seems like a good place to add a repository commit, so let’s do so:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Add env var meta plugin"
</span></code></pre></div></div> <h3 id="migrate-to-extension">Migrate to Extension</h3> <p>If you chord the outline a few times, though, you will see that there is a noticeable time gap between your chording and the output appearing. This is because making a call out to the shell every time is computationally expensive enough for us to notice the lag. The value in the <code class="language-plaintext highlighter-rouge">$USER</code> env var will change rarely, if ever, so making this call out every time just to get back the same information is inefficient (and annoying cause we are all about speed with steno, right?).</p> <p>Migrating over to an extension plugin can enable us to eliminate the lag, and get this functionality feeling snappy. We can begin that process by removing the <code class="language-plaintext highlighter-rouge">get_env_var</code> meta entry point, and replacing it with a <code class="language-plaintext highlighter-rouge">plover_practice_plugin</code> extension entry point:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ...
</span><span class="nn">[options.entry_points]</span>
<span class="c"># ...
</span><span class="py">plover.meta</span> <span class="p">=</span>
    <span class="c"># "{:RANDOM_NUMBER:1:100}"
</span>    <span class="py">random_number</span> <span class="p">=</span> <span class="s">plover_practice_plugin.meta:random_number</span>
<span class="py">plover.extension</span> <span class="p">=</span>
    <span class="c"># "{:GET_ENV_VAR:$USER}"
</span>    <span class="py">plover_practice_plugin</span> <span class="p">=</span> <span class="s">plover_practice_plugin.extension:PracticePlugin</span>
</code></pre></div></div> <blockquote> <p>It would seem that entry point names for extensions tend to be named the same as the project itself, so that convention is followed here.</p> </blockquote> <p>Next, let’s go and create a <code class="language-plaintext highlighter-rouge">PracticePlugin</code> class in a new <code class="language-plaintext highlighter-rouge">extension.py</code> module file. It gets initialized with a <a href="https://plover.readthedocs.io/en/latest/api/engine.html">StenoEngine</a> <code class="language-plaintext highlighter-rouge">engine</code> (provided by Plover), which we just need to assign to an internal property (we will use it later on…). It also implements two callback functions, <code class="language-plaintext highlighter-rouge">start</code> and <code class="language-plaintext highlighter-rouge">stop</code>, which get run when the extension is enabled and disabled respectively.</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">plover.registry</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">registry</span><span class="p">.</span><span class="nf">register_plugin</span><span class="p">(</span><span class="sh">"</span><span class="s">meta</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">get_env_var</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_get_env_var</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_get_env_var</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">SHELL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash</span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">env_var</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s"> -ic </span><span class="sh">'</span><span class="s">echo </span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="sh">'"</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
        <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">env_var</span>
        <span class="k">return</span> <span class="n">action</span>
</code></pre></div></div> <p>Within the <code class="language-plaintext highlighter-rouge">start</code> function, we use the <a href="https://plover.readthedocs.io/en/latest/api/registry.html">Plover Plugin Registry</a> to <a href="https://plover.readthedocs.io/en/latest/api/registry.html#plover.registry.Registry.register_plugin">register a new meta plugin</a> called <code class="language-plaintext highlighter-rouge">"get_env_var"</code> (the exact same name as the original meta), whose implementation we will find in a <a href="https://docs.python.org/3/tutorial/classes.html#tut-private">private instance method</a> called <code class="language-plaintext highlighter-rouge">_get_env_var</code> (note the underscore prefix). That method contains the code we originally had in the <code class="language-plaintext highlighter-rouge">get_env_var</code> meta function (so we do not need the original function anymore, and it can be safely deleted). We do not currently need to do anything when the plugin stops (yet!), so we simply provide the <code class="language-plaintext highlighter-rouge">stop</code> function a <a href="https://docs.python.org/3/tutorial/controlflow.html#pass-statements"><code class="language-plaintext highlighter-rouge">pass</code></a>.</p> <p>Let’s do a quick sanity check to confirm that the initial migration has worked, and run the Plover plugin install script:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>Restart your Plover application, open the Configure screen, and under the Plugins tab, confirm that <code class="language-plaintext highlighter-rouge">plover_practice_plugin</code> is in the list, and that its Enabled box is checked.</p> <div class="centered-image" style="width: 70%;"> <figure> <img src="/assets/images/2024-02-04/plover-extension-running.jpg" alt="Plover Configuration showing the Practice Plugin extension running"> <figcaption> Open Configure &gt; Plugins and confirm that the Enabled box is checked </figcaption> </figure> </div> <p>Now, try chording the <code class="language-plaintext highlighter-rouge">"{:GET_ENV_VAR:$USER}"</code> outline again, and if it still works exactly the same as before (including lag), then the meta-to-extension migration has been successful! Let’s quickly make a commit entry before moving forward:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Migrate env var meta to extension plugin"
</span></code></pre></div></div> <h3 id="env-var-cache">Env Var Cache</h3> <p>The first optimisation we want to make is adding a <a href="https://en.wikipedia.org/wiki/Cache_(computing)">cache</a>, in the form of a <a href="https://docs.python.org/3/tutorial/datastructures.html#dictionaries">Python dictionary</a>, to store environment variable names and values after we fetch them the first time. This will mean we only get lag the first time we fetch the env var, but subsequent fetches will use the cached value, and hence output the text faster. Code-wise, we want to be able to do the following:</p> <ul> <li>Initialise an empty dictionary to store the env vars when plugin starts</li> <li>When attempting to get an env var value, check the cache first for the env var name, and return its value if present</li> <li>If no entry is present, run the command to get the env var, and store its name and value in the dictionary</li> </ul> <p>Let’s see how this looks in code:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">plover.registry</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">_get_env_var</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">SHELL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash</span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s"> -ic </span><span class="sh">'</span><span class="s">echo </span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="sh">'"</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_var</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
        <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">env_var</span>
        <span class="k">return</span> <span class="n">action</span>
</code></pre></div></div> <p>Run the Plover plugin install script again and restart Plover:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>You should find that the first env var retrieval is slow, but subsequent look ups will use the cached version in the dictionary, so the text will output much faster. Chalk up our first optimisation win!</p> <h3 id="clearing-the-cache">Clearing the Cache</h3> <p>Now, it is nice to use a cache, but what if the value of an env var value changes? The extension will keep using the same cached (and now obsolete) value as long as the env var name is the same. It would be nice to have a way to clear the cache when we want to read in new env var values: say, by pushing the Plover <a href="https://en.wikipedia.org/wiki/Graphical_user_interface">GUI</a> “Reconnect” button.</p> <div class="centered-image" style="width: 50%;"> <figure> <img src="/assets/images/2024-02-04/plover-reconnect.jpg" alt="Plover GUI highlighting the Reconnect button"> </figure> </div> <p>Luckily, Plover’s <a href="https://plover.readthedocs.io/en/latest/api/engine.html">StenoEngine</a> contains some <a href="https://plover.readthedocs.io/en/latest/api/engine.html#engine-hooks">hook functions</a> that we can leverage to do just that<sup id="fnref:19" role="doc-noteref"><a href="#fn:19" class="footnote" rel="footnote">19</a></sup>. Plover’s steno engine has <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/plover/machine/base.py#L19">four states</a>:</p> <ul> <li>Stopped</li> <li>Initializing</li> <li>Connected (aka Running)</li> <li>Disconnected (aka Error)</li> </ul> <p>When you press the “Reconnect” GUI button, the engine state changes to Stopped, then Initializing, then either Connected or Disconnected, depending on whether Plover can find your steno machine. We can use the <a href="https://plover.readthedocs.io/en/latest/api/engine.html#machine_state_changed"><code class="language-plaintext highlighter-rouge">machine_state_changed</code></a> engine hook to check the machine status every time it changes, and if it’s Connected, reset the env var cache:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">plover.machine.base</span> <span class="kn">import</span> <span class="n">STATE_RUNNING</span>
<span class="kn">from</span> <span class="n">plover.registry</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="c1"># ...
</span>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">registry</span><span class="p">.</span><span class="nf">register_plugin</span><span class="p">(</span><span class="sh">"</span><span class="s">meta</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">get_env_var</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_get_env_var</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span><span class="p">.</span><span class="nf">hook_connect</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">machine_state_changed</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_machine_state_changed</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span><span class="p">.</span><span class="nf">hook_disconnect</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">machine_state_changed</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_machine_state_changed</span>
        <span class="p">)</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">_machine_state_changed</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">_machine_type</span><span class="p">,</span> <span class="n">machine_state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">machine_state</span> <span class="o">==</span> <span class="n">STATE_RUNNING</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></div> <p>Here we are use the steno engine’s <a href="https://plover.readthedocs.io/en/latest/api/engine.html#plover.engine.StenoEngine.hook_connect"><code class="language-plaintext highlighter-rouge">hook_connect</code></a> and <a href="https://plover.readthedocs.io/en/latest/api/engine.html#plover.engine.StenoEngine.hook_disconnect"><code class="language-plaintext highlighter-rouge">hook_disconnect</code></a> functions to have our new <code class="language-plaintext highlighter-rouge">_machine_state_changed</code> private method run every time Plover’s <code class="language-plaintext highlighter-rouge">"machine_state_changed"</code> event occurs. The <code class="language-plaintext highlighter-rouge">machine_type</code> and <code class="language-plaintext highlighter-rouge">machine_state</code> parameters are provided to us by Plover when the event occurs, but we only care about the machine state, and whether it has changed to be Connected (<code class="language-plaintext highlighter-rouge">STATE_RUNNING</code>). If it has, empty the cache.</p> <p>Let’s check and see if cache emptying works. Run the Plover plugin install script again and restart Plover:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>Like before, the first retrieval of the env var should have a lag, but subsequent retrievals should be fast. Now, press the Plover “Reconnect” button, and try the same outline again. You should find that since there is no longer a cache present, the lag will have returned since the env var value is directly fetched again via the command line. However, subsequent retrievals should be fast again as expected. Great, no more stale data for us!</p> <h3 id="eradicate-lag-with-config">Eradicate Lag with Config</h3> <p>Time to address the final hanging thread in the optimisation story: that initial env var retrieval speed hit. It would be nice to have output of env var values be fast <em>all the time</em>, and we can do this by <a href="https://en.wikipedia.org/wiki/Prefetching">prefetching</a> them when the plugin starts. This will take the form of:</p> <ul> <li>using a <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> configuration file to store the names of the env vars whose values we want to cache</li> <li>when the extension starts, read in config file, fetch all the env var values, and initialise the dictionary cache for them</li> <li>when we encounter an env var that is not in the cache, after fetching its value and adding it to the cache, also add its name to the config file</li> <li>where we previously <em>cleared</em> the cache by pressing the “Reconnect” button, instead we will now re-read in the config file and <em>refresh</em> the cache</li> </ul> <p>The JSON config file will live in Plover’s <a href="https://plover.readthedocs.io/en/latest/api/oslayer_config.html#plover.oslayer.config.CONFIG_DIR">designated configuration directory</a> (<code class="language-plaintext highlighter-rouge">CONFIG_DIR</code>), which is platform dependent. We will call it “<code class="language-plaintext highlighter-rouge">practice_plugin.json</code>”, and it will be created, read, and written to automatically, so it is not something that should need to be edited manually. Its format will look like this:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"env_var_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"$USER"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"$ENV_VAR"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"$SOME_OTHER_ENV_VAR"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>First, let’s update the <code class="language-plaintext highlighter-rouge">_get_env_var</code> method to save newly fetched env var names out to the config file:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># ...
</span><span class="kn">from</span> <span class="n">plover.oslayer.config</span> <span class="kn">import</span> <span class="n">CONFIG_DIR</span>

<span class="n">_CONFIG_FILEPATH</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">CONFIG_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="sh">"</span><span class="s">practice_plugin.json</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">_get_env_var</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">env_var_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="n">env_var_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_expand</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_var_value</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_save_config</span><span class="p">()</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
        <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">env_var_value</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">SHELL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash</span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s"> -ic </span><span class="sh">'</span><span class="s">echo </span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="sh">'"</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_save_config</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">_CONFIG_FILEPATH</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">env_var_names</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">.</span><span class="nf">keys</span><span class="p">())}</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="nb">file</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <p>Here, we have made a small refactor by extracting out <code class="language-plaintext highlighter-rouge">os</code>-related code into an <code class="language-plaintext highlighter-rouge">_expand</code> method (we will reference it again soon), and then added another <code class="language-plaintext highlighter-rouge">_save_config</code> method that creates a new dictionary containing the <a href="https://docs.python.org/3/library/functions.html#sorted"><code class="language-plaintext highlighter-rouge">sorted</code></a> <code class="language-plaintext highlighter-rouge">"env_var_names"</code>, and uses Python’s <a href="https://docs.python.org/3/library/json.html"><code class="language-plaintext highlighter-rouge">json</code></a> library to output (<a href="https://docs.python.org/3/library/json.html#json.dump"><code class="language-plaintext highlighter-rouge">dump</code></a>) it to a JSON config file. We call <code class="language-plaintext highlighter-rouge">_save_config</code> after we add any new env var entry to the cache, so we know to read it in again when the plugin starts.</p> <p>Speaking of that, let’s now add the code that loads in the config, not just when the plugin starts, but also when we want to refresh the env var cache:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># ...
</span><span class="kn">from</span> <span class="n">plover.machine.base</span> <span class="kn">import</span> <span class="n">STATE_RUNNING</span>
<span class="kn">from</span> <span class="n">plover.oslayer.config</span> <span class="kn">import</span> <span class="n">CONFIG_DIR</span>

<span class="n">_CONFIG_FILEPATH</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">CONFIG_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="sh">"</span><span class="s">practice_plugin.json</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># ...
</span>        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_config</span><span class="p">()</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">_CONFIG_FILEPATH</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="nb">file</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">env_var_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">env_var_names</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">env_var_values</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_expand</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">env_var_names</span><span class="p">))</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">env_var_names</span><span class="p">,</span> <span class="n">env_var_values</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">env_vars</span>

    <span class="k">def</span> <span class="nf">_machine_state_changed</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">_machine_type</span><span class="p">,</span> <span class="n">machine_state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">machine_state</span> <span class="o">==</span> <span class="n">STATE_RUNNING</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_config</span><span class="p">()</span>
</code></pre></div></div> <p>Here, you can see that we call a <code class="language-plaintext highlighter-rouge">_load_config</code> method when the plugin starts, and when the Plover “Reconnect” button is pressed. It reads in the config file (<a href="https://docs.python.org/3/library/json.html#json.load"><code class="language-plaintext highlighter-rouge">load</code></a>), extracts its <code class="language-plaintext highlighter-rouge">"env_var_names"</code> list, expands them all, and returns the now-initialised <code class="language-plaintext highlighter-rouge">env_vars</code> dictionary cache<sup id="fnref:20" role="doc-noteref"><a href="#fn:20" class="footnote" rel="footnote">20</a></sup>.</p> <p>For completeness’ sake, and for those following along, this is what the full finished extension code looks like:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/plover_practice_plugin/extension.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="n">plover.machine.base</span> <span class="kn">import</span> <span class="n">STATE_RUNNING</span>
<span class="kn">from</span> <span class="n">plover.oslayer.config</span> <span class="kn">import</span> <span class="n">CONFIG_DIR</span>
<span class="kn">from</span> <span class="n">plover.registry</span> <span class="kn">import</span> <span class="n">registry</span>

<span class="n">_CONFIG_FILEPATH</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">CONFIG_DIR</span><span class="p">)</span> <span class="o">/</span> <span class="sh">"</span><span class="s">practice_plugin.json</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">PracticePlugin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">registry</span><span class="p">.</span><span class="nf">register_plugin</span><span class="p">(</span><span class="sh">"</span><span class="s">meta</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">get_env_var</span><span class="sh">"</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">_get_env_var</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span><span class="p">.</span><span class="nf">hook_connect</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">machine_state_changed</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_machine_state_changed</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_config</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_engine</span><span class="p">.</span><span class="nf">hook_disconnect</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">machine_state_changed</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_machine_state_changed</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_env_var</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">env_var_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="n">env_var_value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_expand</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">[</span><span class="n">argument</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_var_value</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_save_config</span><span class="p">()</span>

        <span class="n">action</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">new_action</span><span class="p">()</span>
        <span class="n">action</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">env_var_value</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span> <span class="nf">_expand</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
        <span class="n">shell</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">SHELL</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">bash</span><span class="sh">"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">shell</span><span class="si">}</span><span class="s"> -ic </span><span class="sh">'</span><span class="s">echo </span><span class="si">{</span><span class="n">argument</span><span class="si">}</span><span class="sh">'"</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_save_config</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">_CONFIG_FILEPATH</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">env_var_names</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span><span class="p">.</span><span class="nf">keys</span><span class="p">())}</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="nb">file</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">_CONFIG_FILEPATH</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
                <span class="nb">file</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">FileNotFoundError</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">env_var_names</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">env_var_names</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">env_var_values</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_expand</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">env_var_names</span><span class="p">))</span>
        <span class="n">env_vars</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">env_var_names</span><span class="p">,</span> <span class="n">env_var_values</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">env_vars</span>

    <span class="k">def</span> <span class="nf">_machine_state_changed</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">_machine_type</span><span class="p">,</span> <span class="n">machine_state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">machine_state</span> <span class="o">==</span> <span class="n">STATE_RUNNING</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">_env_vars</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_config</span><span class="p">()</span>
</code></pre></div></div> <p>Moment of truth: let’s see if this works. Run the Plover plugin install script again and restart Plover:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">plover --script plover_plugins install --editable .
</span></code></pre></div></div> <p>Now, try chording the <code class="language-plaintext highlighter-rouge">"{:GET_ENV_VAR:$USER}"</code> outline. Like before, there will be an initial lag on the first output, with faster subsequent outputs. But! Go and open up your <a href="https://plover.readthedocs.io/en/latest/api/oslayer_config.html#plover.oslayer.config.CONFIG_DIR">Plover configuration directory</a>, and you should find a <code class="language-plaintext highlighter-rouge">practice_plugin.json</code> file with the following contents:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"env_var_names"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"$USER"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <div class="centered-image" style="width: 100%;"> <figure style="margin-bottom: 0;"> <img src="/assets/images/2024-02-04/plover-practice-plugin-config.jpg" alt="Plover plugin config file shown in a Finder window"> </figure> <figcaption> Config file in the Plover configuration directory (macOS) </figcaption> </div> <p>The plugin now knows that it should go and prefetch the value of the <code class="language-plaintext highlighter-rouge">$USER</code> env var. So, if you restart the Plover application now, and try chording the <code class="language-plaintext highlighter-rouge">"{:GET_ENV_VAR:$USER}"</code> outline, there should be no lag at all! Try pressing the Plover “Reconnect” button to refresh the cache, and you should still see no output lag.</p> <p>Looks like we have ourselves a finished extension plugin<sup id="fnref:21" role="doc-noteref"><a href="#fn:21" class="footnote" rel="footnote">21</a></sup>, so let’s check our new additions into Git:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Finish extension plugin"
</span></code></pre></div></div> <p>After showcasing three different examples of Plover plugin types, I think we can put a pin in our project and say that it is “done”. Now, let’s see what is involved in getting this code public, and into the hands of other Plover users.</p> <h2 id="how-to-share">How to Share</h2> <p>Plover does have a <a href="https://plover.readthedocs.io/en/latest/plugin-dev/publishing.html">Publishing Plugins</a> page, and I do think it should be your first point of call for official guidance on this topic. However, as of this writing, I needed extra steps to make everything work in an automated and frictionless manner, so consider this a supplementary guide.</p> <p>I found there were three main steps to complete in order to get plugin code into the Plover ecosystem:</p> <ul> <li>Get your code in a public Git repository</li> <li>Publish your code on <a href="https://pypi.org/">PyPI</a> </li> <li>Get the name of your plugin included in the <a href="https://github.com/openstenoproject/plover_plugins_registry">Plover Plugin Registry list</a> </li> </ul> <h3 id="push-to-github">Push to GitHub</h3> <p>During the course of development, we have been making commits to a local Git repository on our computer, that can only be seen by us. To share our code with others, we need a public repository where others can access it.</p> <p><a href="https://github.com/">GitHub</a> is probably the most well known code sharing platform<sup id="fnref:22" role="doc-noteref"><a href="#fn:22" class="footnote" rel="footnote">22</a></sup>, so we will use it to publish our codebase. If you do not have a GitHub account yet, <a href="https://github.com/signup">sign up</a> for one, <a href="https://github.com/new">create a new repository</a>, and name it <strong>plover-practice-plugin</strong>. No need to worry about any of the optional fields, but just ensure that the repository is set to be Public.</p> <p>Since we already have a local Git repository, we can follow GitHub’s directions to “push an existing repository from the command line”. They will be personal to your account, and look something like:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">git remote add origin git@github.com:&lt;your_username&gt;</span>/plover-practice-plugin.git
<span class="go">git branch -M main
git push -u origin main
</span></code></pre></div></div> <p>Once you have followed your instructions, you should be able to see your plugin code up on GitHub at <code class="language-plaintext highlighter-rouge">https://github.com/&lt;your_username&gt;/plover-practice-plugin</code> (you can see mine <a href="https://github.com/paulfioravanti/plover-practice-plugin">here</a>).</p> <h3 id="publish-to-pypi">Publish to PyPI</h3> <p>The <a href="https://packaging.python.org/en/latest/guides/distributing-packages-using-setuptools/">Python Packaging and Distributing projects</a> page that Plover’s <a href="https://plover.readthedocs.io/en/latest/plugin-dev/publishing.html">Publishing Plugins</a> page would seem to (indirectly) reference in its guide to publish to PyPI is marked as “outdated”. The “modern” way to publish would seem to be by using a <a href="https://en.wikipedia.org/wiki/CI/CD">CI/CD</a> workflow, and Python’s documentation even has a <a href="https://packaging.python.org/en/latest/guides/publishing-package-distribution-releases-using-github-actions-ci-cd-workflows/">Publishing package distribution releases using GitHub Actions CI/CD workflows</a> page to help out GitHub users.</p> <p>Based on some information in that guide, some information in the <a href="https://github.com/marketplace/actions/pypi-publish">PyPI publish GitHub action</a> documentation, and some experimentation on my part, the following is my guide to automate publishing of a Plover plugin to PyPI from GitHub.</p> <p>The goal is to be able to perform a <code class="language-plaintext highlighter-rouge">git push</code> up to GitHub, and then have a GitHub action handle publishing to PyPI without any further interaction from us. The GitHub action should also be smart enough to only publish to PyPI when we <em>explicitly</em> specify a new version of the plugin (via a <a href="https://git-scm.com/book/en/Git-Basics-Tagging">git tag</a>), since not all code pushes need to be published immediately.</p> <h4 id="create-trusted-publisher">Create Trusted Publisher</h4> <p>Before going further with code, though, <a href="https://pypi.org/account/register/">create an account</a> on PyPI if you don’t already have one. Next, in order to allow a GitHub action to publish to PyPI on your behalf, you need to set up a <a href="https://docs.pypi.org/trusted-publishers/">trusted publisher</a>. Open your <a href="https://pypi.org/manage/account/publishing/">Publishing page</a>, scroll down to the “Add a new pending publisher” form, and fill it with information similar to this:</p> <div class="centered-image" style="width: 50%;"> <figure style="margin-bottom: 0;"> <img src="/assets/images/2024-02-04/pypi-trusted-publisher.jpg" alt="PyPI's 'Add a new pending publisher' form"> </figure> <figcaption> Fill in this form to allow GitHub actions to publish to PyPI </figcaption> </div> <ul> <li>If you have been building your own <code class="language-plaintext highlighter-rouge">plover-practice-plugin</code> while reading this post, and are intending to publish to PyPI, you will have to change the “PyPI Project Name” to something else, since <code class="language-plaintext highlighter-rouge">plover-practice-plugin</code> will already be taken by me :) Maybe try <code class="language-plaintext highlighter-rouge">plover-practice-plugin-&lt;your-name&gt;</code>.</li> <li>The “Owner” and “Repository name” fields come from your plugin GitHub repo</li> <li>The information in the “Workflow name” and “Environment” fields are something we will specify soon in the GitHub action configuration. “Release” seems to be a good default name for these, but feel free to choose something else</li> </ul> <p>Once you have added the publisher correctly, it should show up as a “Pending Publisher” on the Publishing page, meaning we are ready to create our GitHub action workflow.</p> <h4 id="create-github-action-workflow">Create GitHub Action WorkFlow</h4> <p>The following is what I consider to be a minimum viable GitHub action workflow configuration for publishing a Plover plugin to PyPI. As per the trusted publisher config above, we will name the workflow file <code class="language-plaintext highlighter-rouge">release.yml</code>, and add it to the project in the following specific location:</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/.github/workflows/release.yml</code></strong></p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">PyPI Release</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>
    <span class="na">tags</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="c1"># Adapted from: https://github.com/pypa/gh-action-pypi-publish#usage</span>
  <span class="na">pypi-publish</span><span class="pi">:</span>
    <span class="na">if</span><span class="pi">:</span> <span class="s">${{ startsWith(github.ref, 'refs/tags') }}</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Build, Release to PyPI</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">release</span>
      <span class="na">url</span><span class="pi">:</span> <span class="s">https://pypi.org/project/plover-practice-plugin/</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">id-token</span><span class="pi">:</span> <span class="s">write</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Clone Repository</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v4</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">python-version</span><span class="pi">:</span> <span class="m">3.9</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Build</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">python -m pip install --upgrade build</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">python -m build</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Publish to PyPI</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">pypa/gh-action-pypi-publish@release/v1</span>
</code></pre></div></div> <ul> <li>As per the trusted publisher config, we have specified that the <code class="language-plaintext highlighter-rouge">name</code> of the <code class="language-plaintext highlighter-rouge">environment</code> this workflow should use is <code class="language-plaintext highlighter-rouge">release</code>, and that its <code class="language-plaintext highlighter-rouge">url</code> points to the “PyPI Project Name” we specified</li> <li>As per Plover’s Python version, we make sure to set up the workflow’s environment with <code class="language-plaintext highlighter-rouge">python-version: 3.9</code> </li> <li>All GitHub action jobs that use <code class="language-plaintext highlighter-rouge">pypa/gh-action-pypi-publish</code> <em>must</em> use <code class="language-plaintext highlighter-rouge">runs-on: ubuntu-latest</code>, and no other operating system<sup id="fnref:23" role="doc-noteref"><a href="#fn:23" class="footnote" rel="footnote">23</a></sup> </li> <li>The conditional <code class="language-plaintext highlighter-rouge">if: ${{ startsWith(github.ref, 'refs/tags') }}</code> statement is where we say to <em>only</em> run the <code class="language-plaintext highlighter-rouge">pypi-publish</code> <a href="https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow">job</a> if the current <a href="https://git-scm.com/book/en/v2/Git-Internals-Git-References">git commit reference</a> (<a href="https://docs.github.com/en/actions/learn-github-actions/contexts#github-context"><code class="language-plaintext highlighter-rouge">github.ref</code></a>) <a href="https://docs.github.com/en/actions/learn-github-actions/expressions#startswith"><code class="language-plaintext highlighter-rouge">startsWith</code></a> a tag (<code class="language-plaintext highlighter-rouge">refs/tags</code>)<sup id="fnref:24" role="doc-noteref"><a href="#fn:24" class="footnote" rel="footnote">24</a></sup> </li> </ul> <p>Before moving forward, let’s add a commit for this new config:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Add publish to PyPI GitHub action"
</span></code></pre></div></div> <blockquote> <p>You can find further information about the details about this config in the <a href="https://github.com/marketplace/actions/pypi-publish#usage">PyPI publish GitHub Action documentation</a>, but aside from what is mentioned above, you should be able to just copy and paste this config into your own plugin project to use as-is.</p> </blockquote> <h4 id="update-project-details">Update Project Details</h4> <p>Remember at the beginning of this project when we specified a minimal set of project metadata? Now that we are nearly at the point of publishing to PyPI, let’s flesh it out a bit more so we can have more information show up on our project’s PyPI page (feel free to add more and customise as you please. Also, the ordering of this config does not matter; I just used alphabetical here):</p> <p><strong><code class="language-plaintext highlighter-rouge">plover-practice-plugin/setup.cfg</code></strong></p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">author</span> <span class="p">=</span> <span class="s">Paul Fioravanti</span>
<span class="py">author_email</span> <span class="p">=</span> <span class="s">paul@paulfioravanti.com</span>
<span class="py">classifiers</span> <span class="p">=</span>
    <span class="err">Development</span> <span class="err">Status</span> <span class="err">::</span> <span class="err">4</span> <span class="err">-</span> <span class="err">Beta</span>
    <span class="err">Environment</span> <span class="err">::</span> <span class="err">Plugins</span>
    <span class="err">Intended</span> <span class="err">Audience</span> <span class="err">::</span> <span class="err">End</span> <span class="err">Users/Desktop</span>
    <span class="err">Operating</span> <span class="err">System</span> <span class="err">::</span> <span class="err">OS</span> <span class="err">Independent</span>
    <span class="err">Programming</span> <span class="err">Language</span> <span class="err">::</span> <span class="err">Python</span> <span class="err">::</span> <span class="err">3</span>
    <span class="err">Programming</span> <span class="err">Language</span> <span class="err">::</span> <span class="err">Python</span> <span class="err">::</span> <span class="err">3.9</span>
<span class="py">description</span> <span class="p">=</span> <span class="s">Plover practice plugin</span>
<span class="py">keywords</span> <span class="p">=</span> <span class="s">plover plover_plugin</span>
<span class="py">license</span> <span class="p">=</span> <span class="s">GNU General Public License v3 or later (GPLv3+)</span>
<span class="py">long_description</span> <span class="p">=</span> <span class="s">file: README.md</span>
<span class="py">long_description_content_type</span> <span class="p">=</span> <span class="s">text/markdown</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">plover_practice_plugin</span>
<span class="py">url</span> <span class="p">=</span> <span class="s">https://github.com/paulfioravanti/plover-practice-plugin</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">0.0.1</span>

<span class="c"># ...
</span></code></pre></div></div> <p>Since we have specified a license in the metadata (in this case the <a href="https://www.gnu.org/licenses/gpl-3.0.txt">GPLv3+</a>, similar to <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/LICENSE.txt">Plover’s license</a>), let’s also create a <code class="language-plaintext highlighter-rouge">plover-practice-plugin/LICENSE.txt</code> file, and copy-paste the contents from the license link in there. Finally, since we only put minimal content in the <code class="language-plaintext highlighter-rouge">README.md</code>, now would also be a good time to update that with more information. You can see what I added in my <a href="https://github.com/paulfioravanti/plover-practice-plugin">project GitHub repo</a>.</p> <p>Let’s now commit all those changes, and push them to GitHub:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git add .
git commit --message="Update project metadata and README, add LICENSE"
git push
</span></code></pre></div></div> <p>Now, if you open your plugin GitHub page, you should see a green check mark next to that last commit, indicating that a GitHub action workflow was run successfully:</p> <div class="centered-image" style="width: 100%;"> <figure> <img src="/assets/images/2024-02-04/github-action-success.jpg" alt="GitHub commit showing that a GitHub action workflow has run successfully"> </figure> </div> <blockquote> <p>You can watch the job in action or check the status of any past jobs on the repo’s Actions page (<a href="https://github.com/paulfioravanti/plover-practice-plugin/actions">see mine</a>).</p> </blockquote> <p>However, if you click that check mark, you will see that although the workflow was run, the job inside the workflow (<code class="language-plaintext highlighter-rouge">pypi-publish</code>) was skipped:</p> <div class="centered-image" style="width: 100%;"> <figure> <img src="/assets/images/2024-02-04/github-action-skipped.jpg" alt="GitHub action showing that jobs were skipped"> </figure> </div> <p>This is what we want! We are now free to push code to the repo, and only publish to PyPI when we are ready…which, at this point, we definitely are.</p> <p>Our <code class="language-plaintext highlighter-rouge">setup.cfg</code> metadata already has a <code class="language-plaintext highlighter-rouge">version</code> entry marked as <code class="language-plaintext highlighter-rouge">0.0.1</code>, so let’s tag the repo’s current commit as being <code class="language-plaintext highlighter-rouge">v0.0.1</code><sup id="fnref:25" role="doc-noteref"><a href="#fn:25" class="footnote" rel="footnote">25</a></sup>. We will then push that tag up to GitHub, where the GitHub action will run, and publish the plugin out to PyPI for us:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">git tag v0.0.1
git push origin v0.0.1
</span></code></pre></div></div> <p>When you check the job status this time (for the same commit, since you only pushed up a tag), you should see that it has been successful:</p> <div class="centered-image" style="width: 100%;"> <figure> <img src="/assets/images/2024-02-04/github-action-job-success.jpg" alt="GitHub action showing that jobs were successfully completed"> </figure> </div> <p>Then, you can open your new plugin page on PyPI to confirm that you are published (for reference, here is <a href="https://pypi.org/project/plover-practice-plugin/">Plover Practice Plugin</a>’s PyPI page). When you are ready to release a new version, remember to update both the <code class="language-plaintext highlighter-rouge">version</code> number in the <code class="language-plaintext highlighter-rouge">setup.cfg</code> file <em>and</em> add a new git tag!</p> <h3 id="add-to-plover-plugin-registry">Add to Plover Plugin Registry</h3> <p>We are now down to the last step in this guide. Congratulations for making it this far! The final small (but important!) barrier between your plugin, and making it available in everyone’s Plover application, is its inclusion in the <a href="https://github.com/openstenoproject/plover_plugins_registry">Plover Plugin Registry list</a>. Follow the instructions on the repo <code class="language-plaintext highlighter-rouge">README</code> file, and <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request">create a pull request</a> that adds the name of your plugin to the <a href="https://github.com/openstenoproject/plover_plugins_registry/blob/421efcac42f0b2aae8cfa039c01b8c281371b621/registry.json"><code class="language-plaintext highlighter-rouge">registry.json</code></a> file.</p> <p>Since the Plover Practice Plugin is only for educational purposes, it does not belong in the registry, and hence we will not be making a pull request for it. However, here is an example of the pull request that added the <a href="https://github.com/paulfioravanti/plover-q-and-a">Plover Q&amp;A</a> plugin to the registry; you would create a similar one for your own plugin.</p> <p>It can sometimes take a while for pull requests to be approved, so do not get disheartened! As long as your plugin code is in a public git repo, people that really want it immediately can download it from there and install it manually, just like we did during development. So, I would recommend adding instructions on how to do that in your <code class="language-plaintext highlighter-rouge">README.md</code> file until your plugin makes it into the registry (<a href="https://github.com/paulfioravanti/plover-practice-plugin?tab=readme-ov-file#install">example</a>).</p> <p>When your pull request gets merged, your plugin will appear in everyone’s Plover Plugin list. Well done, and thanks for contributing to Plover’s ecosystem!</p> <h2 id="conclusion">Conclusion</h2> <p>My first Plover plugin was <a href="https://github.com/paulfioravanti/plover-q-and-a">Plover Q&amp;A</a>, and it was a plugin I did not want to make.</p> <p>It started as just a plain old <a href="https://github.com/paulfioravanti/steno-dictionaries/blob/b5b97066862bb5868ff4ce2dd8fe149e0c198291/dictionaries/q-and-a.json">JSON dictionary</a>, but having to constantly change speaker names for multiple entries was painful enough to make me change it into a <a href="https://github.com/paulfioravanti/steno-dictionaries/blob/697934326e30402f573538876d18b180d92f6eab/dictionaries/q_and_a.py">Plover Python dictionary</a> (thanks to the awesome <a href="https://github.com/openstenoproject/plover_python_dictionary">Plover Python dictionary plugin</a>).</p> <p>However, I found I <em>still</em> needed to manually update speaker names (though not as many as before), and eventually wanted to add more features like:</p> <ul> <li>keeping speaker names in some kind of internal state</li> <li>specifying custom config</li> <li>using Plover’s “Reconnect” button.</li> </ul> <p>Sound familiar? :) The pain of not having a plugin was too much, and the only way forward from there was to learn how to build the plugin I had been avoiding for so long, and take my first deep dive into Python and its ecosystem. I used to dread having to think about making a plugin, and now I am way more comfy with it.</p> <p>Hopefully this guide has been able to help lower any barriers you may feel exist between some cool thing you would love to see Plover do, and actually making it real. I look forward to seeing what you make!</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>You can confirm this in the <a href="https://docs.github.com/en/actions">GitHub action</a> that Plover uses to <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/.github/workflows/ci/workflow_context.yml#L11">build application distributions</a> for its supported platforms (Windows, macOS, Linux). <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2" role="doc-endnote"> <p>The latest version of Python as of this writing is <a href="https://www.python.org/downloads/release/python-3121/">Python 3.12.1</a>. I initially started building Plover plugins using Python 3.11 locally. However, I found out the hard way that some language features I used were introduced in Python versions released after 3.9, like the <a href="https://docs.python.org/3/reference/compound_stmts.html#match"><code class="language-plaintext highlighter-rouge">match</code> statement</a> (added in Python 3.10). This meant that although my plugin code tested fine locally, when I attempted to run it within Plover, it errored out since Python 3.9 has no idea what a <code class="language-plaintext highlighter-rouge">match</code> statement is (this problem is not limited to just your own code, but also if your plugin has <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/f6d522a985cf698127751ae437ff938c06214116/README.md#pyxa-version">third-party dependencies that use syntax features add after Python 3.9</a>). Locally developing on your target environment, and tailoring your code to it, is definitely recommended! <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:3" role="doc-endnote"> <p>See also my <a href="https://github.com/paulfioravanti/dotfiles/blob/3c35334c219ff472b428d49531fb81d38bfc9b33/asdf/setup.sh">asdf installation script</a> and <a href="https://github.com/paulfioravanti/dotfiles/blob/3c35334c219ff472b428d49531fb81d38bfc9b33/zshrc#L56">asdf zsh config</a> for more asdf setup examples. <a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:4" role="doc-endnote"> <p>It would seem that the naming conventions for project directories is to <a href="https://en.wiktionary.org/wiki/dasherize">dasherize</a> them. This is probably to distinguish them from the <a href="https://en.wiktionary.org/wiki/snake_case">snake case</a> naming convention used here for <a href="https://docs.python.org/3/tutorial/modules.html">modules</a> and <a href="https://docs.python.org/3/tutorial/modules.html#packages">packages</a>. <a href="#fnref:4" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:5" role="doc-endnote"> <p>This seems like a good guiding principle for any Plover plugin, rather than a <a href="https://plover.readthedocs.io/en/latest/plugin-dev/setup.html#module-based-structure">module-based structure</a>, unless you really know upfront that the scope of your plugin is going to be very small, and will <em>always stay that way</em>. If you are able to do this consistently, I would love to be able to borrow your <a href="https://en.wikipedia.org/wiki/Crystal_ball">crystal ball</a>! <a href="#fnref:5" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:6" role="doc-endnote"> <p>Setuptools seems to have adopted <a href="https://setuptools.pypa.io/en/latest/userguide/pyproject_config.html"><code class="language-plaintext highlighter-rouge">pyproject.toml</code></a> files as its preferred configuration standard moving forward. However, I found that attempting to use one with a Plover plugin resulted in its entry <a href="https://discord.com/channels/136953735426473984/1034561149947089007/1198977782160568340">mysteriously disappearing</a> from Plover’s Plugin Manager when Plover updated its plugin registry. Even though everything worked as expected during development when using a <code class="language-plaintext highlighter-rouge">pyproject.toml</code> config file (all the way through to deploying out to <a href="https://pypi.org/">PyPI</a>), it would seem that more development work needs to happen on Plover before its use becomes possible.</p> <p>Therefore, as of this writing, regardless of whether you see any documentation that says <code class="language-plaintext highlighter-rouge">setup.cfg</code> and/or <code class="language-plaintext highlighter-rouge">setup.py</code> files are “legacy” (eg <a href="https://pypi.org/project/pip/"><code class="language-plaintext highlighter-rouge">pip</code></a>’s <a href="https://pip.pypa.io/en/stable/reference/build-system/setup-py/">packaging documentation</a> etc), it seems they are currently the only viable option. I would love to be wrong about this, though, so please leave a comment or reach out to me if you have had success with using a <code class="language-plaintext highlighter-rouge">pyproject.toml</code> file with your own Plover plugin! <a href="#fnref:6" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:7" role="doc-endnote"> <p>Like the excellent <a href="https://github.com/KoiOates/plover_dict_commands">Plover Dict Commands</a> plugin. <a href="#fnref:7" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:8" role="doc-endnote"> <p>The Plover <a href="https://plover.readthedocs.io/en/latest/plugin-dev/commands.html">Plugin Commands documentation</a> shows commands as starting with <code class="language-plaintext highlighter-rouge">PLOVER</code>, which is correct: <code class="language-plaintext highlighter-rouge">COMMAND</code> (with a preceding colon [<code class="language-plaintext highlighter-rouge">:COMMAND</code>]) is a “<a href="https://github.com/openstenoproject/plover/wiki/Dictionary-Format#friendly-command-names">friendly command alias</a>” for it. Therefore, either <code class="language-plaintext highlighter-rouge">PLOVER</code> or <code class="language-plaintext highlighter-rouge">COMMAND</code> can be used to define commands, but I tend to use the following rule of thumb with naming in an effort to better communicate a command’s intent:</p> <ul> <li>If the scope of the action the command performs is limited to the Plover application itself, use <code class="language-plaintext highlighter-rouge">PLOVER</code> (eg built-in Plover commands like <code class="language-plaintext highlighter-rouge">{PLOVER:FOCUS}</code>, <code class="language-plaintext highlighter-rouge">{PLOVER:ADD_TRANSLATION}</code> etc)</li> <li>If the command does anything outside Plover, use <code class="language-plaintext highlighter-rouge">COMMAND</code> </li> </ul> <p><a href="#fnref:8" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:9" role="doc-endnote"> <p>Entry points can also be written in uppercase, if that helps you to understand the mapping between the outline and entry point: <code class="language-plaintext highlighter-rouge">OPEN_URL = plover_practice_plugin.command:open_url</code>. It would seem to be convention for entry points to be named in lowercase, but when Plover registers a plugin internally, it <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/plover/registry.py#L48">downcases the name</a> anyway, so you can technically name it in any case you please. <a href="#fnref:9" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:10" role="doc-endnote"> <p>More information about this syntax pattern can be found in Setuptools’ <a href="https://setuptools.pypa.io/en/latest/userguide/entry_point.html#entry-points-syntax">Entry Points Syntax documentation</a>. <a href="#fnref:10" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:11" role="doc-endnote"> <p>The <a href="https://github.com/openstenoproject/plover_plugins_manager/blob/ba368cbd89d48d81ef7d42b626d59fd15c8b17d3/setup.cfg#L53"><code class="language-plaintext highlighter-rouge">plover_plugins</code> script</a> is essentially a <a href="https://github.com/openstenoproject/plover_plugins_manager/blob/ba368cbd89d48d81ef7d42b626d59fd15c8b17d3/plover_plugins_manager/__main__.py#L40">wrapper around <code class="language-plaintext highlighter-rouge">pip</code></a>, and so the <code class="language-plaintext highlighter-rouge">--editable</code> flag here allows you to <a href="https://pip.pypa.io/en/stable/topics/local-project-installs/#editable-installs">“install your project without copying any files</a>. Instead, the files in the development directory are added to Python’s import path”. I initially thought that this meant that when we make changes to existing files that we want to test, we only need to restart the Plover application, rather than run the <code class="language-plaintext highlighter-rouge">plover_plugins</code> script every time. However, I have found that not to be the case, with every change requiring the script to be re-run. <a href="#fnref:11" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:12" role="doc-endnote"> <p>In order to make the <code class="language-plaintext highlighter-rouge">plover</code> command work as-written in the Plover wiki page on my operating system (macOS), I ended up adding the following line to my <a href="https://www.zsh.org/">zsh</a> initialisation file (<code class="language-plaintext highlighter-rouge">.zshrc</code>):</p> <p><code class="language-plaintext highlighter-rouge">alias plover=/Applications/Plover.app/Contents/MacOS/Plover</code> <a href="#fnref:12" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:13" role="doc-endnote"> <p>For a more robust implementation of a command plugin, including error handling etc, check out my <a href="https://github.com/paulfioravanti/plover-run-applescript">Plover Run AppleScript</a> plugin. <a href="#fnref:13" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:14" role="doc-endnote"> <p>Looking through the <a href="https://plover.readthedocs.io/en/latest/plugins.html">Plover Plugin Guide</a>, you may have also read about <a href="https://plover.readthedocs.io/en/latest/plugin-dev/macros.html">Macro</a> plugins, and, if you are like me, been a bit confused as to how they differ from Metas. There seems to be some overlap between their purposes, and I have found they often get lumped together (<a href="https://github.com/nsmarkop/plover_last_translation">Plover Last Translation</a> even has both macro and meta versions of its functions that do the same thing).</p> <p>After looking through how metas and macros are used in different plugins, as well as in <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/setup.cfg#L83">Plover itself</a>, my current personal <a href="https://en.wikipedia.org/wiki/Rule_of_thumb">rule of thumb</a> moving forward would be:</p> <blockquote> <p>“Use metas to output new text, and use macros to change or transform text that has already been output.”</p> </blockquote> <p>However, there are plenty of exceptions to this “rule”, like <a href="https://github.com/morinted/plover_emoji">Plover Emoji</a>, which converts written text to <a href="https://en.wikipedia.org/wiki/Emoji">emojis</a>, being a meta plugin, and Plover’s <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/setup.cfg#L102"><code class="language-plaintext highlighter-rouge">retro_case</code> and <code class="language-plaintext highlighter-rouge">retro_currency</code></a> plugins being metas, as apposed to all its other <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/setup.cfg#L85"><code class="language-plaintext highlighter-rouge">retro_</code> functions</a> being macros.</p> <p>One factor influencing that, though, could have been that macros were <a href="https://github.com/openstenoproject/plover/commit/ce40f8e1eb486226096dbca979ad175c3408431a">added to Plover in 2017</a>, while metas were <a href="https://github.com/openstenoproject/plover/commit/23db9f3ce1f4ec62ffd11055d54525b1691e74ef">added in 2020</a>. Perhaps <code class="language-plaintext highlighter-rouge">retro_case</code> and <code class="language-plaintext highlighter-rouge">retro_currency</code> were written as metas instead of macros because metas were created to supersede macros, which explains their ability to also change previous output via the <code class="language-plaintext highlighter-rouge">prev_replace</code> property of Plover’s <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/plover/formatting.py#L571"><code class="language-plaintext highlighter-rouge">_Action</code></a> class…? I do not know, and have not been able to find a clear answer, so I will stick with my rule of thumb for now. <a href="#fnref:14" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:15" role="doc-endnote"> <p>The naming, purpose, and details of <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/plover/formatting.py#L254"><code class="language-plaintext highlighter-rouge">_Context</code></a> and <a href="https://github.com/openstenoproject/plover/blob/53c416fd893d62ab9ede5898129da3be856e910d/plover/formatting.py#L571"><code class="language-plaintext highlighter-rouge">_Action</code></a> is something that can be glossed over for purposes of this post (and given their underscored naming, it would seem they are thought of as Plover internal details, even though you interact directly with objects of those classes in your plugin code…). There does not currently seem to be any high level documentation around them, so reading the code is currently your only real reference for gathering any further information about what they do and how they relate to each other. <a href="#fnref:15" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:16" role="doc-endnote"> <p>If the <code class="language-plaintext highlighter-rouge">[int(arg) for arg in argument.split(":")]</code> code looks confusing or unfamiliar, check out Python’s documentation on <a href="https://docs.python.org/3/tutorial/datastructures.html#list-comprehensions">list comprehensions</a>, a data structure used heavily in Python code, and definitely worth familiarising yourself with. <a href="#fnref:16" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:17" role="doc-endnote"> <p>Yes, technically <a href="https://en.wikipedia.org/wiki/Pseudorandom_number_generator">pseudo-random</a>, but the number’s unpredictability is not a critical feature of the plugin, so it will do for our purposes. <a href="#fnref:17" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:18" role="doc-endnote"> <p>I tried a multitude of ways that Python allows you to run a <a href="https://en.wikipedia.org/wiki/Shell_(computing)">shell</a> command before settling on using <code class="language-plaintext highlighter-rouge">os.popen</code>. In order to search for variables, the only way I found in which I was able to successfully reach past Plover’s local environment, and into the user’s environment, was to use the <code class="language-plaintext highlighter-rouge">os.popen</code> function, and run the command in <a href="https://www.gnu.org/software/bash/manual/html_node/Interactive-Shell-Behavior.html">interactive mode</a> (<code class="language-plaintext highlighter-rouge">-i</code> flag). I would love to hear from you if you were successful using any other method, as this may just be a macOS quirk! <a href="#fnref:18" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:19" role="doc-endnote"> <p>For an example of a plugin that hooks into <em>all</em> of Plover’s Engine Hooks, check out my <a href="https://github.com/paulfioravanti/plover-steno-engine-hooks-logger">Plover Steno Engine Hooks Logger</a> plugin (only really potentially useful during plugin development) <a href="#fnref:19" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:20" role="doc-endnote"> <p>The whole <a href="https://docs.python.org/3/library/stdtypes.html#str.join"><code class="language-plaintext highlighter-rouge">join</code></a>-ing and <a href="https://docs.python.org/3/library/stdtypes.html#str.split"><code class="language-plaintext highlighter-rouge">split</code></a>-ing in the code was added because running <code class="language-plaintext highlighter-rouge">_expand</code> on each env var name in a large list significantly impacted the plugin’s start up time. It is much faster to send a single string containing all the var names to the shell, like <code class="language-plaintext highlighter-rouge">"$VAR1,$VAR2,..."</code>, and have them all expanded inline at the same time. <a href="#fnref:20" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:21" role="doc-endnote"> <p>For an example of a extension plugin that covers this functionality, but is more thoughtfully architected (separation of plugin-specific logic from Plover-dependent code etc), includes error handling, and contains code quality features like <a href="https://pytest.org/">pytest</a> automated tests (where possible for non-Plover-dependent code), <a href="https://github.com/pylint-dev/pylint">pylint</a> static code analysis, and <a href="https://github.com/python/mypy">mypy</a> type checking, see my <a href="https://github.com/paulfioravanti/plover-local-env-var">Plover Local Env Var</a> plugin. <a href="#fnref:21" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:22" role="doc-endnote"> <p>Other popular ones include <a href="https://about.gitlab.com/">GitLab</a> and <a href="https://bitbucket.org/">Bitbucket</a>. <a href="#fnref:22" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:23" role="doc-endnote"> <p>I found this out the hard way while developing the <a href="https://github.com/paulfioravanti/plover-run-applescript">Plover Run AppleScript</a> plugin. In order to get automated tests to work in my <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/f6d522a985cf698127751ae437ff938c06214116/.github/workflows/ci.yml">GitHub CI workflow</a> for it, I <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/f6d522a985cf698127751ae437ff938c06214116/.github/workflows/ci.yml#L16">changed the OS</a> to be <code class="language-plaintext highlighter-rouge">runs-on: macos-latest</code>. When I attempted to apply that to the <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/f6d522a985cf698127751ae437ff938c06214116/.github/workflows/release.yml">release workflow</a>, publishing to PyPI errored out with a helpful message instructing me to change the config back to <code class="language-plaintext highlighter-rouge">runs-on: ubuntu-latest</code>. <a href="#fnref:23" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:24" role="doc-endnote"> <p><strong>Update Feb 8, 2024</strong>: Wouldn’t you know it, there is a better way to do this without needing that conditional: <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/8d9d14a76c31fd794416367bfa5c727751ca564c/.github/workflows/release.yml">this example</a> just uses <code class="language-plaintext highlighter-rouge">on: push: tags: - "v*"</code> config to make sure the job only runs when tags are pushed up that begin with “v”. It also has the benefit of <a href="https://github.com/paulfioravanti/plover-run-applescript/blob/8d9d14a76c31fd794416367bfa5c727751ca564c/.github/workflows/release.yml#L34">auto-generating a GitHub release</a>, and not needing to skip any jobs. Definitely shop around and check out other people’s plugin GitHub action config for other ways of doing things! <a href="#fnref:24" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:25" role="doc-endnote"> <p>We will just use a <a href="https://git-scm.com/book/en/Git-Basics-Tagging">lightweight tag</a> for simplicity’s sake, rather than an <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging#_annotated_tags">annotated tag</a>. <a href="#fnref:25" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/plover" class="page__taxonomy-item" rel="tag">plover</a><span class="sep">, </span> <a href="/tags/plugin" class="page__taxonomy-item" rel="tag">plugin</a><span class="sep">, </span> <a href="/tags/python" class="page__taxonomy-item" rel="tag">python</a><span class="sep">, </span> <a href="/tags/steno" class="page__taxonomy-item" rel="tag">steno</a><span class="sep">, </span> <a href="/tags/stenography" class="page__taxonomy-item" rel="tag">stenography</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-02-08">February 8, 2024</time></p> </footer> <section class="page__share"> <h4 class="page__share-title">Share on</h4> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Creating+Plover+Plugins+with+Python%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcreating-plover-plugins-python%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcreating-plover-plugins-python%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcreating-plover-plugins-python%2F&amp;title=Creating%20Plover%20Plugins%20with%20Python" class="btn btn--reddit" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcreating-plover-plugins-python%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/coding-test-review-culture-amp/" class="pagination--pager" title="Coding Test Review: Culture Amp ">Previous</a> <a href="/blog/amazon-prime-localisation-fail/" class="pagination--pager" title="Amazon Prime’s Localisation Fail ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Leave a comment</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You may also enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-03-11/shimbashi-screen.jpg" alt="Shake map showing distribution of maximum JMA Seismic Intensities by-prefecture for the 11 March 2011"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/3-11/" rel="permalink">3.11 </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-03-11T09:15:00+11:00">March 11, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 7 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Reflections on living through Japan’s biggest recorded earthquake. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-02-21/frank-mckenna-JB92NeJSxW4-unsplash.jpg" alt="man riding bike and woman running holding flag of USA"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/amazon-prime-localisation-fail/" rel="permalink">Amazon Prime’s Localisation Fail </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-02-21T15:30:00+11:00">February 21, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 4 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Does Prime have an unconscious bias hard coded in its media descriptions? </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-12-07/celpax-1Lf5Adh9SCg-unsplash.jpg" alt="person holding white card near green plant"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/coding-test-review-culture-amp/" rel="permalink">Coding Test Review: Culture Amp </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-12-07T15:10:00+11:00">December 7, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 19 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Did I feel empowered to get the coding tests done for which I am responsible? </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-10-25/dot-matrix-printer.jpg" alt="Epson LX-300+ dot matrix printer with optional colour kit"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/same-page-hid-device/" rel="permalink">Get on the Same Page as your HID Device </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-10-25T16:25:00+11:00">October 25, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 14 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><strong>Follow:</strong></li> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2024 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q173829KF7"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q173829KF7",{anonymize_ip:!1});</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/creating-plover-plugins-python/",this.page.identifier="/blog/creating-plover-plugins-python"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>