<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Sharing AppleScript Handlers | Floor and Varnish</title> <meta name="description" content="Navigating AppleScript’s awkward handshakes between files."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Sharing AppleScript Handlers"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/sharing-applescript-handlers/"> <meta property="og:description" content="Navigating AppleScript’s awkward handshakes between files."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2022-07-05/sliced-apples-overlay.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Sharing AppleScript Handlers"> <meta name="twitter:description" content="Navigating AppleScript’s awkward handshakes between files."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/sharing-applescript-handlers/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2022-07-05/sliced-apples-overlay.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2022-07-05T08:30:00+10:00"> <meta property="article:modified_time" content="2024-01-17T12:46:00+11:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/sharing-applescript-handlers/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('/assets/images/2022-07-05/sliced-apples-overlay.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Sharing AppleScript Handlers </h1> <p class="page__lead">Navigating AppleScript’s awkward handshakes between files. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-07-05T08:30:00+10:00">July 5, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 6 minute read </span> </p> </div> <span class="page__hero-caption">Photo by: Marco Verch under <a href="https://creativecommons.org/licenses/by/2.0/" target="_blank"> Creative Commons 2.0 </a> </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://instagram.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/@paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Sharing AppleScript Handlers"> <meta itemprop="description" content="Navigating AppleScript’s awkward handshakes between files."> <meta itemprop="datePublished" content="2022-07-05T08:30:00+10:00"> <meta itemprop="dateModified" content="2024-01-17T12:46:00+11:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>Being able to share code between files is a great way to put programming logic “<a href="https://en.wikipedia.org/wiki/Single_source_of_truth">in its right place</a>”, and prevent single files from containing hundreds or thousands of lines of code.</p> <p>A very basic example of sharing code in <a href="https://www.python.org/">Python</a> could be having a directory called <code class="language-plaintext highlighter-rouge">code/</code>, and in it, a file called <code class="language-plaintext highlighter-rouge">greetings.py</code>. This file contains very important business logic about how to say “hello”:</p> <p><strong><code class="language-plaintext highlighter-rouge">code/greetings.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Hello there!</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>Now, say I have a <code class="language-plaintext highlighter-rouge">greeter.py</code> file in the same directory, who has no idea how to say “hello”, and wants to leverage the specialised knowledge its neighbour file has on how to do it. It can do so easily by <code class="language-plaintext highlighter-rouge">import</code>ing the <code class="language-plaintext highlighter-rouge">hello</code> function from the <code class="language-plaintext highlighter-rouge">greetings</code> file, and using it:</p> <p><strong><code class="language-plaintext highlighter-rouge">code/greeter.py</code></strong></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">greetings</span> <span class="kn">import</span> <span class="n">hello</span>

<span class="nf">hello</span><span class="p">()</span>
</code></pre></div></div> <p>Running the <code class="language-plaintext highlighter-rouge">greeter</code> program outputs what you would expect:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>python code/greeter.py
<span class="go">Hello there!
</span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">from greetings import hello</code> line is able to find the <code class="language-plaintext highlighter-rouge">greetings</code> file thanks to Python’s <a href="https://docs.python.org/3/library/sys.html#sys.path"><code class="language-plaintext highlighter-rouge">sys.path</code></a>, a “list of strings that specifies the search path for modules”, which includes the directory of the script being run: in this case, the <code class="language-plaintext highlighter-rouge">code/</code> directory. Makes sense.</p> <p>Many programming languages have similar mechanisms to allow sharing code in simple, unobstructive ways. <a href="https://en.wikipedia.org/wiki/AppleScript">AppleScript</a> <em>can</em> share code, but certainly not in an intuitive way like Python. The extra steps required to do so compelled me to make a note of them somewhere, in order to not have to scour the internet to figure this out again.</p> <p>So, I will illustrate this sharing process by <a href="https://en.wikipedia.org/wiki/Code_refactoring">refactoring</a> out <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_about_handlers.html#//apple_ref/doc/uid/TP40000983-CH206-CJBIDBJH">handlers</a> (read: <a href="https://en.wikipedia.org/wiki/Subroutine">functions</a>) into separate files using an example from <a href="https://github.com/paulfioravanti/steno-dictionaries/tree/main/src/command">my stenography dictionaries</a>, where I have employed AppleScript to control my Mac using <a href="https://www.artofchording.com/introduction/how-steno-works.html">stenographic chords</a> (don’t worry, the <a href="https://en.wikipedia.org/wiki/Stenotype">stenography</a> context here is not important).</p> <h2 id="contextual-refreshing">Contextual Refreshing</h2> <p>I have an AppleScript file that performs a keyboard shortcut for a “refresh”.</p> <p>The most common <a href="https://en.wikipedia.org/wiki/Use_case">use case</a> for a “refresh” on a computer would probably be refreshing a browser window, and its keyboard shortcut on <a href="https://en.wikipedia.org/wiki/MacOS">macOS</a> is ⌘R (<a href="https://en.wikipedia.org/wiki/Command_key">Command</a>-R). Many other applications use the same ⌘R shortcut for their own interpretation of “refresh”, so contextually, it is quite a safe one to use.</p> <p>However, when I have the very specific use case of using the <a href="https://www.vim.org/">Vim</a> text editor in an <a href="https://iterm2.com/">iTerm2</a> terminal, I need a “refresh” to mean “refresh the <a href="https://github.com/ctrlpvim/ctrlp.vim">ctrlp.vim</a> fuzzy file finder’s cache, so it picks up the existence of any new files”, and the shortcut for that is F5 (<a href="https://en.wikipedia.org/wiki/Function_key">Function Key</a>-5).</p> <p>So, the script needs to figure out what current the “active” application is, and then “press” the appropriate keyboard shortcut (either ⌘R, or F5). Here is what that looks like in my code:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/command/actions/refresh.applescript</code></strong></p> <div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">on</span> <span class="nb">run</span><span class="w">
  </span><span class="k">set</span><span class="w"> </span><span class="nv">activeApp</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">getActiveApp</span><span class="p">()</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="nv">activeApp</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="s2">"iTerm2"</span><span class="w"> </span><span class="k">then</span><span class="w">
    </span><span class="nv">performiTerm2Refresh</span><span class="p">()</span><span class="w">
  </span><span class="k">else</span><span class="w">
    </span><span class="nv">performRefresh</span><span class="p">(</span><span class="nv">activeApp</span><span class="p">)</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nb">run</span><span class="w">

</span><span class="k">on</span> <span class="nv">performiTerm2Refresh</span><span class="p">()</span><span class="w">
  </span><span class="k">set</span><span class="w"> </span><span class="nv">processName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">getiTermProcessName</span><span class="p">()</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="nv">processName</span><span class="w"> </span><span class="ow">contains</span><span class="w"> </span><span class="s2">"vim"</span><span class="w"> </span><span class="k">then</span><span class="w">
    </span><span class="nv">performVimRefresh</span><span class="p">()</span><span class="w">
  </span><span class="k">else</span><span class="w">
    </span><span class="nb">display</span><span class="w"> </span><span class="nv">notification</span><span class="w"> </span><span class="s2">"Nothing to refresh."</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="na">title</span><span class="w"> </span><span class="s2">"Error"</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">performiTerm2Refresh</span><span class="w">

</span><span class="k">on</span> <span class="nv">performVimRefresh</span><span class="p">()</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">tell</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="s2">"iTerm2"</span><span class="w">
    </span><span class="c1"># 96 = F5</span><span class="w">
    </span><span class="na">key code</span><span class="w"> </span><span class="mi">96</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">performVimRefresh</span><span class="w">

</span><span class="k">on</span> <span class="nv">performRefresh</span><span class="p">(</span><span class="nv">activeApp</span><span class="p">)</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">tell</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="nv">activeApp</span><span class="w">
    </span><span class="nv">keystroke</span><span class="w"> </span><span class="s2">"r"</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="p">{</span><span class="nv">command</span><span class="w"> </span><span class="nv">down</span><span class="p">}</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">performRefresh</span><span class="w">

</span><span class="k">on</span> <span class="nv">getActiveApp</span><span class="p">()</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w">
    </span><span class="nb">return</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">first</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="nb">whose</span><span class="w"> </span><span class="na">frontmost</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="nb">true</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">getActiveApp</span><span class="w">

</span><span class="k">on</span> <span class="nv">getiTermProcessName</span><span class="p">()</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"iTerm2"</span><span class="w">
    </span><span class="nb">return</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="nv">session</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="na">window</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">getiTermProcessName</span><span class="w">
</span></code></pre></div></div> <p>In this file there are six handlers, with the <code class="language-plaintext highlighter-rouge">on run</code> handler at the top being the entry point for when the script is run. The first four handlers contain code that is <em>specific</em> to “refreshing”, but the final two handlers, <code class="language-plaintext highlighter-rouge">getActiveApp()</code> and <code class="language-plaintext highlighter-rouge">getiTermProcessName()</code>, contain code that is general enough that other scripts could leverage them. Therefore, they are the perfect candidates for extraction into some other file, where they can be shared.</p> <p>Let’s remove them from <code class="language-plaintext highlighter-rouge">refresh.applescript</code>, and put them into a “utilities” file:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/command/actions/util.applescript</code></strong></p> <div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">on</span> <span class="nv">getActiveApp</span><span class="p">()</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w">
    </span><span class="nb">return</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">first</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="nb">whose</span><span class="w"> </span><span class="na">frontmost</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="nb">true</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">getActiveApp</span><span class="w">

</span><span class="k">on</span> <span class="nv">getiTermProcessName</span><span class="p">()</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"iTerm2"</span><span class="w">
    </span><span class="nb">return</span><span class="w"> </span><span class="na">name</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="nv">session</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">current</span><span class="w"> </span><span class="na">window</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">getiTermProcessName</span><span class="w">
</span></code></pre></div></div> <p>Okay, so now the big question: how can <code class="language-plaintext highlighter-rouge">refresh.applescript</code> use the code that now lives in <code class="language-plaintext highlighter-rouge">util.applescript</code>?</p> <h2 id="creating-shared-libraries">Creating Shared Libraries</h2> <p>AppleScript cannot just reach into neighbouring files with a line like <code class="language-plaintext highlighter-rouge">from util import getActiveApp</code>. What needs to occur is the metamorphosis of the utilities script into what AppleScript calls a <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_script_objects.html#//apple_ref/doc/uid/TP40000983-CH207-SW6">Script Library</a>, which involves:</p> <ul> <li>Creating a compiled version of the script with the <a href="https://ss64.com/osx/osacompile.html"><code class="language-plaintext highlighter-rouge">osacompile</code></a> command line tool (the compiled script will have a <a href="https://fileinfo.com/extension/scpt"><code class="language-plaintext highlighter-rouge">.scpt</code></a> file extension, instead of <code class="language-plaintext highlighter-rouge">.applescript</code>)</li> <li>Putting the compiled script in a designated “Script Libraries” folder, whose locations are numerous (see previous <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_script_objects.html#//apple_ref/doc/uid/TP40000983-CH207-SW6">Script Library</a> link), but the one I have seen cited most often, and that <em>did</em> work for me, is in the user Library directory, specifically: <code class="language-plaintext highlighter-rouge">~/Library/Script Libraries/</code> </li> </ul> <p>After those steps are done, we can use the utility handlers again, so let’s give it a shot!</p> <p>First, create the compiled script:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">osacompile -o util.scpt util.applescript
</span></code></pre></div></div> <p>Now, move the newly created <code class="language-plaintext highlighter-rouge">util.scpt</code> script to the Script Libraries directory. Since that directory gets used by other programs as well, let’s silo the file in its own directory called <code class="language-plaintext highlighter-rouge">steno-dictionaries</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">mkdir -p ~/Library/Script Libraries/steno-dictionaries
mv util.scpt ~/Library/Script Libraries/steno-dictionaries
</span></code></pre></div></div> <p>Now, we can change <code class="language-plaintext highlighter-rouge">refresh.applescript</code> to use the handlers in the newly-minted Script Library:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/command/actions/refresh.applescript</code></strong></p> <div class="language-applescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">property</span><span class="w"> </span><span class="nv">Util</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nv">script</span><span class="w"> </span><span class="s2">"steno-dictionaries/util"</span><span class="w">

</span><span class="k">on</span> <span class="nb">run</span><span class="w">
  </span><span class="k">set</span><span class="w"> </span><span class="nv">activeApp</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">Util</span>'s <span class="nv">getActiveApp</span><span class="p">()</span><span class="w">

  </span><span class="c1"># ...</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nb">run</span><span class="w">

</span><span class="k">on</span> <span class="nv">performiTerm2Refresh</span><span class="p">()</span><span class="w">
  </span><span class="k">set</span><span class="w"> </span><span class="nv">processName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="nv">Util</span>'s <span class="nv">getiTermProcessName</span><span class="p">()</span><span class="w">

  </span><span class="c1"># ...</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="nv">performiTerm2Refresh</span><span class="w">

</span><span class="c1"># ...</span><span class="w">
</span></code></pre></div></div> <p>Done! Since Shared Libraries are compiled, this enables us to reference them as a static <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_fundamentals.html#//apple_ref/doc/uid/TP40000983-CH218-SW5">Property</a> (here named <code class="language-plaintext highlighter-rouge">Util</code>), allowing for commands to be sent to it using the <a href="https://developer.apple.com/library/archive/documentation/AppleScript/Conceptual/AppleScriptLangGuide/conceptual/ASLR_script_objects.html#//apple_ref/doc/uid/TP40000983-CH207-SW3">possessive syntax</a> (<code class="language-plaintext highlighter-rouge">'s</code>).</p> <h2 id="shared-libraries-at-scale">Shared Libraries at Scale</h2> <p>The example above is all well and good for compiling a single Shared Library, but performing those commands for multiple files gets tiresome quite quickly.</p> <p>In order to automate this in my <a href="https://github.com/paulfioravanti/steno-dictionaries">steno-dictionaries repo</a>, I wrote some <a href="https://en.wikipedia.org/wiki/Shell_script">shell scripts</a> (that live in its <a href="https://github.com/paulfioravanti/steno-dictionaries/tree/main/bin"><code class="language-plaintext highlighter-rouge">bin/</code> directory</a>) that “bootstrap” the process of making the AppleScript code in the repository ready to use after being <a href="https://git-scm.com/docs/git-clone">cloned</a>. They ensure that running one command (<code class="language-plaintext highlighter-rouge">./bin/bootstrap</code>) will, in the following order:</p> <ul> <li>Create a <code class="language-plaintext highlighter-rouge">~/Library/Script Libraries/steno-dictionaries</code> directory</li> <li>Compile all AppleScript files that will become Script Libraries into <code class="language-plaintext highlighter-rouge">.scpt</code> files</li> <li>Move the Script Library <code class="language-plaintext highlighter-rouge">.scpt</code> files to <code class="language-plaintext highlighter-rouge">~/Library/Script Libraries/steno-dictionaries</code> </li> <li>Then, compile all other AppleScript files that reference the Script Libraries (but are not, themselves, Script Libraries) into <code class="language-plaintext highlighter-rouge">.scpt</code> files</li> </ul> <blockquote> <p>(I’m assuming that running <code class="language-plaintext highlighter-rouge">.scpt</code> files are faster than <code class="language-plaintext highlighter-rouge">.applescript</code> files since they are compiled, but I cannot seem to find conclusive evidence to back up that assumption on the internet, which is weird…).</p> </blockquote> <p>The <code class="language-plaintext highlighter-rouge">.scpt</code> scripts are executed by shell commands that run <a href="https://ss64.com/osx/osascript.html"><code class="language-plaintext highlighter-rouge">osascript</code></a> commands, which are contained in steno chord entries in the repo’s <a href="https://github.com/paulfioravanti/steno-dictionaries/tree/main/src/command"><code class="language-plaintext highlighter-rouge">commands</code> directory</a>. The one that runs the “refresh” script looks like this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash <span class="nt">-ci</span> <span class="s1">'osascript $STENO_DICTIONARIES/src/command/actions/refresh.scpt'</span>
</code></pre></div></div> <blockquote> <p>The shell commands run in <a href="https://www.gnu.org/software/bash/manual/html_node/Interactive-Shell-Behavior.html">interactive mode</a> for <a href="https://github.com/paulfioravanti/steno-dictionaries/blob/main/dictionaries/commands.md">reasons</a>.</p> </blockquote> <h2 id="caring-about-sharing">Caring about Sharing</h2> <p>I really wish that sharing code in AppleScript was not as complex as it currently is, but I do not see that changing at all, assuming that AppleScript itself even survives into the future.</p> <p>The revamped <a href="https://developer.apple.com/">Apple Developer site</a> would seem to ignore AppleScript’s existence altogether (all the documentation links used in this post seem to come from the archive, implying they are now legacy and unmaintained…), but I do not see any alternative candidate language being put forward for macOS system automation programming.</p> <p>Personally, I would be happy to change everything I have written into <a href="https://www.swift.org/">Swift</a>, if that was possible. But, for now, I need AppleScript, and if you do too, hopefully this post has been able to serve as some reference.</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/apple" class="page__taxonomy-item" rel="tag">apple</a><span class="sep">, </span> <a href="/tags/scripting" class="page__taxonomy-item" rel="tag">scripting</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-01-17">January 17, 2024</time></p> </footer> <section class="page__share"> <h4 class="page__share-title">Share on</h4> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Sharing+AppleScript+Handlers%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsharing-applescript-handlers%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsharing-applescript-handlers%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsharing-applescript-handlers%2F&amp;title=Sharing%20AppleScript%20Handlers" class="btn btn--reddit" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsharing-applescript-handlers%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/welcome-back-overwork/" class="pagination--pager" title="“Welcome back” ">Previous</a> <a href="/blog/thanks-past-me/" class="pagination--pager" title="Thanks, Past-Me ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Leave a comment</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You may also enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-02-04/doc-brown-cable-connect.jpg" alt="Doc Brown from the movie Back to the Future connecting a plug and socket"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/creating-plover-plugins-python/" rel="permalink">Creating Plover Plugins with Python </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-02-04T21:35:00+11:00">February 4, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 44 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-12-07/celpax-1Lf5Adh9SCg-unsplash.jpg" alt="person holding white card near green plant"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/coding-test-review-culture-amp/" rel="permalink">Coding Test Review: Culture Amp </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-12-07T15:10:00+11:00">December 7, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 20 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Did I feel empowered to get the coding tests done for which I am responsible? </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-10-25/dot-matrix-printer.jpg" alt="Epson LX-300+ dot matrix printer with optional colour kit"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/same-page-hid-device/" rel="permalink">Get on the Same Page as your HID Device </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-10-25T16:25:00+11:00">October 25, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 14 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-04-28/obama-medal.jpg" alt="Obama gives medal to himself meme"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/thanks-past-me/" rel="permalink">Thanks, Past-Me </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-04-28T15:30:00+10:00">April 28, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 19 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">Past-me wrote stuff down that benefited future-me. Present-me needs to keep paying that forward. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><strong>Follow:</strong></li> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2024 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q173829KF7"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q173829KF7",{anonymize_ip:!1});</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/sharing-applescript-handlers/",this.page.identifier="/blog/sharing-applescript-handlers"};!function(){var t=document,a=t.createElement("script");a.src="https://paulfioravanti.disqus.com/embed.js",a.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(a)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>