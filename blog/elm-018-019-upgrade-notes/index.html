<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Elm 0.18 to 0.19 upgrade notes | Floor and Varnish</title> <meta name="description" content="Quite a lot has changed in the Elm ecosystem between version 0.18 and 0.19, so here are some notes I jotted down while upgrading a few small apps."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Elm 0.18 to 0.19 upgrade notes"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/elm-018-019-upgrade-notes/"> <meta property="og:description" content="Quite a lot has changed in the Elm ecosystem between version 0.18 and 0.19, so here are some notes I jotted down while upgrading a few small apps."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2019-04-01/david-travis-547046-unsplash.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Elm 0.18 to 0.19 upgrade notes"> <meta name="twitter:description" content="Quite a lot has changed in the Elm ecosystem between version 0.18 and 0.19, so here are some notes I jotted down while upgrading a few small apps."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/elm-018-019-upgrade-notes/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2019-04-01/david-travis-547046-unsplash.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2019-04-01T14:20:00+11:00"> <meta property="article:modified_time" content="2020-11-08T13:00:00+11:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/elm-018-019-upgrade-notes/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2019-04-01/david-travis-547046-unsplash.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Elm 0.18 to 0.19 upgrade notes </h1> <p class="page__lead">Quite a lot has changed in the Elm ecosystem between version 0.18 and 0.19, so here are some notes I jotted down while upgrading a few small apps. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2019-04-01T14:20:00+11:00">April 1, 2019</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 13 minute read </span> </p> <a href="http://www.elmweekly.nl/issues/elm-weekly-issue-62-176112" style="text-decoration: none;"> <img src="https://img.shields.io/badge/Elm%20Weekly-%2362-green.svg" alt="Elm Weekly #62"> </a> </div> <span class="page__hero-caption">Photo by <a href="https://unsplash.com/photos/5bYxXawHOQg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">David Travis</a> on <a href="https://unsplash.com/search/photos/notes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a> </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/channel/UC_ObnUGtIfRRq6vbxFYRpUg" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Elm 0.18 to 0.19 upgrade notes"> <meta itemprop="description" content="Quite a lot has changed in the Elm ecosystem between version 0.18 and 0.19, so here are some notes I jotted down while upgrading a few small apps."> <meta itemprop="datePublished" content="2019-04-01T14:20:00+11:00"> <meta itemprop="dateModified" content="2020-11-08T13:00:00+11:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>I upgraded a few toy <a href="https://elm-lang.org/">Elm</a> 0.18 applications I had to 0.19, and along the way, I encountered some things that I felt I needed to jot down for future me (and hopefully current/future you as well) to reference.</p> <p>They are mostly the results of trawling the <a href="https://elmlang.herokuapp.com/">Elm Slack</a>, <a href="https://discourse.elm-lang.org/">Elm Discourse</a>, Github issues, documentation for upgraded-to-Elm-0.19 libraries, other blog posts, and trial and error.</p> <p>So, here they are in no particular order. If you are currently going through an Elm 0.18 to 0.19 upgrade, I hope these points save you some time!</p> <h2 id="preface">Preface</h2> <p>The very first thing you should do before attempting to update any code manually is install <a href="https://github.com/avh4/elm-upgrade"><code class="language-plaintext highlighter-rouge">elm-upgrade</code></a>, and run it over your Elm 0.18 app.</p> <p>There is not much else to add here that is not covered in <code class="language-plaintext highlighter-rouge">elm-upgrade</code>’s <code class="language-plaintext highlighter-rouge">README</code> file. Follow its instructions until you have implemented its recommendations, and you will be ready to venture out on your own.</p> <h2 id="rip-partially-exposing-custom-types">RIP partially <code class="language-plaintext highlighter-rouge">exposing</code> custom types</h2> <p>In Elm 0.18, if I had a union type (re-named “custom type” in 0.19) that looked like:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Language</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="k">type</span> <span class="kt">Lang</span>
    <span class="o">=</span> <span class="kt">En</span>
    <span class="o">|</span> <span class="kt">It</span>
    <span class="o">|</span> <span class="kt">Ja</span>
</code></pre></div></div> <p>I was able to partially expose values in the type when <code class="language-plaintext highlighter-rouge">import</code>ed into another module. For example, if I wanted to use <code class="language-plaintext highlighter-rouge">Lang</code> in another module, but did not require the <code class="language-plaintext highlighter-rouge">It</code> value, I could write:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="kt">Language</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">(</span><span class="kt">En</span><span class="o">,</span> <span class="kt">Ja</span><span class="p">))</span>

<span class="n">availableLanguages</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Lang</span>
<span class="n">availableLanguages</span> <span class="o">=</span>
    <span class="p">[</span> <span class="kt">En</span><span class="o">,</span> <span class="kt">Ja</span> <span class="p">]</span>
</code></pre></div></div> <p>In Elm 0.19, this is no longer permitted, nor is explicitly exposing <em>all</em> values from a custom type i.e. <code class="language-plaintext highlighter-rouge">import Language exposing (Lang(En, It, Ja))</code>.</p> <p>The only options for accessing the types directly are exposing everything from a module (<code class="language-plaintext highlighter-rouge">import Language exposing (..)</code>), which I do not like due to its non-explicit nature, or the remaining option, accessing the custom type values through the module name itself:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="kt">Language</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>

<span class="n">availableLanguages</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Lang</span>
<span class="n">availableLanguages</span> <span class="o">=</span>
    <span class="p">[</span> <span class="kt">Language</span><span class="o">.</span><span class="kt">En</span><span class="o">,</span> <span class="kt">Language</span><span class="o">.</span><span class="kt">Ja</span> <span class="p">]</span>
</code></pre></div></div> <p>I do miss not being able to explicitly expose imported custom type values, and it feels strange in this case to write <code class="language-plaintext highlighter-rouge">Language.En</code> instead of <code class="language-plaintext highlighter-rouge">Lang.En</code> (because are we not accessing a value of the type and not of the module?), but this is how I will be using them moving forward. More information about the rationale behind this change can be found at <a href="https://discourse.elm-lang.org/t/exposing-a-subset-of-custom-type-constructors-in-0-19/1836">this Elm Discourse thread</a>.</p> <h2 id="rip-basicstostring">RIP <code class="language-plaintext highlighter-rouge">Basics.toString</code> </h2> <p>In Elm 0.18, I used the convenience of <code class="language-plaintext highlighter-rouge">toString</code> to stringify custom type values. I had a list of typed languages in an app that looked like this:</p> <p><strong><code class="language-plaintext highlighter-rouge">Language.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">Language</span>
    <span class="o">=</span> <span class="kt">En</span>
    <span class="o">|</span> <span class="kt">It</span>
    <span class="o">|</span> <span class="kt">Ja</span>
</code></pre></div></div> <p>In order to keep track of what language a user switched the app to, I wanted to stringify the face values of the type before sending them off via ports to be put in browser local storage. This happened in an <code class="language-plaintext highlighter-rouge">update</code> function that looked something like:</p> <p><strong><code class="language-plaintext highlighter-rouge">Locale/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Locale</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Locale</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">locale</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">ChangeLanguage</span> <span class="n">language</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">locale</span> <span class="o">|</span> <span class="n">language</span> <span class="o">=</span> <span class="n">language</span> <span class="p">}</span>
            <span class="o">,</span> <span class="n">language</span>
                <span class="o">|&gt;</span> <span class="n">toString</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">toLower</span>
                <span class="o">|&gt;</span> <span class="kt">Ports</span><span class="o">.</span><span class="n">storeLanguage</span>
            <span class="p">)</span>

        <span class="c1">-- ...</span>
</code></pre></div></div> <p>When a <code class="language-plaintext highlighter-rouge">ChangeLanguage</code> message is received, before sending the <code class="language-plaintext highlighter-rouge">Language</code> outside of Elm-land, it would get transformed from <code class="language-plaintext highlighter-rouge">En</code> to <code class="language-plaintext highlighter-rouge">"En"</code> to <code class="language-plaintext highlighter-rouge">"en"</code>. I thought this was pretty convenient, but Elm 0.19 put a stop to that, and I needed to change the code to something like this:</p> <p><strong><code class="language-plaintext highlighter-rouge">Language.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">Language</span>
    <span class="o">=</span> <span class="kt">En</span>
    <span class="o">|</span> <span class="kt">It</span>
    <span class="o">|</span> <span class="kt">Ja</span>

<span class="n">toString</span> <span class="p">:</span> <span class="kt">Language</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">toString</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">language</span> <span class="k">of</span>
        <span class="kt">En</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">en"</span>

        <span class="kt">It</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">it"</span>

        <span class="kt">Ja</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">ja"</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">Msg</span><span class="o">.</span><span class="kt">ChangeLanguage</span> <span class="n">language</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="kt">Model</span><span class="o">.</span><span class="n">changeLanguage</span> <span class="n">language</span> <span class="n">model</span>
            <span class="o">,</span> <span class="n">language</span>
                <span class="o">|&gt;</span> <span class="kt">Language</span><span class="o">.</span><span class="n">toString</span>
                <span class="o">|&gt;</span> <span class="kt">Ports</span><span class="o">.</span><span class="n">storeLanguage</span>
            <span class="p">)</span>
</code></pre></div></div> <p>This change initially felt like Elm was forcing me to write more boilerplate code. But, I now like the extra explicitness, as well as the very hard line approach that conveys to me that types are in <em>no way</em> related to strings.</p> <p>There is still an escape hatch to stringify a type during development using Elm 0.19’s <a href="https://package.elm-lang.org/packages/elm/core/latest/Debug#toString"><code class="language-plaintext highlighter-rouge">Debug.toString</code></a> function, but <a href="https://package.elm-lang.org/packages/elm/core/latest/Debug">as its documentation says</a>, “[i]t is not available for use in packages or production”.</p> <h2 id="body-tag-attributes-must-still-be-set-via-ports"> <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> tag attributes must still be set via ports</h2> <p>One major change with views in Elm 0.19 is that if you are creating an HTML document that is entirely managed by Elm (using either <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#document"><code class="language-plaintext highlighter-rouge">Browser.document</code></a> or <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#application"><code class="language-plaintext highlighter-rouge">Browser.application</code></a>), then your <code class="language-plaintext highlighter-rouge">view</code> function now returns <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#document"><code class="language-plaintext highlighter-rouge">Document msg</code></a>, rather than <a href="https://package.elm-lang.org/packages/elm/html/latest/Html#Html"><code class="language-plaintext highlighter-rouge">Html msg</code></a>.</p> <p>A <code class="language-plaintext highlighter-rouge">Document</code> is a record that looks like this:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="k">alias</span> <span class="kt">Document</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">title</span> <span class="p">:</span> <span class="kt">String</span>
    <span class="o">,</span> <span class="n">body</span> <span class="p">:</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Html</span> <span class="n">msg</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div> <p>What is strange to me, is that unlike the function signatures of all the tags in the <a href="https://package.elm-lang.org/packages/elm/html/latest/Html"><code class="language-plaintext highlighter-rouge">Html</code> module</a>, which look like <code class="language-plaintext highlighter-rouge">List (Attribute msg) -&gt; List (Html msg) -&gt; Html msg</code>, the <code class="language-plaintext highlighter-rouge">body</code> attribute of a <code class="language-plaintext highlighter-rouge">Document</code> only takes a <code class="language-plaintext highlighter-rouge">List (Html msg)</code> for the children of the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> tag, and not a <code class="language-plaintext highlighter-rouge">List (Attribute msg)</code> for attributes of the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> tag itself.</p> <p>So, if I want to, say, set some classes on the <code class="language-plaintext highlighter-rouge">&lt;body&gt;</code> tag to get <code class="language-plaintext highlighter-rouge">&lt;body class="bg-white sans-serif w-100"</code>, I would have to do this using ports, just like in Elm 0.18. For a <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#application"><code class="language-plaintext highlighter-rouge">Browser.application</code></a> Elm app, this could look like:</p> <p><strong><code class="language-plaintext highlighter-rouge">Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="n">initBodyClasses</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>

<span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Flags</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Browser</span><span class="o">.</span><span class="n">application</span>
        <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="o">,</span> <span class="c1">-- ...</span>
        <span class="p">}</span>


<span class="n">init</span> <span class="p">:</span> <span class="kt">Flags</span> <span class="o">-&gt;</span> <span class="kt">Url</span> <span class="o">-&gt;</span> <span class="kt">Key</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="n">flags</span> <span class="n">url</span> <span class="n">key</span> <span class="o">=</span>
    <span class="p">(</span> <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="n">flags</span> <span class="n">url</span> <span class="n">key</span>
    <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">batch</span>
        <span class="p">[</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">pushUrl</span> <span class="n">key</span> <span class="p">(</span><span class="kt">Url</span><span class="o">.</span><span class="n">toString</span> <span class="n">url</span><span class="p">)</span>
        <span class="o">,</span> <span class="n">initBodyClasses</span> <span class="s">"</span><span class="s2">bg-white sans-serif w-100"</span>
        <span class="p">]</span>
    <span class="p">)</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">index.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">ports</span><span class="p">.</span><span class="nx">initBodyClasses</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">classes</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">classes</span>
<span class="p">})</span>
</code></pre></div></div> <p>Ultimately, this is a minor inconvenience, but I only note it because it is something that I would expect to be able to do in Elm-land. Perhaps in a future version…?</p> <h2 id="conditional-subscriptions-dependent-on-model-attributes">Conditional subscriptions dependent on model attributes</h2> <p>I had a locale dropdown menu in an application which, when clicked, would open a list of languages that could be switched to (i.e. a <code class="language-plaintext highlighter-rouge">msg</code> would be sent to update a <code class="language-plaintext highlighter-rouge">showAvailableLanguages</code> attribute on a <code class="language-plaintext highlighter-rouge">locale</code> record in the model to <code class="language-plaintext highlighter-rouge">True</code>). Whenever you clicked anywhere on the page aside from the menu, it would close (i.e. a <code class="language-plaintext highlighter-rouge">msg</code> would be sent to update <code class="language-plaintext highlighter-rouge">showAvailableLanguages</code> to <code class="language-plaintext highlighter-rouge">False</code>).</p> <p>This was implemented in the application <code class="language-plaintext highlighter-rouge">subscriptions</code> using the <a href="https://github.com/elm-lang/mouse"><code class="language-plaintext highlighter-rouge">elm-lang/mouse</code></a> package, looking something like this in Elm 0.18 code:</p> <p><strong><code class="language-plaintext highlighter-rouge">Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Flags</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Navigation</span><span class="o">.</span><span class="n">programWithFlags</span>
        <span class="kt">UpdatePage</span>
        <span class="p">{</span> <span class="c1">-- ...</span>
        <span class="o">,</span> <span class="n">subscriptions</span> <span class="o">=</span> <span class="n">subscriptions</span>
        <span class="p">}</span>

<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="kt">Msg</span>
<span class="n">subscriptions</span> <span class="p">{</span> <span class="n">locale</span> <span class="p">}</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">locale</span><span class="o">.</span><span class="n">showAvailableLanguages</span> <span class="k">then</span>
        <span class="kt">Mouse</span><span class="o">.</span><span class="n">clicks</span> <span class="p">(</span><span class="o">\</span><span class="n">_</span> <span class="o">-&gt;</span> <span class="kt">CloseAvailableLanguages</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="kt">Sub</span><span class="o">.</span><span class="n">none</span>
</code></pre></div></div> <p>In Elm 0.18, the model that is passed into the <code class="language-plaintext highlighter-rouge">subscriptions</code> function is the post-<code class="language-plaintext highlighter-rouge">update</code> new model, and therefore we can make subscriptions conditional based on values in it.</p> <p>However, as of this writing, in Elm 0.19 it would seem that is no longer the case. Even after updating <a href="https://package.elm-lang.org/packages/elm-lang/mouse/latest/Mouse#clicks"><code class="language-plaintext highlighter-rouge">Mouse.clicks</code></a> in the above code to use <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser-Events#onClick"><code class="language-plaintext highlighter-rouge">Browser.Events.onClick</code></a> from <a href="https://github.com/elm/browser"><code class="language-plaintext highlighter-rouge">elm/browser</code></a>, the dropdown menu would not close, and <code class="language-plaintext highlighter-rouge">showAvailableLanguages</code> would seem to get updated “out-of-sync” to the application state I was seeing in the Elm debugger.</p> <p>After finding <a href="https://github.com/elm/compiler/issues/1776">this Github issue</a>, I realised that the problem may be with the Elm compiler itself. So, I ended up completely removing the conditional subscription from the Elm 0.19 version of the app, and replacing it with an <a href="https://package.elm-lang.org/packages/elm/html/latest/Html-Events#onMouseLeave"><code class="language-plaintext highlighter-rouge">Html.Events.onMouseLeave</code></a> event directly on the dropdown menu <code class="language-plaintext highlighter-rouge">div</code> element that would send the <code class="language-plaintext highlighter-rouge">CloseAvailableLanguages</code> message, which I now actually prefer. Something like:</p> <p><strong><code class="language-plaintext highlighter-rouge">LanguageSelector/View.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">view</span> <span class="p">:</span> <span class="kt">Language</span> <span class="o">-&gt;</span> <span class="kt">LanguageSelector</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">view</span> <span class="n">language</span> <span class="n">languageSelector</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">availableLanguagesToggle</span> <span class="o">=</span>
            <span class="k">if</span> <span class="n">languageSelector</span><span class="o">.</span><span class="n">showAvailableLanguages</span> <span class="k">then</span>
                <span class="p">[</span> <span class="n">onMouseLeave</span> <span class="kt">Msg</span><span class="o">.</span><span class="kt">CloseAvailableLanguages</span> <span class="p">]</span>

            <span class="k">else</span>
                <span class="p">[]</span>
    <span class="k">in</span>
    <span class="n">div</span>
        <span class="p">([</span> <span class="n">attribute</span> <span class="s">"</span><span class="s2">data-name"</span> <span class="s">"</span><span class="s2">language-selector"</span>
         <span class="o">,</span> <span class="c1">-- ..</span>
         <span class="p">]</span>
            <span class="o">++</span> <span class="n">availableLanguagesToggle</span>
        <span class="p">)</span>
        <span class="p">[</span> <span class="c1">-- ..</span>
        <span class="p">]</span>
</code></pre></div></div> <p>It’s a shame that there is no <code class="language-plaintext highlighter-rouge">Html.Events.none</code> to prevent the list concatenation. Regardless, the takeaway is to, at least for now, refrain from having conditional subscriptions that depend on any attributes in your model until the issue mentioned above is fixed.</p> <h2 id="url-fragment-navigation-has-issues">URL fragment navigation has issues</h2> <p>If you use hashes (<code class="language-plaintext highlighter-rouge">#</code>) in your application, either in the form of hash-based routing (e.g. in a URL like <code class="language-plaintext highlighter-rouge">http://example.com/store/#/products/1</code>, you parse information in the <a href="https://en.wikipedia.org/wiki/Fragment_identifier">fragment</a> to determine that you need to display the page for a product with ID of 1), or you use fragments in <a href="https://en.wikipedia.org/wiki/HTML_element#Anchor">HTML anchors</a> to link to different parts of the same page (e.g. <code class="language-plaintext highlighter-rouge">&lt;a href="#top"&gt;Top&lt;/a&gt;</code>), you will have some decisions to make to get them working as you would expect in Elm 0.19.</p> <h3 id="hash-based-routing-in-path-based-clothes">Hash-based routing in path-based clothes</h3> <p><a href="https://package.elm-lang.org/packages/evancz/url-parser/latest/"><code class="language-plaintext highlighter-rouge">evancz/url-parser</code></a>, often used in Elm 0.18 applications that have navigation, has a <a href="https://package.elm-lang.org/packages/evancz/url-parser/latest/UrlParser#parseHash"><code class="language-plaintext highlighter-rouge">UrlParser.parseHash</code></a> function to help with parsing URL fragments against defined routes. Elm 0.19’s <a href="https://package.elm-lang.org/packages/elm/url/latest/Url-Parser"><code class="language-plaintext highlighter-rouge">Url.Parser</code></a> from <a href="https://package.elm-lang.org/packages/elm/url/latest/Url"><code class="language-plaintext highlighter-rouge">elm/url</code></a> no longer supports this. So, your current routing options for Elm 0.19 are:</p> <ul> <li>Change your application to route on URL paths, rather than fragments</li> <li> <p>Keep your fragment routing, but before you pass your <a href="https://package.elm-lang.org/packages/elm/url/latest/Url"><code class="language-plaintext highlighter-rouge">Url</code></a>, to <a href="https://package.elm-lang.org/packages/elm/url/latest/Url-Parser#parse"><code class="language-plaintext highlighter-rouge">Url.Parser.parse</code></a> to run it against your route matchers, send it through a function that will overwrite the <code class="language-plaintext highlighter-rouge">path</code> property of the <a href="https://package.elm-lang.org/packages/elm/url/latest/Url"><code class="language-plaintext highlighter-rouge">Url</code></a> with the content of the fragment. Something like:</p> <div class="language-elm highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="n">migrateUrlFragmentToPath</span> <span class="p">:</span> <span class="kt">Url</span> <span class="o">-&gt;</span> <span class="kt">Url</span>
<span class="n">migrateUrlFragmentToPath</span> <span class="n">url</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">url</span> <span class="o">|</span> <span class="n">path</span> <span class="o">=</span> <span class="kt">Maybe</span><span class="o">.</span><span class="n">withDefault</span> <span class="s">"</span><span class="s2">"</span> <span class="n">url</span><span class="o">.</span><span class="n">fragment</span><span class="o">,</span> <span class="n">fragment</span> <span class="o">=</span> <span class="kt">Nothing</span> <span class="p">}</span>
</code></pre></div> </div> </li> </ul> <p>The Github issues to follow with regards to this are <a href="https://github.com/elm/browser/issues/43">here</a> and <a href="https://github.com/elm/url/issues/24">here</a>. Both provide further explanation and helpful examples of the problem, so be sure to subscribe to them if this is an issue that affects you.</p> <h3 id="anchor-navigation-requires-a-page-load">Anchor navigation requires a page load</h3> <p>Even if your application has path-based routing, and you think you are not affected by the issue above, if you use fragments to navigate to different parts of a page, and have used code from the <a href="https://guide.elm-lang.org/webapps/navigation.html#example">Elm navigation example</a> for handling <code class="language-plaintext highlighter-rouge">Internal</code> types of <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#UrlRequest"><code class="language-plaintext highlighter-rouge">Browser.UrlRequest</code></a>s (since a fragment is certainly not an <code class="language-plaintext highlighter-rouge">External</code> type of link), you may be surprised that when your <code class="language-plaintext highlighter-rouge">UrlRequest</code> is passed into the <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser-Navigation#pushUrl"><code class="language-plaintext highlighter-rouge">Browser.Navigation.pushUrl</code></a> function…nothing happens.</p> <p>More information around this problem is contained in <a href="https://github.com/elm/browser/issues/39">this Github issue</a>, but the way I am currently working around this, in an application that is both path-routed <em>and</em> contains fragments in anchor tags for same-page navigation, is through the following clause in my <code class="language-plaintext highlighter-rouge">update</code> function:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">Msg</span><span class="o">.</span><span class="kt">LinkClicked</span> <span class="n">urlRequest</span> <span class="o">-&gt;</span>
            <span class="k">case</span> <span class="n">urlRequest</span> <span class="k">of</span>
                <span class="kt">Browser</span><span class="o">.</span><span class="kt">Internal</span> <span class="n">url</span> <span class="o">-&gt;</span>
                    <span class="k">let</span>
                        <span class="n">href</span> <span class="o">=</span>
                            <span class="kt">Url</span><span class="o">.</span><span class="n">toString</span> <span class="n">url</span>

                        <span class="n">navigation</span> <span class="o">=</span>
                            <span class="k">case</span> <span class="n">url</span><span class="o">.</span><span class="n">fragment</span> <span class="k">of</span>
                                <span class="kt">Nothing</span> <span class="o">-&gt;</span>
                                    <span class="kt">Navigation</span><span class="o">.</span><span class="n">pushUrl</span> <span class="n">model</span><span class="o">.</span><span class="n">key</span> <span class="n">href</span>

                                <span class="kt">Just</span> <span class="n">_</span> <span class="o">-&gt;</span>
                                    <span class="kt">Navigation</span><span class="o">.</span><span class="n">load</span> <span class="n">href</span>
                    <span class="k">in</span>
                    <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="n">navigation</span><span class="p">)</span>

                <span class="kt">Browser</span><span class="o">.</span><span class="kt">External</span> <span class="n">href</span> <span class="o">-&gt;</span>
                    <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">load</span> <span class="n">href</span> <span class="p">)</span>
</code></pre></div></div> <p>This does result in a page load for anchor fragment links, but in my case this does not seem to have been a noticeable issue, and as of this writing I do not see another way around it.</p> <h2 id="testing-applications-without-a-browsernavigationkey">Testing applications without a <code class="language-plaintext highlighter-rouge">Browser.Navigation.Key</code> </h2> <p>When the <code class="language-plaintext highlighter-rouge">init</code> function is called in a <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#application"><code class="language-plaintext highlighter-rouge">Browser.application</code></a> program, one of the parameters that it receives is a <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser-Navigation#Key"><code class="language-plaintext highlighter-rouge">Browser.Navigation.Key</code></a>, which is needed to “create navigation commands that change the URL”. For example:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="p">()</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Browser</span><span class="o">.</span><span class="n">application</span>
        <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="o">,</span> <span class="c1">-- ...</span>
        <span class="p">}</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">key</span> <span class="p">:</span> <span class="kt">Key</span>
    <span class="o">,</span> <span class="n">url</span> <span class="p">:</span> <span class="kt">Url</span>
    <span class="p">}</span>


<span class="n">init</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Url</span> <span class="o">-&gt;</span> <span class="kt">Key</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="p">()</span> <span class="n">url</span> <span class="n">key</span> <span class="o">=</span>
    <span class="p">(</span> <span class="kt">Model</span> <span class="n">key</span> <span class="n">url</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
</code></pre></div></div> <p>You receive this key whether you like it or not; it is passed into the Elm application from Javascript-land, and as of this writing there is no way to generate one yourself on-the-fly in Elm-land. What this means is that the <code class="language-plaintext highlighter-rouge">init</code> function, as well as parts of any function that use a key, cannot be tested with <code class="language-plaintext highlighter-rouge">elm test</code>.</p> <p>This is not so great for tests that simulate a click somewhere on a page and check that the right <code class="language-plaintext highlighter-rouge">msg</code> is being sent (<a href="https://package.elm-lang.org/packages/elm-explorations/test/latest/Test-Html-Event#expect">example</a>). If you have an <code class="language-plaintext highlighter-rouge">update</code> function that looks similar to what is in the <a href="https://guide.elm-lang.org/webapps/navigation.html#example">Elm navigation example</a>, you will see that you need to pass a key into the <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser-Navigation#pushUrl"><code class="language-plaintext highlighter-rouge">Browser.Navigation.pushUrl</code></a> function:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">LinkClicked</span> <span class="n">urlRequest</span> <span class="o">-&gt;</span>
            <span class="k">case</span> <span class="n">urlRequest</span> <span class="k">of</span>
                 <span class="kt">Browser</span><span class="o">.</span><span class="kt">Internal</span> <span class="n">url</span> <span class="o">-&gt;</span>
                     <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">pushUrl</span> <span class="n">model</span><span class="o">.</span><span class="n">key</span> <span class="p">(</span><span class="kt">Url</span><span class="o">.</span><span class="n">toString</span> <span class="n">url</span><span class="p">)</span> <span class="p">)</span>

                 <span class="kt">Browser</span><span class="o">.</span><span class="kt">External</span> <span class="n">href</span> <span class="o">-&gt;</span>
                     <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">load</span> <span class="n">href</span> <span class="p">)</span>
</code></pre></div></div> <p>Assuming that, like in the example above, you keep your key somewhere in your model, what can you do without a key during testing that will allow your application to compile?</p> <p>The path of least resistance for me was to change what is stored in the model to a <code class="language-plaintext highlighter-rouge">Maybe Key</code>, and ensure that functions like <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser-Navigation#pushUrl"><code class="language-plaintext highlighter-rouge">Browser.Navigation.pushUrl</code></a> are never run when the key is <code class="language-plaintext highlighter-rouge">Nothing</code>:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">key</span> <span class="p">:</span> <span class="kt">Maybe</span> <span class="kt">Key</span>
    <span class="o">,</span> <span class="n">url</span> <span class="p">:</span> <span class="kt">Url</span>
    <span class="p">}</span>

<span class="n">init</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Url</span> <span class="o">-&gt;</span> <span class="kt">Key</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="p">()</span> <span class="n">url</span> <span class="n">key</span> <span class="o">=</span>
    <span class="p">(</span> <span class="kt">Model</span> <span class="p">(</span><span class="kt">Just</span> <span class="n">key</span><span class="p">)</span> <span class="n">url</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">LinkClicked</span> <span class="n">urlRequest</span> <span class="o">-&gt;</span>
            <span class="k">case</span> <span class="n">urlRequest</span> <span class="k">of</span>
                <span class="kt">Browser</span><span class="o">.</span><span class="kt">Internal</span> <span class="n">url</span> <span class="o">-&gt;</span>
                    <span class="k">case</span> <span class="n">model</span><span class="o">.</span><span class="n">key</span> <span class="k">of</span>
                        <span class="kt">Just</span> <span class="n">key</span> <span class="o">-&gt;</span>
                            <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">pushUrl</span> <span class="n">key</span> <span class="p">(</span><span class="kt">Url</span><span class="o">.</span><span class="n">toString</span> <span class="n">url</span><span class="p">)</span> <span class="p">)</span>

                        <span class="kt">Nothing</span> <span class="o">-&gt;</span>
                            <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>

                <span class="kt">Browser</span><span class="o">.</span><span class="kt">External</span> <span class="n">href</span> <span class="o">-&gt;</span>
                    <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Navigation</span><span class="o">.</span><span class="n">load</span> <span class="n">href</span> <span class="p">)</span>
</code></pre></div></div> <p>The clause for <code class="language-plaintext highlighter-rouge">Nothing</code> will never be matched while you are running your application in development or production: it is there simply so you can test your update function with a key-less model.</p> <p>There is a <a href="https://github.com/elm-explorations/test/issues/24">Github issue</a> tracking this problem, and the Elm team are <a href="https://github.com/elm-explorations/test/issues/24">“working on designs for a possible API to address this”</a>, so consider the above solution strictly a temporary workaround until an API is developed. For now, you will just have to deal with a maximum <a href="https://github.com/zwilias/elm-coverage">test coverage</a> of 99%.</p> <h2 id="upgrading-dependencies">Upgrading dependencies</h2> <p>Once you have upgraded your Elm application to 0.19, you will probably need a way to determine whether any of its packages are out of date.</p> <p>As far as I know, Elm itself does not currently have a way to determine this. However, thanks to <a href="https://github.com/malaire/elm-dependencies-analyzer">elm-dependencies-analyzer</a>, you can simply cut and paste the content of your application’s <code class="language-plaintext highlighter-rouge">elm.json</code> file into the <a href="https://www.markuslaire.com/github/elm-dependencies-analyzer/">live version of the program</a>, and it will tell you which packages you are able to version up.</p> <p>What you should actually do once you know what package(s) you have to upgrade was initially a source of confusion for me, but after reading <a href="https://discourse.elm-lang.org/t/how-do-your-upgrade-a-package-in-your-app/2505">this Discourse thread</a>, and a bit of trial and error, I now work on this rule of thumb:</p> <ul> <li>If the dependency to be upgraded is a “direct” dependency, remove the entry from <code class="language-plaintext highlighter-rouge">elm.json</code> and then run <code class="language-plaintext highlighter-rouge">elm install author/package</code> to re-introduce it back into the <code class="language-plaintext highlighter-rouge">elm.json</code> file using the newest version</li> <li>If the dependency to be upgraded is an “indirect” dependency, then directly edit the entry in <code class="language-plaintext highlighter-rouge">elm.json</code> to the target version number, and then run <code class="language-plaintext highlighter-rouge">elm make</code>, which will download the new dependency (yes, you are not supposed to directly edit <code class="language-plaintext highlighter-rouge">elm.json</code>, but as of this writing I do not see another way around this)</li> </ul> <p>Perhaps an <code class="language-plaintext highlighter-rouge">elm install author/package --indirect</code> command will find its way into a future version of Elm…?</p> <h2 id="other-miscellaneous-thoughts">Other miscellaneous thoughts</h2> <ul> <li>I quite liked the change in the <code class="language-plaintext highlighter-rouge">Html.Attributes.style</code> API from its <code class="language-plaintext highlighter-rouge">List ( String, String ) -&gt; Attribute msg</code> implementation in <a href="https://package.elm-lang.org/packages/elm-lang/html/latest/Html-Attributes#style"><code class="language-plaintext highlighter-rouge">elm-lang/html</code></a> versus the current <code class="language-plaintext highlighter-rouge">String -&gt; String -&gt; Attribute msg</code> implementation in <a href="https://package.elm-lang.org/packages/elm/html/1.0.0/Html-Attributes#style"><code class="language-plaintext highlighter-rouge">elm/html</code></a>. More readable in my opinion.</li> <li> <p>I think the Elm Javascript interface is much nicer in 0.19: being able to explicitly specify <code class="language-plaintext highlighter-rouge">node</code> and <code class="language-plaintext highlighter-rouge">flags</code> elements in a single object to pass in to the Elm application is less cognitive overhead:</p> <p><strong><code class="language-plaintext highlighter-rouge">index.js</code></strong></p> <div class="language-js highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="c1">// Elm 0.18</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Main</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Main.elm</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">appContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#root</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">Main</span><span class="p">.</span><span class="nx">embed</span><span class="p">(</span><span class="nx">appContainer</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">apiUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://www.example.com/api/endpoint</span><span class="dl">"</span>
<span class="p">})</span>

<span class="c1">// Elm 0.19</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Elm</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Main.elm</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">Elm</span><span class="p">.</span><span class="nx">Main</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
  <span class="na">node</span><span class="p">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#root</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">flags</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">apiUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://www.example.com/api/endpoint</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div> </div> </li> <li>For an application that does not accept flags, I like to now be able to write the type signature for its flags with the unit type: <code class="language-plaintext highlighter-rouge">main : Program () Model Msg</code>, rather than <code class="language-plaintext highlighter-rouge">main : Program Never Model Msg</code> </li> <li>Being able to update the title of a page in Elm-land, rather than through ports, thanks to the <a href="https://package.elm-lang.org/packages/elm/browser/latest/Browser#document"><code class="language-plaintext highlighter-rouge">Browser.Document</code></a> API, is a great addition</li> <li>The change in API from <a href="https://package.elm-lang.org/packages/elm-lang/html/latest/Html-Events#onWithOptions"><code class="language-plaintext highlighter-rouge">Html.Events.onWithOptions</code></a> to <a href="https://package.elm-lang.org/packages/elm/html/1.0.0/Html-Events#custom"><code class="language-plaintext highlighter-rouge">Html.Events.custom</code></a> makes it more readable in my opinion. I found out about the change itself <a href="https://stackoverflow.com/questions/52541501/why-cant-i-use-onwithoptions-in-elm-0-19">here</a> </li> <li>A good reference for a bare minimum implementation of each of the 4 different ways to boot an Elm app can be found at <a href="https://gist.github.com/roine/a2da44f2047d494cabaf715f06a591db">this gist</a> </li> </ul> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/elm" class="page__taxonomy-item" rel="tag">elm</a><span class="sep">, </span> <a href="/tags/elm-0-18" class="page__taxonomy-item" rel="tag">elm-0.18</a><span class="sep">, </span> <a href="/tags/elm-0-19" class="page__taxonomy-item" rel="tag">elm-0.19</a><span class="sep">, </span> <a href="/tags/upgrade" class="page__taxonomy-item" rel="tag">upgrade</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-11-08">November 8, 2020</time></p> </footer> <section class="page__share"> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Elm+0.18+to+0.19+upgrade+notes%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Felm-018-019-upgrade-notes%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Felm-018-019-upgrade-notes%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Felm-018-019-upgrade-notes%2F&amp;title=Elm%200.18%20to%200.19%20upgrade%20notes" class="btn btn--reddit" title=" Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Felm-018-019-upgrade-notes%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/build-ci-cd-pipeline-jekyll/" class="pagination--pager" title="Build a CI/CD pipeline for your Jekyll site ">Previous</a> <a href="/blog/chording-qwerty-qmk-combos/" class="pagination--pager" title="Chording QWERTY with QMK Combos ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Comments</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You May Also Enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-11-17/daniel-kuberek-ijL9kGvjO-E-unsplash.jpg" alt="bottle near water"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/mums-meetup/" rel="permalink">Mum’s Meetup </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-11-17T13:05:00+11:00">November 17, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 4 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">Organising a meetup gave my Mum a new lease on life. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-10-17/kinpachi-sensei.jpg" alt="Kinpachi-sensei teaches the meaning of the character for 'person'."> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/persons-character/" rel="permalink">A Person’s Character (人という字は) </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-17T16:14:00+11:00">October 17, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 6 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">“人” may be the kanji for person, but its simplicity masks a deeper meaning. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-10-10/denny-muller-W3wd-rmLP7I-unsplash.jpg" alt="pipe organ"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/pipe-codebase-into-ruby/" rel="permalink">Pipe a Codebase into Ruby </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-10T20:50:00+11:00">October 10, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 6 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">“Pipes! Well done! I feel like Leonardo da Vinci! It’s a masterpiece!” </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-1889.jpg" alt="Van Gogh: A Wheatfield with Cypresses, June 1889"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/canvas-of-cypress-tests/" rel="permalink">A Canvas of Cypress Tests </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-06T22:50:00+11:00">October 6, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 20 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands” </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2021 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-109270947-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/elm-018-019-upgrade-notes/",this.page.identifier="/blog/elm-018-019-upgrade-notes"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>