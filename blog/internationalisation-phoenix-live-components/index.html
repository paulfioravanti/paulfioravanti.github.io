<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Internationalisation with Phoenix LiveComponents | Floor and Varnish</title> <meta name="description" content="Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Internationalisation with Phoenix LiveComponents"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/internationalisation-phoenix-live-components/"> <meta property="og:description" content="Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2020-01-27/jason-leung-jCBzW_Q_UGI-unsplash.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Internationalisation with Phoenix LiveComponents"> <meta name="twitter:description" content="Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/internationalisation-phoenix-live-components/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2020-01-27/jason-leung-jCBzW_Q_UGI-unsplash.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2020-01-27T10:00:00+11:00"> <meta property="article:modified_time" content="2020-11-01T22:00:00+11:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/internationalisation-phoenix-live-components/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"> <!--[if IE]><style>.greedy-nav .site-title{padding-right:3em}.greedy-nav button{position:absolute;top:0;right:0;height:100%}</style><![endif]--> </head> <body class="layout--single wide"> <nav class="skip-links"> <h2 class="screen-reader-text">Skip links</h2> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16"> <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path> </svg> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2020-01-27/jason-leung-jCBzW_Q_UGI-unsplash.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Internationalisation with Phoenix LiveComponents </h1> <p class="page__lead">Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-01-27T10:00:00+11:00">January 27, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 17 minute read </span> </p> </div> <span class="page__hero-caption">Photo by <a href="https://unsplash.com/@ninjason?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jason Leung</a> on <a href="https://unsplash.com/s/photos/flags?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a> </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Internationalisation with Phoenix LiveComponents"> <meta itemprop="description" content="Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents."> <meta itemprop="datePublished" content="2020-01-27T10:00:00+11:00"> <meta itemprop="dateModified" content="2020-11-01T22:00:00+11:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>This blog post is the second in a series on the creation of a small <a href="https://en.wikipedia.org/wiki/Internationalization_and_localization#Naming">I18n</a> application using <a href="https://github.com/phoenixframework/phoenix_live_view">Phoenix LiveView</a>, which updates page content based on the language chosen from a dropdown menu:</p> <ol> <li><em><a href="https://www.paulfioravanti.com/blog/internationalisation-with-phoenix-liveview/">Internationalisation with Phoenix LiveView</a></em></li> <li><em>Internationalisation with Phoenix LiveComponents</em></li> <li><em><a href="https://www.paulfioravanti.com/blog/internationalisation-with-phoenix-live-layouts/">Internationalisation with Phoenix Live Layouts</a></em></li> </ol> <p style="text-align: center;"><img src="/assets/images/2020-01-27/i18n-application.gif" alt="I18n Application" title="Internationalisation Application"></p> <p>Development on LiveView is currently proceeding at a cracking pace, and one of the newer additions to it is the ability to “compartmentalize state, markup, and events in LiveView” using <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html">LiveComponent</a>. So, let’s introduce LiveComponents to the application, and see what effect it has on the codebase.</p> <blockquote> <p>The software versions used for this version of the application have changed slightly, and are now the following:</p> <ul> <li>Elixir: 1.9.4</li> <li>Erlang: 22.2.1</li> <li>Phoenix: 1.4.11</li> <li>Gettext: 0.17.4</li> <li>LiveView: 0.4.1</li> <li>Node: 13.6.0</li> <li>Tachyons: 4.11.1</li> </ul> </blockquote> <h2 id="current-state-of-play">Current State of Play</h2> <p>We are going to pick the application up where we left off from the end of <em><a href="https://www.paulfioravanti.com/blog/internationalisation-with-phoenix-liveview/">Internationalisation with Phoenix LiveView</a></em>, which is its state on the <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/05-liveview-fix"><code class="language-plaintext highlighter-rouge">05-liveview-fix</code> branch</a> of the <a href="https://github.com/paulfioravanti/phx_i18n_example">phx_i18n_example</a> Github repository. So, if you do not have the repository already, just run these commands and the internet shall provide it to you:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:paulfioravanti/phx_i18n_example.git
<span class="nb">cd </span>phx_i18n_example
git checkout 05-liveview-fix
</code></pre></div></div> <h2 id="housekeeping">Housekeeping</h2> <h3 id="upgrading-dependencies">Upgrading dependencies</h3> <p>Before beginning, we will need to upgrade the version of LiveView being used in the application from 0.3.1 to 0.4.1:</p> <p><strong><code class="language-plaintext highlighter-rouge">mix.exs</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExample</span><span class="o">.</span><span class="no">MixProject</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="c1"># ...</span>
      <span class="p">{</span><span class="ss">:phoenix_live_view</span><span class="p">,</span> <span class="s2">"~&gt; 0.4.1"</span><span class="p">},</span>
      <span class="c1"># ...</span>
    <span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Then, upgrade the Elixir dependencies with <code class="language-plaintext highlighter-rouge">mix</code>:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix deps.upgrade <span class="nt">--all</span>
</code></pre></div></div> <p>Updating Javascript asset dependencies should not be an issue for introducing LiveComponents, but if you do find you have front end issues, or you just need to have all the latest packages all the time, then by all means, check what’s outdated and update to your heart’s content:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm outdated <span class="nt">--prefix</span> assets
</code></pre></div></div> <h3 id="enabling-livecomponent-functions">Enabling LiveComponent Functions</h3> <p>In order to use LiveComponents from LiveViews, we are going to need access to the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.Helpers.html#live_component/4"><code class="language-plaintext highlighter-rouge">Phoenix.LiveView.Helpers.live_component/4</code></a> function (and its lower <a href="https://en.wikipedia.org/wiki/Arity">arity</a> cousins), so add it to the list of LiveView-related imports:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">view</span> <span class="k">do</span>
    <span class="kn">quote</span> <span class="k">do</span>
      <span class="c1"># ...</span>
      <span class="kn">import</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span><span class="p">,</span>
        <span class="ss">only:</span> <span class="p">[</span>
          <span class="ss">live_render:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="ss">live_render:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="ss">live_link:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="ss">live_link:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="ss">live_component:</span> <span class="mi">2</span><span class="p">,</span>
          <span class="ss">live_component:</span> <span class="mi">3</span><span class="p">,</span>
          <span class="ss">live_component:</span> <span class="mi">4</span>
        <span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="file-structure-and-naming-changes">File Structure and Naming Changes</h3> <p>It would seem that there has been an informal(?) convention to name LiveView files with a pattern of <code class="language-plaintext highlighter-rouge">FooLive</code> and <code class="language-plaintext highlighter-rouge">BarLive</code>, and place them inside a directory called <code class="language-plaintext highlighter-rouge">live/</code> directly under the Phoenix application <code class="language-plaintext highlighter-rouge">web/</code> directory. The application currently follows this convention.</p> <p>However, with the advent of LiveComponents, we now have more than one type of “LiveThing”, with the likely potential for more “LiveThings” in the future. So, in the absence of any set conventions, we shall:</p> <ul> <li>Move all LiveView files under a new <code class="language-plaintext highlighter-rouge">live/views/</code> directory</li> <li>Re-name all LiveView files from <code class="language-plaintext highlighter-rouge">FooLive</code> to <code class="language-plaintext highlighter-rouge">FooLiveView</code>, and change all of their references throughout the application (specifically, do search and replaces for <code class="language-plaintext highlighter-rouge">TitleLive</code> -&gt; <code class="language-plaintext highlighter-rouge">TitleLiveView</code>, <code class="language-plaintext highlighter-rouge">LanguageDropdownLive</code> -&gt; <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveView</code>, and <code class="language-plaintext highlighter-rouge">PageLive</code> -&gt; <code class="language-plaintext highlighter-rouge">PageLiveView</code>)</li> <li>Create an empty <code class="language-plaintext highlighter-rouge">live/components/</code> directory to store LiveComponent files</li> </ul> <p>Once you have done that, check to see that the application still runs without error, and you will be ready to start the actual fun component-y stuff!</p> <h2 id="livecomponent-flavours">LiveComponent Flavours</h2> <p>There are two different officially-named types of LiveComponents: Stateless and Stateful.</p> <p>Personally, I find this naming quite confusing as both types of component do hold some kind of state, and the difference would seem to lie rather in the <em>degree of independence</em> that the LiveComponent has from its parent LiveView in updating its state, handling messages etc:</p> <ul> <li>Stateless, in diapers, is completely dependent on its parent for any changes</li> <li>Stateful is moved out of home, doing most things independently, but occasionally needs help from its parent for things it cannot do</li> </ul> <p>Anyway, regardless of my opinions about the current naming, use of shared language is important to convey information coherently, so Stateless and Stateful it is.</p> <h2 id="update-to-stateless-component">Update to Stateless Component</h2> <p>Let’s first update the LiveViews to <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-stateless-components-life-cycle">Stateless Components</a>, starting with the one that has the least amount of logic in it: the <code class="language-plaintext highlighter-rouge">TitleLiveView</code>.</p> <p>It is currently responsible for:</p> <ul> <li>Setting up a subscription to locale-change messages, so it knows when it should change languages, and then handling those locale-change events</li> <li>Keeping track of the <code class="language-plaintext highlighter-rouge">locale</code> in its <code class="language-plaintext highlighter-rouge">socket</code> </li> <li>Rendering a LiveView template, in this case inline</li> </ul> <p>At present, the code looks like this:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/title_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">TitleLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="kn">import</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Gettext</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">gettext:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="kn">import</span> <span class="no">Gettext</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">with_locale:</span> <span class="mi">2</span><span class="p">]</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Endpoint</span>

  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= with_locale(@locale, fn -&gt; %&gt;
      &lt;title&gt;
        &lt;%= gettext("</span><span class="no">Multilingualisation</span> <span class="ow">in</span> <span class="no">Phoenix</span><span class="s2">") %&gt;
      &lt;/title&gt;
    &lt;% end) %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"change-locale"</span><span class="p">,</span> <span class="ss">payload:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>In introducing a stateless component, we are not interested in giving the component very much agency or responsibility: we just want to offload view-related functionality to it, and have it render the inline template. So, let’s extract out some code into our first new LiveComponent!</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/components/title_live_component.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">TitleLiveComponent</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveComponent</span>
  <span class="kn">import</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Gettext</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">gettext:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="kn">import</span> <span class="no">Gettext</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">with_locale:</span> <span class="mi">2</span><span class="p">]</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= with_locale(@locale, fn -&gt; %&gt;
      &lt;title&gt;
        &lt;%= gettext("</span><span class="no">Multilingualisation</span> <span class="ow">in</span> <span class="no">Phoenix</span><span class="s2">") %&gt;
      &lt;/title&gt;
    &lt;% end) %&gt;
    """</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Not much to it, is there? Every component <em>does</em> actually require a <code class="language-plaintext highlighter-rouge">mount/1</code> and an <code class="language-plaintext highlighter-rouge">update/2</code> function, but LiveComponent provides default implementations of those functions that look something like this:</p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">mount</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="n">update</span><span class="p">(</span><span class="n">assigns</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)}</span>
<span class="k">end</span>
</code></pre></div></div> <p>If any finer-grained control over mounting and updating is needed, these functions would need to be overridden, but for this LiveComponent, the defaults work just fine.</p> <p>Back in <code class="language-plaintext highlighter-rouge">TitleLiveView</code>, we make a call out to <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.Helpers.html#live_component/4"><code class="language-plaintext highlighter-rouge">live_component</code></a> to spawn off the child LiveComponent:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/title_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">TitleLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">TitleLiveComponent</span><span class="p">}</span>

  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket, TitleLiveComponent, locale: @locale %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"change-locale"</span><span class="p">,</span> <span class="ss">payload:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="a-quick-detour">A Quick Detour</h2> <p>A few things initially confused me as I was implementing this.</p> <p>I thought that because the <code class="language-plaintext highlighter-rouge">locale</code> had already been assigned to the <code class="language-plaintext highlighter-rouge">socket</code> belonging to <code class="language-plaintext highlighter-rouge">TitleLiveView</code> in <code class="language-plaintext highlighter-rouge">mount/2</code>, it would flow through automatically to the <code class="language-plaintext highlighter-rouge">@socket</code> that gets passed into the <code class="language-plaintext highlighter-rouge">live_component</code> function. This is because if you inspect the <code class="language-plaintext highlighter-rouge">@socket</code> in the <code class="language-plaintext highlighter-rouge">render/1</code> function like so:</p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
  <span class="sx">~L""</span><span class="s2">"
  &lt;% IO.inspect(@socket) %&gt;
  &lt;%= live_component @socket, TitleLiveComponent, locale: @locale %&gt;
  """</span>
<span class="k">end</span>
</code></pre></div></div> <p>The output you get is:</p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Phoenix.LiveView.Socket&lt;</span>
  <span class="ss">assigns:</span> <span class="p">%{</span><span class="ss">locale:</span> <span class="s2">"en"</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="s2">"mlZvNkbr/5DxyM9hq2TS0w=="</span><span class="p">},</span>
  <span class="ss">changed:</span> <span class="p">%{</span><span class="ss">locale:</span> <span class="no">true</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="no">true</span><span class="p">},</span>
  <span class="ss">endpoint:</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Endpoint</span><span class="p">,</span>
  <span class="ss">id:</span> <span class="s2">"phx-VwPm6nt2"</span><span class="p">,</span>
  <span class="ss">parent_pid:</span> <span class="no">nil</span><span class="p">,</span>
  <span class="ss">view:</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span><span class="p">,</span>
  <span class="o">...</span>
<span class="o">&gt;</span>
</code></pre></div></div> <p>So, I would have thought that the <code class="language-plaintext highlighter-rouge">assigns</code> would carry through to the <code class="language-plaintext highlighter-rouge">socket</code> in <code class="language-plaintext highlighter-rouge">TitleLiveComponent</code>, but when I overrode the <code class="language-plaintext highlighter-rouge">mount/1</code> function there to inspect the state of the <code class="language-plaintext highlighter-rouge">socket</code> like so:</p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="n">mount</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
  <span class="no">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">socket</span><span class="p">)</span>
  <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div> <p>The output was:</p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Phoenix.LiveView.Socket&lt;</span>
  <span class="ss">assigns:</span> <span class="p">%{},</span>
  <span class="ss">changed:</span> <span class="p">%{</span><span class="ss">locale:</span> <span class="no">true</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="no">true</span><span class="p">},</span>
  <span class="ss">endpoint:</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Endpoint</span><span class="p">,</span>
  <span class="ss">id:</span> <span class="s2">"phx-VwPm6nt2"</span><span class="p">,</span>
  <span class="ss">parent_pid:</span> <span class="no">nil</span><span class="p">,</span>
  <span class="ss">view:</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span><span class="p">,</span>
  <span class="o">...</span>
<span class="o">&gt;</span>
</code></pre></div></div> <p>The information in the <code class="language-plaintext highlighter-rouge">assigns</code> disappears…? But the socket <code class="language-plaintext highlighter-rouge">id</code> (<code class="language-plaintext highlighter-rouge">"phx-VwPm6nt2"</code> in this case) is the same in the LiveView and the LiveComponent! What happened here? This is when a part of the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.Helpers.html#live_component/4"><code class="language-plaintext highlighter-rouge">live_component</code> documentation</a> finally clicked:</p> <blockquote> <p>“A LiveComponent provides similar functionality to LiveView, except they run in the same process as the LiveView, with its own encapsulated state”</p> </blockquote> <p>So, if my understanding is correct, the <code class="language-plaintext highlighter-rouge">id</code> for the <code class="language-plaintext highlighter-rouge">socket</code> is the same since it is the same process, but the <code class="language-plaintext highlighter-rouge">assigns</code> states of the LiveView and LiveComponent are isolated from each other, and we essentially get a “blank slate” socket <code class="language-plaintext highlighter-rouge">assigns</code> in the LiveComponent.</p> <p>The <code class="language-plaintext highlighter-rouge">assigns</code> values we pass in to the <code class="language-plaintext highlighter-rouge">live_component</code> function (in this case <code class="language-plaintext highlighter-rouge">locale: @locale</code>), become available to us in <code class="language-plaintext highlighter-rouge">update/2</code> (which the parent LiveView will call during the initialisation process), where we can then assign them to the LiveComponent <code class="language-plaintext highlighter-rouge">socket</code>.</p> <h2 id="finishing-up-stateless">Finishing Up Stateless</h2> <p>Now that we have cleared up some LiveComponent socket-related gotchas, let’s finish up porting over the remaining two LiveViews to use Stateless components. The way we will do this will be very similar to <code class="language-plaintext highlighter-rouge">TitleLiveView</code>, with the content in the <code class="language-plaintext highlighter-rouge">render/1</code> functions being extracted out into LiveComponents:</p> <h3 id="languagedropdownliveview">LanguageDropdownLiveView</h3> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/language_dropdown_live_view.ex</code></strong></p> <p><strong>Before:</strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">LanguageDropdownView</span><span class="p">}</span>

  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">LanguageDropdownView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"language_dropdown.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong>After:</strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">LanguageDropdownLiveComponent</span><span class="p">}</span>

  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket,
                       LanguageDropdownLiveComponent,
                       locale: @locale,
                       selectable_locales: @selectable_locales,
                       show_available_locales: @show_available_locales %&gt;
    """</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/components/language_dropdown_live_component.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveComponent</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveComponent</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownView</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">LanguageDropdownView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"language_dropdown.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="pageliveview">PageLiveView</h3> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/page_live_view.ex</code></strong></p> <p><strong>Before:</strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageView</span><span class="p">}</span>

  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">PageView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"index.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong>After:</strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageLiveComponent</span><span class="p">}</span>

  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket, PageLiveComponent, locale: @locale %&gt;
    """</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/components/page_live_component.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveComponent</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveComponent</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageView</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">PageView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"index.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>And that’s it! The application is now using Stateless LiveComponents!</p> <p>You can find the code for this iteration of the application in this post’s <a href="https://github.com/paulfioravanti/phx_i18n_example">companion Github repo</a> on the <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/06-live-stateless"><code class="language-plaintext highlighter-rouge">06-live-stateless</code> branch</a>. The branch is also deployed <a href="https://phx-i18n-06-live-stateless.herokuapp.com/">here</a> in its own environment.</p> <h2 id="optional-refactor">Optional Refactor</h2> <p>Before we move on to stateful components, I would just like to bring up that if you do not like to have inline LiveView templates (aka Live Embedded Elixir (<code class="language-plaintext highlighter-rouge">leex</code>), ie <code class="language-plaintext highlighter-rouge">~L"""</code> code) in <em>any</em> of your LiveViews, then it is possible to refactor them out completely into separate files. For example, in <code class="language-plaintext highlighter-rouge">PageLiveView</code>, our <code class="language-plaintext highlighter-rouge">render/1</code> function looks like:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/page_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket, PageLiveComponent, locale: @locale %&gt;
    """</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p>Rather than have this inline template, we <em>could</em> refactor this into something like the following:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/page_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageLiveViewView</span><span class="p">}</span>

  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">PageLiveViewView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"component.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p>And then create a new view and template to call the component:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/views/page_live_view_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveViewView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhxI18nExampleWeb</span><span class="p">,</span> <span class="ss">:view</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveComponent</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/templates/page_live_view/component.html.leex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;%=</span> <span class="n">live_component</span> <span class="nv">@socket</span><span class="p">,</span> <span class="no">PageLiveComponent</span><span class="p">,</span> <span class="ss">locale:</span> <span class="nv">@locale</span> <span class="p">%</span><span class="o">&gt;</span>
</code></pre></div></div> <p>This refactor works, but, to me at least, it just feels awkward to have such few lines of code spread out over multiple files, not to mention the even more awkward <code class="language-plaintext highlighter-rouge">PageLiveViewView</code> naming.</p> <p>I do like having longer templates in their own file, with their own dedicated view file, but for a <code class="language-plaintext highlighter-rouge">live_component</code> one-liner like this, I think inline is fine. But, your mileage may vary, and by all means use your best judgement to determine if this kind of refactor is to your benefit or liking.</p> <h2 id="update-to-stateful-components">Update to Stateful Components</h2> <p>Now, we will move on to giving our LiveComponents more responsibility for managing their own state, by making them <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-stateful-components-life-cycle">Stateful Components</a>. Like before, let’s start with the least complex LiveView/LiveComponent set for the page title. Here is the finished product:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/title_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">TitleLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">TitleLiveComponent</span><span class="p">}</span>

  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket,
                       TitleLiveComponent,
                       id: :title,
                       locale: @locale %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"change-locale"</span><span class="p">,</span> <span class="ss">payload:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>No, your eyes do not deceive you: literally the only change from before has been the addition of the <code class="language-plaintext highlighter-rouge">id: title</code> keyword argument in the <code class="language-plaintext highlighter-rouge">live_component</code> function call. No changes to <code class="language-plaintext highlighter-rouge">TitleLiveComponent</code> were necessary. And now it is stateful.</p> <p>If you are thinking that this does not really represent a change in responsibilities of the <code class="language-plaintext highlighter-rouge">TitleLiveComponent</code>, you would be absolutely correct.</p> <p>Although I would very much like to allow the <code class="language-plaintext highlighter-rouge">TitleLiveComponent</code> to receive and handle <code class="language-plaintext highlighter-rouge">"change-locale"</code> messages, <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-livecomponent-as-the-source-of-truth">“components do not have a <code class="language-plaintext highlighter-rouge">handle_info/2</code> callback”</a>, and so this is one of the areas where a stateful LiveComponent must depend on its parent.</p> <p>Technically, we could have moved the <code class="language-plaintext highlighter-rouge">Endpoint.subscribe/1</code> function call into the LiveComponent, and it would have worked, but I think the demarcation lines of responsibility are clearer if we say that the parent LiveView is entirely responsible for handling external <a href="https://github.com/phoenixframework/phoenix_pubsub">PubSub</a> communication.</p> <p>Therefore, for this particular LiveView/LiveComponent set, there is probably not much value in making it Stateful.</p> <h2 id="moving-on">Moving on</h2> <p>So, that was rather anti-climactic. Let’s move on to the <code class="language-plaintext highlighter-rouge">PageLiveView</code> where we will hopefully have more luck with making at least some consequential changes. Currently, it looks like:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/page_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageLiveComponent</span><span class="p">}</span>

  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>
  <span class="nv">@dropdown_changes</span> <span class="s2">"dropdown-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket, PageLiveComponent, locale: @locale %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"hide-dropdown"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">broadcast_from</span><span class="p">(</span>
      <span class="n">self</span><span class="p">(),</span>
      <span class="nv">@dropdown_changes</span> <span class="o">&lt;&gt;</span> <span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
      <span class="s2">"hide-dropdown"</span><span class="p">,</span>
      <span class="p">%{}</span>
    <span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"change-locale"</span><span class="p">,</span> <span class="ss">payload:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:locale</span><span class="p">,</span> <span class="n">payload</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Like <code class="language-plaintext highlighter-rouge">TitleLiveView</code>, there is some external PubSub message handling here around <code class="language-plaintext highlighter-rouge">"change-locale"</code> events that we need to leave in the parent LiveView, but handling <code class="language-plaintext highlighter-rouge">"hide-dropdown"</code> events is definitely something that a LiveComponent can perform, so let’s extract the <code class="language-plaintext highlighter-rouge">handle_event/3</code> code out to <code class="language-plaintext highlighter-rouge">PageLiveComponent</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/components/page_live_component.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveComponent</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveComponent</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageView</span><span class="p">}</span>

  <span class="nv">@dropdown_changes</span> <span class="s2">"dropdown-changes:"</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">PageView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"index.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"hide-dropdown"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">broadcast_from</span><span class="p">(</span>
      <span class="n">self</span><span class="p">(),</span>
      <span class="nv">@dropdown_changes</span> <span class="o">&lt;&gt;</span> <span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
      <span class="s2">"hide-dropdown"</span><span class="p">,</span>
      <span class="p">%{}</span>
    <span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Great! The LiveComponent is now broadcasting out <code class="language-plaintext highlighter-rouge">"hide-dropdown"</code> messages if it, itself, receives a <code class="language-plaintext highlighter-rouge">"hide-dropdown"</code> event. This extraction leaves the parent LiveView with slightly less code, and one less thing to worry about:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/page_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">PageLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">PageLiveComponent</span><span class="p">}</span>

  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket,
                       PageLiveComponent,
                       id: :page,
                       locale: @locale,
                       user_id: @user_id %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"change-locale"</span><span class="p">,</span> <span class="ss">payload:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">send_update</span><span class="p">(</span><span class="no">PageLiveComponent</span><span class="p">,</span> <span class="ss">id:</span> <span class="ss">:page</span><span class="p">,</span> <span class="ss">locale:</span> <span class="n">payload</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Note that as opposed to the <code class="language-plaintext highlighter-rouge">TitleLiveView</code>, in which we only passed the <code class="language-plaintext highlighter-rouge">@locale</code> parameter into the call to <code class="language-plaintext highlighter-rouge">live_component</code>, in the <code class="language-plaintext highlighter-rouge">PageLiveView</code>, we are also passing through the <code class="language-plaintext highlighter-rouge">@user_id</code>, since <code class="language-plaintext highlighter-rouge">PageLiveComponent</code> needs it to perform the <code class="language-plaintext highlighter-rouge">"hide-dropdown"</code> broadcasts. Parent LiveViews can keep a tight leash on what information child LiveComponents need to know about.</p> <h2 id="filial-piety">Filial Piety</h2> <p>We have been taking baby-steps towards LiveComponent independence, but now it’s time to take a bigger step: let’s move on to the busiest LiveView in the application, <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveView</code>, and see how much we can lighten its load. Currently, it does quite a lot:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/language_dropdown_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">LanguageDropdownLiveComponent</span><span class="p">}</span>

  <span class="nv">@locales</span> <span class="no">Gettext</span><span class="o">.</span><span class="n">known_locales</span><span class="p">(</span><span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Gettext</span><span class="p">)</span>
  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>
  <span class="nv">@dropdown_changes</span> <span class="s2">"dropdown-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@dropdown_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">init_state</span><span class="p">(</span><span class="n">locale</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket,
                       LanguageDropdownLiveComponent,
                       locale: @locale,
                       selectable_locales: @selectable_locales,
                       show_available_locales: @show_available_locales %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"hide"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:show_available_locales</span><span class="p">,</span> <span class="no">false</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"toggle"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span>
      <span class="n">assign</span><span class="p">(</span>
        <span class="n">socket</span><span class="p">,</span>
        <span class="ss">:show_available_locales</span><span class="p">,</span>
        <span class="n">!socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">show_available_locales</span>
      <span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"locale-changed"</span><span class="p">,</span> <span class="p">%{</span><span class="s2">"locale"</span> <span class="o">=&gt;</span> <span class="n">locale</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">broadcast_from</span><span class="p">(</span>
      <span class="n">self</span><span class="p">(),</span>
      <span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
      <span class="s2">"change-locale"</span><span class="p">,</span>
      <span class="p">%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"hide-dropdown"</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:show_available_locales</span><span class="p">,</span> <span class="no">false</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">init_state</span><span class="p">(</span><span class="n">locale</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
      <span class="p">%{</span><span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span>
      <span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">selectable_locales</span> <span class="o">=</span> <span class="no">List</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nv">@locales</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

    <span class="p">%{</span>
      <span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span>
      <span class="ss">selectable_locales:</span> <span class="n">selectable_locales</span><span class="p">,</span>
      <span class="ss">show_available_locales:</span> <span class="no">false</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Like the other LiveViews, there is external PubSub communication that we must keep as-is, but I would say <em>every other function</em> can be shipped out wholesale to <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveComponent</code>, lightening <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveView</code>’s load considerably:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/views/language_dropdown_live_view.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveView</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveView</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">LanguageDropdownLiveComponent</span><span class="p">}</span>

  <span class="nv">@dropdown_changes</span> <span class="s2">"dropdown-changes:"</span>

  <span class="k">def</span> <span class="n">mount</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nv">@dropdown_changes</span> <span class="o">&lt;&gt;</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">locale:</span> <span class="n">locale</span><span class="p">,</span> <span class="ss">user_id:</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="sx">~L""</span><span class="s2">"
    &lt;%= live_component @socket,
                       LanguageDropdownLiveComponent,
                       id: :language_dropdown,
                       locale: @locale,
                       user_id: @user_id %&gt;
    """</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_info</span><span class="p">(%{</span><span class="ss">event:</span> <span class="s2">"hide-dropdown"</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">send_update</span><span class="p">(</span>
      <span class="no">LanguageDropdownLiveComponent</span><span class="p">,</span>
      <span class="ss">id:</span> <span class="ss">:language_dropdown</span><span class="p">,</span>
      <span class="ss">show_available_locales:</span> <span class="no">false</span>
    <span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>It now does not need to worry about setting up internal state for the dropdown menu, nor handle any of its events. It does still continue to handle external PubSub messages, but it completely delegates responsibility of what action should be performed to <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveComponent</code> via the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html#send_update/2"><code class="language-plaintext highlighter-rouge">send_update/2</code></a> function.</p> <p>So, let’s see where all that logic has gone:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phx_i18n_example_web/live/components/language_dropdown_live_component.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">LanguageDropdownLiveComponent</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveComponent</span>
  <span class="n">alias</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="p">{</span><span class="no">Endpoint</span><span class="p">,</span> <span class="no">LanguageDropdownView</span><span class="p">}</span>

  <span class="nv">@locales</span> <span class="no">Gettext</span><span class="o">.</span><span class="n">known_locales</span><span class="p">(</span><span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">Gettext</span><span class="p">)</span>
  <span class="nv">@locale_changes</span> <span class="s2">"locale-changes:"</span>

  <span class="k">def</span> <span class="n">update</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">}</span> <span class="o">=</span> <span class="n">assigns</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">state</span> <span class="o">=</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">assigns</span><span class="p">,</span> <span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">update</span><span class="p">(%{</span><span class="ss">show_available_locales:</span> <span class="no">false</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:show_available_locales</span><span class="p">,</span> <span class="no">false</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">render</span><span class="p">(</span><span class="n">assigns</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">LanguageDropdownView</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">"language_dropdown.html"</span><span class="p">,</span> <span class="n">assigns</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"hide"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="ss">:show_available_locales</span><span class="p">,</span> <span class="no">false</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"toggle"</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">socket</span> <span class="o">=</span>
      <span class="n">assign</span><span class="p">(</span>
        <span class="n">socket</span><span class="p">,</span>
        <span class="ss">:show_available_locales</span><span class="p">,</span>
        <span class="n">!socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">show_available_locales</span>
      <span class="p">)</span>

    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">handle_event</span><span class="p">(</span><span class="s2">"locale-changed"</span><span class="p">,</span> <span class="p">%{</span><span class="s2">"locale"</span> <span class="o">=&gt;</span> <span class="n">locale</span><span class="p">},</span> <span class="n">socket</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Endpoint</span><span class="o">.</span><span class="n">broadcast_from</span><span class="p">(</span>
      <span class="n">self</span><span class="p">(),</span>
      <span class="nv">@locale_changes</span> <span class="o">&lt;&gt;</span> <span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
      <span class="s2">"change-locale"</span><span class="p">,</span>
      <span class="p">%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">update_locale_changed_state</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">assigns</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>
    <span class="n">socket</span> <span class="o">=</span> <span class="n">assign</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:noreply</span><span class="p">,</span> <span class="n">socket</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">update_locale_changed_state</span><span class="p">(</span><span class="n">assigns</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">assigns</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(%{</span><span class="ss">locale:</span> <span class="n">locale</span><span class="p">})</span>
    <span class="o">|&gt;</span> <span class="no">Map</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="k">defp</span> <span class="n">init_dropdown_state</span><span class="p">(</span><span class="n">locale</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">selectable_locales</span> <span class="o">=</span> <span class="no">List</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="nv">@locales</span><span class="p">,</span> <span class="n">locale</span><span class="p">)</span>

    <span class="p">%{</span>
      <span class="ss">selectable_locales:</span> <span class="n">selectable_locales</span><span class="p">,</span>
      <span class="ss">show_available_locales:</span> <span class="no">false</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>The LiveComponent now has responsibilities over:</p> <ul> <li>Manually handling updating its state by overriding the <code class="language-plaintext highlighter-rouge">update/2</code> function, since the LiveComponent default implementation does not cut it any more</li> <li>Handling the two different flavours of <code class="language-plaintext highlighter-rouge">update</code> that the component needs to know about (via the <code class="language-plaintext highlighter-rouge">update</code> function heads), which are: <ul> <li>when the <code class="language-plaintext highlighter-rouge">locale</code> is updated, upon which it needs to re-initialise its state (which, by the by, the parent LiveView does not need to know anything about)</li> <li>when <code class="language-plaintext highlighter-rouge">show_available_locales</code> is explicitly set to <code class="language-plaintext highlighter-rouge">false</code> (ie from when <code class="language-plaintext highlighter-rouge">LanguageDropdownLiveView</code> calls <code class="language-plaintext highlighter-rouge">send_update/2</code>), at which point the menu needs to be hidden</li> </ul> </li> <li>Handling <em>all</em> its local events</li> <li>Broadcasting <code class="language-plaintext highlighter-rouge">"change-locale"</code> messages when it gets a <code class="language-plaintext highlighter-rouge">"locale-changed"</code> message</li> </ul> <p>Easily the most independent of the three LiveComponents in the application.</p> <p>You can find the code for this iteration of the application in this post’s <a href="https://github.com/paulfioravanti/phx_i18n_example">companion Github repo</a> on the <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/07-live-stateful"><code class="language-plaintext highlighter-rouge">07-live-stateful</code> branch</a>. The branch is also deployed <a href="https://phx-i18n-07-live-stateful.herokuapp.com/">here</a> in its own environment.</p> <h2 id="stateless-or-stateful">Stateless or Stateful?</h2> <p>In this application, I think the benefits of using Stateless versus Stateful LiveComponents are largely subjective, and really depend on personal preferences about how to divide up logic between LiveViews and LiveComponents.</p> <p>If you have an application that has more moving parts and complexity, like fetching from a database to populate multiple LiveComponents on a page, in which you may need to consider <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-preloading-and-update">preloading</a> using <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#c:preload/1"><code class="language-plaintext highlighter-rouge">preload/1</code></a> (not covered in this blog post), then the decision to specifically use Stateful components may become clearer.</p> <p>Regardless of your preferred flavour of LiveComponent, I think they are a welcome addition to the Phoenix’s Live Toolbox, and I’m sure I will be making more use of them in the future.</p> <h2 id="update-29-01-2020">Update (29-01-2020)</h2> <p>Well, the cracking pace of development on new libraries like LiveView can mean that even minor version changes can result in having the rug pulled out from under you, and this application is no exception.</p> <p>On updating the application to LiveView <a href="https://github.com/phoenixframework/phoenix_live_view/blob/master/CHANGELOG.md#deprecations">version 0.6.0</a>, everything stopped working, and my LiveComponents mysteriously stopped handling events.</p> <p>If you are following along, <a href="https://github.com/paulfioravanti/phx_i18n_example/compare/07-live-stateful...08-live-stateful-0-6">here is the diff</a> between the <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/07-live-stateful"><code class="language-plaintext highlighter-rouge">07-live-stateful</code> branch</a> you have already seen, and a new <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/08-live-stateful-0-6"><code class="language-plaintext highlighter-rouge">08-live-stateful-0-6</code> branch</a>, all updated and working with LiveView 0.6.0 (with a couple of small refactors).</p> <p>It is not worth going into the deep details of how to upgrade, since I think the diff, as well as the <a href="https://github.com/phoenixframework/phoenix_live_view/blob/924fe4aa53e690751cdc063883a356b7c8165f08/guides/introduction/installation.md">LiveView 0.6 Installation instructions</a> and the <a href="https://github.com/phoenixframework/phoenix_live_view/blob/master/CHANGELOG.md#deprecations">Changelog</a>, provide enough information, but I will outline a few points:</p> <ul> <li>The socket <code class="language-plaintext highlighter-rouge">session</code> now accepts only string keys. This affected code in Plugs as well as LiveViews. It does seem a bit strange now to have <code class="language-plaintext highlighter-rouge">Conn.assign(:locale, locale)</code> with an atom key, and <code class="language-plaintext highlighter-rouge">Conn.put_session("locale", locale)</code> with a string key</li> <li>I think it’s great that any <code class="language-plaintext highlighter-rouge">session</code> variables set in plugs are available automatically in LiveViews now, without having to explicitly indicate a set of session keys in the route. (eg <code class="language-plaintext highlighter-rouge">live "/", PageLiveView, session: [:locale, :user_id]</code>). You could explicitly override values here using a map, though, if you wanted to (eg <code class="language-plaintext highlighter-rouge">live "/", PageLiveView, session: %{"locale" =&gt; "en"}</code>)</li> <li> <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-targeting-component-events">Targeting Component Events</a> is where the Stateful LiveComponent trip ups occurred. With 0.6.0, if template code managed by a LiveComponent does not have a <code class="language-plaintext highlighter-rouge">phx-target</code> attribute, then the LiveComponent’s <code class="language-plaintext highlighter-rouge">handle_event/3</code> function that previously may have worked will now <em>not</em> pick up the event, and instead event handling will go straight to the parent LiveView. In this case, I got an error complaining that I did not have <code class="language-plaintext highlighter-rouge">handle_event/3</code> implementations in the LiveView to handle the events that it was receiving. See the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveComponent.html#module-targeting-component-events">Targeting Component Events</a> documentation and the <code class="language-plaintext highlighter-rouge">.eex</code>/<code class="language-plaintext highlighter-rouge">.leex</code> template files in <a href="https://github.com/paulfioravanti/phx_i18n_example/compare/07-live-stateful...08-live-stateful-0-6">the diff</a> for details on getting your Stateful LiveComponents back on the job of handling events</li> </ul> <p>You can find the code for this iteration of the application in this post’s <a href="https://github.com/paulfioravanti/phx_i18n_example">companion Github repo</a> on the <a href="https://github.com/paulfioravanti/phx_i18n_example/tree/08-live-stateful-0-6"><code class="language-plaintext highlighter-rouge">08-live-stateful-0-6</code> branch</a>. The branch is also deployed <a href="https://phx-i18n-08-live-stateful-0-6.herokuapp.com/">here</a> in its own environment.</p> <p>Follow the next steps of this application’s journey in <em><a href="https://www.paulfioravanti.com/blog/internationalisation-with-phoenix-live-layouts/">Internationalisation with Phoenix Live Layouts</a></em>!</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/elixir" class="page__taxonomy-item" rel="tag">elixir</a><span class="sep">, </span> <a href="/tags/i18n" class="page__taxonomy-item" rel="tag">i18n</a><span class="sep">, </span> <a href="/tags/italiano" class="page__taxonomy-item" rel="tag">italiano</a><span class="sep">, </span> <a href="/tags/italian" class="page__taxonomy-item" rel="tag">italian</a><span class="sep">, </span> <a href="/tags/japanese" class="page__taxonomy-item" rel="tag">japanese</a><span class="sep">, </span> <a href="/tags/live-components" class="page__taxonomy-item" rel="tag">live-components</a><span class="sep">, </span> <a href="/tags/liveview" class="page__taxonomy-item" rel="tag">liveview</a><span class="sep">, </span> <a href="/tags/phoenix" class="page__taxonomy-item" rel="tag">phoenix</a><span class="sep">, </span> <a href="/tags/%E6%97%A5%E6%9C%AC%E8%AA%9E" class="page__taxonomy-item" rel="tag">日本語</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-11-01">November 1, 2020</time></p> </footer> <section class="page__share"> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Internationalisation+with+Phoenix+LiveComponents%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Finternationalisation-phoenix-live-components%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Finternationalisation-phoenix-live-components%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Finternationalisation-phoenix-live-components%2F&amp;title=Internationalisation%20with%20Phoenix%20LiveComponents" class="btn btn--reddit" title=" Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Finternationalisation-phoenix-live-components%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/employee-sans-office/" class="pagination--pager" title="Employee Sans Office ">Previous</a> <a href="/blog/internationalisation-phoenix-live-layouts/" class="pagination--pager" title="Internationalisation with Phoenix Live Layouts ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Comments</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You May Also Enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-11-22/abi-schreider-yb16pT5F_jE-unsplash.jpg" alt="two green ceramic cups with chocolate bar on top"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/jlpt-study-guide/" rel="permalink">My JLPT N1 Study Guide </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-11-22T23:05:00+11:00">November 22, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 9 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Level N1 of The Japanese Language Proficiency Test is a tough nut to crack, but these study methods got me over the line. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-07-25/all-i-want-is-a-timestamp.png" alt="Marty McFly from Back to the Future exclaiming that all he wants is a Pepsi."> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/google-sheets-timestamp/" rel="permalink">All I want is a Timestamp </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-07-25T17:35:00+10:00">July 25, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 8 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Google Sheets can insert the current date and time in your spreadsheet, if you know where to look. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-06-10/stenotype.jpg" alt="Stenotype advertisement by La Salle Extension University in 'Lady's Circle magazine's November 1965 issue"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/completed-typey-type/" rel="permalink">I Completed Typey Type </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-06-10T21:00:00+10:00">June 10, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 8 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">So, am I a stenographer now, or what? </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-02-03/kyle-glenn-nXt5HtLmlgE-unsplash.jpg" alt="desk globe on table"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/internationalisation-phoenix-live-layouts/" rel="permalink">Internationalisation with Phoenix Live Layouts </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-02-03T17:00:00+11:00">February 3, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 9 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Phoenix layouts are now live-powered, giving LiveViews more flexibility and control over a template’s surrounding content. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2020 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-109270947-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/internationalisation-phoenix-live-components/",this.page.identifier="/blog/internationalisation-phoenix-live-components"};!function(){var t=document,i=t.createElement("script");i.src="https://paulfioravanti.disqus.com/embed.js",i.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(i)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>