<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Migrating a Phoenix and Elm app from REST to GraphQL | Floor and Varnish</title> <meta name="description" content="Change your API from set menu to à la carte."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Migrating a Phoenix and Elm app from REST to GraphQL"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/migrate-phoenix-elm-app-rest-graphql/"> <meta property="og:description" content="Change your API from set menu to à la carte."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2018-03-07/GraphiQL-contact-query.png"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Migrating a Phoenix and Elm app from REST to GraphQL"> <meta name="twitter:description" content="Change your API from set menu to à la carte."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/migrate-phoenix-elm-app-rest-graphql/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2018-03-07/GraphiQL-contact-query.png"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2018-03-07T09:10:00+11:00"> <meta property="article:modified_time" content="2019-04-15T13:45:00+10:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/migrate-phoenix-elm-app-rest-graphql/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"> <!--[if IE]><style>.greedy-nav .site-title{padding-right:3em}.greedy-nav button{position:absolute;top:0;right:0;height:100%}</style><![endif]--> </head> <body class="layout--single wide"> <nav class="skip-links"> <h2 class="screen-reader-text">Skip links</h2> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16"> <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path> </svg> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('/assets/images/2018-03-07/GraphiQL-contact-query.png');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Migrating a Phoenix and Elm app from REST to GraphQL </h1> <p class="page__lead">Change your API from set menu to à la carte. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2018-03-07T09:10:00+11:00">March 7, 2018</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 17 minute read </span> </p> <a href="https://elixirweekly.net/issues/87" style="text-decoration: none;"> <img src="https://img.shields.io/badge/Elixir%20Weekly-%2387-blueviolet.svg" alt="Elixir Weekly #87"> </a> <a href="https://www.graphqlweekly.com/issues/88/" style="text-decoration: none;"> <img src="https://img.shields.io/badge/GraphQL%20Weekly-%2388-ff69b4.svg" alt="GraphQL Weekly #88"> </a> </div> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Migrating a Phoenix and Elm app from REST to GraphQL"> <meta itemprop="description" content="Change your API from set menu to à la carte."> <meta itemprop="datePublished" content="2018-03-07T09:10:00+11:00"> <meta itemprop="dateModified" content="2019-04-15T13:45:00+10:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p><a href="http://graphql.org/">GraphQL</a> enables consumers of an <a href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a> to ask for the exact data they want from it. This is as opposed to <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>, where the API provider dictates what and how data will be served, and it is up to the consumer to make sense of whatever data it receives.</p> <p>In an app that uses <a href="http://phoenixframework.org/">Phoenix</a> for the back end and <a href="http://elm-lang.org/">Elm</a> for the front end, the flow of data via APIs for a query will usually take the form of:</p> <ul> <li>Elm requests Phoenix for data via an API call</li> <li>Phoenix provides the requested data via a <a href="https://www.json.org/">JSON</a> response</li> <li>Elm decodes the data from the response and displays it</li> </ul> <p>This blog post will cover migrating the APIs of an existing Phoenix/Elm from using REST to using GraphQL, including:</p> <ul> <li>Adding <a href="http://graphql.org/learn/schema/">GraphQL schemas and types</a> to the Phoenix back end</li> <li>Migrating from Phoenix controllers to <a href="http://graphql.org/learn/execution/#root-fields-resolvers">resolvers</a> </li> <li>Migrating Elm-side JSON response decoding from using <a href="http://package.elm-lang.org/packages/elm-lang/core/5.1.1/Json-Decode"><code class="language-plaintext highlighter-rouge">JSON.Decode</code></a> to <a href="http://package.elm-lang.org/packages/jamesmacaulay/elm-graphql/1.8.0/GraphQL-Request-Builder#ValueSpec"><code class="language-plaintext highlighter-rouge">ValueSpec</code></a> from the <a href="https://github.com/jamesmacaulay/elm-graphql"><code class="language-plaintext highlighter-rouge">elm-graphql</code></a> Elm package.</li> <li>Translating GraphQL requests created in <a href="https://github.com/graphql/graphiql">GraphiQL</a> into Elm code, and sending them to Phoenix</li> </ul> <h2 id="starting-point">Starting Point</h2> <p>The app that we are going to use as a baseline to migrate from REST to GraphQL is an Address Book app that was originally created by <a href="https://twitter.com/bigardone">Ricardo García Vega</a> over a <a href="http://codeloveandboards.com/blog/2017/02/02/phoenix-and-elm-a-real-use-case-pt-1/">series of blog posts</a> (<a href="https://github.com/bigardone/phoenix-and-elm">Ricardo’s Github repo</a>).</p> <p><img src="/assets/images/2018-03-07/address-book-contacts-index.png" alt="Address Book contacts" title="Address Book contacts" class="img-responsive"></p> <p>I learned a lot from coding up the app while reading those posts, and I thank Ricardo sincerely for putting the time into his write-ups! Afterwards, I upgraded the app to Phoenix 1.3, played around with the codebase, and put my version of it in its own Github repository, so it is this version of the app that we will use. If you are following along at home, please clone <a href="https://github.com/paulfioravanti/phoenix-and-elm">my repo</a> and follow the <code class="language-plaintext highlighter-rouge">README</code> instructions to get up and running, or you can skip straight to the finished product, which is in the repo’s <a href="https://github.com/paulfioravanti/phoenix-and-elm/tree/graphql"><code class="language-plaintext highlighter-rouge">graphql</code> branch</a>.</p> <h2 id="current-state-of-play">Current State of Play</h2> <p>Before jumping into migrating to GraphQL, let’s take a look at some of the application’s current structure and see how communication is done via REST requests.</p> <h3 id="back-end">Back End</h3> <p>First, let’s have a look at the router:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/router.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">scope</span> <span class="s2">"/api"</span><span class="p">,</span> <span class="no">PhoenixAndElmWeb</span> <span class="k">do</span>
    <span class="n">pipe_through</span> <span class="ss">:api</span>

    <span class="n">scope</span> <span class="s2">"/v1"</span><span class="p">,</span> <span class="no">V1</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="s2">"/contacts"</span><span class="p">,</span> <span class="no">ContactController</span><span class="p">,</span> <span class="ss">only:</span> <span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="s2">"/"</span><span class="p">,</span> <span class="no">PhoenixAndElmWeb</span> <span class="k">do</span>
    <span class="n">pipe_through</span> <span class="ss">:browser</span>

    <span class="n">get</span> <span class="s2">"/*path"</span><span class="p">,</span> <span class="no">AddressBookController</span><span class="p">,</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>In this app, <code class="language-plaintext highlighter-rouge">AddressBook</code> is the <a href="https://hexdocs.pm/phoenix/contexts.html">Phoenix context</a> behind which <code class="language-plaintext highlighter-rouge">Contact</code>s live. So, the <code class="language-plaintext highlighter-rouge">AddressBookController</code>’s purpose is solely to render the HTML tag where the Elm app will be embedded:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/templates/address_book/index.html.eex</code></strong></p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"elm-main"</span><span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div></div> <p>Once the Elm app is embedded, it can make calls out to the versioned (<code class="language-plaintext highlighter-rouge">/v1</code>) contact APIs to fetch contact information, which will be handled by the <code class="language-plaintext highlighter-rouge">ContactController</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/controllers/v1/contact_controller.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">V1</span><span class="o">.</span><span class="no">ContactController</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhoenixAndElmWeb</span><span class="p">,</span> <span class="ss">:controller</span>
  <span class="n">alias</span> <span class="no">PhoenixAndElm</span><span class="o">.</span><span class="no">AddressBook</span>

  <span class="k">def</span> <span class="n">index</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">contacts</span> <span class="o">=</span> <span class="no">AddressBook</span><span class="o">.</span><span class="n">list_contacts</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">json</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">contacts</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">show</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="p">%{</span><span class="s2">"id"</span> <span class="o">=&gt;</span> <span class="n">id</span><span class="p">})</span> <span class="k">do</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="no">AddressBook</span><span class="o">.</span><span class="n">get_contact!</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
    <span class="n">json</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">contact</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>There are two APIs that Phoenix provides: listing contacts and showing (retrieving) information for a contact. Each function talks only to the <code class="language-plaintext highlighter-rouge">AddressBook</code> context, leaving the responsibility of determining <em>how</em> the information requested is provided up to the Address Book “sub-system”: as far as the controller functions are concerned, they provide some parameter to an <code class="language-plaintext highlighter-rouge">AddressBook</code> function, and get returned some value which they then serialize into JSON. So, this controller is effectively our REST boundary, and it is these few lines of functionality that will need to be replicated when migrating over to GraphQL.</p> <h3 id="front-end">Front End</h3> <p>The contact API URL (<code class="language-plaintext highlighter-rouge">api/v1/contacts</code>), that maps to the <code class="language-plaintext highlighter-rouge">ContactController</code> in the Phoenix app, is defined in a common <code class="language-plaintext highlighter-rouge">Commands.elm</code> file so that it can be easily shared between the different API calls coming from Elm:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">contactsApiUrl</span><span class="p">)</span>


<span class="n">contactsApiUrl</span> <span class="p">:</span> <span class="kt">String</span>
<span class="n">contactsApiUrl</span> <span class="o">=</span>
    <span class="s">"</span><span class="s2">/api/v1/contacts"</span>
</code></pre></div></div> <p>The two main models in the Elm app are <a href="https://github.com/paulfioravanti/phoenix-and-elm/blob/rest/assets/elm/src/Contact/Model.elm"><code class="language-plaintext highlighter-rouge">Contact</code></a> and <a href="https://github.com/paulfioravanti/phoenix-and-elm/blob/rest/assets/elm/src/ContactList/Model.elm"><code class="language-plaintext highlighter-rouge">ContactList</code></a>, and code related to how to fetch information to fill the <a href="http://elm-lang.org/docs/records">records</a> of these models is kept in <code class="language-plaintext highlighter-rouge">Commands</code> files under directories named after the model itself.</p> <h4 id="contact-via-rest">Contact via REST</h4> <p>Let’s see how information for a single contact is retrieved:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContact</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">contactsApiUrl</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Decoder</span> <span class="k">as</span> <span class="kt">Decoder</span>
<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactMsg</span><span class="p">(</span><span class="kt">FetchContact</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Http</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ContactMsg</span><span class="p">))</span>


<span class="n">fetchContact</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">fetchContact</span> <span class="n">id</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">apiUrl</span> <span class="o">=</span>
            <span class="n">contactsApiUrl</span> <span class="o">++</span> <span class="s">"</span><span class="s2">/"</span> <span class="o">++</span> <span class="n">toString</span> <span class="n">id</span>
    <span class="k">in</span>
        <span class="kt">Decoder</span><span class="o">.</span><span class="n">decoder</span>
            <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">get</span> <span class="n">apiUrl</span>
            <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">send</span> <span class="kt">FetchContact</span>
            <span class="o">|&gt;</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">map</span> <span class="kt">ContactMsg</span>
</code></pre></div></div> <p>When <code class="language-plaintext highlighter-rouge">Contact.Commands.fetchContact</code> is called within the Elm app, a <code class="language-plaintext highlighter-rouge">Cmd</code> is sent to the Elm Runtime, with a <code class="language-plaintext highlighter-rouge">Msg</code> type of <code class="language-plaintext highlighter-rouge">ContactMsg FetchContact</code>, telling it to send a request to the <code class="language-plaintext highlighter-rouge">apiUrl</code> (looking something like <code class="language-plaintext highlighter-rouge">api/v1/contacts/5</code>), and decode the response using <code class="language-plaintext highlighter-rouge">Contact.Decoder</code>.</p> <p>The decoder used for a <code class="language-plaintext highlighter-rouge">Contact</code> looks like the following:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Decoder.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Decoder</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">decoder</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Contact</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">as</span> <span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">field</span><span class="o">,</span> <span class="n">int</span><span class="o">,</span> <span class="n">string</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span><span class="o">.</span><span class="kt">Extra</span> <span class="k">exposing</span> <span class="p">((</span><span class="o">|</span><span class="p">:))</span>


<span class="n">decoder</span> <span class="p">:</span> <span class="kt">Decode</span><span class="o">.</span><span class="kt">Decoder</span> <span class="kt">Contact</span>
<span class="n">decoder</span> <span class="o">=</span>
    <span class="kt">Decode</span><span class="o">.</span><span class="n">succeed</span>
        <span class="kt">Contact</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">id"</span> <span class="n">int</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">first_name"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">last_name"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">gender"</span> <span class="n">int</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">birth_date"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">location"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">phone_number"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">email"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">headline"</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">picture"</span> <span class="n">string</span><span class="p">)</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">ContactMsg FetchContact</code> message gets handled in <code class="language-plaintext highlighter-rouge">Contact.Update</code>, which updates the <code class="language-plaintext highlighter-rouge">Contact</code> model record:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactMsg</span><span class="p">(</span><span class="kt">FetchContact</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="o">,</span> <span class="kt">RemoteData</span><span class="p">(</span><span class="kt">Failure</span><span class="o">,</span> <span class="kt">Success</span><span class="p">))</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">ContactMsg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">FetchContact</span> <span class="p">(</span><span class="kt">Ok</span> <span class="n">response</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">contact</span> <span class="o">=</span> <span class="kt">Success</span> <span class="n">response</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>

        <span class="kt">FetchContact</span> <span class="p">(</span><span class="kt">Err</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">contact</span> <span class="o">=</span> <span class="kt">Failure</span> <span class="s">"</span><span class="s2">Contact not found"</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
</code></pre></div></div> <p>The use of <code class="language-plaintext highlighter-rouge">Cmd.map ContactMsg</code> in <code class="language-plaintext highlighter-rouge">Contact.Commands</code> is what enables the <code class="language-plaintext highlighter-rouge">FetchContact</code> message to be handled in a “child” <code class="language-plaintext highlighter-rouge">update</code> function (in this case <code class="language-plaintext highlighter-rouge">Contact.Update</code> is considered a child of <code class="language-plaintext highlighter-rouge">Update</code>), which can help reduce the size of the “parent” <code class="language-plaintext highlighter-rouge">update</code> function:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">update</span><span class="o">,</span> <span class="n">urlUpdate</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Update</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ContactMsg</span><span class="o">,</span> <span class="kt">ContactListMsg</span><span class="o">,</span> <span class="kt">NavigateTo</span><span class="o">,</span> <span class="o">...</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="o">,</span> <span class="kt">RemoteData</span><span class="p">(</span><span class="kt">NotRequested</span><span class="o">,</span> <span class="kt">Requesting</span><span class="p">))</span>
<span class="c1">-- ...</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">ContactMsg</span> <span class="n">msg</span> <span class="o">-&gt;</span>
            <span class="kt">Contact</span><span class="o">.</span><span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">msg</span> <span class="n">model</span>

        <span class="kt">ContactListMsg</span> <span class="n">msg</span> <span class="o">-&gt;</span>
            <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">msg</span> <span class="n">model</span>

        <span class="kt">UpdateSearchQuery</span> <span class="n">value</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">search</span> <span class="o">=</span> <span class="n">value</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>

        <span class="c1">-- ...</span>
<span class="c1">-- ...</span>
</code></pre></div></div> <p>Here, in the “parent” <code class="language-plaintext highlighter-rouge">update</code> function, there are messages that are handled directly, like <code class="language-plaintext highlighter-rouge">UpdateSearchQuery</code>, while messages that are wrapped in a <code class="language-plaintext highlighter-rouge">ContactMsg</code> message, for example, are delegated straight off to the <code class="language-plaintext highlighter-rouge">Contact.Update.update</code> function.</p> <blockquote> <p>See <a href="https://medium.com/@alex.lew/the-translator-pattern-a-model-for-child-to-parent-communication-in-elm-f4bfaa1d3f98">this blog post about “The Translator Pattern” in Elm</a> for more information about this style of message passing.</p> </blockquote> <h4 id="contact-list-via-rest">Contact List via REST</h4> <p>Now that we know about fetching a single contact to populate a <code class="language-plaintext highlighter-rouge">Contact</code> record, what about fetching a list of contacts to populate a <code class="language-plaintext highlighter-rouge">ContactList</code> record?</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/ContactList/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContactList</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">contactsApiUrl</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactListMsg</span><span class="p">(</span><span class="kt">FetchContactList</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Decoder</span> <span class="k">as</span> <span class="kt">Decoder</span>
<span class="k">import</span> <span class="kt">Http</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ContactListMsg</span><span class="p">))</span>


<span class="n">fetchContactList</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">fetchContactList</span> <span class="n">page</span> <span class="n">search</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">apiUrl</span> <span class="o">=</span>
            <span class="n">contactsApiUrl</span>
                <span class="o">++</span> <span class="s">"</span><span class="s2">?search="</span>
                <span class="o">++</span> <span class="n">search</span>
                <span class="o">++</span> <span class="s">"</span><span class="s2">&amp;page="</span>
                <span class="o">++</span> <span class="p">(</span><span class="n">toString</span> <span class="n">page</span><span class="p">)</span>
    <span class="k">in</span>
        <span class="kt">Decoder</span><span class="o">.</span><span class="n">decoder</span>
            <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">get</span> <span class="n">apiUrl</span>
            <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">send</span> <span class="kt">FetchContactList</span>
            <span class="o">|&gt;</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">map</span> <span class="kt">ContactListMsg</span>
</code></pre></div></div> <p>Fetching a list of contacts looks very similar to fetching a single contact from an API callout point of view, except that we are now providing <code class="language-plaintext highlighter-rouge">page</code> and <code class="language-plaintext highlighter-rouge">search</code> parameters, resulting in an <code class="language-plaintext highlighter-rouge">apiUrl</code> that looks something like <code class="language-plaintext highlighter-rouge">api/v1/contacts?search=paul&amp;page=2</code>.</p> <p>Just like with the contact API call, we decode the response, this time using the <code class="language-plaintext highlighter-rouge">ContactList.Decoder</code>, and then send a <code class="language-plaintext highlighter-rouge">Cmd</code> with a <code class="language-plaintext highlighter-rouge">Msg</code> of type <code class="language-plaintext highlighter-rouge">ContactListMsg FetchContactList</code>, which will then be handled in the <code class="language-plaintext highlighter-rouge">ContactList.Update.update</code> function.</p> <p>The <code class="language-plaintext highlighter-rouge">ContactList.Decoder</code> itself delegates its <code class="language-plaintext highlighter-rouge">Contact</code>-decoding logic to <code class="language-plaintext highlighter-rouge">Contact.Decoder</code>, defining only fields related to data about a paginated list of records:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/ContactList/Decoder.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Decoder</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">decoder</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Decoder</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactList</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">as</span> <span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">field</span><span class="o">,</span> <span class="n">int</span><span class="o">,</span> <span class="n">list</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span><span class="o">.</span><span class="kt">Extra</span> <span class="k">exposing</span> <span class="p">((</span><span class="o">|</span><span class="p">:))</span>


<span class="n">decoder</span> <span class="p">:</span> <span class="kt">Decode</span><span class="o">.</span><span class="kt">Decoder</span> <span class="kt">ContactList</span>
<span class="n">decoder</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">contact</span> <span class="o">=</span>
            <span class="kt">Contact</span><span class="o">.</span><span class="kt">Decoder</span><span class="o">.</span><span class="n">decoder</span>
    <span class="k">in</span>
        <span class="kt">Decode</span><span class="o">.</span><span class="n">succeed</span>
            <span class="kt">ContactList</span>
            <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">entries"</span> <span class="p">(</span><span class="n">list</span> <span class="n">contact</span><span class="p">))</span>
            <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">page_number"</span> <span class="n">int</span><span class="p">)</span>
            <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">total_entries"</span> <span class="n">int</span><span class="p">)</span>
            <span class="o">|</span><span class="p">:</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">total_pages"</span> <span class="n">int</span><span class="p">)</span>
</code></pre></div></div> <p>The reason that the <code class="language-plaintext highlighter-rouge">field</code> for a list of contacts is specifically named <code class="language-plaintext highlighter-rouge">"entries"</code> is due to the Phoenix app using <a href="https://github.com/drewolson/scrivener_ecto">Scrivener.Ecto</a> for pagination. Paginated contact lists are provided in a <a href="https://github.com/drewolson/scrivener/blob/master/lib/scrivener/page.ex"><code class="language-plaintext highlighter-rouge">Scrivener.Page</code></a> struct, that contains the list of items its paginating under an <code class="language-plaintext highlighter-rouge">:entries</code> map key.</p> <p>And I think that about covers the request/response handling code on the front end. So, it looks like we will need to:</p> <ul> <li>Change the URL in <code class="language-plaintext highlighter-rouge">Commands.elm</code> to reference a different GraphQL endpoint URL</li> <li>Switch out the <code class="language-plaintext highlighter-rouge">Http</code> package for a GraphQL client package</li> <li>Remove decoders, and replace with GraphQL request builders</li> </ul> <h2 id="migrate-back-end-to-graphql">Migrate Back End to GraphQL</h2> <p>Phew, that is a fair bit to take in for what is a tour of only one conceptual part of a toy app, but at least now we have an idea of the API-related parts of the app that are targets for change in both the front and back ends.</p> <p>So, without further ado, let’s tackle migration of the back end first.</p> <h3 id="absinthe">Absinthe</h3> <p><a href="https://github.com/absinthe-graphql/absinthe">Absinthe</a> is the go-to toolkit for using GraphQL in Elixir, with its authors pretty much <a href="https://pragprog.com/book/wwgraphql/craft-graphql-apis-in-elixir-with-absinthe">writing the book</a> on the subject, hence we will be use it in this project. So, open up <code class="language-plaintext highlighter-rouge">mix.exs</code>, and add the following libraries:</p> <p><strong><code class="language-plaintext highlighter-rouge">mix.exs</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElm</span><span class="o">.</span><span class="no">Mixfile</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="k">defp</span> <span class="n">deps</span> <span class="k">do</span>
    <span class="p">[</span>
      <span class="c1"># ...</span>
      <span class="p">{</span><span class="ss">:absinthe</span><span class="p">,</span> <span class="s2">"~&gt; 1.4"</span><span class="p">},</span>
      <span class="p">{</span><span class="ss">:absinthe_plug</span><span class="p">,</span> <span class="s2">"~&gt; 1.4"</span><span class="p">}</span>
    <span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <blockquote> <p>Note that even though this is a Phoenix app, for this example we will not need the <a href="https://github.com/absinthe-graphql/absinthe_phoenix">Absinthe.Phoenix</a> package since we will be sending messages via HTTP, and not via <a href="https://hexdocs.pm/phoenix/channels.html">Phoenix channels</a>/websockets.</p> </blockquote> <h3 id="types">Types</h3> <p>Once you have run <code class="language-plaintext highlighter-rouge">mix deps.get</code>, create a new <code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/schema/</code> directory and let’s create some GraphQL types to describe the data we want to query:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/schema/types.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Types</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Notation</span>
  <span class="n">import_types</span><span class="p">(</span><span class="no">Absinthe</span><span class="o">.</span><span class="no">Type</span><span class="o">.</span><span class="no">Custom</span><span class="p">)</span>

  <span class="n">object</span> <span class="ss">:contact_list</span> <span class="k">do</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:total_entries</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:total_pages</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:page_number</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:page_size</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:entries</span><span class="p">,</span> <span class="n">list_of</span><span class="p">(</span><span class="ss">:contact</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="n">object</span> <span class="ss">:contact</span> <span class="k">do</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:first_name</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:last_name</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:gender</span><span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:birth_date</span><span class="p">,</span> <span class="ss">:date</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:location</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:phone_number</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:email</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:headline</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="ss">:picture</span><span class="p">,</span> <span class="ss">:string</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">:contact</code> <code class="language-plaintext highlighter-rouge">object</code> almost directly mirrors <a href="https://github.com/paulfioravanti/phoenix-and-elm/blob/graphql/lib/phoenix_and_elm/address_book/contact.ex#L26">the contact database schema</a>, with the one small caveat here being that the GraphQL specification does not provide a <code class="language-plaintext highlighter-rouge">:date</code> type for the <code class="language-plaintext highlighter-rouge">:birth_date</code> field, so the <code class="language-plaintext highlighter-rouge">Absinthe.Type.Custom</code> module provides one that we can use.</p> <p>The <code class="language-plaintext highlighter-rouge">:contact_list</code> <code class="language-plaintext highlighter-rouge">object</code> essentially describes a <a href="https://github.com/drewolson/scrivener/blob/master/lib/scrivener/page.ex"><code class="language-plaintext highlighter-rouge">Scrivener.Page</code></a>, though for simplicity’s sake, we are limiting <code class="language-plaintext highlighter-rouge">entries</code> to only containing a <code class="language-plaintext highlighter-rouge">list_of(:contact)</code> (Scrivener can, of course, paginate other types of things!).</p> <h3 id="schema">Schema</h3> <p>Now, we need the schema itself to describe the queries we will allow into the Phoenix app, what arguments each query takes, and what execution should happen for each valid query (done here in the form of resolvers).</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/schema/schema.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Schema</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Schema</span>
  <span class="n">alias</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">ContactResolver</span>
  <span class="n">import_types</span><span class="p">(</span><span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Schema</span><span class="o">.</span><span class="no">Types</span><span class="p">)</span>

  <span class="n">query</span> <span class="k">do</span>
    <span class="n">field</span> <span class="ss">:contacts</span><span class="p">,</span> <span class="ss">type:</span> <span class="ss">:contact_list</span> <span class="k">do</span>
      <span class="n">arg</span><span class="p">(</span><span class="ss">:search</span><span class="p">,</span> <span class="n">non_null</span><span class="p">(</span><span class="ss">:string</span><span class="p">))</span>
      <span class="n">arg</span><span class="p">(</span><span class="ss">:page</span><span class="p">,</span> <span class="n">non_null</span><span class="p">(</span><span class="ss">:integer</span><span class="p">))</span>
      <span class="n">resolve</span><span class="p">(</span><span class="o">&amp;</span><span class="no">ContactResolver</span><span class="o">.</span><span class="n">list_contacts</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">field</span> <span class="ss">:contact</span><span class="p">,</span> <span class="ss">type:</span> <span class="ss">:contact</span> <span class="k">do</span>
      <span class="n">arg</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="n">non_null</span><span class="p">(</span><span class="ss">:id</span><span class="p">))</span>
      <span class="n">resolve</span><span class="p">(</span><span class="o">&amp;</span><span class="no">ContactResolver</span><span class="o">.</span><span class="n">get_contact</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="resolvers">Resolvers</h3> <p>Resolvers can tend to get quite long, so it is considered good practice to put them into their own top level directory under the web app, so let’s do that and create a <code class="language-plaintext highlighter-rouge">ContactResolver</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/resolvers/contact_resolver.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">ContactResolver</span> <span class="k">do</span>
  <span class="n">alias</span> <span class="no">PhoenixAndElm</span><span class="o">.</span><span class="no">AddressBook</span>

  <span class="k">def</span> <span class="n">list_contacts</span><span class="p">(</span><span class="n">_parent</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">_resolution</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">contacts</span> <span class="o">=</span> <span class="no">AddressBook</span><span class="o">.</span><span class="n">list_contacts</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">contacts</span><span class="p">}</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="n">get_contact</span><span class="p">(</span><span class="n">_parent</span><span class="p">,</span> <span class="p">%{</span><span class="ss">id:</span> <span class="n">id</span><span class="p">},</span> <span class="n">_resolution</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="no">AddressBook</span><span class="o">.</span><span class="n">get_contact!</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">contact</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>This resolver looks suspiciously like the original REST <code class="language-plaintext highlighter-rouge">ContactController</code>, and this is mainly thanks to having the <code class="language-plaintext highlighter-rouge">AddressBook</code> context hide away all of the complexity around preparing contact data sets for delivery to the front end. Handy!</p> <p>One extra tiny change that needs to happen before we move on: did you notice in the <code class="language-plaintext highlighter-rouge">get_contact()</code> function that the map that comes through as the <code class="language-plaintext highlighter-rouge">args</code> parameter has atoms for keys, as opposed to the <code class="language-plaintext highlighter-rouge">ContactController</code>, where the keys are strings? We’re handling that fine in the <code class="language-plaintext highlighter-rouge">get_contact</code> function, but in <code class="language-plaintext highlighter-rouge">list_contacts()</code>, we’re passing <code class="language-plaintext highlighter-rouge">args</code> straight through to <code class="language-plaintext highlighter-rouge">AddressBook.list_contacts()</code>, which is expecting a map with string keys, so we will have to update it to expect one with atom keys:</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm/address_book/address_book.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElm</span><span class="o">.</span><span class="no">AddressBook</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="n">list_contacts</span><span class="p">(%{</span><span class="ss">search:</span> <span class="n">query</span><span class="p">}</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>This small change is the only time we should have to climb over the <code class="language-plaintext highlighter-rouge">AddressBook</code> context wall.</p> <h3 id="router">Router</h3> <p>Finally, let’s expose our new GraphQL API to the world by changing the router to send <code class="language-plaintext highlighter-rouge">/api</code> requests to the new schema, and <code class="language-plaintext highlighter-rouge">/api/graphiql</code> requests to GraphiQL.</p> <p><strong><code class="language-plaintext highlighter-rouge">lib/phoenix_and_elm_web/router.ex</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Router</span> <span class="k">do</span>
  <span class="c1"># ...</span>
  <span class="n">scope</span> <span class="s2">"/api"</span> <span class="k">do</span>
    <span class="n">pipe_through</span> <span class="ss">:api</span>

    <span class="n">forward</span> <span class="s2">"/graphiql"</span><span class="p">,</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Plug</span><span class="o">.</span><span class="no">GraphiQL</span><span class="p">,</span>
      <span class="ss">schema:</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Schema</span><span class="p">,</span>
      <span class="ss">interface:</span> <span class="ss">:simple</span>

    <span class="n">forward</span> <span class="s2">"/"</span><span class="p">,</span> <span class="no">Absinthe</span><span class="o">.</span><span class="no">Plug</span><span class="p">,</span> <span class="ss">schema:</span> <span class="no">PhoenixAndElmWeb</span><span class="o">.</span><span class="no">Schema</span>
  <span class="k">end</span>

  <span class="n">scope</span> <span class="s2">"/"</span><span class="p">,</span> <span class="no">PhoenixAndElmWeb</span> <span class="k">do</span>
    <span class="n">pipe_through</span> <span class="ss">:browser</span>

    <span class="n">get</span> <span class="s2">"/*path"</span><span class="p">,</span> <span class="no">AddressBookController</span><span class="p">,</span> <span class="ss">:index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h2 id="testing-with-graphiql">Testing with GraphiQL</h2> <p>Speaking of GraphiQL, let’s use it to help us build the queries that we’re going to want to have Elm send to it. Navigating to <a href="http://localhost:4000/api/graphiql">http://localhost:4000/api/graphiql</a> will bring up the GraphiQL interface, so let’s start with a GraphQL query for a single contact.</p> <p>We need a query that will take in a contact ID parameter, and will return all the fields that we currently have defined in the <code class="language-plaintext highlighter-rouge">Contact.Decoder</code> Elm file:</p> <div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">query</span><span class="p">(</span><span class="nv">$contactID</span><span class="p">:</span><span class="w"> </span><span class="nb">ID</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">contact</span><span class="p">(</span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nv">$contactID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">id</span><span class="w">
    </span><span class="n">firstName</span><span class="w">
    </span><span class="n">lastName</span><span class="w">
    </span><span class="n">gender</span><span class="w">
    </span><span class="n">birthDate</span><span class="w">
    </span><span class="n">location</span><span class="w">
    </span><span class="n">phoneNumber</span><span class="w">
    </span><span class="n">email</span><span class="w">
    </span><span class="n">headline</span><span class="w">
    </span><span class="n">picture</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <blockquote> <p>The exclamation mark on <code class="language-plaintext highlighter-rouge">ID!</code> means that <a href="http://graphql.org/learn/schema/#object-types-and-fields">the field is non-nullable</a>, so you have to provide an ID or the query will error out.</p> </blockquote> <p>Let’s now input that in GraphiQL and fire it off to the Phoenix app, along with a <code class="language-plaintext highlighter-rouge">contactID</code> parameter:</p> <p><img src="/assets/images/2018-03-07/GraphiQL-contact-query.png" alt="GraphiQL contact query" title="GraphiQL contact query" class="img-responsive"></p> <p>Looks pretty good to me! Now, how about for a list of contacts?</p> <p>We need a query that will take in search and page number parameters, and return all the fields that we currently have defined in the <code class="language-plaintext highlighter-rouge">ContactList.Decoder</code> Elm file:</p> <div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">query</span><span class="p">(</span><span class="nv">$searchQuery</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">!,</span><span class="w"> </span><span class="nv">$pageNumber</span><span class="p">:</span><span class="w"> </span><span class="nb">Int</span><span class="p">!)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">contacts</span><span class="p">(</span><span class="n">search</span><span class="p">:</span><span class="w"> </span><span class="nv">$searchQuery</span><span class="p">,</span><span class="w"> </span><span class="n">page</span><span class="p">:</span><span class="w"> </span><span class="nv">$pageNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">entries</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">id</span><span class="w">
      </span><span class="n">firstName</span><span class="w">
      </span><span class="n">lastName</span><span class="w">
      </span><span class="n">gender</span><span class="w">
      </span><span class="n">birthDate</span><span class="w">
      </span><span class="n">location</span><span class="w">
      </span><span class="n">phoneNumber</span><span class="w">
      </span><span class="n">email</span><span class="w">
      </span><span class="n">headline</span><span class="w">
      </span><span class="n">picture</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="n">pageNumber</span><span class="p">,</span><span class="w">
    </span><span class="n">totalEntries</span><span class="w">
    </span><span class="n">totalPages</span><span class="p">,</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>And for a search query of <code class="language-plaintext highlighter-rouge">"Barn"</code>, the results are…</p> <p><img src="/assets/images/2018-03-07/GraphiQL-contacts-query.png" alt="GraphiQL contacts query" title="GraphiQL contacts query" class="img-responsive"></p> <p>…all of the users with a first name of Barney! Great! We now know the GraphQL queries that we want the front end to send to the back end, and now, it’s time to get them translated into Elm code! (At this point, now that the migration from controllers to resolvers is complete, it is safe to delete <code class="language-plaintext highlighter-rouge">ContactController</code> from the app.)</p> <h2 id="migrate-front-end-to-graphql">Migrate Front End to GraphQL</h2> <p>Before we start, we will need a GraphQL package for Elm, and for this project, we will use <a href="https://github.com/jamesmacaulay/elm-graphql"><code class="language-plaintext highlighter-rouge">elm-graphql</code></a>. Let’s install it directly in the Elm app:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>assets/elm
elm-package <span class="nb">install </span>jamesmacaulay/elm-graphql
</code></pre></div></div> <p>Now, since the Phoenix-side API URL has changed, the first thing we need to do is make our easiest edit, and tell Elm the new location to send requests to:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">apiUrl</span><span class="p">)</span>


<span class="n">apiUrl</span> <span class="p">:</span> <span class="kt">String</span>
<span class="n">apiUrl</span> <span class="o">=</span>
    <span class="s">"</span><span class="s2">/api"</span>
</code></pre></div></div> <h3 id="contact-via-graphql">Contact via GraphQL</h3> <p>Now, let’s begin the process of getting the display of a single contact working again, starting with changing <code class="language-plaintext highlighter-rouge">Contact.Commands</code> to use GraphQL when sending requests:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContact</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">apiUrl</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactMsg</span><span class="p">(</span><span class="kt">FetchContact</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Request</span> <span class="k">as</span> <span class="kt">Request</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Client</span><span class="o">.</span><span class="kt">Http</span> <span class="k">as</span> <span class="kt">Http</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ContactMsg</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Task</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Task</span><span class="p">)</span>


<span class="n">fetchContact</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">fetchContact</span> <span class="n">id</span> <span class="o">=</span>
    <span class="n">id</span>
        <span class="o">|&gt;</span> <span class="kt">Request</span><span class="o">.</span><span class="n">fetchContact</span>
        <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">sendQuery</span> <span class="n">apiUrl</span>
        <span class="o">|&gt;</span> <span class="kt">Task</span><span class="o">.</span><span class="n">attempt</span> <span class="kt">FetchContact</span>
        <span class="o">|&gt;</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">map</span> <span class="kt">ContactMsg</span>
</code></pre></div></div> <p>Once we’ve built the GraphQL request to fetch a contact (whose <code class="language-plaintext highlighter-rouge">Contact.Request</code> module we will create next), we:</p> <ul> <li>use <a href="http://package.elm-lang.org/packages/jamesmacaulay/elm-graphql/1.8.0/GraphQL-Client-Http#sendQuery"><code class="language-plaintext highlighter-rouge">GraphQL.Client.Http.sendQuery</code></a> to create a <code class="language-plaintext highlighter-rouge">Task</code> to send the query off to the <code class="language-plaintext highlighter-rouge">apiUrl</code> </li> <li>ask the Elm runtime to <code class="language-plaintext highlighter-rouge">attempt</code> to run that <code class="language-plaintext highlighter-rouge">Task</code> </li> <li>send a <code class="language-plaintext highlighter-rouge">Msg</code> of type <code class="language-plaintext highlighter-rouge">ContactMsg FetchContact</code>, which gets handled just like before in <code class="language-plaintext highlighter-rouge">Contact.Update</code> (no changes needed to that file)</li> </ul> <p>Now, let’s create that <code class="language-plaintext highlighter-rouge">Contact.Request</code> module to replace the <code class="language-plaintext highlighter-rouge">Contact.Decoder</code>. Unlike in GraphiQL, we cannot use raw GraphQL queries in Elm-land, so we will have to port the content of the query to Elm (but let’s keep the GraphQL query that we want generated as a comment, just so we can keep our bearings):</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Request.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Request</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContact</span><span class="o">,</span> <span class="n">contactSpec</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Contact</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span> <span class="k">as</span> <span class="kt">Builder</span>
    <span class="k">exposing</span>
        <span class="p">(</span> <span class="kt">Document</span>
        <span class="o">,</span> <span class="kt">NonNull</span>
        <span class="o">,</span> <span class="kt">ObjectType</span>
        <span class="o">,</span> <span class="kt">Query</span>
        <span class="o">,</span> <span class="kt">Request</span>
        <span class="o">,</span> <span class="kt">ValueSpec</span>
        <span class="o">,</span> <span class="n">field</span>
        <span class="o">,</span> <span class="n">int</span>
        <span class="o">,</span> <span class="n">object</span>
        <span class="o">,</span> <span class="n">string</span>
        <span class="o">,</span> <span class="n">with</span>
        <span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span><span class="o">.</span><span class="kt">Arg</span> <span class="k">as</span> <span class="kt">Arg</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span><span class="o">.</span><span class="kt">Variable</span> <span class="k">as</span> <span class="kt">Var</span>


<span class="cm">{-|
query($contactID: ID!) {
  contact(id: $contactID) {
    id
    firstName
    lastName
    gender
    birthDate
    location
    phoneNumber
    email
    headline
    picture
  }
}
-}</span>
<span class="n">fetchContact</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Request</span> <span class="kt">Query</span> <span class="kt">Contact</span>
<span class="n">fetchContact</span> <span class="n">id</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">contactID</span> <span class="o">=</span>
            <span class="kt">Arg</span><span class="o">.</span><span class="n">variable</span> <span class="p">(</span><span class="kt">Var</span><span class="o">.</span><span class="n">required</span> <span class="s">"</span><span class="s2">contactID"</span> <span class="o">.</span><span class="n">contactID</span> <span class="kt">Var</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="n">contactField</span> <span class="o">=</span>
            <span class="kt">Builder</span><span class="o">.</span><span class="n">extract</span>
                <span class="p">(</span><span class="n">field</span>
                    <span class="s">"</span><span class="s2">contact"</span>
                    <span class="p">[</span> <span class="p">(</span> <span class="s">"</span><span class="s2">id"</span><span class="o">,</span> <span class="n">contactID</span> <span class="p">)</span> <span class="p">]</span>
                    <span class="n">contactSpec</span>
                <span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span>
            <span class="p">{</span> <span class="n">contactID</span> <span class="o">=</span> <span class="n">id</span> <span class="p">}</span>
    <span class="k">in</span>
        <span class="n">contactField</span>
            <span class="o">|&gt;</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">queryDocument</span>
            <span class="o">|&gt;</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">request</span> <span class="n">params</span>


<span class="n">contactSpec</span> <span class="p">:</span> <span class="kt">ValueSpec</span> <span class="kt">NonNull</span> <span class="kt">ObjectType</span> <span class="kt">Contact</span> <span class="n">vars</span>
<span class="n">contactSpec</span> <span class="o">=</span>
    <span class="kt">Contact</span>
        <span class="o">|&gt;</span> <span class="n">object</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">id"</span> <span class="p">[]</span> <span class="n">int</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">firstName"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">lastName"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">gender"</span> <span class="p">[]</span> <span class="n">int</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">birthDate"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">location"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">phoneNumber"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">email"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">headline"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
        <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">picture"</span> <span class="p">[]</span> <span class="n">string</span><span class="p">)</span>
</code></pre></div></div> <p>The content of the <code class="language-plaintext highlighter-rouge">contactSpec</code> function pretty much lines up logically with the code that we have in <code class="language-plaintext highlighter-rouge">Contact.Decoder</code>, while <code class="language-plaintext highlighter-rouge">fetchContact</code>:</p> <ul> <li>builds the query step by step with the <code class="language-plaintext highlighter-rouge">let</code> expressions</li> <li>creates a <code class="language-plaintext highlighter-rouge">GraphQL.Request.Builder.Document</code> for the query</li> <li>creates a <code class="language-plaintext highlighter-rouge">GraphQL.Request.Builder.Request</code> from the <code class="language-plaintext highlighter-rouge">Document</code> that gets sent to the <code class="language-plaintext highlighter-rouge">apiUrl</code> in <code class="language-plaintext highlighter-rouge">Contact.Commands</code> </li> </ul> <p>One final small change is to make sure that the <code class="language-plaintext highlighter-rouge">Contact.Messages</code> file, which has been referencing the <a href="https://github.com/elm-lang/http"><code class="language-plaintext highlighter-rouge">Http</code></a> library, now needs to reference <a href="http://package.elm-lang.org/packages/jamesmacaulay/elm-graphql/1.8.0/GraphQL-Client-Http"><code class="language-plaintext highlighter-rouge">GraphQL.Client.Http</code></a> instead:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/Contact/Messages.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactMsg</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Contact</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Client</span><span class="o">.</span><span class="kt">Http</span> <span class="k">as</span> <span class="kt">Http</span>


<span class="k">type</span> <span class="kt">ContactMsg</span>
    <span class="o">=</span> <span class="kt">FetchContact</span> <span class="p">(</span><span class="kt">Result</span> <span class="kt">Http</span><span class="o">.</span><span class="kt">Error</span> <span class="kt">Contact</span><span class="p">)</span>
</code></pre></div></div> <p>At this point, individual contact detail pages should be displaying, so navigate to the URL of a known contact (eg <a href="http://localhost:4000/contacts/4">http://localhost:4000/contacts/4</a>), and you should see a page that looks something like:</p> <p><img src="/assets/images/2018-03-07/address-book-contact-show.png" alt="Address Book contact" title="Address Book contact" class="img-responsive"></p> <p>The sample data in the app is generated randomly, so the contact you see from the URL above will most likely be different, but, it works! Performing a search, or navigating to the root page of the app, or doing anything that results in displaying a list of contacts will <em>not</em> work just yet, though, so let’s polish that task off and finish up this migration.</p> <h3 id="contact-list-via-graphql">Contact List via GraphQL</h3> <p>This process will look (and be) very similar to how we migrated the contacts, so let’s briskly get through how the files will change:</p> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/ContactList/Commands.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContactList</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Commands</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">apiUrl</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactListMsg</span><span class="p">(</span><span class="kt">FetchContactList</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Request</span> <span class="k">as</span> <span class="kt">Request</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Client</span><span class="o">.</span><span class="kt">Http</span> <span class="k">as</span> <span class="kt">Http</span>
<span class="k">import</span> <span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ContactListMsg</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Task</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Task</span><span class="p">)</span>


<span class="n">fetchContactList</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">fetchContactList</span> <span class="n">pageNumber</span> <span class="n">search</span> <span class="o">=</span>
    <span class="n">search</span>
        <span class="o">|&gt;</span> <span class="kt">Request</span><span class="o">.</span><span class="n">fetchContactList</span> <span class="n">pageNumber</span>
        <span class="o">|&gt;</span> <span class="kt">Http</span><span class="o">.</span><span class="n">sendQuery</span> <span class="n">apiUrl</span>
        <span class="o">|&gt;</span> <span class="kt">Task</span><span class="o">.</span><span class="n">attempt</span> <span class="kt">FetchContactList</span>
        <span class="o">|&gt;</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">map</span> <span class="kt">ContactListMsg</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/ContactList/Messages.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Messages</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactListMsg</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactList</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Client</span><span class="o">.</span><span class="kt">Http</span> <span class="k">as</span> <span class="kt">Http</span>


<span class="k">type</span> <span class="kt">ContactListMsg</span>
    <span class="o">=</span> <span class="kt">FetchContactList</span> <span class="p">(</span><span class="kt">Result</span> <span class="kt">Http</span><span class="o">.</span><span class="kt">Error</span> <span class="kt">ContactList</span><span class="p">)</span>
    <span class="o">|</span> <span class="kt">Paginate</span> <span class="kt">Int</span>
    <span class="o">|</span> <span class="kt">ResetSearch</span>
    <span class="o">|</span> <span class="kt">SearchContacts</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">assets/elm/src/ContactList/Request.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Request</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchContactList</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Contact</span><span class="o">.</span><span class="kt">Request</span>
<span class="k">import</span> <span class="kt">ContactList</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ContactList</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span> <span class="k">as</span> <span class="kt">Builder</span>
    <span class="k">exposing</span>
        <span class="p">(</span> <span class="kt">NonNull</span>
        <span class="o">,</span> <span class="kt">ObjectType</span>
        <span class="o">,</span> <span class="kt">Query</span>
        <span class="o">,</span> <span class="kt">Request</span>
        <span class="o">,</span> <span class="kt">ValueSpec</span>
        <span class="o">,</span> <span class="n">field</span>
        <span class="o">,</span> <span class="n">int</span>
        <span class="o">,</span> <span class="n">list</span>
        <span class="o">,</span> <span class="n">object</span>
        <span class="o">,</span> <span class="n">with</span>
        <span class="p">)</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span><span class="o">.</span><span class="kt">Arg</span> <span class="k">as</span> <span class="kt">Arg</span>
<span class="k">import</span> <span class="kt">GraphQL</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="kt">Builder</span><span class="o">.</span><span class="kt">Variable</span> <span class="k">as</span> <span class="kt">Var</span>


<span class="cm">{-|
query($searchQuery: String!, $pageNumber: Int!) {
  contacts(search: $searchQuery, page: $pageNumber) {
    entries {
      id
      firstName
      lastName
      gender
      birthDate
      location
      phoneNumber
      email
      headline
      picture
    },
    pageNumber,
    totalEntries,
    totalPages
  }
}
-}</span>
<span class="n">fetchContactList</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Request</span> <span class="kt">Query</span> <span class="kt">ContactList</span>
<span class="n">fetchContactList</span> <span class="n">page</span> <span class="n">search</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">searchQuery</span> <span class="o">=</span>
            <span class="kt">Arg</span><span class="o">.</span><span class="n">variable</span> <span class="p">(</span><span class="kt">Var</span><span class="o">.</span><span class="n">required</span> <span class="s">"</span><span class="s2">searchQuery"</span> <span class="o">.</span><span class="n">searchQuery</span> <span class="kt">Var</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>

        <span class="n">pageNumber</span> <span class="o">=</span>
            <span class="kt">Arg</span><span class="o">.</span><span class="n">variable</span> <span class="p">(</span><span class="kt">Var</span><span class="o">.</span><span class="n">required</span> <span class="s">"</span><span class="s2">pageNumber"</span> <span class="o">.</span><span class="n">pageNumber</span> <span class="kt">Var</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

        <span class="n">contactsField</span> <span class="o">=</span>
            <span class="kt">Builder</span><span class="o">.</span><span class="n">extract</span>
                <span class="p">(</span><span class="n">field</span>
                    <span class="s">"</span><span class="s2">contacts"</span>
                    <span class="p">[</span> <span class="p">(</span> <span class="s">"</span><span class="s2">search"</span><span class="o">,</span> <span class="n">searchQuery</span> <span class="p">)</span><span class="o">,</span> <span class="p">(</span> <span class="s">"</span><span class="s2">page"</span><span class="o">,</span> <span class="n">pageNumber</span> <span class="p">)</span> <span class="p">]</span>
                    <span class="n">contactListSpec</span>
                <span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span>
            <span class="p">{</span> <span class="n">searchQuery</span> <span class="o">=</span> <span class="n">search</span>
            <span class="o">,</span> <span class="n">pageNumber</span> <span class="o">=</span> <span class="n">page</span>
            <span class="p">}</span>
    <span class="k">in</span>
        <span class="n">contactsField</span>
            <span class="o">|&gt;</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">queryDocument</span>
            <span class="o">|&gt;</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">request</span> <span class="n">params</span>


<span class="n">contactListSpec</span> <span class="p">:</span> <span class="kt">ValueSpec</span> <span class="kt">NonNull</span> <span class="kt">ObjectType</span> <span class="kt">ContactList</span> <span class="n">vars</span>
<span class="n">contactListSpec</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">contact</span> <span class="o">=</span>
            <span class="kt">Contact</span><span class="o">.</span><span class="kt">Request</span><span class="o">.</span><span class="n">contactSpec</span>
    <span class="k">in</span>
        <span class="kt">ContactList</span>
            <span class="o">|&gt;</span> <span class="n">object</span>
            <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">entries"</span> <span class="p">[]</span> <span class="p">(</span><span class="n">list</span> <span class="n">contact</span><span class="p">))</span>
            <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">pageNumber"</span> <span class="p">[]</span> <span class="n">int</span><span class="p">)</span>
            <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">totalEntries"</span> <span class="p">[]</span> <span class="n">int</span><span class="p">)</span>
            <span class="o">|&gt;</span> <span class="n">with</span> <span class="p">(</span><span class="n">field</span> <span class="s">"</span><span class="s2">totalPages"</span> <span class="p">[]</span> <span class="n">int</span><span class="p">)</span>
</code></pre></div></div> <p>Pretty similar set of changes, right? The only real differences are the number of parameters for the query, and the <code class="language-plaintext highlighter-rouge">contactSpec</code> nesting inside <code class="language-plaintext highlighter-rouge">contactListSpec</code>, which is in a similar vein to the nesting of the <code class="language-plaintext highlighter-rouge">Contact.Decoder</code> inside a <code class="language-plaintext highlighter-rouge">ContactList.Decoder</code>.</p> <p>Now, you should be able to view any page in the app that displays a list of contacts. The GraphQL migration is complete, and you can safely remove the <code class="language-plaintext highlighter-rouge">Decoder</code> files from the application.</p> <blockquote> <p>Any issues getting things to work? Have a look at the <a href="https://github.com/paulfioravanti/phoenix-and-elm/tree/graphql"><code class="language-plaintext highlighter-rouge">graphql</code> branch</a> and see if there are any differences from your code.</p> </blockquote> <h2 id="wrapping-up">Wrapping Up</h2> <p>There is so much more to GraphQL than what I’ve managed to fit into this admittedly long blog post. We only dealt with queries, and did not even touch other GraphQL fundamentals like <a href="http://graphql.org/learn/queries/#mutations">mutations</a>, which cover modifying server-side data (though take a look at the <a href="https://github.com/carleryd/elm-hipster-stack">Elm hipster stack repo</a> for some good examples of that).</p> <p>However, I hope that you enjoyed this small taste of Phoenix, Elm, and GraphQL working together, and if you join me in making further inroads with this fully functional tech stack moving forward, I would love to hear about it!</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/api" class="page__taxonomy-item" rel="tag">api</a><span class="sep">, </span> <a href="/tags/elixir" class="page__taxonomy-item" rel="tag">elixir</a><span class="sep">, </span> <a href="/tags/elm" class="page__taxonomy-item" rel="tag">elm</a><span class="sep">, </span> <a href="/tags/graphql" class="page__taxonomy-item" rel="tag">graphql</a><span class="sep">, </span> <a href="/tags/phoenix" class="page__taxonomy-item" rel="tag">phoenix</a><span class="sep">, </span> <a href="/tags/rest" class="page__taxonomy-item" rel="tag">rest</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-15">April 15, 2019</time></p> </footer> <section class="page__share"> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Migrating+a+Phoenix+and+Elm+app+from+REST+to+GraphQL%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fmigrate-phoenix-elm-app-rest-graphql%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fmigrate-phoenix-elm-app-rest-graphql%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fmigrate-phoenix-elm-app-rest-graphql%2F&amp;title=Migrating%20a%20Phoenix%20and%20Elm%20app%20from%20REST%20to%20GraphQL" class="btn btn--reddit" title=" Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fmigrate-phoenix-elm-app-rest-graphql%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/elm-phoenix-13/" class="pagination--pager" title="Connecting Elm to Phoenix 1.3 ">Previous</a> <a href="/blog/graph-driven-refactoring-elm/" class="pagination--pager" title="Graph-driven Refactoring in Elm ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Comments</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You May Also Enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-01-06/anakin-naboo-battle.png" alt="Anakin Skywalker piloting a Naboo fighter"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/your-code-episode-one/" rel="permalink">Your Code: Episode I - The Phantom Repository </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-01-06T17:25:00+11:00">January 6, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 3 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Every Developer Learns To Program. Every Journey Has A First Step. Every Coding Saga Has A Beginning. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-01-04/roro.jpg" alt="The Ruby on Rails Oceania (RORO) meetup at Airtasker offices"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/organise-meetups/" rel="permalink">Organise a Meetup </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-01-04T10:00:00+11:00">January 4, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 36 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Looking to take your love of meetups to the next level? Try organising! </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-01-03/infobar.jpg" alt="Japanese feature phones"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/oi-kochi/" rel="permalink">Oi! Kochi: Japanese Feature Phone-driven Development </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-01-03T21:05:00+11:00">January 3, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 3 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">During Japan’s mobile web infancy, I wanted my little community newsletter to ride the wave of the future. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-12-06/roro-paul.jpg" alt="Paul Fioravanti speaking at a Ruby on Rails Oceania Sydney meetup"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/speak-at-meetups/" rel="permalink">Speak at a Meetup </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-12-06T19:05:00+11:00">December 6, 2020</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 5 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Worked on a project or learned something new that others might not know about? Share your knowledge with your peers at a local meetup! </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2021 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-109270947-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/migrate-phoenix-elm-app-rest-graphql/",this.page.identifier="/blog/migrate-phoenix-elm-app-rest-graphql"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>