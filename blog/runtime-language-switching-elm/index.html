<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Runtime Language Switching in Elm | Floor and Varnish</title> <meta name="description" content="Internationalisation would seem to be a deceptively complex problem using Elm."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Runtime Language Switching in Elm"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/"> <meta property="og:description" content="Internationalisation would seem to be a deceptively complex problem using Elm."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2018-05-11/ameet-dhanda-476959-unsplash.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Runtime Language Switching in Elm"> <meta name="twitter:description" content="Internationalisation would seem to be a deceptively complex problem using Elm."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2018-05-11/ameet-dhanda-476959-unsplash.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2018-05-11T19:05:00+10:00"> <meta property="article:modified_time" content="2019-04-17T06:30:00+10:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2018-05-11/ameet-dhanda-476959-unsplash.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Runtime Language Switching in Elm </h1> <p class="page__lead">Internationalisation would seem to be a deceptively complex problem using Elm. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2018-05-11T19:05:00+10:00">May 11, 2018</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 25 minute read </span> </p> <a href="http://www.elmweekly.nl/issues/elm-weekly-issue-59-172288" style="text-decoration: none;"> <img src="https://img.shields.io/badge/Elm%20Weekly-%2359-green.svg" alt="Elm Weekly #59"> </a> </div> <span class="page__hero-caption">Photo by <a href="https://unsplash.com/photos/ojVfHwrBlP4?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Ameet Dhanda</a> on <a href="https://unsplash.com/search/photos/language?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a> </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://instagram.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/@paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Runtime Language Switching in Elm"> <meta itemprop="description" content="Internationalisation would seem to be a deceptively complex problem using Elm."> <meta itemprop="datePublished" content="2018-05-11T19:05:00+10:00"> <meta itemprop="dateModified" content="2019-04-17T06:30:00+10:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>When it comes to creating multilingual web pages, internationali[s|z]ation (<a href="https://en.wikipedia.org/wiki/Internationalization_and_localization#Naming">I18n</a>) would seem to be a deceptively complex problem using <a href="http://elm-lang.org/">Elm</a>.</p> <p>I have never had to consider the choice of generating application translations as a pre-build phase of an app (eg <a href="https://github.com/iosphere/elm-i18n">elm-i18n</a>), or have them be dynamically loaded (eg <a href="https://github.com/ChristophP/elm-i18next">elm-i18next</a>) when working with i18n in <a href="https://guides.rubyonrails.org/i18n.html">Rails</a> or <a href="https://hexdocs.pm/gettext/Gettext.html">Phoenix</a>. To be honest, I still do not know which way of doing things is “best” in an Elm context. But, I do know that I want to have runtime-switchable languages via a dropdown menu, so the creation of an example page with dynamically loaded translations will be the main focus of this blog post.</p> <p>I have been using <a href="http://tachyons.io/">Tachyons</a> a lot lately for styling, and like how it plays with Elm, so we will set about doing the following:</p> <ul> <li>Re-create Tachyons’ <a href="http://tachyons.io/components/layout/full-screen-centered-title/index.html">Full Screen Centered Title component documentation page</a> in Elm</li> <li>Add a custom language-switcher dropdown menu to the page</li> <li>Provide some translations for the page in <a href="https://www.json.org/">JSON</a> format, and allow the dropdown menu to switch the language</li> <li>Store the selected language in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-plaintext highlighter-rouge">localStorage</code></a> so that any selected language persists through page refreshes and different sessions.</li> <li>Explore generating Elm modules from the JSON translation files in order to give the translations some type safety</li> </ul> <p>(If you want to skip ahead and see the final result, feel free to clone my <a href="https://github.com/paulfioravanti/elm-i18n-example"><code class="language-plaintext highlighter-rouge">elm-i18n-example</code> repo</a>)</p> <p>Let’s get started!</p> <blockquote> <p><strong>Update (21 December 2018)</strong></p> <p>The version of Elm used in this post is 0.18. I still stand by the overall points of the post, but some of the code is now outdated. The <code class="language-plaintext highlighter-rouge">master</code> branch of the <a href="https://github.com/paulfioravanti/elm-i18n-example"><code class="language-plaintext highlighter-rouge">elm-i18n-example</code> repo</a> has been updated to Elm 0.19, so if you are following along, and you get issues, try reconciling them there with the updated codebase.</p> <p>The full original 0.18 codebase used in this post can be found on the <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/0.18">0.18 branch</a> of the repo.</p> </blockquote> <h2 id="bootstrap-a-new-elm-application">Bootstrap a New Elm Application</h2> <p><a href="https://github.com/halfzebra/create-elm-app">Create Elm App</a> will help us bootstrap our app, so install it with:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> create-elm-app
</code></pre></div></div> <p>Then, generate a new app, initialise <code class="language-plaintext highlighter-rouge">npm</code> (using the default fields provided for the generated <code class="language-plaintext highlighter-rouge">package.json</code> file is fine), and install Tachyons:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create-elm-app elm-i18n-example
<span class="nb">cd </span>elm-i18n-example
npm init
npm <span class="nb">install </span>tachyons
</code></pre></div></div> <p>Next, to import Tachyons into the project, change the generated <code class="language-plaintext highlighter-rouge">index.js</code> file to look like the following:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/index.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">tachyons</span><span class="dl">"</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">./main.css</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Main</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Main.elm</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">appContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">)</span>

<span class="k">if </span><span class="p">(</span><span class="nx">appContainer</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Main</span><span class="p">.</span><span class="nf">embed</span><span class="p">(</span><span class="nx">appContainer</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now, if you run <code class="language-plaintext highlighter-rouge">elm-app start</code>, <a href="http://localhost:3000/">http://localhost:3000/</a> should open automatically and you should see a familiar splash screen letting you know that your Elm app is working.</p> <p>Before we get started properly, let’s do a bit of clean-up of some of the generated code Create Elm App gave us:</p> <ul> <li>We do not need <code class="language-plaintext highlighter-rouge">src/main.css</code> since Tachyons will take care of styling</li> <li>This app will not use service workers, so <code class="language-plaintext highlighter-rouge">src/registerServiceWorker.js</code> can be removed</li> <li>We will not be using the Elm logo from the splash screen, so that can be removed, as well as references to it in <code class="language-plaintext highlighter-rouge">src/Main.elm</code> </li> </ul> <p>So, run the command below and make the following changes:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm </span>src/main.css src/registerServiceWorker.js public/logo.svg
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">src/index.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">tachyons</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Main</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Main.elm</span><span class="dl">"</span>

<span class="c1">// ...</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="n">div</span> <span class="p">[]</span>
        <span class="p">[</span> <span class="n">h1</span> <span class="p">[]</span> <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">Your Elm App is working!"</span> <span class="p">]</span>
        <span class="p">]</span>
</code></pre></div></div> <p>You should now be left with a very plain looking (but compilable) page, so let’s brighten it up a bit!</p> <h2 id="re-create-the-tachyons-documentation-page">Re-create the Tachyons Documentation Page</h2> <p>Using the sample code on the <a href="http://tachyons.io/components/layout/full-screen-centered-title/index.html">Full Screen Centered Title page</a> as a guide (but with a few minor edits), change the <code class="language-plaintext highlighter-rouge">Main.elm</code> module definitions, import declarations, and <code class="language-plaintext highlighter-rouge">view</code> function to re-create the page:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Main</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="o">,</span> <span class="n">article</span><span class="o">,</span> <span class="n">div</span><span class="o">,</span> <span class="n">h1</span><span class="o">,</span> <span class="n">main_</span><span class="o">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Attributes</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">bg-dark-pink"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">overflow-container"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">sans-serif"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">white"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">main_</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">content</span> <span class="p">]</span>


<span class="n">content</span> <span class="p">:</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">content</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">articleClasses</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">dt"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">vh-100"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w-100"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="n">divClasses</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">dtc"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">ph3 ph4-l"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">tc"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">v-mid"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">article</span> <span class="p">[</span> <span class="n">articleClasses</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">div</span> <span class="p">[</span> <span class="n">divClasses</span> <span class="p">]</span>
                <span class="p">[</span> <span class="n">heading</span> <span class="p">]</span>
            <span class="p">]</span>


<span class="n">heading</span> <span class="p">:</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">heading</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">f6 f2m"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">f-subheadline-l"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">fw6"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">tc"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">h1</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">Vertically centering things in css is easy!"</span> <span class="p">]</span>
</code></pre></div></div> <p>I think that putting Tachyons classes in lists like this makes them easier to scan and maintain, but it also has the side effect of making function definitions really long, so here we have split out the content across three different smaller functions.</p> <p>Using utility-based CSS frameworks like Tachyons and <a href="https://tailwindcss.com/">Tailwind</a> can seem daunting at first, what with all the mnemonics that you seem to have to commit to memory, so I always keep <a href="http://tachyons.io/docs/table-of-styles/">Tachyons’ Table of Styles</a> open in a browser tab for quick reference, and if this is your first look at Tachyons, I would recommend you do the same.</p> <p>Anyway, your page should now look like the following screen shot:</p> <p><img src="/assets/images/2018-05-11/Tachyons-Page-Recreated.png" alt="Tachyons Page Recreated" title="Tachyons Page Recreated" class="img-responsive"></p> <p>If it does not, check your code against <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/1-recreate-tachyons-doc-page">the <code class="language-plaintext highlighter-rouge">1-recreate-tachyons-doc-page</code> branch</a> of my codebase to see if anything is missing.</p> <h2 id="add-language-dropdown-menu">Add Language Dropdown Menu</h2> <p>For now, the language dropdown menu will be populated with placeholder values, and will not actually be able to change languages, but what we want from the menu in the end is:</p> <ul> <li>The current language should be shown on the menu by default</li> <li>When you click the menu, it should open, revealing any other available languages <em>aside from</em> the current language</li> <li>When you mouse over a menu item, it should be highlighted in some way</li> <li>When you click on a menu item, it should change the current language of the application (we’ll do that later)</li> <li>If, while the menu is open, you click anywhere else on the page, the menu should close</li> </ul> <p>Most of these requirements sound like they would be best served in their own module, so let’s create one called <code class="language-plaintext highlighter-rouge">LanguageDropdown.elm</code>, and start with rendering just the current language selection so we can get the menu positioning right.</p> <h3 id="current-selection">Current Selection</h3> <p><strong><code class="language-plaintext highlighter-rouge">src/LanguageDropdown.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">LanguageDropdown</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">view</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="o">,</span> <span class="n">div</span><span class="o">,</span> <span class="n">li</span><span class="o">,</span> <span class="n">p</span><span class="o">,</span> <span class="n">span</span><span class="o">,</span> <span class="n">text</span><span class="o">,</span> <span class="n">ul</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Attributes</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">class</span><span class="p">)</span>


<span class="n">view</span> <span class="p">:</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">view</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">center"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">f3"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">flex"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">h3"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">items-center"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">justify-end"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w-90"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">div</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">currentSelection</span> <span class="p">]</span>


<span class="n">currentSelection</span> <span class="p">:</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">currentSelection</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">b--white"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">ba"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">br2"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pa2"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pointer"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">tc"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w4"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="n">caretClasses</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">absolute"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">ml2"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">p</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">span</span> <span class="p">[]</span>
                <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">English"</span> <span class="p">]</span>
            <span class="o">,</span> <span class="n">span</span> <span class="p">[</span> <span class="n">caretClasses</span> <span class="p">]</span>
                <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">▾"</span> <span class="p">]</span>
            <span class="p">]</span>
</code></pre></div></div> <p>Next, we have to import the language dropdown code in the <code class="language-plaintext highlighter-rouge">Main</code> module, as well as slightly adjust the styles in the <code class="language-plaintext highlighter-rouge">view</code> function, since there is now more on the page than just the message:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">LanguageDropdown</span>

<span class="c1">-- ...</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">bg-dark-pink"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">overflow-container"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pt3"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">sans-serif"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">vh-100"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">white"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">main_</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="kt">LanguageDropdown</span><span class="o">.</span><span class="n">view</span>
            <span class="o">,</span> <span class="n">content</span>
            <span class="p">]</span>

<span class="n">content</span> <span class="p">:</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">content</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">articleClasses</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">dt"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">vh-75"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w-100"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="c1">-- ...</span>
</code></pre></div></div> <p>Now, your page should look like this:</p> <p><img src="/assets/images/2018-05-11/menu-with-current-selection.png" alt="Menu with current selection only" title="Menu with current selection only" class="img-responsive"></p> <p>The “menu” here (yes, it is currently just a <code class="language-plaintext highlighter-rouge">p</code> tag), currently does nothing, but we can at least confirm that it looks like it is in a good spot on the page. Now, let’s actually give it a <code class="language-plaintext highlighter-rouge">dropdownList</code> under the <code class="language-plaintext highlighter-rouge">currentSelection</code>!</p> <h3 id="language-dropdown-list">Language Dropdown List</h3> <p><strong><code class="language-plaintext highlighter-rouge">src/LanguageDropdown.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">view</span> <span class="p">:</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">view</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">div</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">currentSelection</span>
            <span class="o">,</span> <span class="n">dropdownList</span>
            <span class="p">]</span>

<span class="c1">-- ...</span>

<span class="n">dropdownList</span> <span class="p">:</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">dropdownList</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">absolute"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">b--white"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">bb"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">bl"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">br"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">br--bottom"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">br2"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">items-center"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">list"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">mt5"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pl0"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pointer"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pr0"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pt1"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">tc"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">top-0"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w4"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="n">selectableLanguages</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">Italiano"</span><span class="o">,</span> <span class="s">"</span><span class="s2">日本語"</span> <span class="p">]</span>

    <span class="k">in</span>
        <span class="n">ul</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">dropdownListItem</span> <span class="n">selectableLanguages</span><span class="p">)</span>


<span class="n">dropdownListItem</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">dropdownListItem</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="s">"</span><span class="s2">hover-bg-white"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">hover-dark-pink"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">ph1"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pv2"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">pt0"</span>
            <span class="o">,</span> <span class="s">"</span><span class="s2">w-100"</span>
            <span class="p">]</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>
    <span class="k">in</span>
        <span class="n">li</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">span</span> <span class="p">[]</span> <span class="p">[</span> <span class="n">text</span> <span class="n">language</span> <span class="p">]</span> <span class="p">]</span>
</code></pre></div></div> <p>This results in:</p> <p><img src="/assets/images/2018-05-11/menu-with-open-selection.png" alt="Menu with open selection" title="Menu with open selection" class="img-responsive"></p> <ul> <li>For the dropdown list, we are shoving a HTML unordered list (<code class="language-plaintext highlighter-rouge">ul</code>) right underneath the <code class="language-plaintext highlighter-rouge">p</code> tag, simulating a menu opening.</li> <li>When we hover over a menu item, we can tell which item is currently being selected.</li> <li>Selectable languages currently have strings as their placeholders, but we will change that later on as we introduce the concept of a language to the application.</li> </ul> <p>So, we now know what the menu looks like when it is open, but we need it to respond to mouse clicks to open and close the dropdown list (read: show and hide the list), so let’s do that now.</p> <h2 id="show-and-hide-available-languages">Show and Hide Available Languages</h2> <p>The application needs to be able to keep track of whether to show or hide the dropdown list, and needs to be able to track clicks on the menu and page, so it sounds like we need the following:</p> <ul> <li>A Boolean flag to tell the app whether to <code class="language-plaintext highlighter-rouge">showAvailableLanguages</code> or not</li> <li>An update <code class="language-plaintext highlighter-rouge">Msg</code> that will toggle the visibility of the dropdown list; let’s call it <code class="language-plaintext highlighter-rouge">ShowAvailableLanguages</code> </li> <li>An update <code class="language-plaintext highlighter-rouge">Msg</code> that will hide the dropdown list, for when the dropdown is open but a click is registered anywhere else on the page; let’s call it <code class="language-plaintext highlighter-rouge">CloseAvailableLanguages</code> </li> </ul> <p>We will start with updating the <code class="language-plaintext highlighter-rouge">Msg</code> union type. Both <code class="language-plaintext highlighter-rouge">Main.elm</code> and <code class="language-plaintext highlighter-rouge">LanguageDropdown.elm</code> are going to need access to <code class="language-plaintext highlighter-rouge">Msg</code>, so let’s extract it into its own module:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Msg.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>


<span class="k">type</span> <span class="kt">Msg</span>
    <span class="o">=</span> <span class="kt">CloseAvailableLanguages</span>
    <span class="o">|</span> <span class="kt">ShowAvailableLanguages</span>
</code></pre></div></div> <p>Next, extract <code class="language-plaintext highlighter-rouge">Model</code> and the <code class="language-plaintext highlighter-rouge">init</code> function from <code class="language-plaintext highlighter-rouge">Main</code> into a new <code class="language-plaintext highlighter-rouge">Model.elm</code> module, making sure that the dropdown is set to be hidden by default:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Model.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="o">,</span> <span class="n">init</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">showAvailableLanguages</span> <span class="p">:</span> <span class="kt">Bool</span> <span class="p">}</span>


<span class="n">init</span> <span class="p">:</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="o">=</span>
    <span class="p">(</span> <span class="p">{</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">False</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
</code></pre></div></div> <p>Now, we need to update <code class="language-plaintext highlighter-rouge">Main.elm</code> and <code class="language-plaintext highlighter-rouge">LanguageDropdown.elm</code> to import these modules, and then write some handling code for these <code class="language-plaintext highlighter-rouge">Msg</code>s in the <code class="language-plaintext highlighter-rouge">update</code> function:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">CloseAvailableLanguages</span><span class="o">,</span> <span class="kt">ShowAvailableLanguages</span><span class="p">))</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">CloseAvailableLanguages</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">False</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>

        <span class="kt">ShowAvailableLanguages</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span>
                <span class="o">|</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="n">not</span> <span class="n">model</span><span class="o">.</span><span class="n">showAvailableLanguages</span>
              <span class="p">}</span>
            <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span>
            <span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Never</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Html</span><span class="o">.</span><span class="n">program</span>
        <span class="p">{</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="o">,</span> <span class="n">init</span> <span class="o">=</span> <span class="kt">Model</span><span class="o">.</span><span class="n">init</span>
        <span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span>
        <span class="o">,</span> <span class="n">subscriptions</span> <span class="o">=</span> <span class="n">always</span> <span class="kt">Sub</span><span class="o">.</span><span class="n">none</span>
        <span class="p">}</span>
</code></pre></div></div> <p>In the <code class="language-plaintext highlighter-rouge">LanguageDropdown</code>, since we will be now be sending messages of type <code class="language-plaintext highlighter-rouge">Msg</code>, all function annotations with <code class="language-plaintext highlighter-rouge">Html msg</code> will need to be updated to be <code class="language-plaintext highlighter-rouge">Html Msg</code>. We will also be making use of the <code class="language-plaintext highlighter-rouge">view</code> function’s <code class="language-plaintext highlighter-rouge">model</code> parameter throughout the dropdown in order to determine what to show, as well as how to style the dropdown menu when it is open and closed:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/LanguageDropdown.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Events</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">onClick</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ShowAvailableLanguages</span><span class="p">))</span>


<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">div</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">currentSelection</span> <span class="n">model</span>
            <span class="o">,</span> <span class="n">dropdownList</span> <span class="n">model</span>
            <span class="p">]</span>


<span class="n">currentSelection</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">currentSelection</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">displayClasses</span> <span class="o">=</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">showAvailableLanguages</span> <span class="k">then</span>
                <span class="p">[</span> <span class="s">"</span><span class="s2">br--top"</span> <span class="p">]</span>
            <span class="k">else</span>
                <span class="p">[]</span>

        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="c1">-- ...</span>
            <span class="p">]</span>
                <span class="o">++</span> <span class="n">displayClasses</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">p</span> <span class="p">[</span> <span class="n">classes</span><span class="o">,</span> <span class="n">onClick</span> <span class="kt">ShowAvailableLanguages</span> <span class="p">]</span>
            <span class="p">[</span> <span class="c1">-- ...</span>
            <span class="p">]</span>


<span class="n">dropdownList</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">dropdownList</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">displayClasses</span> <span class="o">=</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">showAvailableLanguages</span> <span class="k">then</span>
                <span class="p">[</span> <span class="s">"</span><span class="s2">flex"</span><span class="o">,</span> <span class="s">"</span><span class="s2">flex-column"</span> <span class="p">]</span>
            <span class="k">else</span>
                <span class="p">[</span> <span class="s">"</span><span class="s2">dn"</span> <span class="p">]</span>

        <span class="n">classes</span> <span class="o">=</span>
            <span class="p">[</span> <span class="c1">-- ...</span>
            <span class="p">]</span>
                <span class="o">++</span> <span class="n">displayClasses</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">join</span> <span class="s">"</span><span class="s2"> "</span>
                <span class="o">|&gt;</span> <span class="n">class</span>

        <span class="c1">-- ...</span>
    <span class="k">in</span>
       <span class="c1">-- ...</span>


<span class="n">dropdownListItem</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="c1">-- ...</span>
</code></pre></div></div> <p>Once the above changes are made, you should be able to click on the dropdown menu to open and close it, showing and hiding the available languages. However, if you open the menu and then click anywhere else, the menu stays open.</p> <p>In order to get it to close (and actually use that <code class="language-plaintext highlighter-rouge">CloseAvailableLanguages</code> message), we are going to have to make use of the <a href="https://github.com/elm-lang/mouse">Elm Mouse package</a>, and a subscription to mouse clicks.</p> <h2 id="subscribe-to-mouse-clicks">Subscribe to Mouse Clicks</h2> <p>Install the Elm Mouse package:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elm-package <span class="nb">install</span> <span class="nt">-y</span> elm-lang/mouse
</code></pre></div></div> <p>Then, create a <code class="language-plaintext highlighter-rouge">subscriptions</code> function in Elm that listens out for mouse clicks <em>only</em> when the dropdown menu is open, and if a click is detected, sends a <code class="language-plaintext highlighter-rouge">CloseAvailableLanguages</code> message:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Mouse</span>

<span class="c1">-- ...</span>

<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="kt">Msg</span>
<span class="n">subscriptions</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">showAvailableLanguages</span> <span class="k">then</span>
        <span class="kt">Mouse</span><span class="o">.</span><span class="n">clicks</span> <span class="p">(</span><span class="o">\</span><span class="n">_</span> <span class="o">-&gt;</span> <span class="kt">CloseAvailableLanguages</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="kt">Sub</span><span class="o">.</span><span class="n">none</span>


<span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Never</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Html</span><span class="o">.</span><span class="n">programWithFlags</span>
        <span class="p">{</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="o">,</span> <span class="n">init</span> <span class="o">=</span> <span class="kt">Model</span><span class="o">.</span><span class="n">init</span>
        <span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span>
        <span class="o">,</span> <span class="n">subscriptions</span> <span class="o">=</span> <span class="n">subscriptions</span>
        <span class="p">}</span>
</code></pre></div></div> <p>Now, whenever you click open the dropdown menu, and then click anywhere else, the menu will close, as expected.</p> <p>If the app so far is not behaving as you would expect, compare your code to <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/2-add-language-dropdown">the <code class="language-plaintext highlighter-rouge">2-add-language-dropdown</code> branch</a> of my codebase to see if anything is missing.</p> <p>Now, it’s time to give the application the concept of a language to switch, and replace those placeholder values with actual data!</p> <h2 id="language-switching">Language Switching</h2> <p>Time to get some translations into the application, and for that, we will use <a href="https://github.com/ChristophP/elm-i18next">elm-i18next</a>, along with the <a href="https://github.com/elm-lang/http">HTTP in Elm</a> package, so let’s get installing:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elm-package <span class="nb">install</span> <span class="nt">-y</span> ChristophP/elm-i18next
elm-package <span class="nb">install</span> <span class="nt">-y</span> elm-lang/http
</code></pre></div></div> <p>First, let’s provide some translation JSON files for the message on screen in English, Italian, and Japanese. Create a <code class="language-plaintext highlighter-rouge">public/locale/</code> directory and add the following files under it:</p> <p><strong><code class="language-plaintext highlighter-rouge">public/locale/translations.en.json</code></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"verticallyCenteringInCssIsEasy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Vertically centering things in css is easy!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">public/locale/translations.it.json</code></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"verticallyCenteringInCssIsEasy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Centrare verticalmente con css è facile!"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">public/locale/translations.ja.json</code></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"verticallyCenteringInCssIsEasy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CSSで垂直センタリングは簡単だよ！"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Next, let’s create a <code class="language-plaintext highlighter-rouge">Translations</code> module where we will define the type for a language, and provide a helper function to convert a string language code into a language:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Translations.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="o">,</span> <span class="n">getLnFromCode</span><span class="p">)</span>


<span class="k">type</span> <span class="kt">Lang</span>
    <span class="o">=</span> <span class="kt">En</span>
    <span class="o">|</span> <span class="kt">It</span>
    <span class="o">|</span> <span class="kt">Ja</span>


<span class="n">getLnFromCode</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Lang</span>
<span class="n">getLnFromCode</span> <span class="n">code</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">code</span> <span class="k">of</span>
        <span class="s">"</span><span class="s2">en"</span> <span class="o">-&gt;</span>
            <span class="kt">En</span>

        <span class="s">"</span><span class="s2">it"</span> <span class="o">-&gt;</span>
            <span class="kt">It</span>

        <span class="s">"</span><span class="s2">ja"</span> <span class="o">-&gt;</span>
            <span class="kt">Ja</span>

        <span class="n">_</span> <span class="o">-&gt;</span>
            <span class="kt">En</span>
</code></pre></div></div> <p>Great! Now we need to add some new <code class="language-plaintext highlighter-rouge">Msg</code> types for:</p> <ul> <li>Fetching the translations from the JSON files</li> <li>Changing the language</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">src/Msg.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="o">..</span><span class="p">))</span>

<span class="k">import</span> <span class="kt">Http</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">I18Next</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Translations</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>


<span class="k">type</span> <span class="kt">Msg</span>
    <span class="o">=</span> <span class="kt">ChangeLanguage</span> <span class="kt">Lang</span>
    <span class="o">|</span> <span class="kt">CloseAvailableLanguages</span>
    <span class="o">|</span> <span class="kt">FetchTranslations</span> <span class="p">(</span><span class="kt">Result</span> <span class="kt">Error</span> <span class="kt">Translations</span><span class="p">)</span>
    <span class="o">|</span> <span class="kt">ShowAvailableLanguages</span>
</code></pre></div></div> <p>We now need a way to be able to go and fetch the translations from the JSON files, and return the result back via the <code class="language-plaintext highlighter-rouge">FetchTranslations</code> message, so let’s create that in a new module called <code class="language-plaintext highlighter-rouge">Cmd</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Cmd.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Cmd</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchTranslations</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">I18Next</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">FetchTranslations</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>


<span class="n">fetchTranslations</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">fetchTranslations</span> <span class="n">language</span> <span class="o">=</span>
    <span class="n">language</span>
        <span class="o">|&gt;</span> <span class="n">toTranslationsUrl</span>
        <span class="o">|&gt;</span> <span class="kt">I18Next</span><span class="o">.</span><span class="n">fetchTranslations</span> <span class="kt">FetchTranslations</span>


<span class="n">toTranslationsUrl</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">toTranslationsUrl</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">translationLanguage</span> <span class="o">=</span>
            <span class="n">language</span>
                <span class="o">|&gt;</span> <span class="n">toString</span>
                <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">toLower</span>
    <span class="k">in</span>
        <span class="s">"</span><span class="s2">/locale/translations."</span> <span class="o">++</span> <span class="n">translationLanguage</span> <span class="o">++</span> <span class="s">"</span><span class="s2">.json"</span>
</code></pre></div></div> <p>Now, the <code class="language-plaintext highlighter-rouge">Model</code> needs to know about what the <code class="language-plaintext highlighter-rouge">currentLanguage</code> of the application is in order to determine what <code class="language-plaintext highlighter-rouge">translations</code> should be loaded, so let’s add that information, and call the <code class="language-plaintext highlighter-rouge">Cmd.fetchTranslations En</code> command to immediately go and fetch the appropriate English translations, which we will also set as the default language:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Model.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="o">,</span> <span class="n">init</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Cmd</span>
<span class="k">import</span> <span class="kt">I18Next</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Translations</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">(</span><span class="kt">En</span><span class="p">))</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Model</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">currentLanguage</span> <span class="p">:</span> <span class="kt">Lang</span>
    <span class="o">,</span> <span class="n">showAvailableLanguages</span> <span class="p">:</span> <span class="kt">Bool</span>
    <span class="o">,</span> <span class="n">translations</span> <span class="p">:</span> <span class="kt">Translations</span>
    <span class="p">}</span>


<span class="n">init</span> <span class="p">:</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="o">=</span>
    <span class="p">(</span> <span class="p">{</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="kt">En</span>
      <span class="o">,</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">False</span>
      <span class="o">,</span> <span class="n">translations</span> <span class="o">=</span> <span class="kt">I18Next</span><span class="o">.</span><span class="n">initialTranslations</span>
      <span class="p">}</span>
    <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">fetchTranslations</span> <span class="kt">En</span>
    <span class="p">)</span>
</code></pre></div></div> <p>Next, we need to handle the new <code class="language-plaintext highlighter-rouge">ChangeLanguage</code> and <code class="language-plaintext highlighter-rouge">FetchTranslations</code> messages in the <code class="language-plaintext highlighter-rouge">update</code> function:</p> <ul> <li>When the language is changed, as well as change the <code class="language-plaintext highlighter-rouge">currentLanguage</code>, we need to go and fetch the translations for that language in the same way we did in the <code class="language-plaintext highlighter-rouge">init</code> function</li> <li>If fetching the translations succeeds, we will display the new translations, otherwise, for now we will just ignore any errors since we would not expect to fetch translations for a language that we did not create ourselves.</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Cmd</span>
<span class="k">import</span> <span class="kt">Msg</span>
    <span class="k">exposing</span>
        <span class="p">(</span> <span class="kt">Msg</span>
            <span class="p">(</span> <span class="kt">ChangeLanguage</span>
            <span class="o">,</span> <span class="kt">CloseAvailableLanguages</span>
            <span class="o">,</span> <span class="kt">FetchTranslations</span>
            <span class="o">,</span> <span class="kt">ShowAvailableLanguages</span>
            <span class="p">)</span>
        <span class="p">)</span>

<span class="c1">--- ...</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">ChangeLanguage</span> <span class="n">language</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="n">language</span> <span class="p">}</span>
            <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">fetchTranslations</span> <span class="n">language</span>
            <span class="p">)</span>

        <span class="kt">FetchTranslations</span> <span class="p">(</span><span class="kt">Ok</span> <span class="n">translations</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">translations</span> <span class="o">=</span> <span class="n">translations</span> <span class="p">}</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>

        <span class="kt">FetchTranslations</span> <span class="p">(</span><span class="kt">Err</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
</code></pre></div></div> <p>At this stage, the application should be back to a point where everything is compiling again, but on the surface there are no changes since the language display still consists of static values, so let’s change that.</p> <p>First, we will create a <code class="language-plaintext highlighter-rouge">Language</code> module that will have some helper functions around generating the string value for a language (eg “English” should always be displayed as “English”, regardless of what the current language is), and keeping a static list of available languages so we can display them in the dropdown menu. Unfortunately, there is no way to generate a list of type values from a type (eg <code class="language-plaintext highlighter-rouge">[En, It, Ja]</code> from the <code class="language-plaintext highlighter-rouge">Lang</code> type), so it will have to be a separate definition:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Language.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Language</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">availableLanguages</span><span class="o">,</span> <span class="n">langToString</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">(</span><span class="kt">En</span><span class="o">,</span> <span class="kt">It</span><span class="o">,</span> <span class="kt">Ja</span><span class="p">))</span>


<span class="n">availableLanguages</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Lang</span>
<span class="n">availableLanguages</span> <span class="o">=</span>
    <span class="p">[</span> <span class="kt">En</span><span class="o">,</span> <span class="kt">It</span><span class="o">,</span> <span class="kt">Ja</span> <span class="p">]</span>


<span class="n">langToString</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">langToString</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">language</span> <span class="k">of</span>
        <span class="kt">En</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">English"</span>

        <span class="kt">It</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">Italiano"</span>

        <span class="kt">Ja</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">日本語"</span>
</code></pre></div></div> <p>Now that we have our language data setup, let’s go back to the view code and get the page to start displaying it. First, let’s get the correct information displayed on the dropdown menu for both the current language, and for the other available languages in the dropdown:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/LanguageDropdown.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Language</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="kt">ChangeLanguage</span><span class="o">,</span> <span class="kt">ShowAvailableLanguages</span><span class="p">))</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">currentSelection</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">currentSelection</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">p</span> <span class="p">[</span> <span class="n">classes</span><span class="o">,</span> <span class="n">onClick</span> <span class="kt">ShowAvailableLanguages</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">span</span> <span class="p">[]</span>
                <span class="p">[</span> <span class="n">text</span> <span class="p">(</span><span class="kt">Language</span><span class="o">.</span><span class="n">langToString</span> <span class="n">model</span><span class="o">.</span><span class="n">currentLanguage</span><span class="p">)</span> <span class="p">]</span>
            <span class="o">,</span> <span class="n">span</span> <span class="p">[</span> <span class="n">caretClasses</span> <span class="p">]</span>
                <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">▾"</span> <span class="p">]</span>
            <span class="p">]</span>


<span class="n">dropdownList</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">dropdownList</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>

        <span class="n">selectableLanguages</span> <span class="o">=</span>
            <span class="kt">List</span><span class="o">.</span><span class="n">filter</span>
                <span class="p">(</span><span class="o">\</span><span class="n">language</span> <span class="o">-&gt;</span> <span class="n">language</span> <span class="o">/=</span> <span class="n">model</span><span class="o">.</span><span class="n">currentLanguage</span><span class="p">)</span>
                <span class="kt">Language</span><span class="o">.</span><span class="n">availableLanguages</span>
    <span class="k">in</span>
        <span class="n">ul</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">(</span><span class="kt">List</span><span class="o">.</span><span class="n">map</span> <span class="n">dropdownListItem</span> <span class="n">selectableLanguages</span><span class="p">)</span>


<span class="n">dropdownListItem</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">dropdownListItem</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">li</span> <span class="p">[</span> <span class="n">classes</span><span class="o">,</span> <span class="n">onClick</span> <span class="p">(</span><span class="kt">ChangeLanguage</span> <span class="n">language</span><span class="p">)</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">span</span> <span class="p">[]</span>
                <span class="p">[</span> <span class="n">text</span> <span class="p">(</span><span class="kt">Language</span><span class="o">.</span><span class="n">langToString</span> <span class="n">language</span><span class="p">)</span> <span class="p">]</span>
            <span class="p">]</span>
</code></pre></div></div> <p>At this point, if you select a new language from the dropdown menu, you will see the current language display change on the menu, and if you open the Elm debugger, you will see that the language of the application is <em>actually</em> changing, and the translations for the language <em>are</em> being loaded into the application:</p> <p><img src="/assets/images/2018-05-11/language-change.png" alt="Language Change" title="Language Change" class="img-responsive"></p> <p>Great! Now let’s get that translated message showing on the page by letting the content know what translations it is supposed to be displaying:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">main_</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="kt">LanguageDropdown</span><span class="o">.</span><span class="n">view</span> <span class="n">model</span>
            <span class="o">,</span> <span class="n">content</span> <span class="n">model</span><span class="o">.</span><span class="n">translations</span>
            <span class="p">]</span>


<span class="n">content</span> <span class="p">:</span> <span class="kt">Translations</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">content</span> <span class="n">translations</span> <span class="o">=</span>
    <span class="k">let</span>
       <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">article</span> <span class="p">[</span> <span class="n">articleClasses</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">div</span> <span class="p">[</span> <span class="n">divClasses</span> <span class="p">]</span>
                <span class="p">[</span> <span class="n">heading</span> <span class="n">translations</span> <span class="p">]</span>
            <span class="p">]</span>


<span class="n">heading</span> <span class="p">:</span> <span class="kt">Translations</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">heading</span> <span class="n">translations</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">h1</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">text</span> <span class="p">(</span><span class="kt">I18Next</span><span class="o">.</span><span class="n">t</span> <span class="n">translations</span> <span class="s">"</span><span class="s2">verticallyCenteringInCssIsEasy"</span><span class="p">)</span> <span class="p">]</span>
</code></pre></div></div> <p>And now, when you change language, you should see the displayed message in that language:</p> <p><img src="/assets/images/2018-05-11/japanese-display.png" alt="Japanese Display" title="Japanese display" class="img-responsive"></p> <p>Fantastic! That covers the main functionality of language switching, but there is still more we can do. Before we move on though, if you cannot switch languages, be sure to double-check your code against <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/3-add-language-switching">the <code class="language-plaintext highlighter-rouge">3-add-language-switching</code> branch</a> of my codebase.</p> <h2 id="detect-user-language">Detect User Language</h2> <p>Currently, the application language is set to English by default when it starts, but it would be nice if we at least tried to set the application to initially display in the user’s preferred language. To simplify the idea of a “preferred language” (because <a href="https://gist.github.com/ksol/62b489572944ca70b4ba">this is not universal amongst browers</a>), we will consider it to be the language of the browser being used. How do we get that? In Javascript, we can use:</p> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorLanguage/language"><code class="language-plaintext highlighter-rouge">navigator.language</code></a></li> <li> <a href="http://help.dottoro.com/ljgtasfq.php"><code class="language-plaintext highlighter-rouge">navigator.userLanguage</code></a> (for Internet Explorer)</li> </ul> <p>So, let’s grab this information from Javascript, and pass it into Elm as a flag:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/index.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="dl">"</span><span class="s2">tachyons</span><span class="dl">"</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Main</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Main.elm</span><span class="dl">"</span>

<span class="kd">const</span> <span class="nx">appContainer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">root</span><span class="dl">"</span><span class="p">)</span>

<span class="k">if </span><span class="p">(</span><span class="nx">appContainer</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">Main</span><span class="p">.</span><span class="nf">embed</span><span class="p">(</span><span class="nx">appContainer</span><span class="p">,</span> <span class="p">{</span> <span class="na">language</span><span class="p">:</span> <span class="nf">getLanguage</span><span class="p">()</span> <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getLanguage</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">language</span> <span class="o">||</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userLanguage</span>
<span class="p">}</span>
</code></pre></div></div> <p>Our application cannot currently accept flags from Javascript, so let’s change our program type to <code class="language-plaintext highlighter-rouge">programWithFlags</code> to allow that to happen:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Flags</span><span class="o">,</span> <span class="kt">Model</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Flags</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="kt">Html</span><span class="o">.</span><span class="n">programWithFlags</span>
        <span class="p">{</span> <span class="n">view</span> <span class="o">=</span> <span class="n">view</span>
        <span class="o">,</span> <span class="n">init</span> <span class="o">=</span> <span class="kt">Model</span><span class="o">.</span><span class="n">init</span>
        <span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="n">update</span>
        <span class="o">,</span> <span class="n">subscriptions</span> <span class="o">=</span> <span class="n">subscriptions</span>
        <span class="p">}</span>
</code></pre></div></div> <p>Next, we will define what type of flags we will accept in the <code class="language-plaintext highlighter-rouge">Model</code> module, and because we do not trust any information passed in from Javascript, we will decode the flag to ensure that we are getting a string.</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Model.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Flags</span><span class="o">,</span> <span class="kt">Model</span><span class="o">,</span> <span class="n">init</span><span class="p">)</span>

<span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">as</span> <span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Language</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Flags</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">language</span> <span class="p">:</span> <span class="kt">Value</span> <span class="p">}</span>

<span class="c1">-- ...</span>

<span class="n">init</span> <span class="p">:</span> <span class="kt">Flags</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">init</span> <span class="n">flags</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">language</span> <span class="o">=</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">language</span>
                <span class="o">|&gt;</span> <span class="kt">Decode</span><span class="o">.</span><span class="n">decodeValue</span> <span class="kt">Decode</span><span class="o">.</span><span class="n">string</span>
                <span class="o">|&gt;</span> <span class="kt">Language</span><span class="o">.</span><span class="n">langFromFlag</span>
    <span class="k">in</span>
        <span class="p">(</span> <span class="p">{</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="n">language</span>
          <span class="o">,</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">False</span>
          <span class="o">,</span> <span class="n">translations</span> <span class="o">=</span> <span class="kt">I18Next</span><span class="o">.</span><span class="n">initialTranslations</span>
          <span class="p">}</span>
        <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">fetchTranslations</span> <span class="n">language</span>
        <span class="p">)</span>
</code></pre></div></div> <p>Finally, we will create the <code class="language-plaintext highlighter-rouge">Language.langFromFlag</code> function that will return a language if decoding goes well, and return a default language if not:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Language.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Language</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">availableLanguages</span><span class="o">,</span> <span class="n">langFromFlag</span><span class="o">,</span> <span class="n">langToString</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">langFromFlag</span> <span class="p">:</span> <span class="kt">Result</span> <span class="kt">String</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Lang</span>
<span class="n">langFromFlag</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">language</span> <span class="k">of</span>
        <span class="kt">Ok</span> <span class="n">language</span> <span class="o">-&gt;</span>
            <span class="kt">Translations</span><span class="o">.</span><span class="n">getLnFromCode</span> <span class="n">language</span>

        <span class="kt">Err</span> <span class="n">_</span> <span class="o">-&gt;</span>
            <span class="kt">En</span>
</code></pre></div></div> <p>If your browser language is English, you will not notice any change as a result of these additions, but if you change your browser language to Italian or Japanese and then refresh the page, you will see that the application will start in that language.</p> <p>For Chrome, you can change the language setting by opening the browser preferences, opening the Advanced preferences…</p> <p><img src="/assets/images/2018-05-11/chrome-advanced-preferences.png" alt="Chrome Advanced Preferences" title="Chrome Advanced Preferences" class="img-responsive"></p> <p>…finding the Languages preferences, and then choosing a language to Move to the top of the list:</p> <p><img src="/assets/images/2018-05-11/chrome-language-preferences.png" alt="Chrome Language Preferences" title="Chrome Language Preferences" class="img-responsive"></p> <p>Default language not changing? Check your code against <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/4-detect-user-language">the <code class="language-plaintext highlighter-rouge">4-detect-user-language</code> branch</a> of my codebase.</p> <p>Now, having a default language is nice, but if you switch languages and then refresh the page, the application will revert back to the language set in the browser. Plenty of people want to read content in a different language than their system settings, and it would be nice to be able to save their language preference for this application. So, let’s then use the browser’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-plaintext highlighter-rouge">localStorage</code></a> to help us do exactly that.</p> <h2 id="store-language-preference">Store Language Preference</h2> <p>Sending Elm data to Javscript requires us to use <a href="https://guide.elm-lang.org/interop/">Elm Ports</a>. All port functions return a <code class="language-plaintext highlighter-rouge">Cmd msg</code>, so let’s put the function to remember a language preference in the <code class="language-plaintext highlighter-rouge">Cmd</code> module, changing it over to a <code class="language-plaintext highlighter-rouge">port module</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Cmd.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="k">module</span> <span class="kt">Cmd</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">fetchTranslations</span><span class="o">,</span> <span class="n">storeLanguage</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="k">port</span> <span class="n">storeLanguageInLocalStorage</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>

<span class="c1">-- ...</span>

<span class="n">storeLanguage</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
<span class="n">storeLanguage</span> <span class="n">language</span> <span class="o">=</span>
    <span class="n">language</span>
        <span class="o">|&gt;</span> <span class="n">toString</span>
        <span class="o">|&gt;</span> <span class="kt">String</span><span class="o">.</span><span class="n">toLower</span>
        <span class="o">|&gt;</span> <span class="n">storeLanguageInLocalStorage</span>
</code></pre></div></div> <p>Here we have created a <code class="language-plaintext highlighter-rouge">storeLanguage</code> command function that takes in a <code class="language-plaintext highlighter-rouge">Lang</code> type, stringifies it, and sends it off to Javascript via the <code class="language-plaintext highlighter-rouge">storeLanguageInLocalStorage</code> port. On the Javascript side, there is currently no code that is subscribing to messages coming from that port, so we’ll make that next:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/index.js</code></strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="k">if </span><span class="p">(</span><span class="nx">appContainer</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">Main</span><span class="p">.</span><span class="nf">embed</span><span class="p">(</span><span class="nx">appContainer</span><span class="p">,</span> <span class="p">{</span> <span class="na">language</span><span class="p">:</span> <span class="nf">getLanguage</span><span class="p">()</span> <span class="p">})</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">ports</span><span class="p">.</span><span class="nx">storeLanguageInLocalStorage</span><span class="p">.</span><span class="nf">subscribe</span><span class="p">((</span><span class="nx">language</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nf">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="c1">// ...</span>
</code></pre></div></div> <p>There is no particular reason behind the “elm-i18n-example-language” named key; it could have been named anything, but it is best to have it as unique as possible, since many different applications will likely be making use of <code class="language-plaintext highlighter-rouge">localStorage</code>.</p> <p>Okay, we’ve got the pathway to Javascript set up, now we need to make sure that the command is run every time the language is changed (ie the <code class="language-plaintext highlighter-rouge">ChangeLanguage</code> message is sent), so let’s make that addition to the <code class="language-plaintext highlighter-rouge">update</code> function:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">ChangeLanguage</span> <span class="n">language</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="n">language</span> <span class="p">}</span>
            <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">batch</span>
                <span class="p">[</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">fetchTranslations</span> <span class="n">language</span>
                <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">storeLanguage</span> <span class="n">language</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">ChangeLanguage</code> branch of the <code class="language-plaintext highlighter-rouge">update</code> function has gotten a bit busier, needing to use <code class="language-plaintext highlighter-rouge">Cmd.batch</code> to send commands to both fetch new language translations, and store the user language preference.</p> <p>Now, you should be able to switch languages, and have it stored in <code class="language-plaintext highlighter-rouge">localStorage</code>. Open up the Javascript console in your browser’s developer tools to confirm this with the following command: <code class="language-plaintext highlighter-rouge">localStorage.getItem("elm-i18n-example-language")</code></p> <p><img src="/assets/images/2018-05-11/language-stored.png" alt="Language Stored" title="Language Stored" class="img-responsive"></p> <p>Success! But there is one small lingering issue though: if you refresh the browser, the application is still reverting back to the default language of English. We need to have our Javascript code get the language from <code class="language-plaintext highlighter-rouge">localStorage</code> (if it’s there), and pass that in as the Elm language flag, so let’s do that:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/index.js</code></strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">function</span> <span class="nf">getLanguage</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nf">getItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">language</span> <span class="o">||</span>
    <span class="nb">navigator</span><span class="p">.</span><span class="nx">userLanguage</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now, if you change languages and refresh the page, the application should still show you the language that you originally selected! If it doesn’t, check your code against <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/5-store-language-preference">the <code class="language-plaintext highlighter-rouge">5-store-language-preference</code> branch</a> of my codebase.</p> <p>At this stage, our page is pretty much feature complete. However, there are still a few potential issues that would be worthy of a bit more investigation:</p> <ul> <li>If you refresh the page, you may see the translation key “verticallyCenteringInCssIsEasy” briefly flash before the translation is shown. This is particularly noticeable on the Japanese translation. Perhaps the translations are being loaded too slowly…?</li> <li>If you accidentally make a typo when requesting a translation by key in a view (eg <code class="language-plaintext highlighter-rouge">I18Next.t translations "thisKeyDoesNotExist"</code>), then no error is raised: the key is simply displayed on the page, which may not be what you want.</li> <li>If you accidentally do not provide a translation for a particular key for a known available language, or make a typo in the translation file (eg delete the <code class="language-plaintext highlighter-rouge">translations.ja.json</code> file or change its key name), then, again, no error is raised, and the requested key is displayed on the page as-is.</li> </ul> <p>Elm programmers are spoiled by the Elm compiler always looking over our shoulder and helping us avoid these kinds of mistakes. If you are confident about manually handling the issues outlined or they are not important to you, then all is good and you need not go any further. But, if want Elm to cast more of an eye over your i18n development, what options are available to you?</p> <h2 id="type-safe-translations">Type-Safe Translations</h2> <p>Since we have our translation files as JSON, we can use <a href="https://github.com/ChristophP/elm-i18n-module-generator">Elm i18n Gen</a> to generate a <code class="language-plaintext highlighter-rouge">Translations</code> module containing one function for every translation in the JSON files. So, let’s give it a try.</p> <p>Install it with the following command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> elm-i18n-gen
</code></pre></div></div> <p>Generate a new <code class="language-plaintext highlighter-rouge">Translations</code> module for the app with the following command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elm-i18n-gen public/locale src/Translations.elm
</code></pre></div></div> <p>And if you open up the <code class="language-plaintext highlighter-rouge">Translations</code> module you should see the following:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Translations.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="o">..</span><span class="p">)</span>


<span class="k">type</span> <span class="kt">Lang</span>
    <span class="o">=</span> <span class="kt">En</span>
    <span class="o">|</span> <span class="kt">It</span>
    <span class="o">|</span> <span class="kt">Ja</span>


<span class="n">getLnFromCode</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Lang</span>
<span class="n">getLnFromCode</span> <span class="n">code</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">code</span> <span class="k">of</span>
        <span class="s">"</span><span class="s2">en"</span> <span class="o">-&gt;</span>
            <span class="kt">En</span>

        <span class="s">"</span><span class="s2">it"</span> <span class="o">-&gt;</span>
            <span class="kt">It</span>

        <span class="s">"</span><span class="s2">ja"</span> <span class="o">-&gt;</span>
            <span class="kt">Ja</span>

        <span class="n">_</span> <span class="o">-&gt;</span>
            <span class="kt">En</span>


<span class="n">verticallyCenteringInCssIsEasy</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">verticallyCenteringInCssIsEasy</span> <span class="n">lang</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">lang</span> <span class="k">of</span>
        <span class="kt">En</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">Vertically centering things in css is easy!"</span>

        <span class="kt">It</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">Centrare verticalmente con css è facile!"</span>

        <span class="kt">Ja</span> <span class="o">-&gt;</span>
            <span class="s">"</span><span class="s2">CSSで垂直センタリングは簡単だよ！"</span>
</code></pre></div></div> <p>We only have one translation key in our JSON files, so <code class="language-plaintext highlighter-rouge">elm-i18n-gen</code> created just one function for us that covers translations for all our languages. You can also see here that I adopted <code class="language-plaintext highlighter-rouge">elm-i18n-gen</code>’s specific naming conventions for <code class="language-plaintext highlighter-rouge">Lang</code>, and <code class="language-plaintext highlighter-rouge">getLnFromCode</code> in advance, and deliberately put that information in the <code class="language-plaintext highlighter-rouge">Translations</code> module knowing it would be overwritten when the new <code class="language-plaintext highlighter-rouge">Translations</code> file was generated (…I think my <a href="https://en.wikipedia.org/wiki/Chekhov%27s_gun">Chekhov’s Gun</a> is jammed…).</p> <p>Anyway, now that we have our function, let’s use it in the view:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ...</span>
<span class="k">import</span> <span class="kt">Translations</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Lang</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="n">view</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">main_</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="kt">LanguageDropdown</span><span class="o">.</span><span class="n">view</span> <span class="n">model</span>
            <span class="o">,</span> <span class="n">content</span> <span class="n">model</span><span class="o">.</span><span class="n">currentLanguage</span>
            <span class="p">]</span>


<span class="n">content</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">content</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">article</span> <span class="p">[</span> <span class="n">articleClasses</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">div</span> <span class="p">[</span> <span class="n">divClasses</span> <span class="p">]</span>
                <span class="p">[</span> <span class="n">heading</span> <span class="n">language</span> <span class="p">]</span>
            <span class="p">]</span>


<span class="n">heading</span> <span class="p">:</span> <span class="kt">Lang</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="kt">Msg</span>
<span class="n">heading</span> <span class="n">language</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>
    <span class="k">in</span>
        <span class="n">h1</span> <span class="p">[</span> <span class="n">classes</span> <span class="p">]</span>
            <span class="p">[</span> <span class="n">text</span> <span class="p">(</span><span class="kt">Translations</span><span class="o">.</span><span class="n">verticallyCenteringInCssIsEasy</span> <span class="n">language</span><span class="p">)</span> <span class="p">]</span>
</code></pre></div></div> <p>The effects of this one change are the following:</p> <ul> <li>There is now no need to fetch any translations, and consequently the <code class="language-plaintext highlighter-rouge">FetchTranslations</code> <code class="language-plaintext highlighter-rouge">Msg</code>, the <code class="language-plaintext highlighter-rouge">fetchTranslations</code> function in the <code class="language-plaintext highlighter-rouge">Cmd</code> module, the <code class="language-plaintext highlighter-rouge">translations</code> entry in the <code class="language-plaintext highlighter-rouge">Model</code>, and any trace of the <code class="language-plaintext highlighter-rouge">I18Next</code> and <code class="language-plaintext highlighter-rouge">Http</code> packages, can now be safely removed.</li> <li>The issue of a translation key displaying before the translation is loaded has consequently gone away since we are now just calling a function.</li> <li>Elm will raise a compiler error if a translation is not provided for all languages.</li> </ul> <p>Those are some pretty good benefits! I’m not sure about any downsides to this, aside from maybe having a single module with potentially hundreds of functions in it for any given large JSON translation file. But, I would guess the overhead for maintainability of that module would be the same for the JSON file. Please let me know if I’m wrong about this!</p> <p>See <a href="https://github.com/paulfioravanti/elm-i18n-example/tree/6-type-safe-translations">the <code class="language-plaintext highlighter-rouge">6-type-safe-translations</code> branch</a> of my codebase to see the final form of the application, with all extraneous code removed.</p> <h2 id="conclusion">Conclusion</h2> <p>Even after all this, I’m still not really sure what to think when it comes to an ideal solution for I18n in Elm. I am planning on using the methods outlined in this blog post for the time being, but if you have any better ways of doing things (I’d love to see an actual example of an app using the <a href="https://github.com/iosphere/elm-i18n">elm-i18n</a> package), please let me know!</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/elm" class="page__taxonomy-item" rel="tag">elm</a><span class="sep">, </span> <a href="/tags/i18n" class="page__taxonomy-item" rel="tag">i18n</a><span class="sep">, </span> <a href="/tags/italian" class="page__taxonomy-item" rel="tag">italian</a><span class="sep">, </span> <a href="/tags/italiano" class="page__taxonomy-item" rel="tag">italiano</a><span class="sep">, </span> <a href="/tags/japanese" class="page__taxonomy-item" rel="tag">japanese</a><span class="sep">, </span> <a href="/tags/%E6%97%A5%E6%9C%AC%E8%AA%9E" class="page__taxonomy-item" rel="tag">日本語</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-17">April 17, 2019</time></p> </footer> <section class="page__share"> <h4 class="page__share-title">Share on</h4> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Runtime+Language+Switching+in+Elm%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fruntime-language-switching-elm%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fruntime-language-switching-elm%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fruntime-language-switching-elm%2F&amp;title=Runtime%20Language%20Switching%20in%20Elm" class="btn btn--reddit" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fruntime-language-switching-elm%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/graph-driven-refactoring-elm/" class="pagination--pager" title="Graph-driven Refactoring in Elm ">Previous</a> <a href="/blog/elm-phoenix-14-webpack/" class="pagination--pager" title="Connecting Elm to Phoenix 1.4 with webpack ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Leave a comment</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You may also enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-04-28/obama-medal.jpg" alt="Obama gives medal to himself meme"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/thanks-past-me/" rel="permalink">Thanks, Past-Me </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-04-28T15:30:00+10:00">April 28, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 19 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">Past-me wrote stuff down that benefited future-me. Present-me needs to keep paying that forward. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-07-05/sliced-apples.jpg" alt="Sliced red apples on a wooden board"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/sharing-applescript-handlers/" rel="permalink">Sharing AppleScript Handlers </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-07-05T08:30:00+10:00">July 5, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 6 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Navigating AppleScript’s awkward handshakes between files. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-07-03/working-late.jpg" alt="On the beers, working late in a hotel room"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/welcome-back-overwork/" rel="permalink">“Welcome back” </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-07-03T12:50:00+10:00">July 3, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 5 minute read </span> <span class="page__meta-sep"></span> <i class="fas fa-microphone" aria-hidden="true"></i> Audio Narration </p> <p class="archive__item-excerpt" itemprop="description">A short story of overwork from the software trenches of Tokyo. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2022-06-25/menu-with-furigana.jpg" alt="大和田鮨"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/flexbox-furigana/" rel="permalink">Flexbox Furigana </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2022-06-25T10:30:00+10:00">June 25, 2022</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 18 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Styling kanji readings is a big subject for such small text. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><strong>Follow:</strong></li> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2023 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q173829KF7"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q173829KF7",{anonymize_ip:!1});</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/",this.page.identifier="/blog/runtime-language-switching-elm"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>