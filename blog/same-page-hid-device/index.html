<!doctype html> <html lang="en-US" class="no-js"> <head> <meta charset="utf-8"> <title>Get on the Same Page as your HID Device | Floor and Varnish</title> <meta name="description" content="Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page."> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Get on the Same Page as your HID Device"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/same-page-hid-device/"> <meta property="og:description" content="Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page."> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2023-10-25/dot-matrix-printer-overlay.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Get on the Same Page as your HID Device"> <meta name="twitter:description" content="Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page."> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/same-page-hid-device/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2023-10-25/dot-matrix-printer-overlay.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2023-10-25T16:25:00+11:00"> <meta property="article:modified_time" content="2024-08-13T21:30:00+10:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/same-page-hid-device/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script type="text/javascript">document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('/assets/images/2023-10-25/dot-matrix-printer-overlay.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Get on the Same Page as your HID Device </h1> <p class="page__lead">Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page. </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-10-25T16:25:00+11:00">October 25, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 14 minute read </span> </p> </div> <span class="page__hero-caption"><a href="https://commons.wikimedia.org/wiki/File:Epson_LX-300%2B_dot_matrix_printer_with_colour_kit.JPG">Corvair</a>, <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>, via Wikimedia Commons </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person" class="h-card"> <div class="author__avatar"> <a href="https://www.paulfioravanti.com/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image" class="u-photo"> </a> </div> <div class="author__content"> <h3 class="author__name p-name" itemprop="name"> <a class="u-url" rel="me" href="https://www.paulfioravanti.com/" itemprop="url">Paul Fioravanti</a> </h3> <div class="author__bio p-note" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url" rel="me"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com" rel="me" class="u-email"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-keybase" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://instagram.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/@paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Get on the Same Page as your HID Device"> <meta itemprop="description" content="Does communicating with your HID device seem flaky? You may be looking at the wrong (usage) page."> <meta itemprop="datePublished" content="2023-10-25T16:25:00+11:00"> <meta itemprop="dateModified" content="2024-08-13T21:30:00+10:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/egReh-6maNw" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <blockquote> <p>Check out steno coding demos of this post’s content in the video above!</p> </blockquote> <p>I use the <a href="https://en.wikipedia.org/wiki/USB_human_interface_device_class">Human Interface Device</a> (HID) specification to enable programs I write to communicate back and forth directly with my <a href="https://en.wikipedia.org/wiki/USB">USB</a> keyboards.</p> <p>Specifically, I leverage the <a href="https://github.com/libusb/hidapi">HIDAPI</a> library to enable an <a href="https://www.elgato.com/us/en/p/stream-deck-pedal">Elgato Stream Deck Pedal</a> to talk to my <a href="https://github.com/qmk/qmk_firmware/tree/dccada95aaad475ebe6da5d98fd0e2b428b19034/keyboards/gboards/georgi">Georgi</a> keyboard via my computer, and help me use <a href="https://www.openstenoproject.org/plover/">steno</a> chords to defeat demon hordes when playing <a href="https://github.com/mmaulwurff/typist.pk3">Doom Typist</a>.<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup></p> <div class="centered-image" style="width: 90%"> <figure> <img src="/assets/images/2023-10-25/georgi.jpg" alt="Georgi keyboard"> </figure> </div> <p>…Which is all great, when it actually works. However, every time I would attempt to make a connection to the Georgi via my “<a href="https://en.wikipedia.org/wiki/Human_interface_device#Components_of_the_HID_protocol">host</a>” program, sometimes it would work, sometimes not. The failures seemed to happen at completely random intervals, making gameplay frustrating. Was the problem with my code? The device? A platform (in my case macOS) related issue? Something else? I had no idea.</p> <h2 id="example-host">Example Host</h2> <p>Let’s illustrate the problem by recreating (and slightly simplifying) the <a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/README.md#what-does-the-api-look-like">example host program</a> from the HIDAPI <code class="language-plaintext highlighter-rouge">README</code> file. It will:</p> <ul> <li>Initialise the HID library</li> <li>Attempt to connect to the Georgi using <a href="https://github.com/qmk/qmk_firmware/blob/ca4541699915b37cd1f253bbed51854627efd2ce/keyboards/gboards/georgi/info.json#L6">its Product ID and Vendor ID</a> <a href="https://en.wikipedia.org/wiki/Hexadecimal">hexadecimal</a> values (printing an error message and exiting if it fails)</li> <li>Attempt to read the Georgi’s manufacturer string and print it out</li> <li>Clean up and exit</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">host.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> // printf</span><span class="cp">
#include</span> <span class="cpf">&lt;wchar.h&gt;</span><span class="c1"> // wchar_t</span><span class="cp">
#include</span> <span class="cpf">&lt;hidapi.h&gt;</span><span class="c1"> // hid_*</span><span class="cp">
</span>
<span class="k">enum</span> <span class="p">{</span>
  <span class="n">VENDOR_ID</span> <span class="o">=</span> <span class="mh">0xFEED</span><span class="p">,</span>
  <span class="n">PRODUCT_ID</span> <span class="o">=</span> <span class="mh">0x1337</span><span class="p">,</span>
  <span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">255</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// Initialize the hidapi library</span>
  <span class="n">hid_init</span><span class="p">();</span>

  <span class="c1">// Open the Georgi using the VID, PID.</span>
  <span class="n">hid_device</span> <span class="o">*</span><span class="n">handle</span> <span class="o">=</span> <span class="n">hid_open</span><span class="p">(</span><span class="n">VENDOR_ID</span><span class="p">,</span> <span class="n">PRODUCT_ID</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open device</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">hid_exit</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Read the Manufacturer String</span>
  <span class="kt">wchar_t</span> <span class="n">manufacturer</span><span class="p">[</span><span class="n">MAX_LENGTH</span><span class="p">];</span>
  <span class="n">hid_get_manufacturer_string</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">MAX_LENGTH</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Manufacturer String: %ls</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">);</span>

  <span class="c1">// Close the device</span>
  <span class="n">hid_close</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>

  <span class="c1">// Finalize the hidapi library</span>
  <span class="n">hid_exit</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now, compile the file with <a href="https://gcc.gnu.org/"><code class="language-plaintext highlighter-rouge">gcc</code></a> (and <a href="https://www.freedesktop.org/wiki/Software/pkg-config/"><code class="language-plaintext highlighter-rouge">pkg-config</code></a> to bring in the HIDAPI library):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">gcc $</span><span class="o">(</span>pkg-config <span class="nt">--cflags</span> <span class="nt">--libs</span> hidapi<span class="o">)</span> host.c <span class="nt">-o</span> host
</code></pre></div></div> <p>And, this was the output of running the host file a few times:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Manufacturer String: g Heavy Industries
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Manufacturer String: g Heavy Industries
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Manufacturer String: g Heavy Industries
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Unable to open device
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Manufacturer String: g Heavy Industries
</span></code></pre></div></div> <p>Looks like pretty random failures to me! There is probably not much more we can do with the host file at the moment, so it would seem the next step in getting to the bottom of this problem would be to dive one level deeper, and see what happens when an attempt to open a device is made.</p> <h2 id="opening-devices">Opening Devices</h2> <p>From the API in the host code, we can see that the <a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/libusb/hid.c#L915"><code class="language-plaintext highlighter-rouge">hid_open</code></a> function is responsible for opening devices, so let’s check out the HIDAPI codebase and see what it does:</p> <p><a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/libusb/hid.c#L915"><strong><code class="language-plaintext highlighter-rouge">hidapi/libusb/hid.c</code></strong></a></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hid_device</span> <span class="o">*</span> <span class="nf">hid_open</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vendor_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">product_id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">wchar_t</span> <span class="o">*</span><span class="n">serial_number</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">hid_device_info</span> <span class="o">*</span><span class="n">devs</span><span class="p">,</span> <span class="o">*</span><span class="n">cur_dev</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path_to_open</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">hid_device</span> <span class="o">*</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">devs</span> <span class="o">=</span> <span class="n">hid_enumerate</span><span class="p">(</span><span class="n">vendor_id</span><span class="p">,</span> <span class="n">product_id</span><span class="p">);</span>
    <span class="n">cur_dev</span> <span class="o">=</span> <span class="n">devs</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">cur_dev</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cur_dev</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">==</span> <span class="n">vendor_id</span> <span class="o">&amp;&amp;</span> <span class="n">cur_dev</span><span class="o">-&gt;</span><span class="n">product_id</span> <span class="o">==</span> <span class="n">product_id</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ... serial_number-related code snipped for brevity ...</span>
            <span class="n">path_to_open</span> <span class="o">=</span> <span class="n">cur_dev</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cur_dev</span> <span class="o">=</span> <span class="n">cur_dev</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">path_to_open</span><span class="p">)</span> <span class="p">{</span>
        <span class="cm">/* Open the device */</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">hid_open_path</span><span class="p">(</span><span class="n">path_to_open</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">hid_free_enumeration</span><span class="p">(</span><span class="n">devs</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">handle</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>This code retrieves a list of devices that match the vendor and product IDs (<a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/libusb/hid.c#L787"><code class="language-plaintext highlighter-rouge">hid_enumerate</code></a>)<sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>. It then attempts to open the first device it finds in that list where the IDs match (<a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/libusb/hid.c#L1261"><code class="language-plaintext highlighter-rouge">hid_open_path</code></a>), and returns a <a href="https://en.wikipedia.org/wiki/Handle_(computing)">handle</a> reference to it. Even if the <code class="language-plaintext highlighter-rouge">handle</code> to the device is not <code class="language-plaintext highlighter-rouge">NULL</code>, it is unknown at this point whether it can be read from or written to.</p> <p>This code surprised me because I would have thought that given a set of IDs, that are presumably unique (…but I guess not…?<sup id="fnref:3"><a href="#fn:3" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>), there would only ever be one device that would get opened. So, given that the host code works <em>sometimes</em>, it seems that when <code class="language-plaintext highlighter-rouge">hid_enumerate</code> is called, the Georgi is <em>sometimes</em> the first device in the returned list (and hence opened successfully), but <em>sometimes</em> not, resulting in the attempted opening of…some other device…?</p> <p>Regardless, what I do know is that the host code will need to change to reflect the dynamic ordering of the list provided from <code class="language-plaintext highlighter-rouge">hid_enumerate</code>, and will need to deal with potentially performing a <code class="language-plaintext highlighter-rouge">hid_get_manufacturer_string</code> function call against each device in that list, until it gets back a successful response.</p> <p>Before starting on those changes, though, how can we find out what devices are actually showing up where we do not expect them? Is there something we can use to show us what HIDAPI is seeing? Thankfully, yes.</p> <h2 id="testing-the-hid-api">Testing the HID API</h2> <p><a href="https://github.com/todbot/hidapitester"><code class="language-plaintext highlighter-rouge">hidapitester</code></a> is a command-line tool that can test out every API call in the HIDAPI library. Let’s first use it to get the lay of the device land by asking it to just list the available devices that are on my computer:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>./hidapitester <span class="nt">--list</span>
<span class="go">05AC/8104: Apple -
05AC/8104: Apple -
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
0000/0000: Apple -
0000/0000: Apple - Headset
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
FEED/1337: g Heavy Industries - Georgi
0FD9/0086: Elgato - Stream Deck Pedal
05AC/8104: Apple -
05AC/8104: Apple -
05AC/0342:  - Keyboard Backlight
0000/0000: Apple -
0000/0000: APPL - BTM
0000/0000: Apple -
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
FEED/1337: g Heavy Industries - Georgi
FEED/1337: g Heavy Industries - Georgi
FEED/1337: g Heavy Industries - Georgi
FEED/1337: g Heavy Industries - Georgi
FEED/1337: g Heavy Industries - Georgi
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
05AC/0342: Apple Inc. - Apple Internal Keyboard / Trackpad
0000/0000: Apple -
</span></code></pre></div></div> <p>Aside from lots of random Apple-related entries, we can see 6 devices that identify as the Georgi with a <code class="language-plaintext highlighter-rouge">0xFEED/0x1337</code> VID/PID combination, and they seem to be in 2 groupings(?), consisting of 1 and 5 entries. Compare that to the easy-to-distinguish Elgato Stream Deck Pedal, with just a single device detected.</p> <p>So, which one of these is the “real” Georgi? Let’s further refine the <code class="language-plaintext highlighter-rouge">hidapitester</code> command and see if we can print out more details:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">./hidapitester --vidpid FEED:1337 --list-detail
FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0xFF60
  usage:         0x0061
  serial_number:
  interface:     1
  path: DevSrvsID:4294971346

FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0x0001
  usage:         0x0006
  serial_number:
  interface:     0
  path: DevSrvsID:4294971342

FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0x0001
  usage:         0x0002
  serial_number:
  interface:     0
  path: DevSrvsID:4294971342

FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0x0001
  usage:         0x0001
  serial_number:
  interface:     0
  path: DevSrvsID:4294971342

FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0x0001
  usage:         0x0080
  serial_number:
  interface:     0
  path: DevSrvsID:4294971342

FEED/1337: g Heavy Industries - Georgi
  vendorId:      0xFEED
  productId:     0x1337
  usagePage:     0x000C
  usage:         0x0001
  serial_number:
  interface:     0
  path: DevSrvsID:4294971342
</span></code></pre></div></div> <p>The details have provided us with extra hexadecimal values called “usage page” and “usage”, and a number for an “interface”<sup id="fnref:4"><a href="#fn:4" class="footnote" rel="footnote" role="doc-noteref">4</a></sup>.</p> <p>Since we have five entries with an interface value of <code class="language-plaintext highlighter-rouge">0</code>, and one with <code class="language-plaintext highlighter-rouge">1</code>, that would seem to explain the “groupings” we saw earlier in the device list. But what does this new set of “usage” hexadecimal numbers mean?</p> <h2 id="hidapi-usage">HIDAPI Usage</h2> <p>The concept of “usage” and “usage pages” in the context of HIDAPI is, I think, best described in <a href="https://developer.chrome.com/en/articles/hid/#terminology">this article</a>:</p> <blockquote> <p>“An HID usage is a numeric value referring to a standardized input or output. Usage values allow a device to describe the intended use of the device […]. For example, one is defined for the left button of a mouse. Usages are also organized into usage pages, which provide an indication of the high-level category of the device or report.</p> </blockquote> <p>Hexadecimal numbers are a bit abstract in conveying what this “intended use” really means, but, fortunately for us, we can use the <a href="https://nondebug.github.io/webhid-explorer/">Web HID Explorer</a> to get some more human-readable information:</p> <h3 id="interface-0">Interface 0</h3> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">productName: Georgi
vendorId:    0xFEED (65261) Unknown vendor
productId:   0x1337 (4919)
opened:      false
collections[0]
</span><span class="gp">  Usage: 0001:0006 (Generic Desktop &gt;</span><span class="w"> </span>Keyboard<span class="o">)</span>
<span class="go">collections[1]
</span><span class="gp">  Usage: 0001:0002 (Generic Desktop &gt;</span><span class="w"> </span>Mouse<span class="o">)</span>
<span class="go">collections[2]
</span><span class="gp">  Usage: 0001:0080 (Generic Desktop &gt;</span><span class="w"> </span>System Control<span class="o">)</span>
<span class="go">collections[3]
</span><span class="gp">  Usage: 000C:0001 (Consumer &gt;</span><span class="w"> </span>Consumer Control<span class="o">)</span>
<span class="go">  Input reports: 0x04
collections[4]
</span><span class="gp">  Usage: 0001:0006 (Generic Desktop &gt;</span><span class="w"> </span>Keyboard<span class="o">)</span>
<span class="go">Input report 0x04
  16 bits (bits 0 to 15)
    Data,Ary,Abs
</span><span class="gp">    Usages: 000C:0001 (Consumer &gt;</span><span class="w"> </span>Consumer Control<span class="o">)</span> to 000C:02A0 <span class="o">(</span>Consumer <span class="o">&gt;</span> AC Soft Key Left<span class="o">)</span>
<span class="go">    Logical bounds: 1 to 672
</span></code></pre></div></div> <h3 id="interface-1">Interface 1</h3> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">productName: Georgi
vendorId:    0xFEED (65261) Unknown vendor
productId:   0x1337 (4919)
opened:      true
collections[0]
  Usage: FF60:0061 (Vendor-defined page 0xFF60 usage 0x0061)
  Input reports: 0x00
  Output reports: 0x00
Input report 0x00
  32 values * 8 bits (bits 0 to 255)
    Data,Var,Abs
    Usage: FF60:0062 (Vendor-defined page 0xFF60 usage 0x0062)
    Logical bounds: 0 to 255
Output report 0x00
  32 values * 8 bits (bits 0 to 255)
    Data,Var,Abs
    Usage: FF60:0063 (Vendor-defined page 0xFF60 usage 0x0063)
    Logical bounds: 0 to 255
</span></code></pre></div></div> <p>I guess in the end we can consider the human-readable information “nice to know”, but my main takeaway from all this would be that the <code class="language-plaintext highlighter-rouge">usagePage:usage</code> pair feel quite similar to the <code class="language-plaintext highlighter-rouge">vid:pid</code> pair, in terms of their hierarchical relationship to each other.</p> <p>Anyway, it seems we will need to use all four values in the host code in order to make a stable connection to a device. However, there is no real way to know in advance which usage values will successfully open up that connection (even the information above does not hint at that…at least, not that I can see). Therefore, the host code will need to be changed to handle the following scenarios:</p> <ul> <li>Where a <code class="language-plaintext highlighter-rouge">usagePage:usage</code> pair <em>are not</em> present, loop over the <code class="language-plaintext highlighter-rouge">vid:pid</code>-matching devices, and attempt to make a connection with each one until successful. Also, log out the device details on each attempt, so we can find out which usage values to use on future attempts so that…</li> <li>Where a <code class="language-plaintext highlighter-rouge">usagePage:usage</code> pair <em>are</em> present, loop over the <code class="language-plaintext highlighter-rouge">vid:pid</code>-matching devices until a match is found for the usage values, and only attempt to make a connection with that device</li> </ul> <p>Let’s give it a try!</p> <h2 id="host-with-usage">Host with Usage</h2> <p>First, let’s change the host code to make a connection with each device in the list until it is successful, rather than just blindly return the list’s first device. Instead of calling <code class="language-plaintext highlighter-rouge">hid_open</code>, let’s adapt its internals to fit our needs:</p> <p><strong><code class="language-plaintext highlighter-rouge">host.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// ...</span>

  <span class="n">hid_device</span> <span class="o">*</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">hid_device_info</span> <span class="o">*</span><span class="n">devices</span><span class="p">,</span> <span class="o">*</span><span class="n">current_device</span><span class="p">;</span>
  <span class="c1">// Enumerate over the Georgi devices using the VID, PID.</span>
  <span class="n">devices</span> <span class="o">=</span> <span class="n">hid_enumerate</span><span class="p">(</span><span class="n">VENDOR_ID</span><span class="p">,</span> <span class="n">PRODUCT_ID</span><span class="p">);</span>
  <span class="n">current_device</span> <span class="o">=</span> <span class="n">devices</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">current_device</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage_page</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage_page</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Opening -- Usage (page): 0x%hX (0x%hX)...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">usage_page</span><span class="p">);</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">hid_open_path</span><span class="p">(</span><span class="n">current_device</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open device</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
      <span class="n">current_device</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Success!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">hid_free_enumeration</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>

  <span class="c1">// Read the Manufacturer String if handle valid</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">wchar_t</span> <span class="n">manufacturer</span><span class="p">[</span><span class="n">MAX_LENGTH</span><span class="p">];</span>
    <span class="n">hid_get_manufacturer_string</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">MAX_LENGTH</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Manufacturer String: %ls</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">);</span>
    <span class="n">hid_close</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open any devices for 0x%hX:0x%hX</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">VENDOR_ID</span><span class="p">,</span> <span class="n">PRODUCT_ID</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Finalize the hidapi library</span>
  <span class="n">hid_exit</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Compiling and running the changed host file a couple of times gives us the following output:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Opening -- Usage (page): 0x6 (0x1)...
Unable to open device
Opening -- Usage (page): 0x2 (0x1)...
Unable to open device
Opening -- Usage (page): 0x1 (0x1)...
Unable to open device
Opening -- Usage (page): 0x80 (0x1)...
Unable to open device
Opening -- Usage (page): 0x1 (0xc)...
Unable to open device
Opening -- Usage (page): 0x61 (0xff60)...
Success!
Manufacturer String: g Heavy Industries
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Opening -- Usage (page): 0x61 (0xff60)...
Success!
Manufacturer String: g Heavy Industries
</span></code></pre></div></div> <p>Great! We get a successful connection every time at usage <code class="language-plaintext highlighter-rouge">FF60:61</code>, and can confidently say <em>that</em> is our target device. Now, since every connection we open exerts a time cost, let’s change the host code to skip devices that we now know will not give us a successful connection, while still handling the possibility that we may not know the usage values of other devices we may want to connect to:</p> <p><strong><code class="language-plaintext highlighter-rouge">host.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="k">enum</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="c1">// Set usage values to 0 if unknown.</span>
  <span class="n">USAGE_PAGE</span> <span class="o">=</span> <span class="mh">0xFF60</span><span class="p">,</span>
  <span class="n">USAGE</span> <span class="o">=</span> <span class="mh">0x61</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="kt">int</span> <span class="n">usage_known</span> <span class="o">=</span> <span class="p">(</span><span class="n">USAGE_PAGE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">USAGE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">current_device</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage_page</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage_page</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">usage_known</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">usage_page</span> <span class="o">!=</span> <span class="n">USAGE_PAGE</span> <span class="o">||</span> <span class="n">usage</span> <span class="o">!=</span> <span class="n">USAGE</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Skipping -- Usage (page): 0x%hX (0x%hX)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">usage_page</span><span class="p">);</span>
      <span class="n">current_device</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">hid_open_path</span><span class="p">(</span><span class="n">current_device</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open device</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">usage_known</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">current_device</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
  <span class="p">}</span>

  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>Compiling and running these changes a couple of times gives us the following output:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Skipping -- Usage (page): 0x6 (0x1)
Skipping -- Usage (page): 0x2 (0x1)
Skipping -- Usage (page): 0x1 (0x1)
Skipping -- Usage (page): 0x80 (0x1)
Skipping -- Usage (page): 0x1 (0xc)
Opening -- Usage (page): 0x61 (0xff60)...
Success!
Manufacturer String: g Heavy Industries
</span><span class="gp">$</span><span class="w"> </span>./host
<span class="go">Opening -- Usage (page): 0x61 (0xff60)...
Success!
Manufacturer String: g Heavy Industries
</span></code></pre></div></div> <p>It works! And, if you have been following along (with your own Georgi or other keyboard of choice), you will notice that successful connections are now made much faster, even if you do not hit the target device on the first try!</p> <p>So, if you ever find yourself writing custom firmware that connects to HID devices, remember to always include the usage values, as well as vendor/product IDs, to ensure you can get a stable connection.</p> <p>The complete code for the host file is below, but you can also get it from its GitHub repo <a href="https://github.com/paulfioravanti/hid_host_example">here</a>:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> // printf</span><span class="cp">
#include</span> <span class="cpf">&lt;wchar.h&gt;</span><span class="c1"> // wchar_t</span><span class="cp">
#include</span> <span class="cpf">&lt;hidapi.h&gt;</span><span class="c1"> // hid_*</span><span class="cp">
</span>
<span class="k">enum</span> <span class="p">{</span>
  <span class="n">VENDOR_ID</span> <span class="o">=</span> <span class="mh">0xFEED</span><span class="p">,</span>
  <span class="n">PRODUCT_ID</span> <span class="o">=</span> <span class="mh">0x1337</span><span class="p">,</span>
  <span class="c1">// Set usage values to 0 if unknown.</span>
  <span class="n">USAGE_PAGE</span> <span class="o">=</span> <span class="mh">0xFF60</span><span class="p">,</span>
  <span class="n">USAGE</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
  <span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">255</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="c1">// Initialize the hidapi library</span>
  <span class="n">hid_init</span><span class="p">();</span>

  <span class="n">hid_device</span> <span class="o">*</span><span class="n">handle</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">hid_device_info</span> <span class="o">*</span><span class="n">devices</span><span class="p">,</span> <span class="o">*</span><span class="n">current_device</span><span class="p">;</span>
  <span class="c1">// Enumerate over the Georgi devices using the VID, PID.</span>
  <span class="n">devices</span> <span class="o">=</span> <span class="n">hid_enumerate</span><span class="p">(</span><span class="n">VENDOR_ID</span><span class="p">,</span> <span class="n">PRODUCT_ID</span><span class="p">);</span>
  <span class="n">current_device</span> <span class="o">=</span> <span class="n">devices</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">usage_known</span> <span class="o">=</span> <span class="p">(</span><span class="n">USAGE_PAGE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">USAGE</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">current_device</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage_page</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage_page</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span> <span class="n">usage</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">usage_known</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">usage_page</span> <span class="o">!=</span> <span class="n">USAGE_PAGE</span> <span class="o">||</span> <span class="n">usage</span> <span class="o">!=</span> <span class="n">USAGE</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Skipping -- Usage (page): 0x%hX (0x%hX)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">usage_page</span><span class="p">);</span>
      <span class="n">current_device</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Opening -- Usage (page): 0x%hX (0x%hX)...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">usage_page</span><span class="p">);</span>
    <span class="n">handle</span> <span class="o">=</span> <span class="n">hid_open_path</span><span class="p">(</span><span class="n">current_device</span><span class="o">-&gt;</span><span class="n">path</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open device</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">usage_known</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">current_device</span> <span class="o">=</span> <span class="n">current_device</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
        <span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Success!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">hid_free_enumeration</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>

  <span class="c1">// Read the Manufacturer String if handle valid</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">wchar_t</span> <span class="n">manufacturer</span><span class="p">[</span><span class="n">MAX_LENGTH</span><span class="p">];</span>
    <span class="n">hid_get_manufacturer_string</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">,</span> <span class="n">MAX_LENGTH</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Manufacturer String: %ls</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">);</span>
    <span class="n">hid_close</span><span class="p">(</span><span class="n">handle</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Unable to open any devices for 0x%hX:0x%hX</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">VENDOR_ID</span><span class="p">,</span> <span class="n">PRODUCT_ID</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Finalize the hidapi library</span>
  <span class="n">hid_exit</span><span class="p">();</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <blockquote> <p>If you are interested in seeing other host code containing more robust error handling, and the reading and writing of custom information to and from a device, check out my <a href="https://github.com/paulfioravanti/hid_hosts">HID Hosts</a> GitHub repository.</p> </blockquote> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1"> <p>I’ve written about playing <a href="https://en.wikipedia.org/wiki/Doom_(1993_video_game)">Doom</a> [1993] with steno in <em><a href="https://www.paulfioravanti.com/blog/steno-gaming-doom-typist/">Steno Gaming: Doom Typist</a></em>, but the mechanics around making communication possible between the Georgi, Elgato pedal, and <a href="https://www.openstenoproject.org/plover/">Plover</a> probably warrants its own blog post. If you’re game, you can check out the code specifics in the following GitHub repos: <a href="https://github.com/paulfioravanti/hid_hosts">HID Hosts</a>, <a href="https://github.com/paulfioravanti/steno_tape">Steno Tape</a>, and my <a href="https://github.com/paulfioravanti/qmk_keymaps/tree/master/keyboards/gboards/georgi/keymaps/paulfioravanti">Georgi firmware</a>. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:2"> <p>Yes, technically, it is a <a href="https://en.wikipedia.org/wiki/Pointer_(computer_programming)">pointer</a> to a <a href="https://en.wikipedia.org/wiki/Linked_list">linked list</a> of <a href="https://github.com/libusb/hidapi/blob/baa0dab6114e8654161478e10a20c67cf5d1a1a3/hidapi/hidapi.h#L150"><code class="language-plaintext highlighter-rouge">hid_device_info</code></a> <code class="language-plaintext highlighter-rouge">struct</code>s, but that detail can be glossed over in this context. <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:3"> <p>Vendor IDs are meant to be globally unique, while product IDs are meant to be unique within the scope of a vendor ID. The <a href="https://www.usb.org/about">USB Implementers Forum</a> (USB-IF) is the <a href="https://www.usb.org/developers">“authority which assigns and maintains all USB Vendor ID Numbers”</a> (a vendor ID <a href="https://www.usb.org/getting-vendor-id">costs US$6000</a> as of this writing). Also, apparently “unauthorized use of assigned or unassigned USB Vendor ID Numbers is strictly prohibited”. However, a search of popular hobbyist keyboard firmware <a href="https://qmk.fm/">QMK</a>’s codebase reveals that <a href="https://github.com/search?q=repo%3Aqmk%2Fqmk_firmware+%22vid%22%3A+%220xFEED%22+language%3AJSON&amp;type=code&amp;l=JSON">hundreds of devices</a> aside from the Georgi use <code class="language-plaintext highlighter-rouge">0xFEED</code> as their vendor ID (it seems to be QMK’s arbitrarily assigned <a href="https://github.com/qmk/qmk_firmware/blob/ca4541699915b37cd1f253bbed51854627efd2ce/docs/faq_build.md?plain=1#L54">default vendor ID</a>). So, we can conclude that:</p> <ul> <li>the <code class="language-plaintext highlighter-rouge">0xFEED</code> vendor ID does not belong exclusively to the Georgi</li> <li>enforcement of vendor ID uniqueness is lax/non-existent</li> <li>we cannot rely on the VID/PID combo alone to open a connection to a device: we need more information to target it correctly</li> </ul> <p><a href="#fnref:3" class="reversefootnote" role="doc-backlink">↩</a></p> </li> <li id="fn:4"> <p>Since I could not find any references on the web that describe what an “interface” means within the context of HIDAPI, <a href="https://chat.openai.com/">ChatGPT</a> says that it “can represent a specific device or a group of similar devices that share a common way of communicating with the computer. These interfaces are identified by interface numbers and can have different features, reports, and capabilities depending on the type of HID device”. I am not sure why the Georgi would need multiple ways to communicate with the computer, but I am just going to consider this an implementation detail we do not need to concern ourselves with. Also, as an aside, I cannot believe we are at the stage where I am quoting AI… <a href="#fnref:4" class="reversefootnote" role="doc-backlink">↩</a></p> </li> </ol> </div> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/clang" class="page__taxonomy-item p-category" rel="tag">clang</a><span class="sep">, </span> <a href="/tags/georgi" class="page__taxonomy-item p-category" rel="tag">georgi</a><span class="sep">, </span> <a href="/tags/hid" class="page__taxonomy-item p-category" rel="tag">HID</a><span class="sep">, </span> <a href="/tags/hidapi" class="page__taxonomy-item p-category" rel="tag">hidapi</a><span class="sep">, </span> <a href="/tags/keyboards" class="page__taxonomy-item p-category" rel="tag">keyboards</a><span class="sep">, </span> <a href="/tags/steno" class="page__taxonomy-item p-category" rel="tag">steno</a><span class="sep">, </span> <a href="/tags/stenography" class="page__taxonomy-item p-category" rel="tag">stenography</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2024-08-13">August 13, 2024</time></p> </footer> <section class="page__share"> <h4 class="page__share-title">Share on</h4> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Get+on+the+Same+Page+as+your+HID+Device%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsame-page-hid-device%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsame-page-hid-device%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsame-page-hid-device%2F&amp;title=Get%20on%20the%20Same%20Page%20as%20your%20HID%20Device" class="btn btn--reddit" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fsame-page-hid-device%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/thanks-past-me/" class="pagination--pager" title="Thanks, Past-Me ">Previous</a> <a href="/blog/coding-test-review-culture-amp/" class="pagination--pager" title="Coding Test Review: Culture Amp ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Leave a comment</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h2 class="page__related-title">You may also enjoy</h2> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-03-11/shimbashi-screen.jpg" alt="Shake map showing distribution of maximum JMA Seismic Intensities by-prefecture for the 11 March 2011"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/3-11/" rel="permalink">3.11 </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-03-11T09:15:00+11:00">March 11, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 7 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Reflections on living through Japan’s biggest recorded earthquake. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-02-21/frank-mckenna-JB92NeJSxW4-unsplash.jpg" alt="man riding bike and woman running holding flag of USA"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/amazon-prime-localisation-fail/" rel="permalink">Amazon Prime’s Localisation Fail </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-02-21T15:30:00+11:00">February 21, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 4 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Does Prime have an unconscious bias hard coded in its media descriptions? </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2024-02-04/doc-brown-cable-connect.jpg" alt="Doc Brown from the movie Back to the Future connecting a plug and socket"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/creating-plover-plugins-python/" rel="permalink">Creating Plover Plugins with Python </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2024-02-04T21:35:00+11:00">February 4, 2024</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 44 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Level up your steno chording with the power of Python! Hook into Plover plugins, and discover a world beyond keystrokes. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2023-12-07/celpax-1Lf5Adh9SCg-unsplash.jpg" alt="person holding white card near green plant"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/coding-test-review-culture-amp/" rel="permalink">Coding Test Review: Culture Amp </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2023-12-07T15:10:00+11:00">December 7, 2023</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 20 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Did I feel empowered to get the coding tests done for which I am responsible? </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><strong>Follow:</strong></li> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2025 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q173829KF7"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Q173829KF7",{anonymize_ip:!1});</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/same-page-hid-device/",this.page.identifier="/blog/same-page-hid-device"};!function(){var e=document,t=e.createElement("script");t.src="https://paulfioravanti.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>