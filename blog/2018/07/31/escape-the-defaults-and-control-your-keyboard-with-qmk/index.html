<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>Escape the defaults and Control your keyboard with QMK | Floor and Varnish</title> <meta name="description" content="Getting a keyboard with programmable firmware can enable you to uniquely personalise how you use your keyboard. "> <meta name="author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="Escape the defaults and Control your keyboard with QMK"> <meta property="og:url" content="https://paulfioravanti.com/blog/2018/07/31/escape-the-defaults-and-control-your-keyboard-with-qmk/"> <meta property="og:description" content="Getting a keyboard with programmable firmware can enable you to uniquely personalise how you use your keyboard. "> <meta property="og:image" content="https://paulfioravanti.com/assets/images/2018-07-31/ergodox-kit.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="Escape the defaults and Control your keyboard with QMK"> <meta name="twitter:description" content="Getting a keyboard with programmable firmware can enable you to uniquely personalise how you use your keyboard. "> <meta name="twitter:url" content="https://paulfioravanti.com/blog/2018/07/31/escape-the-defaults-and-control-your-keyboard-with-qmk/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://paulfioravanti.com/assets/images/2018-07-31/ergodox-kit.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2018-07-31T08:10:00+10:00"> <link rel="canonical" href="https://paulfioravanti.com/blog/2018/07/31/escape-the-defaults-and-control-your-keyboard-with-qmk/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://paulfioravanti.com/"
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <!--[if IE]><style>.greedy-nav .site-title{padding-right:3em}.greedy-nav button{position:absolute;top:0;right:0;height:100%}</style><![endif]--> </head> <body class="layout--single wide"> <nav class="skip-links"> <h2 class="screen-reader-text">Skip links</h2> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"></ul> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/2018-07-31/ergodox-kit.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> Escape the defaults and Control your keyboard with QMK </h1> <p class="page__lead">Getting a keyboard with programmable firmware can enable you to uniquely personalise how you use your keyboard. </p> <p class="page__meta"> <i class="fa fa-calendar-alt" aria-hidden="true"></i> <time datetime="2018-07-31T08:10:00+10:00"> July 31, 2018 </time>   <i class="far fa-clock" aria-hidden="true"></i> 10 minute read </p> </div> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p>Coder, linguist, mechanical keyboard enthusiast.</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i> Website </a> </li> <li> <a href="mailto:paul.fioravanti@gmail.com"> <meta itemprop="email" content="paul.fioravanti@gmail.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i> Stack Overflow </a> </li> </ul> </div> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="Escape the defaults and Control your keyboard with QMK"> <meta itemprop="description" content="Getting a keyboard with programmable firmware can enable you to uniquely personalise how you use your keyboard."> <meta itemprop="datePublished" content="2018-07-31T08:10:00+10:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>I love <a href="https://www.reddit.com/r/MechanicalKeyboards/">mechanical keyboards</a>, and have been using an <a href="https://www.ergodox.io/">Ergodox</a> as my daily driver since 2014.</p> <p><img src="/assets/images/2018-07-31/ergodox-ez.jpg" alt="Ergodox EZ" title="Ergodox EZ" class="img-responsive"></p> <p>If you are someone who spends a lot of time using a keyboard, and are likely to continue to do so in the future, then I would:</p> <ul> <li> <a href="https://speakerdeck.com/paulfioravanti/hand-coded">encourage you to learn touch typing</a> if you haven’t already</li> <li>consider ergonomic keyboard options to increase comfort, as well as reduce strain on your shoulders and wrists (the keyboard you choose does not necessarily have to be mechanical, or a split-hand option like the Ergodox)</li> </ul> <p>If you are programmer or tinkerer, then getting a keyboard with programmable firmware can enable you to personalise how you use your keyboard, allowing your brain (or hand muscle memory) a say in assigning functionality to keys, rather than you having to train yourself to adapt to some product’s specification.</p> <p><img src="/assets/images/2018-07-31/massdrop-configurator.png" alt="Massdrop Configurator" title="Massdrop Configurator" class="img-responsive"></p> <p>When I got my first Ergodox, I used <a href="https://www.massdrop.com/configurator/ergodox">Massdrop’s Ergodox Configurator</a> to generate firmware for the keyboard. As I got to know my Ergodox better, and my brain started to tell me that it was expecting certain keys to be in different places from the default setup, I was able to use the Configurator’s nice user interface to make basic changes, and then re-generate the firmware in a matter of minutes.</p> <p>It was only when I started wanting to have a keystroke represent a combination of keys, rather than a single key, that I hit the limitations of what the web-based Configurator enabled me to do. So, I decided to bypass it and go straight to the source code that the Configurator itself was using to generate its firmware: <a href="https://github.com/benblazak">Ben Blazak</a>’s <a href="https://github.com/benblazak/ergodox-firmware">Ergodox Firmware</a>.</p> <p>I am not a C language programmer, but after a period of tinkering, I was able to cobble together a <a href="https://github.com/paulfioravanti/ergodox-firmware/blob/custom-layout/firmware/keyboard/ergodox/layout/custom-layout.c">custom keymap layout</a>, and successfully flash it on to my keyboard firmware. It worked great, and I happily used it for years.</p> <p>Then, one day, I wanted to make some updates, and realised that some code libraries that the firmware used were now so old and outdated that I was unable to compile a new version of the firmware on my computer.</p> <p>As of this writing, it looks like development on the firmware has stalled, and so if I really wanted to update my keyboard layout, I would need re-write it for a new platform.</p> <h2 id="enter-qmk">Enter QMK</h2> <p>After some investigation, I came to the conclusion that the <a href="https://qmk.fm/">Quantum Mechanical Keyboard (QMK) Firmware</a> would likely be my best choice, given its popularity with Ergodox users, and because it supports <a href="https://qmk.fm/keyboards/">many other keyboard types</a>. So, I can continue to use it if, somehow, I <em>accidentally</em> end up buying other different types of mechanical keyboards (if you are into mechs, you know how it is… <img class="emoji" title=":money_with_wings:" alt=":money_with_wings:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f4b8.png" height="20" width="20">)</p> <p>So, let’s grab the firmware from Github:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:qmk/qmk_firmware.git
<span class="nb">cd </span>qmk_firmware
</code></pre></div></div> <p>Now, open up the <a href="https://github.com/qmk/qmk_firmware/blob/master/keyboards/ergodox_ez/keymaps/default/keymap.c">QMK Ergodox EZ default layout</a> (so called, I believe, because <a href="https://ergodox-ez.com/">Ergodox EZ</a> is now the pre-eminent retailer of original version Ergodoxes) to use as a base, and see about getting a feel for how to use it.</p> <h3 id="keyboard-layout">Keyboard Layout</h3> <p><img src="/assets/images/2018-07-31/ergodox-left-hand.jpg" alt="Ergodox Left Hand" title="Ergodox Left Hand" class="img-responsive"></p> <p>Below is an abbreviated part of the default layout, focusing on one layer for the left side of an Ergodox keyboard:</p> <p><strong><code class="highlighter-rouge">qmk_firmware/keyboards/ergodox_ez/keymaps/default/keymap.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="cm">/* Keymap 0: Basic layer
 *
 * ,--------------------------------------------------.
 * |   =    |   1  |   2  |   3  |   4  |   5  | LEFT |
 * |--------+------+------+------+------+-------------|
 * | Del    |   Q  |   W  |   E  |   R  |   T  |  L1  |
 * |--------+------+------+------+------+------|      |
 * | BkSp   |   A  |   S  |   D  |   F  |   G  |------|
 * |--------+------+------+------+------+------| Hyper|
 * | LShift |Z/Ctrl|   X  |   C  |   V  |   B  |      |
 * `--------+------+------+------+------+-------------'
 *   |Grv/L1|  '"  |AltShf| Left | Right|
 *   `----------------------------------'
 *                                        ,-------------.
 *                                        | App  | LGui |
 *                                 ,------|------|------|
 *                                 |      |      | Home |
 *                                 | Space|Backsp|------|
 *                                 |      |ace   | End  |
 *                                 `--------------------'
 */</span>
<span class="p">[</span><span class="n">BASE</span><span class="p">]</span> <span class="o">=</span> <span class="n">LAYOUT_ergodox</span><span class="p">(</span>  <span class="c1">// layer 0 : default</span>
  <span class="c1">// left hand</span>
  <span class="n">KC_EQL</span><span class="p">,</span>          <span class="n">KC_1</span><span class="p">,</span>        <span class="n">KC_2</span><span class="p">,</span>          <span class="n">KC_3</span><span class="p">,</span>    <span class="n">KC_4</span><span class="p">,</span>    <span class="n">KC_5</span><span class="p">,</span> <span class="n">KC_LEFT</span><span class="p">,</span>
  <span class="n">KC_DELT</span><span class="p">,</span>         <span class="n">KC_Q</span><span class="p">,</span>        <span class="n">KC_W</span><span class="p">,</span>          <span class="n">KC_E</span><span class="p">,</span>    <span class="n">KC_R</span><span class="p">,</span>    <span class="n">KC_T</span><span class="p">,</span> <span class="n">TG</span><span class="p">(</span><span class="n">SYMB</span><span class="p">),</span>
  <span class="n">KC_BSPC</span><span class="p">,</span>         <span class="n">KC_A</span><span class="p">,</span>        <span class="n">KC_S</span><span class="p">,</span>          <span class="n">KC_D</span><span class="p">,</span>    <span class="n">KC_F</span><span class="p">,</span>    <span class="n">KC_G</span><span class="p">,</span>
  <span class="n">KC_LSFT</span><span class="p">,</span>         <span class="n">CTL_T</span><span class="p">(</span><span class="n">KC_Z</span><span class="p">),</span> <span class="n">KC_X</span><span class="p">,</span>          <span class="n">KC_C</span><span class="p">,</span>    <span class="n">KC_V</span><span class="p">,</span>    <span class="n">KC_B</span><span class="p">,</span> <span class="n">ALL_T</span><span class="p">(</span><span class="n">KC_NO</span><span class="p">),</span>
  <span class="n">LT</span><span class="p">(</span><span class="n">SYMB</span><span class="p">,</span><span class="n">KC_GRV</span><span class="p">),</span> <span class="n">KC_QUOT</span><span class="p">,</span>     <span class="n">LALT</span><span class="p">(</span><span class="n">KC_LSFT</span><span class="p">),</span> <span class="n">KC_LEFT</span><span class="p">,</span> <span class="n">KC_RGHT</span><span class="p">,</span>
                                                        <span class="n">ALT_T</span><span class="p">(</span><span class="n">KC_APP</span><span class="p">),</span> <span class="n">KC_LGUI</span><span class="p">,</span>
                                                                       <span class="n">KC_HOME</span><span class="p">,</span>
                                               <span class="n">KC_SPC</span><span class="p">,</span>  <span class="n">KC_BSPC</span><span class="p">,</span>       <span class="n">KC_END</span><span class="p">,</span>
  <span class="c1">// ..</span>
<span class="p">)</span>
</code></pre></div></div> <p>Here, we can see:</p> <ul> <li>Constant variables that begin with <code class="highlighter-rouge">KC_</code>. These represent a single basic key code, like the “A” or “1” keys.</li> <li>Other mappings that do not begin with <code class="highlighter-rouge">KC_</code>. These are functions that take arguments, and can represent actions like holding down one key while pressing another.</li> </ul> <p>All these constants and functions (and more representing every key on a keyboard, as well as various key combinations) are enumerated in the <a href="https://docs.qmk.fm/#/keycodes">QMK Keycodes Documentation</a>, and are available to use in the layout without any further configuration.</p> <p>That’s all well and good, but what if there is no built-in mapping for a key combination you want to perform?</p> <h3 id="custom-key-mappings">Custom Key Mappings</h3> <p>Let’s say that on the layout above, instead of having the top left corner key be the “=” character (ie <code class="highlighter-rouge">KC_EQL</code>) when tapped, you would like it to perform some custom combination of key presses, which we’ll name <code class="highlighter-rouge">MY_KEY_COMBO</code>.</p> <p>Where does <code class="highlighter-rouge">MY_KEY_COMBO</code> get declared, and where do we define what it is supposed to actually do? Well, there are three main steps for this, but before we do them, let’s create a copy of the default keymap folder, put it into a <code class="highlighter-rouge">custom</code> directory, and make our edits on that:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-r</span> qmk_firmware/keyboards/ergodox_ez/keymaps/default qmk_firmware/keyboards/ergodox_ez/keymaps/custom
</code></pre></div></div> <p>First, we need to add a new <code class="highlighter-rouge">MY_KEY_COMBO</code> type to the existing <code class="highlighter-rouge">custom_keycodes</code> enumerated types list, which is declared towards the top of the keymap file:</p> <p><strong><code class="highlighter-rouge">qmk_firmware/keyboards/ergodox_ez/keymaps/custom/keymap.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">custom_keycodes</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="n">MY_KEY_COMBO</span>
<span class="p">};</span>
</code></pre></div></div> <p>Now, we can replace <code class="highlighter-rouge">KC_EQL</code> with <code class="highlighter-rouge">MY_KEY_COMBO</code> in the keyboard layout:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="p">[</span><span class="n">BASE</span><span class="p">]</span> <span class="o">=</span> <span class="n">LAYOUT_ergodox</span><span class="p">(</span>  <span class="c1">// layer 0 : default</span>
  <span class="c1">// left hand</span>
  <span class="n">MY_KEY_COMBO</span><span class="p">,</span> <span class="n">KC_1</span><span class="p">,</span> <span class="n">KC_2</span><span class="p">,</span> <span class="n">KC_3</span><span class="p">,</span> <span class="n">KC_4</span><span class="p">,</span> <span class="n">KC_5</span><span class="p">,</span> <span class="n">KC_LEFT</span><span class="p">,</span>
  <span class="c1">// ...</span>
</code></pre></div></div> <p>To give this new type some behaviour, we need to register it inside a function called <code class="highlighter-rouge">process_record_user()</code>, which can be found towards the bottom of the keymap file:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bool</span> <span class="nf">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">MY_KEY_COMBO</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Do whatever it is that MY_KEY_COMBO is supposed to do when pressed</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="c1">// other case statements ...</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="highlighter-rouge">process_record_user()</code> will get called automatically whenever a key on your keyboard is pressed or released, so there is no need to add any code that specifically calls it. More information about this function, as well as how to define a new key code, can be found on the <a href="https://docs.qmk.fm/#/custom_quantum_functions">QMK Custom Quantum Functions</a> documentation page.</p> <blockquote> <p>You will, of course, see more code and functions in the keymap file, but for what we want to accomplish, we just need to concern ourselves with a limited section of code. If there is anything you see that we do not cover, and that you do not understand, and you want more information about, then definitely give the <a href="https://docs.qmk.fm/#/">QMK documentation</a> a search.</p> </blockquote> <p>So, now that we know <em>where</em> we need to put code for custom key actions, <em>what</em> kind of implementation code can we actually put in there? We will answer this with a few examples of the actions I have in my personal keymap.</p> <h2 id="key-requirements">Key Requirements</h2> <p>My main use cases for custom key actions pretty much fall into the following categories:</p> <ul> <li>Output a string of characters on screen, which enables single-key mappings to programming-related operators like the <a href="https://hexdocs.pm/elixir/Kernel.html#%7C%3E/2">pipe operator (<code class="highlighter-rouge">|&gt;</code>)</a> from <a href="https://elixir-lang.org/">Elixir</a>, <a href="https://ruby-doc.org/stdlib-2.5.1/libdoc/erb/rdoc/ERB.html#class-ERB-label-Recognized+Tags">ERB tags (<code class="highlighter-rouge">&lt;%=</code>, <code class="highlighter-rouge">%&gt;</code>)</a> from <a href="https://www.ruby-lang.org/en/">Ruby</a>, and emoji codes like <img class="emoji" title=":+1:" alt=":+1:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f44d.png" height="20" width="20"> (<code class="highlighter-rouge">:+1:</code>)</li> <li>Key Hold/Key Press combinations of varying complexity, which enable single key mappings for application start up or manipulation. For example, Option-Space for <a href="https://www.alfredapp.com/">Alfred</a>, Shift-Command-Space for <a href="http://mizage.com/divvy/">Divvy</a>, and Alt-Command-Left/Right for moving web browser tabs to the left or right.</li> <li>Modifying a key based on its state. For example, re-mapping the Caps Lock key to be Control when held, and Escape when tapped: a popular mod for <a href="https://www.vim.org/">Vim</a> users.</li> </ul> <p>QMK does have built-in functionality for some of these use-cases:</p> <ul> <li>The <a href="https://docs.qmk.fm/#/feature_advanced_keycodes?id=mod-tap">Mod Tap</a> function <code class="highlighter-rouge">LCTL_T(kc)</code> is Left Control when held, and <code class="highlighter-rouge">kc</code> when tapped. So, <code class="highlighter-rouge">LCTL_T(KC_ESC)</code> will provide the desired “Left Control when held, Escape when tapped” functionality. All that needs to be done is assign that function to a key, and you will be a happy Vimmer.</li> <li> <a href="https://docs.qmk.fm/#/feature_advanced_keycodes?id=modifier-keys">Modifier Key</a> functions like <code class="highlighter-rouge">LALT(kc)</code> (apply Left Alt to <code class="highlighter-rouge">kc</code>), and <code class="highlighter-rouge">SGUI(kc)</code> (Hold Left Shift and GUI — read: ⌘Command — and press <code class="highlighter-rouge">kc</code>), cover Alfred and Divvy commands (<code class="highlighter-rouge">LALT(KC_SPACE)</code> and <code class="highlighter-rouge">SGUI(KC_SPACE)</code> respectively).</li> </ul> <p>For the rest though, we will need to write some custom implementation code.</p> <h3 id="sending-strings">Sending Strings</h3> <p>Let’s get started with the programming-related operators and emoji codes. Like before, first add the new types:</p> <p><strong><code class="highlighter-rouge">qmk_firmware/keyboards/ergodox_ez/keymaps/custom/keymap.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">custom_keycodes</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="n">FORWARD_PIPE</span>
  <span class="n">LEFT_ERB</span>
  <span class="n">PLUS_ONE</span>
  <span class="n">RIGHT_ERB</span>
<span class="p">};</span>
</code></pre></div></div> <p>Assign the types to some keys (these key locations are illustrative only, you probably don’t <em>actually</em> want these keys at the top left of the board):</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="p">[</span><span class="n">BASE</span><span class="p">]</span> <span class="o">=</span> <span class="n">LAYOUT_ergodox</span><span class="p">(</span>  <span class="c1">// layer 0 : default</span>
  <span class="c1">// left hand</span>
  <span class="n">FORWARD_PIPE</span><span class="p">,</span> <span class="n">LEFT_ERB</span><span class="p">,</span> <span class="n">PLUS_ONE</span><span class="p">,</span> <span class="n">RIGHT_ERB</span><span class="p">,</span> <span class="n">KC_4</span><span class="p">,</span> <span class="n">KC_5</span><span class="p">,</span> <span class="n">KC_LEFT</span><span class="p">,</span>
  <span class="c1">// ...</span>
</code></pre></div></div> <p>And now, let’s use the <code class="highlighter-rouge">SEND_STRING</code> <a href="https://docs.qmk.fm/#/feature_macros">Feature Macro</a> to type out the strings:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bool</span> <span class="nf">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="n">FORWARD_PIPE</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">"|&gt;"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">case</span> <span class="n">LEFT_ERB</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">"&lt;%="</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">case</span> <span class="n">PLUS_ONE</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">":+1:"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">case</span> <span class="n">RIGHT_ERB</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="s">"%&gt;"</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>That wasn’t too bad! All we have left now is getting Alt-Command-Left/Right working for navigating browser tabs. Unfortunately, the <a href="https://docs.qmk.fm/#/keycodes?id=modifiers">list of Modifier Keys</a>, although comprehensive, does not have a function available for holding down Alt, Command, and pressing a key. So, we will have to manually re-create it.</p> <p>Create two new types, <code class="highlighter-rouge">LEFT_PANE</code> and <code class="highlighter-rouge">RIGHT_PANE</code>, add them to the <code class="highlighter-rouge">custom_keycodes</code> enumerated types list, and assign them to keys, just like with the previous types. Then, their implementation will look something like this:</p> <p><strong><code class="highlighter-rouge">qmk_firmware/keyboards/ergodox_ez/keymaps/custom/keymap.c</code></strong></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bool</span> <span class="nf">process_record_user</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">keyrecord_t</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">pressed</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">keycode</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ...</span>
      <span class="k">case</span> <span class="n">LEFT_PANE</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_DOWN</span><span class="p">(</span><span class="n">X_LALT</span><span class="p">)</span><span class="n">SS_DOWN</span><span class="p">(</span><span class="n">X_LGUI</span><span class="p">));</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_TAP</span><span class="p">(</span><span class="n">X_LEFT</span><span class="p">));</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_UP</span><span class="p">(</span><span class="n">X_LGUI</span><span class="p">)</span><span class="n">SS_UP</span><span class="p">(</span><span class="n">X_LALT</span><span class="p">));</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">case</span> <span class="n">RIGHT_PANE</span><span class="p">:</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_DOWN</span><span class="p">(</span><span class="n">X_LALT</span><span class="p">)</span><span class="n">SS_DOWN</span><span class="p">(</span><span class="n">X_LGUI</span><span class="p">));</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_TAP</span><span class="p">(</span><span class="n">X_RIGHT</span><span class="p">));</span>
        <span class="n">SEND_STRING</span><span class="p">(</span><span class="n">SS_UP</span><span class="p">(</span><span class="n">X_LGUI</span><span class="p">)</span><span class="n">SS_UP</span><span class="p">(</span><span class="n">X_LALT</span><span class="p">));</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Let’s take a look at what’s going on here:</p> <ul> <li> <code class="highlighter-rouge">SS_DOWN</code>, <code class="highlighter-rouge">SS_UP</code>, and <code class="highlighter-rouge">SS_TAP</code> are <a href="https://docs.qmk.fm/#/feature_macros?id=tap-down-and-up">specific Feature Macros</a> that cover pressing (but not releasing) a key, releasing a key, and pressing-and-releasing a key respectively. So, we are issuing three commands in our <code class="highlighter-rouge">case</code> statements: press (and hold) Left Alt and Left GUI, then tap the Left (or Right) Arrow key, then release the Left GUI and Left Alt keys.</li> <li>Keycodes, when used with the <code class="highlighter-rouge">SEND_STRING</code> function, apparently need to have an <code class="highlighter-rouge">X_</code> prefix, rather than <code class="highlighter-rouge">KC_</code>, <a href="https://github.com/qmk/qmk_firmware/pull/1657">“because of some pre-processor magic”</a>… ¯\_(ツ)_/¯</li> </ul> <h2 id="compile-time">Compile Time</h2> <p>At this point, we should have a compilable program, so if you wanted to generate the firmware, return to the root <code class="highlighter-rouge">qmk_firmware</code> directory, and after <a href="https://docs.qmk.fm/#/getting_started_build_tools">installing the build tools</a> for your system, run the following command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make ergodox_ez:custom
</code></pre></div></div> <p>This should result in an <code class="highlighter-rouge">ergodox_ez_custom.hex</code> file being generated in the <code class="highlighter-rouge">qmk_firmware</code> root directory, which can then be used to flash the Ergodox keyboard firmware, instructions for which are in the video on the <a href="https://ergodox-ez.com/pages/graphical-configurator">ErgoDox EZ Graphical Configurator page</a> (consult your keyboard’s documentation for its specific firmware-flashing instructions).</p> <p>Rather than <em>actually</em> compiling and using the layout we have created here, though, use what we have done as a base for thinking about what custom keys you would like to have, and then creating your own personal keymap layout.</p> <p>There is plenty of inspiration in the <a href="https://github.com/qmk/qmk_firmware/tree/master/keyboards/ergodox_ez/keymaps">QMK Ergodox EZ keymaps</a> directory (or in the keymaps directory of whatever type of keyboard you may be using), and please feel free to take anything of use from <a href="https://github.com/paulfioravanti/qmk_keymaps">my own keymap layout</a>.</p> <h2 id="other-resources">Other Resources</h2> <ul> <li>If you like emoji, but would prefer to have your mappings send Unicode characters, rather than emoji codes (eg <code class="highlighter-rouge">SEND_STRING(SS_LALT("D83D+DC4D"))</code> rather than <code class="highlighter-rouge">SEND_STRING(":+1:")</code>), then check out the <a href="https://sevenseacat.net/posts/2018/unicode-in-qmk-on-osx/">One-keystroke Unicode characters in QMK on macOS</a> blog post by <a href="https://sevenseacat.net/about/">Rebecca Le</a>.</li> </ul> <h2 id="bonus-software-based-key-mapping-for-mac">Bonus: Software-based Key Mapping for Mac</h2> <p>Sometimes, you just cannot get to an external keyboard and need to use the keyboard built-in to your laptop computer. If you need key mappings in that situation, then I can definitely recommend <a href="https://github.com/tekezo/Karabiner-Elements">Karabiner Elements</a>. My mappings look like the following from the user interface:</p> <p><img src="/assets/images/2018-07-31/karabiner-mappings.png" alt="Karabiner Mappings" title="Karabiner Mappings" class="img-responsive"></p> <p>Some notes on these rules:</p> <ul> <li>In order to get a mirroring “Caps Lock to Control/Escape” key on the right side of the keyboard for Vim, using a combination of rules, I mapped Enter/Return to be “Control when held, Return/Enter when tapped”. Works great for touch typing Vimmers that want to stay close to the home row!</li> <li>The final rule represents the following mappings: when Left-⌘ is tapped (not held), send the “英数” (<em>eisū</em>, alphanumeric) key, and when Right-⌘ is tapped (not held), send the “かな” (<em>kana</em>, Japanese) key. These two keys are often found on Japanese Mac OS keyboards and make it easy to switch between the inputting English and Japanese. More info <a href="https://en.wikipedia.org/wiki/Language_input_keys#Keys_for_Japanese_Keyboards">here</a> if you are interested.</li> </ul> <p>You can also get the config details in <a href="https://github.com/paulfioravanti/dotfiles/blob/master/config/karabiner/karabiner.json"><code class="highlighter-rouge">karabiner.json</code></a> from <a href="https://github.com/paulfioravanti/dotfiles">my Dotfiles</a>.</p> <p>Happy Clacking!</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/clang" class="page__taxonomy-item" rel="tag">clang</a><span class="sep">, </span> <a href="/tags/ergodox" class="page__taxonomy-item" rel="tag">ergodox</a><span class="sep">, </span> <a href="/tags/keyboards" class="page__taxonomy-item" rel="tag">keyboards</a><span class="sep">, </span> <a href="/tags/mechanical-keyboards" class="page__taxonomy-item" rel="tag">mechanical-keyboards</a><span class="sep">, </span> <a href="/tags/qmk" class="page__taxonomy-item" rel="tag">qmk</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-07-31T08:10:00+10:00">July 31, 2018</time></p> </footer> <section class="page__share"> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=Escape+the+defaults+and+Control+your+keyboard+with+QMK%20https%3A%2F%2Fpaulfioravanti.com%2Fblog%2F2018%2F07%2F31%2Fescape-the-defaults-and-control-your-keyboard-with-qmk%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fpaulfioravanti.com%2Fblog%2F2018%2F07%2F31%2Fescape-the-defaults-and-control-your-keyboard-with-qmk%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fpaulfioravanti.com%2Fblog%2F2018%2F07%2F31%2Fescape-the-defaults-and-control-your-keyboard-with-qmk%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/2018/07/26/connecting-elm-to-phoenix-1-4-with-webpack/" class="pagination--pager" title="Connecting Elm to Phoenix 1.4 with webpack ">Previous</a> <a href="/blog/2018/08/20/the-curious-incident-of-the-shadow-in-the-run-time/" class="pagination--pager" title="The Curious Incident of the Shadow in the Run-Time ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Comments</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You May Also Enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-01-27/jason-leung-jCBzW_Q_UGI-unsplash.jpg" alt="photo of assorted-color nation flags on wall during daytime"> </div> <h2 class="archive__item-title" itemprop="headline"> <a href="/blog/2020/01/27/internationalisation-with-phoenix-live-components/" rel="permalink">Internationalisation with Phoenix LiveComponents </a> </h2> <p class="page__meta"> <i class="fa fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-01-27T10:00:00+11:00"> Jan 27, 2020 </time>   <i class="far fa-clock" aria-hidden="true"></i> 15 minute read </p> <p class="archive__item-excerpt" itemprop="description">Draw the responsibility demarcation lines between your LiveView-managed state, markup, and events with LiveComponents. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2020-01-08/allie-smith-vuWCq1bXZy0-unsplash.jpg" alt="cup of coffee on laptop"> </div> <h2 class="archive__item-title" itemprop="headline"> <a href="/blog/2020/01/08/employee-sans-office/" rel="permalink">Employee Sans Office </a> </h2> <p class="page__meta"> <i class="fa fa-calendar-alt" aria-hidden="true"></i> <time datetime="2020-01-08T16:45:00+11:00"> Jan 08, 2020 </time>   <i class="far fa-clock" aria-hidden="true"></i> 4 minute read </p> <p class="archive__item-excerpt" itemprop="description">Small thoughts on remote working. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2019-11-03/nareeta-martin-vF1YCoLHMpg-unsplash.jpg" alt="multicolored buntings on pathway"> </div> <h2 class="archive__item-title" itemprop="headline"> <a href="/blog/2019/11/03/internationalisation-with-phoenix-liveview/" rel="permalink">Internationalisation with Phoenix LiveView </a> </h2> <p class="page__meta"> <i class="fa fa-calendar-alt" aria-hidden="true"></i> <time datetime="2019-11-03T00:00:00+11:00"> Nov 03, 2019 </time>   <i class="far fa-clock" aria-hidden="true"></i> 47 minute read </p> <p class="archive__item-excerpt" itemprop="description">Change your application locale without a full-page reload or having to write (much) Javascript. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2019-06-22/drew-beamer-692664-unsplash.jpg" alt="black rolling chairs beside brown table"> </div> <h2 class="archive__item-title" itemprop="headline"> <a href="/blog/2019/06/22/resume-as-code/" rel="permalink">Resume as Code </a> </h2> <p class="page__meta"> <i class="fa fa-calendar-alt" aria-hidden="true"></i> <time datetime="2019-06-22T21:00:00+10:00"> Jun 22, 2019 </time>   <i class="far fa-clock" aria-hidden="true"></i> 10 minute read </p> <p class="archive__item-excerpt" itemprop="description">Bring some fun back into the document that sells you to the world. </p> </article> </div> </div> </div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2020 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="https://kit.fontawesome.com/4eee35f757.js"></script> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-109270947-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script> <script>var disqus_config=function(){this.page.url="https://paulfioravanti.com/blog/2018/07/31/escape-the-defaults-and-control-your-keyboard-with-qmk/",this.page.identifier="/blog/2018/07/31/escape-the-defaults-and-control-your-keyboard-with-qmk"};!function(){var t=document,e=t.createElement("script");e.src="https://paulfioravanti.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>