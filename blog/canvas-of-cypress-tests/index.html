<!doctype html> <html lang="en" class="no-js"> <head> <meta charset="utf-8"> <title>A Canvas of Cypress Tests | Floor and Varnish</title> <meta name="description" content="“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands”"> <meta name="author" content="Paul Fioravanti"> <meta property="article:author" content="Paul Fioravanti"> <meta property="og:type" content="article"> <meta property="og:locale" content="en_US"> <meta property="og:site_name" content="Floor and Varnish"> <meta property="og:title" content="A Canvas of Cypress Tests"> <meta property="og:url" content="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/"> <meta property="og:description" content="“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands”"> <meta property="og:image" content="https://www.paulfioravanti.com/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-1889.jpg"> <meta name="twitter:site" content="@paulfioravanti"> <meta name="twitter:title" content="A Canvas of Cypress Tests"> <meta name="twitter:description" content="“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands”"> <meta name="twitter:url" content="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://www.paulfioravanti.com/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-1889.jpg"> <meta name="twitter:creator" content="@paulfioravanti"> <meta property="article:published_time" content="2021-10-06T22:50:00+11:00"> <meta property="article:modified_time" content="2021-10-06T22:50:00+11:00"> <link rel="canonical" href="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/"> <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Paul Fioravanti",
      "url": "https://www.paulfioravanti.com/",
      "sameAs": ["https://twitter.com/paulfioravanti","https://www.linkedin.com/in/paulfioravanti","https://github.com/paulfioravanti","https://stackoverflow.com/users/567863/paul-fioravanti"]
    
  }
</script> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Floor and Varnish Feed"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <script>document.documentElement.className=document.documentElement.className.replace(/\bno-js\b/g,"")+" js ";</script> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript> </head> <body class="layout--single wide"> <nav class="skip-links"> <ul> <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li> <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li> <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li> </ul> </nav> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--> <div class="masthead"> <div class="masthead__inner-wrap"> <div class="masthead__menu"> <nav id="site-nav" class="greedy-nav"> <a class="site-title" href="/"> Floor and Varnish </a> <ul class="visible-links"><li class="masthead__menu-item"> <a href="/about/">About</a> </li></ul> <button class="search__toggle" type="button"> <span class="visually-hidden">Toggle search</span> <i class="fas fa-search"></i> </button> <button class="greedy-nav__toggle hidden" type="button"> <span class="visually-hidden">Toggle menu</span> <div class="navicon"></div> </button> <ul class="hidden-links hidden"></ul> </nav> </div> </div> </div> <div class="initial-content"> <div class="page__hero--overlay" style=" background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-1889.jpg');"> <div class="wrapper"> <h1 id="page-title" class="page__title" itemprop="headline"> A Canvas of Cypress Tests </h1> <p class="page__lead">“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands” <small>(<a href="https://en.wikipedia.org/wiki/Wheat_Field_with_Cypresses#:~:text=I%20have%20a%20canvas%20of%20cypresses%20with%20some%20ears%20of%20wheat%2C%20some%20poppies%2C%20a%20blue%20sky%20like%20a%20piece%20of%20Scotch%20plaid">with apologies</a>)</small> </p> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-06T22:50:00+11:00">October 6, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-clock" aria-hidden="true"></i> 19 minute read </span> </p> <a href="https://www.testautomationweekly.com/post/issue-15/" style="text-decoration: none;"> <img src="https://img.shields.io/badge/Test%20Automation%20Weekly-%23115-4C625F.svg" alt="Test Automation Weekly #15"> </a> </div> <span class="page__hero-caption">“A Wheatfield with Cypresses”, Vincent Van Gogh, June 1889 </span> </div> <div id="main" role="main"> <div class="sidebar sticky"> <div itemscope itemtype="https://schema.org/Person"> <div class="author__avatar"> <a href="/"> <img src="https://s.gravatar.com/avatar/abda861707b1e78e0fce47ced55f84ee" alt="Paul Fioravanti" itemprop="image"> </a> </div> <div class="author__content"> <a href="/"><h3 class="author__name" itemprop="name">Paul Fioravanti</h3></a> <div class="author__bio" itemprop="description"> <p><img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> code / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> languages <img class="emoji" title=":it:" alt=":it:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ee-1f1f9.png" height="20" width="20"> <img class="emoji" title=":jp:" alt=":jp:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f1ef-1f1f5.png" height="20" width="20"> / <img class="emoji" title=":heart:" alt=":heart:" src="https://github.githubassets.com/images/icons/emoji/unicode/2764.png" height="20" width="20"> mech <img class="emoji" title=":keyboard:" alt=":keyboard:" src="https://github.githubassets.com/images/icons/emoji/unicode/2328.png" height="20" width="20"> / Learning stenography</p> </div> </div> <div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button> <ul class="author__urls social-icons"> <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place"> <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, Australia</span> </li> <li> <a href="https://www.paulfioravanti.com" itemprop="url"> <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span> </a> </li> <li> <a href="mailto:paul@paulfioravanti.com"> <meta itemprop="email" content="paul@paulfioravanti.com"> <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span> </a> </li> <li> <a href="https://keybase.io/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fas fa-fw fa-key" aria-hidden="true"></i><span class="label">Keybase</span> </a> </li> <li> <a href="https://twitter.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span> </a> </li> <li> <a href="https://www.linkedin.com/in/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span> </a> </li> <li> <a href="https://github.com/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span> </a> </li> <li> <a href="https://stackoverflow.com/users/567863/paul-fioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span> </a> </li> <li> <a href="https://www.youtube.com/channel/UC_ObnUGtIfRRq6vbxFYRpUg" itemprop="sameAs" rel="nofollow noopener noreferrer"> <i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span> </a> </li> <li> <a href="https://www.strava.com/athletes/paulfioravanti" itemprop="sameAs" rel="nofollow noopener noreferrer me"> <i class="fab fa-strava" aria-hidden="true"></i> Strava </a> </li> </ul> </div> </div> <div id="bd_embed_signup"> <form action="https://buttondown.email/api/emails/embed-subscribe/paulfioravanti" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/paulfioravanti', 'popupwindow')" class="embeddable-buttondown-form"> <label for="bd-email">Get notified of new posts!</label> <input type="email" name="email" id="bd-email" class="email" placeholder="email address"> <input type="hidden" value="1" name="embed"> <div class="clear"> <input type="submit" value="Subscribe" id="bd-embedded-subscribe" class="button"> </div> <p> I send email when I have new content to share. No spam; unsubscribe at any time. <a href="/privacy">Privacy Policy</a> </p> </form> </div> </div> <article class="page" itemscope itemtype="https://schema.org/CreativeWork"> <meta itemprop="headline" content="A Canvas of Cypress Tests"> <meta itemprop="description" content="“I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands”"> <meta itemprop="datePublished" content="2021-10-06T22:50:00+11:00"> <meta itemprop="dateModified" content="2021-10-06T22:50:00+11:00"> <div class="page__inner-wrap"> <section class="page__content" itemprop="text"> <p>I have two different applications that essentially do the same thing. One is written using <a href="https://elixir-lang.org/">Elixir</a> and <a href="https://www.phoenixframework.org/">Phoenix</a>; the other, <a href="https://elm-lang.org/">Elm</a>.</p> <p>I am too lazy to write a separate test suite in each application’s language. I want to write just one test suite, and be able to run it against either application, without it needing to know about any technical internals.</p> <p>Sounds a lot like I want an <a href="https://en.wikipedia.org/wiki/Integration_testing">integration test</a> suite, something that <a href="https://www.cypress.io/">Cypress</a> excels in helping you build. Let’s see how we can use it to create the testing glue between the two applications.</p> <h2 id="internationalisation-in-elixirelm">Internationalisation in Elixir/Elm</h2> <p>The application under test is a very simple toy application that re-creates the <a href="http://tachyons.io/">Tachyons</a> <a href="http://tachyons.io/components/layout/full-screen-centered-title/index.html">Full Screen Centered Title component documentation page</a>, but adds a dropdown menu to change the language of the message on screen, and in the browser title.</p> <p><img src="/assets/images/2021-10-06/tachyons-elm.gif" alt="Tachyons App" title="Animated GIF of Tachyons page implemented in Elm"></p> <blockquote> <p>The application codebases, and their companion blog posts, can be found at the following locations:</p> <table style="display: inline-table;"> <thead> <tr> <th style="text-align: left">Language</th> <th style="text-align: left">Application Codebase</th> <th style="text-align: left">Companion Blog Post</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Elixir/Phoenix</td> <td style="text-align: left"><a href="https://github.com/paulfioravanti/phx_i18n_example">Phoenix LiveView I18n Example</a></td> <td style="text-align: left"><em><a href="https://www.paulfioravanti.com/blog/internationalisation-phoenix-liveview/">Internationalisation with Phoenix LiveView</a></em></td> </tr> <tr> <td style="text-align: left">Elm</td> <td style="text-align: left"><a href="https://github.com/paulfioravanti/elm-i18n-example">Elm I18n Example</a></td> <td style="text-align: left"><em><a href="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/">Runtime Language Switching in Elm</a></em></td> </tr> </tbody> </table> </blockquote> <p>The entire feature set consists of the following use cases:</p> <ol> <li> <strong>Initial language setting</strong> <ul> <li>When the application has a language setting, it displays a message and title in that language.</li> <li>When the language setting is set to an unknown language, or is left blank, English is displayed.</li> </ul> </li> <li> <strong>The language menu</strong> <ul> <li>The default state for the menu is closed.</li> <li>If you click the current language, the menu opens.</li> <li>When the menu is open: <ul> <li>if you click the current language, the menu closes</li> <li>if you click anywhere else on the pager, the menu closes</li> <li>if you click another language, the menu closes</li> </ul> </li> </ul> </li> <li> <strong>Changing language</strong> <ul> <li>For any language selectable in the dropdown menu, when you click that language, the display of the page will change to that language</li> </ul> </li> <li> <strong>Language setting storage</strong> <ul> <li>If you change the application language and refresh the browser, the application will remember that change and still display in your chosen language</li> </ul> </li> </ol> <p>These use cases will form the blueprint for creating some <a href="http://mochajs.org/">Mocha</a> and <a href="http://chaijs.com/">Chai</a>-based tests in Cypress.</p> <p>We will start off with the third scenario, changing languages, since it will introduce us to some building blocks of Cypress testing. Initially, we will also focus on testing a single application, the Elm one.</p> <p>Once we have some passing tests, we will leverage some of Cypress’ features to do some refactoring, make sure that the same test can exercise both the Elm and Elixir applications at the same time, and then build on our knowledge by moving on to the other scenarios</p> <blockquote> <p>Feel free to follow along with the finished application, located at the <a href="https://github.com/paulfioravanti/cypress-i18n-example">Cypress I18n Example</a> Github repository.</p> </blockquote> <h2 id="changing-language">Changing Language</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-july-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, mid June - 2 July 1889"> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, mid June - 2 July 1889 </figcaption> </figure> </div> <p>After <a href="https://docs.npmjs.com/cli/init/">initialising a new Node JS application</a>, <a href="https://docs.cypress.io/guides/getting-started/installing-cypress">installing Cypress</a>, and making sure the Elm application is running, let’s create our first test to make sure we can switch language to Italian.</p> <blockquote> <p><a href="https://docs.cypress.io/api/table-of-contents">Cypress’ API documentation</a> is very user-friendly, so I will defer to you to reference it for any detailed explanations of Cypress-related functions you may see in the example code. I will only focus my commentary on application-specific logic, and any Cypress functionality I want to highlight.</p> </blockquote> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">Italiano</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>A few notes about this test:</p> <ul> <li>Since no language is initially set in this scenario, the application defaults to display in English</li> <li>An Elm application runs at <code class="language-plaintext highlighter-rouge">http://localhost:3000</code> by default</li> <li>Since we are testing a bare-bones toy application, many <a href="https://en.wikipedia.org/wiki/HTML">HTML</a> tags represent unique elements on a page (eg <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> for language menu), so we are able to target them by simply using commands like <a href="https://docs.cypress.io/api/commands/get"><code class="language-plaintext highlighter-rouge">cy.get()</code></a>, rather than needing more granular targets like <a href="https://www.w3schools.com/html/html_classes.asp">classes</a> or <a href="https://www.w3schools.com/html/html_id.asp">IDs</a>.</li> </ul> <p>Running the test within Cypress will look something like the following (but just note it has been slowed down significantly via <a href="https://github.com/cypress-io/cypress/issues/249#issuecomment-670028947">this technique</a>):</p> <figure> <img src="/assets/images/2021-10-06/change-language-italian-cypress.gif" alt="Change language to Italian passing test in Cypress"> </figure> <p>Great! We have our first passing test, and a baseline case to create tests for the other scenarios. Thanks to this, testing for changing the language to Japanese is, for the most part, a reproduction job:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">日本語</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Elmにおける多言語化</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">CSSで垂直センタリングは簡単だよ！</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>The test for changing the language to English, though, will be slightly more involved, since we have to change the application language to be non-English before the test runs.</p> <p>The Elm application attempts to set the initial language by first checking <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-plaintext highlighter-rouge">localStorage</code></a> for a specific key/value pair. Since Cypress tests are run in a browser, we have direct access to <code class="language-plaintext highlighter-rouge">localStorage</code>, as well as other browser-related functionality.</p> <p>We can leverage that, and the Cypress <code class="language-plaintext highlighter-rouge">before()</code> <a href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests#Hooks">hook</a>, to make sure we can set the initial language within a nested test, even before the top level <code class="language-plaintext highlighter-rouge">beforeEach()</code> hook visits the application URL:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Start in a non-English language.</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ja</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Okay, that’s our test suite for the use case done! Let’s run the tests!</p> <figure> <img src="/assets/images/2021-10-06/change-language-all-cypress.gif" alt="Changing languages passing test suite in Cypress"> </figure> <p>Looks like they all pass, which is good, but looking at the test code, it does seem to look quite repetitive…</p> <p>It might be nice to clean them up by extracting out the logic involved to perform core testing actions, and explicitly giving those extractions names, like “click language menu” or “displays Japanese” etc.</p> <h2 id="custom-commands">Custom Commands</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-early-september-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, Early September 1889"> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, Early September 1889 </figcaption> </figure> </div> <p>Using <a href="https://docs.cypress.io/api/cypress-api/custom-commands">Custom Commands</a>, we can define our own methods to use in the same way that Cypress uses its own API. When we set up Cypress, it provided us a file to put them in, so let’s fill it up with some methods to clean up the tests!</p> <p>We will start with some commands that wrap around logic related to the language menu:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickLanguageMenu</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickItalian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">Italiano</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickJapanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">日本語</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="nx">label</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div> <p>The first argument in each of the commands is the name of the command that will become available to us in the tests, so let’s see how that looks:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickItalian</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>

  <span class="c1">// ...</span>
<span class="p">})</span>
</code></pre></div></div> <p>This looks okay for a first refactor, so let’s go ahead and add some other commands to deal with language display, and, while we are at it, language storage:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysItalian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysJapanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Elmにおける多言語化</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">CSSで垂直センタリングは簡単だよ！</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">storeLanguage</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div> <p>Back in the test file, here is an example of how we can use these commands, inside the test that changes the language to English:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="c1">// ...</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Start in a non-English language.</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">storeLanguage</span><span class="p">(</span><span class="dl">"</span><span class="s2">ja</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickEnglish</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysEnglish</span><span class="p">()</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Not bad…for tests that only need to deal with the Elm application. But, the aim is to be lazy and re-use these tests for the Elixir application as well!</p> <p>The Phoenix server runs by default on port <code class="language-plaintext highlighter-rouge">4000</code>, rather than <code class="language-plaintext highlighter-rouge">3000</code>, and it is application-specific information like this that we will need to dynamically inject into the tests in order to enable maximum laziness.</p> <p>It would be handy to define this kind of information somewhere outside the test suite, where it can be referenced when needed. Luckily, Cypress has just the place for it.</p> <h2 id="cypress-environment-variables">Cypress Environment Variables</h2> <p>Cypress offers a few different options to define <a href="https://docs.cypress.io/guides/guides/environment-variables">environment variables</a>.</p> <p>The one we will use is defining an application root-level <a href="https://docs.cypress.io/guides/guides/environment-variables#Option-2-cypress-env-json"><code class="language-plaintext highlighter-rouge">cypress.env.json</code></a> file, which will contain static information about each application, as well as the language codes common across both applications:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress.env.json</code></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ENGLISH_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ITALIAN_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"it"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"JAPANESE_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ja"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"APPLICATIONS"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elm-i18n-example"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:3000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"storageKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elm-i18n-example-language"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phx_i18n_example"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:4000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"storageKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phxi18nexamplelanguage"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>As well as the <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">storageKey</code> for each application, we have added an application <code class="language-plaintext highlighter-rouge">name</code> identifier, as there are some test commands that will need to know which application is currently under test in order to correctly perform some action.</p> <p>Variables defined in <code class="language-plaintext highlighter-rouge">cypress.env.json</code> can be accessed via <a href="https://docs.cypress.io/api/cypress-api/env"><code class="language-plaintext highlighter-rouge">Cypress.env</code></a>, so let’s see how the changing language test file we have been working on changes in order to accommodate multiple applications:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">APPLICATIONS</span><span class="p">,</span> <span class="nx">JAPANESE_LANGUAGE</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">()</span>

<span class="nx">APPLICATIONS</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">url</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">: changing language`</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickItalian</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysItalian</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickJapanese</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysJapanese</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Start in a non-English language.</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">storeLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">JAPANESE_LANGUAGE</span><span class="p">)</span>
      <span class="p">})</span>

      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickEnglish</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysEnglish</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>And, we now have a passing set of tests that cover both applications!</p> <figure> <img src="/assets/images/2021-10-06/change-language-all-apps-cypress.gif" alt="Changing languages passing test suite in Cypress for both apps"> </figure> <p>Note how the address in the browser changes from the Elm application on port <code class="language-plaintext highlighter-rouge">3000</code>, to the Phoenix application on port <code class="language-plaintext highlighter-rouge">4000</code>.</p> <p>While we did not need to make any changes regarding the way that the language menu and language options are clicked between the applications, there are slight differences in how each application displays messages for a language, and how it remembers a language choice.</p> <p>As mentioned above, this has resulted in the need for some custom commands to accept the <code class="language-plaintext highlighter-rouge">name</code> parameter from the config, so let’s see how it is being used.</p> <h2 id="application-dependent-commands">Application-Dependent Commands</h2> <p>First up are the “displays language” set of commands. They have all changed in the same way, so we will just have a look at <code class="language-plaintext highlighter-rouge">displaysEnglish</code> as an example (check the application codebase for details of the other commands):</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">ELM_APP_NAME</span> <span class="p">}]</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="dl">"</span><span class="s2">APPLICATIONS</span><span class="dl">"</span><span class="p">)</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="nx">appName</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span>
    <span class="nx">appName</span> <span class="o">===</span> <span class="nx">ELM_APP_NAME</span>
      <span class="p">?</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span>
      <span class="p">:</span> <span class="dl">"</span><span class="s2">Multilingualisation in Phoenix</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div> <p>The only display difference between the two applications is the page title content, so we do a simple <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">ternary expression</a> to decide which title to use.</p> <p>How about storing the language for future reference? Although I used <code class="language-plaintext highlighter-rouge">localStorage</code> for the Elm application, I opted to instead use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">cookies</a> in the Phoenix application, so that I could keep as much logic as possible in Elixir, and not have to write any Javascript in <a href="https://hexdocs.pm/phoenix_live_view/js-interop.html#client-hooks">LiveView Hooks</a>.</p> <p>Cypress has an easy-to-use <a href="https://docs.cypress.io/api/commands/setcookie"><code class="language-plaintext highlighter-rouge">setCookie</code></a> API, and so adapting the <code class="language-plaintext highlighter-rouge">storeLanguage</code> custom command to handle the Phoenix application was very straightforward:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">ELM_APP_NAME</span><span class="p">,</span> <span class="na">storageKey</span><span class="p">:</span> <span class="nx">ELM_STORAGE_KEY</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">storageKey</span><span class="p">:</span> <span class="nx">PHX_STORAGE_KEY</span> <span class="p">}</span>
<span class="p">]</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="dl">"</span><span class="s2">APPLICATIONS</span><span class="dl">"</span><span class="p">)</span>

<span class="c1">// ...</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">storeLanguage</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">appName</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">appName</span> <span class="o">===</span> <span class="nx">ELM_APP_NAME</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">ELM_STORAGE_KEY</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">setCookie</span><span class="p">(</span><span class="nx">PHX_STORAGE_KEY</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>I did end up doing some further refactoring of the commands, like splitting them out into different files by functionality, and extracting static string values into their own file. If you are interested in those changes, see the <a href="https://github.com/paulfioravanti/cypress-i18n-example/tree/main/cypress/support"><code class="language-plaintext highlighter-rouge">support</code> directory</a> of the <a href="https://github.com/paulfioravanti/cypress-i18n-example">Cypress I18n Example</a> application.</p> <h2 id="all-green">All Green</h2> <p>Most of the other tests in the suite are quite similar in format to <code class="language-plaintext highlighter-rouge">changing_language.spec.js</code>, and build off of functionality that we have already seen. So, I will leave it to any interested parties to have a look at the rest of the test suite in detail.</p> <p>Suffice to say, that all the tests do pass, and you should be able to see below a test for every feature described in the use case set towards the top of this post:</p> <div> <figure> <img src="/assets/images/2021-10-06/full-test-suite-all-apps-cypress.gif" alt="Full passing test suite in Cypress for both apps"> </figure> </div> <p>There is one <a href="https://www.merriam-webster.com/dictionary/gotcha">gotcha</a>, though, that is worth bringing up: the applications would seem to sometimes inexplicably fail to register clicks on the language menu when the suite ran at full speed. This resulted in tests randomly failing, and much frustration and confusion on my part.</p> <p>Trawling through the <a href="https://github.com/cypress-io/cypress">Cypress GitHub repository</a> surfaced <a href="https://github.com/cypress-io/cypress/issues/1847">this issue</a>, seemingly indicating that there was a time where clicks were not being registered properly due to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseover_event"><code class="language-plaintext highlighter-rouge">mouseover</code> events</a> not being fired. <a href="https://github.com/cypress-io/cypress/issues/1847#issuecomment-447996153">The workaround</a> was to manually fire the event before clicking using <code class="language-plaintext highlighter-rouge">.trigger("mouseover").click()</code>.</p> <p><a href="https://github.com/cypress-io/cypress/pull/3030">This pull request</a> introduced automatic firing of <code class="language-plaintext highlighter-rouge">mouseover</code> events for clicks, but only for clickable input tags like <code class="language-plaintext highlighter-rouge">&lt;button&gt;</code>s. The language menu in our application is a <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> tag, so it does not benefit from auto-firing <code class="language-plaintext highlighter-rouge">mouseover</code> events, but manually adding that to the <code class="language-plaintext highlighter-rouge">clickLanguageMenu</code> command fixed the issue (and gave me a new rule-of-thumb for clicking elements in Cypress):</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickLanguageMenu</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">mouseover</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div> <h2 id="cypress-vs-phoenix-tests-vs-elm-tests">Cypress vs Phoenix Tests vs Elm Tests</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-late-september-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, Late September 1889"> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, Late September 1889 </figcaption> </figure> </div> <p>Remember when I said that the reason for creating the Cypress test suite was that “I am too lazy to write a separate test suite in each application’s language”?</p> <p>Well, writing this blog post ended up baiting me into writing them anyway.</p> <p>I wanted to see how much of the Cypress tests I could actually replicate in the respective application languages. You can find the tests in their Github repositories:</p> <ul> <li><a href="https://github.com/paulfioravanti/phx_i18n_example/tree/master/test/phx_i18n_example_web/integration">Phoenix LiveView integration tests</a></li> <li><a href="https://github.com/paulfioravanti/elm-i18n-example/tree/master/tests">Elm integration tests</a></li> </ul> <p>So, how do each of these test suites fare? Let’s take a look at each language’s equivalent of the “displays English” test from <code class="language-plaintext highlighter-rouge">changing_language.spec.js</code> and do a bit of compare and contrast.</p> <h3 id="phoenix-liveview-tests">Phoenix LiveView Tests</h3> <p>Since the Phoenix application uses <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html">LiveView</a>, which “enables rich, real-time user experiences with server-rendered HTML”, we leverage the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html"><code class="language-plaintext highlighter-rouge">Phoenix.LiveViewTest</code></a> module to create our tests.</p> <p>Unlike Cypress, Phoenix tests are not run in a browser (<a href="https://github.com/elixir-wallaby/wallaby">Wallaby</a> is the tool for that in Elixir-land). Rather, we start off with a socket connection (<code class="language-plaintext highlighter-rouge">conn</code>, a <a href="https://hexdocs.pm/plug/Plug.Conn.html"><code class="language-plaintext highlighter-rouge">Plug.Conn</code></a>), and use <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html#live/2"><code class="language-plaintext highlighter-rouge">live/2</code></a> to spawn a stateful LiveView process (<code class="language-plaintext highlighter-rouge">view</code>), that we can then interact with like we would a web page:</p> <p><strong><code class="language-plaintext highlighter-rouge">test/phx_i18n_example_web/integration/changing_language_test.exs</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">ChangingLanguageTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">ConnCase</span>
  <span class="kn">import</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">ConnTest</span>
  <span class="kn">import</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveViewTest</span>

  <span class="n">setup</span> <span class="p">%{</span><span class="ss">conn:</span> <span class="n">conn</span><span class="p">,</span> <span class="ss">language:</span> <span class="n">language</span><span class="p">,</span> <span class="ss">cookie:</span> <span class="n">cookie</span><span class="p">}</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">_html</span><span class="p">}</span> <span class="o">=</span>
      <span class="n">conn</span>
      <span class="o">|&gt;</span> <span class="n">put_req_cookie</span><span class="p">(</span><span class="s2">"phxi18nexamplelanguage"</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="n">live</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>

    <span class="n">view</span>
    <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"p"</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">render_click</span><span class="p">()</span>

    <span class="n">view</span>
    <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"li"</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">render_click</span><span class="p">()</span>

    <span class="n">heading</span> <span class="o">=</span>
      <span class="n">view</span>
      <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"h1"</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="n">render</span><span class="p">()</span>

    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">[</span><span class="ss">heading:</span> <span class="n">heading</span><span class="p">,</span> <span class="ss">title:</span> <span class="n">page_title</span><span class="p">(</span><span class="n">view</span><span class="p">)]}</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>

  <span class="nv">@tag</span> <span class="ss">cookie:</span> <span class="s2">"ja"</span>
  <span class="nv">@tag</span> <span class="ss">language:</span> <span class="s2">"English"</span>
  <span class="n">test</span> <span class="s2">"displays English when language changed to English"</span><span class="p">,</span>
       <span class="p">%{</span><span class="ss">heading:</span> <span class="n">heading</span><span class="p">,</span> <span class="ss">title:</span> <span class="n">title</span><span class="p">}</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="n">heading</span> <span class="o">=~</span> <span class="s2">"Vertically centering things in css is easy!"</span>
    <span class="n">assert</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">"Multilingualisation in Phoenix"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Since we are not working with a browser, we have to inject the language cookie value directly into the raw connection, using <a href="https://hexdocs.pm/plug/Plug.Test.html#put_req_cookie/3"><code class="language-plaintext highlighter-rouge">put_req_cookie/3</code></a>, in order to change the LiveView’s <code class="language-plaintext highlighter-rouge">language</code> (passed up to <code class="language-plaintext highlighter-rouge">setup</code> from the <code class="language-plaintext highlighter-rouge">@tag</code> attribute on the test) to English.</p> <p>From there, we perform <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html#render_click/1"><code class="language-plaintext highlighter-rouge">render_click/1</code></a> actions to open the language dropdown menu, select a language, and then extract the LiveView page title and heading to send into the test itself.</p> <p>For testing LiveViews in isolation, I think these kinds of tests are absolutely fine. However, where I think Cypress does get an upper hand in this use case, and some others in the application, is, as you may expect, related to its tests being run in a browser:</p> <ul> <li>No manual injection of cookies are needed into the application; Cypress can set cookie values directly in the browser, which the application can then read in and use</li> <li>Once the language is set, Cypress is able to <a href="https://docs.cypress.io/api/commands/reload"><code class="language-plaintext highlighter-rouge">cy.reload()</code></a> the browser to confirm that the new language is set in the cookies (check the Github repo for that test), but doing something like checking whether a cookie value has been changed in a <code class="language-plaintext highlighter-rouge">conn</code> is not feasible, and LiveViews cannot be “reloaded”</li> </ul> <h3 id="elm-tests">Elm Tests</h3> <p><a href="https://guide.elm-lang.org/architecture/">The Elm Architecture</a> (TEA) breaks Elm applications up into three parts:</p> <ul> <li>Model — the state of your application</li> <li>View — a way to turn your state into HTML</li> <li>Update — a way to update your state based on messages</li> </ul> <p>When attempting to write an “integration test” in Elm, you are able to initialise a model and pass it into a view to render.</p> <p>However, unlike a LiveView, it is not possible to trigger multiple events on a view (eg click language dropdown, then select a language) that then updates the state of a model, or the view itself, and then make assertions on it.</p> <p>It is not even possible to do this for a single event: the only assertions we can make based off of an event being triggered are <em>that</em> a certain type of message gets generated.</p> <p>For example, in the test below we:</p> <ul> <li>Initialise a model using <code class="language-plaintext highlighter-rouge">Main.init</code> </li> <li>Change the model values to indicate that the language menu should be open (<code class="language-plaintext highlighter-rouge">showAvailableLanguages = True</code>), and that the current language is Italian ( the <code class="language-plaintext highlighter-rouge">Translations.It</code> type)</li> <li>Render the model in the view and find <code class="language-plaintext highlighter-rouge">"English"</code> from the language dropdown menu</li> <li> <a href="https://package.elm-lang.org/packages/elm-explorations/test/latest/Test-Html-Event#simulate"><code class="language-plaintext highlighter-rouge">Event.Simulate</code></a> a <code class="language-plaintext highlighter-rouge">click</code> </li> <li>Assert that a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.En</code> message gets generated</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">tests/ChangingLanguageTest.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ChangingLanguageTest</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">all</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Main</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Test</span><span class="o">,</span> <span class="n">describe</span><span class="o">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Event</span> <span class="k">as</span> <span class="kt">Event</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">click</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Query</span> <span class="k">as</span> <span class="kt">Query</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Selector</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">containing</span><span class="o">,</span> <span class="n">tag</span><span class="o">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span>
<span class="k">import</span> <span class="kt">View</span>


<span class="n">all</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">all</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="n">_</span> <span class="p">)</span> <span class="o">=</span>
            <span class="kt">Main</span><span class="o">.</span><span class="n">init</span> <span class="p">{</span> <span class="n">language</span> <span class="o">=</span> <span class="n">null</span> <span class="p">}</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Changing language"</span>
        <span class="p">[</span> <span class="c1">-- ...</span>
        <span class="o">,</span> <span class="n">changeLanguageToEnglishTest</span> <span class="n">model</span>
        <span class="p">]</span>


<span class="c1">-- ...</span>


<span class="n">changeLanguageToEnglishTest</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Test</span>
<span class="n">changeLanguageToEnglishTest</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">initModel</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">initModel</span> <span class="o">=</span>
            <span class="p">{</span> <span class="n">model</span>
                <span class="o">|</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">True</span>
                <span class="o">,</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>
            <span class="p">}</span>

        <span class="n">html</span> <span class="p">:</span> <span class="kt">Html</span> <span class="kt">Msg</span>
        <span class="n">html</span> <span class="o">=</span>
            <span class="n">initModel</span>
                <span class="o">|&gt;</span> <span class="kt">View</span><span class="o">.</span><span class="n">view</span>
                <span class="o">|&gt;</span> <span class="o">.</span><span class="n">body</span>
                <span class="o">|&gt;</span> <span class="kt">List</span><span class="o">.</span><span class="n">head</span>
                <span class="o">|&gt;</span> <span class="kt">Maybe</span><span class="o">.</span><span class="n">withDefault</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">changing the language to English"</span>
        <span class="p">[</span> <span class="n">test</span> <span class="s">"</span><span class="s2">sends a message to change the language to English"</span> <span class="o">&lt;|</span>
            <span class="o">\</span><span class="p">()</span> <span class="o">-&gt;</span>
                <span class="n">html</span>
                    <span class="o">|&gt;</span> <span class="kt">Query</span><span class="o">.</span><span class="n">fromHtml</span>
                    <span class="o">|&gt;</span> <span class="kt">Query</span><span class="o">.</span><span class="n">find</span> <span class="p">[</span> <span class="n">tag</span> <span class="s">"</span><span class="s2">li"</span><span class="o">,</span> <span class="n">containing</span> <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">English"</span> <span class="p">]</span> <span class="p">]</span>
                    <span class="o">|&gt;</span> <span class="kt">Event</span><span class="o">.</span><span class="n">simulate</span> <span class="n">click</span>
                    <span class="o">|&gt;</span> <span class="kt">Event</span><span class="o">.</span><span class="n">expect</span> <span class="p">(</span><span class="kt">Msg</span><span class="o">.</span><span class="kt">ChangeLanguage</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">En</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></div></div> <p>From here, if we want to find out what should happen when Elm receives a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.En</code> message, we need to write a specific Update-focused test which:</p> <ul> <li>Initialises a model with its language setting as English (<code class="language-plaintext highlighter-rouge">Translations.En</code>)</li> <li>Initialises a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.It</code> message</li> <li>Passes the model and message into the Update function</li> <li>Asserts that the language in the model has changed from Italian to English</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">tests/UpdateTest.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">UpdateTest</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">all</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Expect</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Test</span><span class="o">,</span> <span class="n">describe</span><span class="o">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span>
<span class="k">import</span> <span class="kt">Update</span>


<span class="n">all</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">all</span> <span class="o">=</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Update"</span>
        <span class="p">[</span> <span class="n">changeLanguageTest</span>
        <span class="o">,</span> <span class="c1">-- ...</span>
        <span class="p">]</span>


<span class="n">changeLanguageTest</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">changeLanguageTest</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">msg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="n">msg</span> <span class="o">=</span>
            <span class="kt">Msg</span><span class="o">.</span><span class="kt">ChangeLanguage</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>

        <span class="n">model</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">model</span> <span class="o">=</span>
            <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">En</span>

        <span class="p">(</span> <span class="n">actualModel</span><span class="o">,</span> <span class="n">_</span> <span class="p">)</span> <span class="o">=</span>
            <span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">msg</span> <span class="n">model</span>

        <span class="n">expectedModel</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">expectedModel</span> <span class="o">=</span>
            <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Msg.ChangeLanguage"</span>
        <span class="p">[</span> <span class="n">test</span> <span class="s">"</span><span class="s2">updates the model to the specified language"</span> <span class="o">&lt;|</span>
            <span class="o">\</span><span class="p">()</span> <span class="o">-&gt;</span>
                <span class="kt">Expect</span><span class="o">.</span><span class="n">equal</span> <span class="n">expectedModel</span> <span class="n">actualModel</span>
        <span class="p">]</span>
</code></pre></div></div> <p>Similar to my opinions about the Elixir tests, I think these tests are totally fine for testing parts of an Elm application in isolation.</p> <p>There are some other Elm options to enable testing programs as more complete units, negating the need to divide up tests, like <a href="https://github.com/avh4/elm-program-test">elm-program-test</a> (does not drive a web browser), or <a href="https://github.com/justgook/elm-webdriver">Elm-WebDriver</a> (drives a web browser), so there are other options outside of Elm’s default testing paradigms.</p> <p>However, for similar reasons as the Elixir tests, I think there is a strong case for involving Cypress’ power and flexibility in the testing mix for Elm applications.</p> <h2 id="an-aside-testing-internationalisation">An Aside: Testing Internationalisation</h2> <p>The purpose of the Phoenix and Elm I18n example applications are just that: to be toy applications that provide example implementations of using internationalisation in those languages.</p> <p>Showing that text changes on a screen as a result of a language setting changing is their key functionality, and this is reflected in how the tests are written.</p> <p>For a real application containing many translated text entries in different locations in multiple languages, the string-based testing used in these test suites is not really feasible. The burden of having to update tests whenever translations are updated will get tiresome quickly; translations and tests are best being able to change independent of each other.</p> <p>Instead, it is much more helpful to have some kind of external tool that can run over your codebase and translation files to inform you on whether:</p> <ul> <li>you have any missing translations in certain languages</li> <li>whether you have translations for strings that are not referenced in the application anymore (ie they are obsolete)</li> </ul> <p>My favourite local developer tool I have used in the past to do this has actually been a <a href="https://www.ruby-lang.org/en/">Ruby</a> gem, <a href="https://glebm.github.io/i18n-tasks/">i18n-tasks</a>. If you do <a href="https://rubyonrails.org/">Ruby on Rails</a> development with internationalisation, definitely add it to your toolbox.</p> <p>There does not seem to be quite as robust a tool in the Phoenix or Elm ecosystems as of this writing, but there are other options available.</p> <p>For a Phoenix application, it would seem that you can “verify that your <a href="https://en.wikipedia.org/wiki/Gettext#Programming">POT files</a> are up to date with the current state of the codebase” with a <a href="https://hexdocs.pm/gettext/Mix.Tasks.Gettext.Extract.html#content"><code class="language-plaintext highlighter-rouge">mix gettext.extract</code></a> task:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix gettext.extract <span class="nt">--check-up-to-date</span>
</code></pre></div></div> <blockquote> <p>This task is in the <a href="https://github.com/elixir-gettext/gettext/blob/becf0585b12762bddb6dd04a9f0a307c8768fa1a/lib/mix/tasks/gettext.extract.ex#L23">Elixir Gettext <code class="language-plaintext highlighter-rouge">master</code> branch</a> as of this writing, so by the time you read this, it may have been released on <a href="https://hex.pm/">Hex</a>.</p> </blockquote> <p>For Elm, the situation is a bit more complex (that I go into in much more detail in <em><a href="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/">Runtime Language Switching in Elm</a></em>) but I would currently recommend <a href="https://github.com/ChristophP/elm-i18n-module-generator">Elm i18n Gen</a> to give some type safety to your translations.</p> <h2 id="paint-some-cypress-tests">Paint some Cypress tests</h2> <p>I have found writing and running integration tests with Cypress to be lots of fun, and think there is definitely a place for them alongside more unit-focused tests in your programming language of choice.</p> <p>The visual feedback Cypress can provide for high-value application workflows like account sign-up, or making a payment, make the tests something that can also be shared with non-technical areas of your team or business.</p> <p>If you have not used Cypress already, I would encourage you to give it a shot, and walk through your application in the shoes of your end users!</p> </section> <footer class="page__meta"> <p class="page__taxonomy"> <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong> <span itemprop="keywords"> <a href="/tags/chai" class="page__taxonomy-item" rel="tag">chai</a><span class="sep">, </span> <a href="/tags/cypress" class="page__taxonomy-item" rel="tag">cypress</a><span class="sep">, </span> <a href="/tags/elixir" class="page__taxonomy-item" rel="tag">elixir</a><span class="sep">, </span> <a href="/tags/elm" class="page__taxonomy-item" rel="tag">elm</a><span class="sep">, </span> <a href="/tags/i18n" class="page__taxonomy-item" rel="tag">i18n</a><span class="sep">, </span> <a href="/tags/javascript" class="page__taxonomy-item" rel="tag">javascript</a><span class="sep">, </span> <a href="/tags/mocha" class="page__taxonomy-item" rel="tag">mocha</a><span class="sep">, </span> <a href="/tags/phoenix" class="page__taxonomy-item" rel="tag">phoenix</a><span class="sep">, </span> <a href="/tags/testing" class="page__taxonomy-item" rel="tag">testing</a> </span> </p> <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-10-06">October 6, 2021</time></p> </footer> <section class="page__share"> <a href="https://twitter.com/intent/tweet?via=paulfioravanti&amp;text=A+Canvas+of+Cypress+Tests%20https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcanvas-of-cypress-tests%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcanvas-of-cypress-tests%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcanvas-of-cypress-tests%2F&amp;title=A%20Canvas%20of%20Cypress%20Tests" class="btn btn--reddit" title=" Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.paulfioravanti.com%2Fblog%2Fcanvas-of-cypress-tests%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> </section> <nav class="pagination"> <a href="/blog/plover-for-the-record/" class="pagination--pager" title="Plover For the Record ">Previous</a> <a href="/blog/pipe-codebase-into-ruby/" class="pagination--pager" title="Pipe a Codebase into Ruby ">Next</a> </nav> </div> <div class="page__comments"> <h4 class="page__comments-title">Comments</h4> <section id="disqus_thread"></section> </div> </article> <div class="page__related"> <h4 class="page__related-title">You May Also Enjoy</h4> <div class="grid__wrapper"> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-11-17/daniel-kuberek-ijL9kGvjO-E-unsplash.jpg" alt="bottle near water"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/mums-meetup/" rel="permalink">Mum’s Meetup </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-11-17T13:05:00+11:00">November 17, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 4 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Organising a meetup gave my Mum a new lease on life. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-10-17/kinpachi-sensei.jpg" alt="Kinpachi-sensei teaches the meaning of the character for 'person'."> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/persons-character/" rel="permalink">A Person’s Character (人という字は) </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-17T16:14:00+11:00">October 17, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 4 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">“人” may be the kanji for person, but its simplicity masks a deeper meaning. </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-10-10/denny-muller-W3wd-rmLP7I-unsplash.jpg" alt="pipe organ"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/pipe-codebase-into-ruby/" rel="permalink">Pipe a Codebase into Ruby </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-10-10T20:50:00+11:00">October 10, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 6 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">“Pipes! Well done! I feel like Leonardo da Vinci! It’s a masterpiece!” </p> </article> </div> <div class="grid__item"> <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork"> <div class="archive__item-teaser"> <img src="/assets/images/2021-09-04/ace-attorney-cosplay.jpg" alt="Ace Attorney Cosplay"> </div> <h2 class="archive__item-title no_toc" itemprop="headline"> <a href="/blog/plover-for-the-record/" rel="permalink">Plover For the Record </a> </h2> <p class="page__meta"> <span class="page__meta-date"> <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> <time datetime="2021-09-04T16:00:00+10:00">September 4, 2021</time> </span> <span class="page__meta-sep"></span> <span class="page__meta-readtime"> <i class="far fa-fw fa-clock" aria-hidden="true"></i> 21 minute read </span> </p> <p class="archive__item-excerpt" itemprop="description">Want to try recording legal testimony with just your computer keyboard? With Plover, court is in session. </p> </article> </div> </div> </div> </div> </div> <div class="search-content"> <div class="search-content__inner-wrap"> <form class="search-content__form" onkeydown="return event.key != 'Enter';"> <label class="sr-only" for="search"> Enter your search term... </label> <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..."> </form> <div id="results" class="results"></div> </div> </div> <div id="footer" class="page__footer"> <footer> <div class="page__footer-follow"> <ul class="social-icons"> <li> <a href="/privacy"> <i class="fas fa-user-shield"></i> Privacy Policy </a> </li> <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li> </ul> </div> <div class="page__footer-copyright">© 2021 Paul Fioravanti. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div> </footer> </div> <script src="/assets/js/main.min.js"></script> <script src="/assets/js/lunr/lunr.min.js"></script> <script src="/assets/js/lunr/lunr-store.js"></script> <script src="/assets/js/lunr/lunr-en.js"></script> <script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-109270947-1"]),_gaq.push(["_trackPageview"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}();</script> <script>var disqus_config=function(){this.page.url="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/",this.page.identifier="/blog/canvas-of-cypress-tests"};!function(){var t=document,s=t.createElement("script");s.src="https://paulfioravanti.disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(s)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </body> </html>