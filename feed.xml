<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://www.paulfioravanti.com/feed.xml" rel="self" type="application/atom+xml"/><link href="https://www.paulfioravanti.com/" rel="alternate" type="text/html"/><updated>2022-04-25T14:31:14+10:00</updated><id>https://www.paulfioravanti.com/feed.xml</id><title type="html">Floor and Varnish</title><subtitle>The permanent drafts folder for brain dumps of Paul Fioravanti</subtitle><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><entry><title type="html">Mum’s Meetup</title><link href="https://www.paulfioravanti.com/blog/mums-meetup/" rel="alternate" type="text/html" title="Mum’s Meetup"/><published>2021-11-17T13:05:00+11:00</published><updated>2021-11-27T23:05:00+11:00</updated><id>https://www.paulfioravanti.com/blog/mums-meetup</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/mums-meetup/"><![CDATA[<div class="post-audio"> <div class="post-audio-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/Ehi-ett4PWM" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div class="spacer"></div> <div class="text"> :studio_microphone: This post has audio narration </div> </div> <p>When you run a meetup, one of the more difficult things to gauge can be whether you’re actually doing it right.</p> <p>Feedback can be elusive, so it can be hard to know if this event that you put on has some value for, or is meaningful to, the people that come along.</p> <p>One day, though, I did get some feedback about a meetup from the most unlikely of places, and it helped reframe my views on the importance of community and human connection.</p> <hr/> <p>I have written posts encouraging participation in meetups before (<em><a href="https://www.paulfioravanti.com/blog/speak-at-meetups/">Speak at a Meetup</a></em>, and <em><a href="https://www.paulfioravanti.com/blog/organise-meetups/">Organise a Meetup</a></em>), but of all my attempts at evangelising this, I think I am most proud of having gotten one particular person into the meetup game:</p> <p>My mother.</p> <p>When Mum retired after a long career in education, I worried about how she would fill her days.</p> <p>Work constituted an important part of her life, and kept her constantly busy. With her children occupied with their own lives, no other family, few close friends who were, themselves, still working, and no specific hobbies that involved socialising, what would she do with herself?</p> <p>I was organising the <a href="https://www.meetup.com/en-AU/Ruby-On-Rails-Oceania-Sydney">Ruby on Rails Oceania Sydney</a> meetup at the time, and suggested that she try finding some communities that interested her, and go along to their events.</p> <p>Making new friends is harder as you get older, so she was hesitant at first. But, after talking up the benefits that I got from meetup participation after moving to a new city where I knew no one, she took the plunge.</p> <p>It was an over-50s social meetup, and on her first timid steps into the event space, the organiser rushed over, welcomed her with a big smile, and introduced her to some of the other members of the group.</p> <p>First impressions from the initial meetup were so good that Mum started regularly attending almost immediately. All the new people she met at the meetup, the places they went to, and the activities they did together, became a staple feature of our conversations.</p> <p>Frequent participation at the meetup events led Mum to become well-known and trusted. It was not long before she was invited into the leadership team, started running specific events for members, and eventually took on more responsibility as one of the main meetup organisers.</p> <p>And when Mum runs a meetup, much like when she ran a single-parent household, you will find no <a href="https://www.merriam-webster.com/dictionary/half%20measure">half measures</a>: multiple social events every week, from pub gatherings to cultural excursions to dinner parties.</p> <p>Between running her own events, helping others run theirs, scouting new venues for future potential meetups, handling new memberships (including dealing with financials), general <a href="https://en.wiktionary.org/wiki/herd_cats">cat herding</a>, and managing the drama found in large social groups of people with various personalities and temperaments, there is no doubt I would define it as a full-time job.</p> <p>Mum and I essentially became peers in this meetup space, though the amount of effort involved in her meetups leaves my own credentials as a so-called “organiser” of some <a href="https://www.merriam-webster.com/dictionary/dinky">dinky</a> technical meetups once a month in the dust!</p> <p>I am glad to have been shown up, though, as Mum’s passion and enthusiasm for meetup organisation and bringing people together led to her to become a happier, and even more outgoing, person.</p> <hr/> <p>We held Mum’s wake in the same pub we celebrated her 60th birthday some years earlier.</p> <p>More than a hundred people crammed into the room we had reserved to farewell Mum<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>, and I delivered a tearful eulogy to a group of unfamiliar faces.</p> <p>But, they all knew Mum from the meetup.</p> <p>Over the course of the afternoon, I got to meet many of them, and receive their memories of Mum, each recount a small gift to my mourning soul.</p> <p>One, though, in particular, stood out:</p> <blockquote> <p>“Your Mum saved my life.”</p> </blockquote> <p>I smiled politely, but as if to immediately quash any potential thoughts of hyperbole, they continued on that no, really, they were mentally in a very dark place when they first went on a whim to one of Mum’s meetups.</p> <p>But, Mum took care of them immediately, got them talking to others, which led to conversations that grew into friendships.</p> <p>And that’s what kept them going, enabling them to be there, at the wake, on that day.</p> <hr/> <p>So, I got to take that feedback, on behalf of Mum, and attempt to apply it to my own meetups. Getting together to nerd out over programming languages seems unlikely to save a life in my mind, but, ultimately, who’s to say?</p> <p>You may not know, nor ever know, the impact on others of whatever you put out in the world. I think as long as the effort is worth the intrinsic value you get from it, it’s okay to just keep doing it.</p> <p>In times of plague, it has admittedly been tough to keep up a feeling of community when we are all apart, and the interface to meetups is the same as every work meeting you have been forced to attend on <a href="https://zoom.us/">Zoom</a>.</p> <p>But, I hope that having persevered with them, even in a remote format, is considered better than not, and that once we reach whatever ends up passing for normality, real human connection (and maybe even shared :pizza:?) can come back to meetups.</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>Early 2019, pre-normalisation of social distancing <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p> </li> </ol> </div>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="meetups"/><summary type="html"><![CDATA[Organising a meetup gave my Mum a new lease on life.]]></summary></entry><entry><title type="html">A Person’s Character (人という字は)</title><link href="https://www.paulfioravanti.com/blog/persons-character/" rel="alternate" type="text/html" title="A Person’s Character (人という字は)"/><published>2021-10-17T16:14:00+11:00</published><updated>2021-12-04T14:00:00+11:00</updated><id>https://www.paulfioravanti.com/blog/persons-character</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/persons-character/"><![CDATA[<div class="post-audio"> <div class="post-audio-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/TlkoRxyb7E4" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div class="spacer"></div> <div class="text"> :studio_microphone: This post has audio narration </div> </div> <p>The father of the bride was making his wedding toast. He recounted how his daughter had left Japan alone to embark on an adventure to Australia, where she met the man she would eventually marry.</p> <p>I stood beside the father, translating his speech to English for the benefit of the Australian locals in attendance. I am not a professional interpreter by any means, but I thought I was doing pretty well.</p> <p>The speech continued, with the father suggesting that since the bridegroom was also a Japanese far from home, the couple could leverage their shared experiences, and support each other as they move forward and grow in their new life together.</p> <p>The father then did something that completely threw me off guard.</p> <p>He raised his two hands up to form a representation of “<a href="https://en.wiktionary.org/wiki/%E4%BA%BA">人</a>” (<em>hito</em>), the <em><a href="https://en.wikipedia.org/wiki/Kanji">kanji</a></em> character for “person”:</p> <div class="centered-image"> <figure> <img src="/assets/images/2021-10-17/person-hands.jpg" alt="Hands in the shape of the Japanese character for person"/> </figure> </div> <p>He then said:</p> <blockquote style="font-size: xx-large;"> <div class="japanese-with-furigana-romaji"> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> Hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> の <rp>[</rp> <rt class="romaji"> no </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 漢字 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 8px;"> かんじ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> kanji </rt> <rp>]</rp> </ruby> <ruby class="japanese"> は <rp>[</rp> <rt class="romaji"> wa </rt> <rp>]</rp> </ruby> <ruby class="japanese"> こう <rp>[</rp> <rt class="romaji"> kō </rt> <rp>]</rp> </ruby> <ruby class="japanese"> だから <rp>[</rp> <rt class="romaji"> dakara </rt> <rp>]</rp> </ruby> <ruby class="japanese"> ね <rp>[</rp> <rt class="romaji"> ne. </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 。 </ruby> </div> <strong>The <em>kanji</em> for "person" looks like this.</strong> </blockquote> <p>The Japanese in the audience smiled knowingly and laughed politely.</p> <p>I stopped and looked at the father, waiting for some further information that could help me contextualise what seemed like a complete <a href="https://www.merriam-webster.com/dictionary/non%20sequitur">non sequitur</a>.</p> <p>He looked back at me, hands still raised, waiting for his cue to continue after my interpretation.</p> <p>With no further assistance, nor any real idea of how to proceed through this awkward pause, I felt I had no other choice but to also raise my hands into a “人” shape, and just translate what had been said literally:</p> <blockquote> <p>“The <em>kanji</em> for person looks like this…¯\<em>(ツ)</em>/¯”</p> </blockquote> <p>With a sympathetic shrug of the shoulders to the audience, who were clearly as confused as I was, we continued on. Translation of the rest of the speech went fine, but this “人” issue really stuck with me.</p> <p>What did I miss that was so intuitively obvious to the Japanese in attendance, but left me completely blindsided?</p> <h2 id="kinpachi-sensei">Kinpachi-sensei</h2> <p>The answer lies with <em><a href="https://en.wikipedia.org/wiki/Kinpachi-sensei">Kinpachi-sensei</a></em> (<a href="https://ja.wikipedia.org/wiki/3%E5%B9%B4B%E7%B5%84%E9%87%91%E5%85%AB%E5%85%88%E7%94%9F">3<ruby>年<rt>ねん</rt></ruby>B<ruby>組金八先生<rt>ぐみきんぱちせんせい</rt></ruby></a>, <em>San-nen B-gumi Kinpachi-sensei</em>), a long-running Japanese television drama that portrays a variety of social issues faced by junior high school students.</p> <p><a href="https://en.wikipedia.org/wiki/Tetsuya_Takeda">Tetsuya Takeda</a> (<a href="https://ja.wikipedia.org/wiki/%E6%AD%A6%E7%94%B0%E9%89%84%E7%9F%A2"><ruby>武田<rt>たけだ</rt></ruby><ruby>鉄矢<rt>てつや</rt></ruby></a>) plays the titular role of school teacher Kinpachi Sakamoto, who sometimes illustrates points of morality to his students by deconstructing parts of <em>kanji</em> characters to reveal their deeper hidden meanings.</p> <p>During a scene in <em>Kinpachi-sensei</em>’s <a href="https://www.tbs.co.jp/tbs-ch/item/d1111/">4th special episode</a>, aired in 1985, Kinpachi writes “人” on the classroom blackboard, and says to his students:</p> <blockquote> <div class="japanese-with-furigana-romaji"> <ruby class="japanese"> <ruby> 君 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> きみ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> Kimi </rt> <rp>]</rp> </ruby> <ruby class="japanese"> たち <rp>[</rp> <rt class="romaji"> tachi </rt> <rp>]</rp> </ruby> <ruby class="japanese"> いい <rp>[</rp> <rt class="romaji"> ii </rt> <rp>]</rp> </ruby> <ruby class="japanese"> です <rp>[</rp> <rt class="romaji"> desu </rt> <rp>]</rp> </ruby> <ruby class="japanese"> か <rp>[</rp> <rt class="romaji"> ka~. </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 〜。 </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> Hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> と <rp>[</rp> <rt class="romaji"> to </rt> <rp>]</rp> </ruby> <ruby class="japanese"> いう <rp>[</rp> <rt class="romaji"> iu </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 字 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> じ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> ji </rt> <rp>]</rp> </ruby> <ruby class="japanese"> は <rp>[</rp> <rt class="romaji"> wa </rt> <rp>]</rp> </ruby> <ruby class="japanese"> ねぇ <rp>[</rp> <rt class="romaji"> nē, </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 、 </ruby> <ruby class="japanese"> ひとり <rp>[</rp> <rt class="romaji"> hitori </rt> <rp>]</rp> </ruby> <ruby class="japanese"> の <rp>[</rp> <rt class="romaji"> no </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 「人」 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 8px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> "hito" </rt> <rp>]</rp> </ruby> <ruby class="japanese"> が <rp>[</rp> <rt class="romaji"> ga </rt> <rp>]</rp> </ruby> <ruby class="japanese"> もう <rp>[</rp> <rt class="romaji"> mō </rt> <rp>]</rp> </ruby> <ruby class="japanese"> ひとり <rp>[</rp> <rt class="romaji"> hitori </rt> <rp>]</rp> </ruby> <ruby class="japanese"> の <rp>[</rp> <rt class="romaji"> no </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 「人」 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 8px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> "hito" </rt> <rp>]</rp> </ruby> <ruby class="japanese"> を <rp>[</rp> <rt class="romaji"> wo </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 支えて <rp>(</rp> <rt style="ruby-align: start; text-align: left; padding-left: 3px;"> ささ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> sasaete </rt> <rp>]</rp> </ruby> <ruby class="japanese"> いる <rp>[</rp> <rt class="romaji"> iru </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 字 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> じ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> ji </rt> <rp>]</rp> </ruby> <ruby class="japanese"> です <rp>[</rp> <rt class="romaji"> desu. </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 。 </ruby> <ruby class="japanese"> つまり <rp>[</rp> <rt class="romaji"> Tsumari, </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 、 </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> と <rp>[</rp> <rt class="romaji"> to </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> が <rp>[</rp> <rt class="romaji"> ga </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <span class="japanese-compound-word"> <ruby class="japanese"> <ruby> 支え <rp>(</rp> <rt style="ruby-align: start; text-align: left; padding-left:3px;"> ささ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> sasae </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 合ってる <rp>(</rp> <rt style="ruby-align: start; text-align: left; padding-left:8px;"> あ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> atteru </rt> <rp>]</rp> </ruby> </span> </ruby> <ruby class="japanese"> から <rp>[</rp> <rt class="romaji"> kara </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> なん <rp>[</rp> <rt class="romaji"> nan </rt> <rp>]</rp> </ruby> <ruby class="japanese"> です <rp>[</rp> <rt class="romaji"> desu. </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 。 </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> Hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> は <rp>[</rp> <rt class="romaji"> wa </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> に <rp>[</rp> <rt class="romaji"> ni </rt> <rp>]</rp> </ruby> <ruby class="japanese"> よって <rp>[</rp> <rt class="romaji"> yotte </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 支えられ <rp>(</rp> <rt style="ruby-align: start; text-align: left; padding-left: 3px;"> ささ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> sasaerare, </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 、 </ruby> <ruby class="japanese"> <ruby> 人 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 4px;"> ひと </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> hito </rt> <rp>]</rp> </ruby> <ruby class="japanese"> の <rp>[</rp> <rt class="romaji"> no </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 間 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 5px;"> あいだ </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> aida </rt> <rp>]</rp> </ruby> <ruby class="japanese"> で <rp>[</rp> <rt class="romaji"> de </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 人間 <rp>(</rp> <rt style="ruby-align: center; text-align: center; padding-left: 6px;"> にんげん </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> ningen </rt> <rp>]</rp> </ruby> <ruby class="japanese"> として <rp>[</rp> <rt class="romaji"> toshite </rt> <rp>]</rp> </ruby> <ruby class="japanese"> <ruby> 磨かれて <rp>(</rp> <rt style="ruby-align: start; text-align: left; padding-left: 4px;"> みが </rt> <rp>)</rp> </ruby> <rp>[</rp> <rt class="romaji"> migakarete </rt> <rp>]</rp> </ruby> <ruby class="japanese"> いくん <rp>[</rp> <rt class="romaji"> ikun </rt> <rp>]</rp> </ruby> <ruby class="japanese"> です <rp>[</rp> <rt class="romaji"> desu. </rt> <rp>]</rp> </ruby> <ruby class="japanese"> 。 </ruby> </div> <br/> Can I have your attention, please. So, the character for "person" consists of one person holding up and sustaining another person. In other words, it is a "person" precisely <em>because</em> a person and another person are supporting each other. A person gets support from other people and their community, and through that support, grows and develops as a human. </blockquote> <p>So, our expectations about the composition of this character are flipped on learning this new information: “人” is not a single character or “person”, but rather one person, <code class="language-plaintext highlighter-rouge">|</code>, leaning into another person, <code class="language-plaintext highlighter-rouge">|</code>, to form <code class="language-plaintext highlighter-rouge">人</code>.</p> <p>For English speakers, the sentiment above perhaps has recognisable echoes of the African proverb <a href="https://en.wikipedia.org/wiki/It_takes_a_village">“It takes a village to raise a child”</a>. But for Japanese, it resonated within the context of marriage, where two people “become one”.</p> <p>For the father of the bride, his daughter and new son-in-law would be leaning on each other for support as they begin their life together, not as two individuals, but as one family unit.</p> <p>Hence, “人” represented the new form their relationship had evolved into.</p> <h2 id="the-power-of-人">The Power of 人</h2> <p>The kicker to this romantic notion? It was <a href="https://news.yahoo.co.jp/articles/709a167033b56d303ec2f93ce5609892e7309d62">a complete lie</a>.</p> <p>Takeda confirmed as much in an appearance he made in 2021 on The Wide Show (<a href="https://www.fujitv.co.jp/widna-show/">ワイドナショー</a>), a Japanese news and entertainment television program.</p> <p>But, the meme has had decades to burrow into the collective consciousness of a generation, and regardless of the generally accepted <a href="https://en.wiktionary.org/wiki/%E4%BA%BA/derived_terms#Glyph_origin">glyph origin of 人</a> to be a “side view of a standing man, highlighting the arms and legs” (known before Takeda made his admission, of course), I would wager we will see “人” appear again at future weddings.</p> <p>If I had my time again at that speech, knowing what I know now, I think I would offer up the following translation for “the <em>kanji</em> for ‘person’ looks like this”:</p> <blockquote> <p><strong>[Hold both hands apart in a straight “<code class="language-plaintext highlighter-rouge">|</code>” formation]</strong>: “The bride and groom, once two individuals…“<br/> <strong>[Bring hands together to form “<code class="language-plaintext highlighter-rouge">人</code>”]</strong>: “…have come together to become a single family unit, leaning on each other for support as they begin their new life together, forming this, the Japanese character for ‘person’.”<br/> <strong>[Push hands slightly forward]</strong>: “These two have become one”.</p> </blockquote> <p>It’s certainly not a literal translation, nor an academic one, nor one that directly infers how the character of “人” is derived. Rather, it’s just a short bit of fanciful flourish that I think conveys enough meaning for the time given without having to impart all the details given in this blog post.</p> <p>So, if you ever somehow find yourself in a similar wedding-speech-interpreting situation, feel free to use or riff on my translation, and hopefully that will at least reduce your number of potential awkward pauses by one.</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="japanese"/><category term="日本語"/><summary type="html"><![CDATA["人" may be the _kanji_ for person, but its simplicity masks a deeper meaning.]]></summary></entry><entry><title type="html">Pipe a Codebase into Ruby</title><link href="https://www.paulfioravanti.com/blog/pipe-codebase-into-ruby/" rel="alternate" type="text/html" title="Pipe a Codebase into Ruby"/><published>2021-10-10T20:50:00+11:00</published><updated>2021-10-10T20:50:00+11:00</updated><id>https://www.paulfioravanti.com/blog/pipe-codebase-into-ruby</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/pipe-codebase-into-ruby/"><![CDATA[<p><a href="https://twitter.com/alistairtweed">Alistair Tweed</a> asked an interesting question on the <a href="https://ruby.org.au/">Ruby Australia</a> <a href="https://ruby-au-join.herokuapp.com/">Slack</a>, which I thought deserved a more permanent home over being banished to <a href="https://slack.com/">Slack</a>’s archives:</p> <blockquote> <p>Can anyone help me with getting user input when piping code to Ruby?<br/> The command I’m using is:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>hello | ruby
</code></pre></div> </div> <p>The <code class="language-plaintext highlighter-rouge">hello</code> file contains the following code:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># frozen_string_literal: true</span>

<span class="nb">name</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">strip</span>

<span class="nb">puts</span> <span class="s2">"Hello, </span><span class="si">#{</span><span class="nb">name</span> <span class="o">||</span> <span class="s1">'World'</span><span class="si">}</span><span class="s2">!"</span>
</code></pre></div> </div> <p>When using <code class="language-plaintext highlighter-rouge">gets</code>, the output is <code class="language-plaintext highlighter-rouge">Hello, World!</code><br/> When using <code class="language-plaintext highlighter-rouge">STDIN.read</code>, the output is <code class="language-plaintext highlighter-rouge">Hello, !</code><br/> The problem is that the script doesn’t stop to allow the user to type in a value. Any ideas?</p> </blockquote> <p>I do not think I had previously considered running a <a href="https://www.ruby-lang.org/en/">Ruby</a> program in this way, but regardless of whether I ever would or not, I was curious about how this question could be answered.</p> <p>All the examples below will be for the <a href="https://www.gnu.org/software/bash/">Bash</a> shell unless specified.</p> <h2 id="why-dont-you-just">Why don’t you just…?</h2> <p>First, though, let’s just address some potential “why don’t you just…?” questions around the use of <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">piping</a> in this scenario.</p> <div class="centered-image"> <figure> <img src="/assets/images/2021-10-10/treachery-of-images-unix.jpg" alt="The Treachery of Images Unix parody"/> <figcaption> This is not a Unix pipe. From <a href="https://www.reddit.com/r/ProgrammerHumor/comments/1vyuny/ceci_nest_pas_une_pipe/"> r/ProgrammerHumor </a> </figcaption> </figure> </div> <p>Yes, we could <em>just</em> change the command to pass the file directly to <code class="language-plaintext highlighter-rouge">ruby</code>, and manually type in a name when <a href="https://rubyapi.org/o/kernel#method-i-gets"><code class="language-plaintext highlighter-rouge">gets</code></a> prompts for it:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ruby hello
Mario
Hello, Mario!
</code></pre></div></div> <p>We could also use <a href="http://www.gnu.org/software/bash/manual/html_node/Process-Substitution.html#Process-Substitution">process substitution</a> to allow us to provide a name as an argument when running a command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ruby hello &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">)</span>
Hello, Mario!
</code></pre></div></div> <p>The codebase, as it stands, only really gives unexpected results when we ignore the input prompt (ie just press <code class="language-plaintext highlighter-rouge">[Enter]</code>):</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ruby hello
&lt;press Enter&gt;
Hello, <span class="o">!</span>
</code></pre></div></div> <p>Pressing <code class="language-plaintext highlighter-rouge">[Enter]</code> sends an empty string (<code class="language-plaintext highlighter-rouge">""</code>), not <code class="language-plaintext highlighter-rouge">nil</code>, and since <code class="language-plaintext highlighter-rouge">""</code> is a <a href="https://learn.co/lessons/truthiness-in-ruby-readme">truthy value in Ruby</a>, when <code class="language-plaintext highlighter-rouge">name || 'World'</code> gets evaluated, <code class="language-plaintext highlighter-rouge">name</code> gets output.</p> <p>This could be fixed by changing final line of the code to something like:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="s2">"Hello, </span><span class="si">#{</span><span class="nb">name</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">?</span> <span class="s1">'World'</span> <span class="p">:</span> <span class="nb">name</span><span class="si">}</span><span class="s2">!"</span>
</code></pre></div></div> <p>This allows the program to fall back to its default value when input is not provided:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ruby hello
&lt;press Enter&gt;
Hello, World!
</code></pre></div></div> <p>But! We are going to consider all of the above as <em>out of scope</em> for answering this question, and we are going to take the use of a pipe as an <em>unchangeable</em> (hard) requirement.</p> <h2 id="down-the-pipe">Down the Pipe</h2> <div class="centered-image"> <figure> <img src="/assets/images/2021-10-10/Mario!_(86871905).jpg" alt="The Manchester Mario"/> <figcaption> The Manchester Mario. <a href="https://commons.wikimedia.org/wiki/File:Mario!_(86871905).jpg"> Pete Birkinshaw from Manchester, UK </a>, <a href="https://creativecommons.org/licenses/by/2.0"> CC BY 2.0 </a>, via Wikimedia Commons </figcaption> </figure> </div> <p>Back to the problem at hand. Running the original command, we get the following:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | ruby
Hello, World!
</code></pre></div></div> <p>The codebase is being passed over to <code class="language-plaintext highlighter-rouge">ruby</code>, so that we end up with a command that looks something like:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby &lt;code&gt;
</code></pre></div></div> <p>We want to be able to capture a reference to that code being passed over via the pipe, so that we can inject arguments into it, and create a command that looks something like:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby &lt;code&gt; <span class="o">[</span>arguments]
</code></pre></div></div> <h3 id="xargs">xargs</h3> <p>Whenever I want to do something potentially complex with piped-in arguments, I tend to reach for the <a href="https://en.wikipedia.org/wiki/Xargs">xargs</a> utility first. Let’s see what we can do with it.</p> <p>We will start with attempting to get the most basic command running first (without any arguments), follow the trail of errors until it works, add in arguments, then rinse and repeat.</p> <p>First let’s just try passing the code through xargs and see what happens:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | xargs ruby
/../bin/ruby: No such file or directory <span class="nt">--</span> <span class="c">#!/usr/bin/env (LoadError)</span>
</code></pre></div></div> <p>It looks like we are only passing the first line of the file over to Ruby, rather than the entire file.</p> <p>This would seem to indicate that we have a <a href="https://en.wikipedia.org/wiki/Xargs#Separator_problem">separator problem</a>: xargs is not a line-oriented tool, but also separates on spaces.</p> <p>Looking back at the file, it’s first line is:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>
</code></pre></div></div> <p>xargs has separated on the space between <code class="language-plaintext highlighter-rouge">env</code> and <code class="language-plaintext highlighter-rouge">ruby</code>, resulting in the error above. Fortunately, using the <code class="language-plaintext highlighter-rouge">-0</code> flag deals with this problem, so let’s add it in:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | xargs <span class="nt">-0</span> ruby
/../bin/ruby: No such file or directory <span class="nt">--</span> <span class="c">#!/usr/bin/env ruby (LoadError)</span>
<span class="c"># frozen_string_literal: true</span>

name <span class="o">=</span> gets&amp;.strip

puts <span class="s2">"Hello, #{name || 'World'}!"</span>
</code></pre></div></div> <p>Okay, it looks like the whole file is being passed through this time, but we are still getting the same error. It would seem that perhaps <code class="language-plaintext highlighter-rouge">ruby</code> is not evaluating the code it is getting passed.</p> <p>We can fix this by adding <code class="language-plaintext highlighter-rouge">ruby</code>’s <code class="language-plaintext highlighter-rouge">-e</code> flag:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | xargs <span class="nt">-0</span> ruby <span class="nt">-e</span>
Hello, World!
</code></pre></div></div> <p>Great! We now have the default case working with xargs!</p> <p>But, we still need a reference to the Ruby code being piped through so that we can then give <em>it</em> arguments.</p> <p>To do that, we can use xargs’ <code class="language-plaintext highlighter-rouge">-I</code> option, and name the variable however we want. Let’s call it <code class="language-plaintext highlighter-rouge">rubycode</code>:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | xargs <span class="nt">-0I</span> rubycode ruby <span class="nt">-e</span> rubycode
Hello, World!
</code></pre></div></div> <p>So far, so good. Now, what happens when we use process substitution to provide a name argument…?</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | xargs <span class="nt">-0I</span> rubycode ruby <span class="nt">-e</span> rubycode &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">)</span>
Hello, Mario!
</code></pre></div></div> <p>Looks like we have ourselves a working command! Ship it! :shipit:</p> <h3 id="xargs-1">!xargs</h3> <p>Looking back at the command, I cannot help but think that using xargs is overkill for this kind of problem. The pipe is passing the code through as <a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_input_(stdin)">standard input</a> (<code class="language-plaintext highlighter-rouge">stdin</code>), we use xargs to “catch” it, assign it to the <code class="language-plaintext highlighter-rouge">rubycode</code> variable, and then pass that variable on to <code class="language-plaintext highlighter-rouge">ruby</code>.</p> <p>Surely we can do the same thing with just plain bash code, right? Let’s give it a try by using <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Substitution.html">command substitution</a> to capture the output of a <a href="https://www.gnu.org/software/bash/manual/html_node/Redirections.html">redirection</a> of <code class="language-plaintext highlighter-rouge">stdin</code> into a <code class="language-plaintext highlighter-rouge">rubycode</code> variable.</p> <p>As we did with xargs, we can then use that variable in the Ruby command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | <span class="nv">rubycode</span><span class="o">=</span><span class="si">$(</span>&lt; /dev/stdin<span class="si">)</span><span class="p">;</span> ruby <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$rubycode</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">)</span>
<span class="o">[</span>No output]
</code></pre></div></div> <p>Hmmm…getting no output here is unexpected.</p> <p>And, indeed, it would seem that I have neglected to <a href="https://www.gnu.org/software/bash/manual/html_node/Command-Grouping.html">group these commands together</a> in <code class="language-plaintext highlighter-rouge">(</code>parentheses<code class="language-plaintext highlighter-rouge">)</code>, so that the redirection that gets assigned to the <code class="language-plaintext highlighter-rouge">rubycode</code> variable can be applied to the other command when it gets referenced in the <code class="language-plaintext highlighter-rouge">ruby</code> command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | <span class="o">(</span><span class="nv">rubycode</span><span class="o">=</span><span class="si">$(</span>&lt; /dev/stdin<span class="si">)</span><span class="p">;</span> ruby <span class="nt">-e</span> <span class="s2">"</span><span class="nv">$rubycode</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">))</span>
Hello, Mario!
</code></pre></div></div> <p>And we are back to working again! But, we can probably make this a little bit more compact without sacrificing readability.</p> <p>Let’s get rid of the intermediate <code class="language-plaintext highlighter-rouge">rubycode</code> variable, which removes a command, meaning no need for any grouping:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span>&lt; /dev/stdin<span class="si">)</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">)</span>
Hello, Mario!
</code></pre></div></div> <p>Success! At this point, I think I would consider the <a href="https://en.wiktionary.org/wiki/yak_shaving">yak shaved</a>, and leave it at that.</p> <p>There are two other minor refactors I can think of, which we will go through below for completeness’ sake (said very loosely: “completeness” as in “all I could think of right now”, as I am sure there are more ways to do many of the commands in this post), but I personally think they sacrifice readability.</p> <h3 id="bonus-shave">Bonus Shave</h3> <p>The <a href="https://www.gnu.org/software/coreutils/manual/html_node/cat-invocation.html"><code class="language-plaintext highlighter-rouge">cat</code></a> command, if no arguments are provided, copies the contents of what it receives from standard input to <a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_output_(stdout)">standard output</a> (<code class="language-plaintext highlighter-rouge">stdout</code>). This means that we do not need to grab a reference to <code class="language-plaintext highlighter-rouge">stdin</code> and redirect it, but can instead just use <code class="language-plaintext highlighter-rouge">cat</code> in the <code class="language-plaintext highlighter-rouge">ruby</code> command:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span><span class="si">)</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">)</span>
Hello, Mario!
</code></pre></div></div> <p>If you use <a href="https://en.wikipedia.org/wiki/Z_shell">Z Shell</a> (<a href="https://www.zsh.org/"><code class="language-plaintext highlighter-rouge">zsh</code></a>), then you have the option of tapping directly into the mnemonics for Unix <a href="https://en.wikipedia.org/wiki/File_descriptor">file descriptors</a> for <code class="language-plaintext highlighter-rouge">stdin</code> (<code class="language-plaintext highlighter-rouge">0</code>), <code class="language-plaintext highlighter-rouge">stdout</code> (<code class="language-plaintext highlighter-rouge">1</code>), and <a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_error_(stderr)">standard error</a> (<code class="language-plaintext highlighter-rouge">stderr</code>, <code class="language-plaintext highlighter-rouge">2</code>):</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>hello | <span class="o">(</span>ruby <span class="nt">-e</span> <span class="s2">"</span><span class="si">$(</span>&lt;&amp;0<span class="si">)</span><span class="s2">"</span> &lt;<span class="o">(</span><span class="nb">echo </span>Mario<span class="o">))</span>
Hello, Mario!
</code></pre></div></div> <h2 id="blunt-razors">Blunt Razors</h2> <p>Our supply of yak shaving cream is depleted, and our razors are now blunt.</p> <p>Even if you never plan to run Ruby programs in the ways outlined above, hopefully, like me, you were able to learn a bit more about shell programming!</p> <p>Got any better commands that would make a shaven yak happier? Leave them in the comments!</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="ruby"/><category term="bash"/><category term="zsh"/><category term="shell"/><category term="pipe"/><category term="unix"/><summary type="html"><![CDATA["Pipes! Well done! I feel like Leonardo da Vinci! It's a masterpiece!"]]></summary></entry><entry><title type="html">A Canvas of Cypress Tests</title><link href="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/" rel="alternate" type="text/html" title="A Canvas of Cypress Tests"/><published>2021-10-06T22:50:00+11:00</published><updated>2022-03-25T15:40:00+11:00</updated><id>https://www.paulfioravanti.com/blog/canvas-of-cypress-tests</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/canvas-of-cypress-tests/"><![CDATA[<p>I have two different applications that essentially do the same thing. One is written using <a href="https://elixir-lang.org/">Elixir</a> and <a href="https://www.phoenixframework.org/">Phoenix</a>; the other, <a href="https://elm-lang.org/">Elm</a>.</p> <p>I am too lazy to write a separate test suite in each application’s language. I want to write just one test suite, and be able to run it against either application, without it needing to know about any technical internals.</p> <p>Sounds a lot like I want an <a href="https://en.wikipedia.org/wiki/Integration_testing">integration test</a> suite, something that <a href="https://www.cypress.io/">Cypress</a> excels in helping you build. Let’s see how we can use it to create the testing glue between the two applications.</p> <h2 id="internationalisation-in-elixirelm">Internationalisation in Elixir/Elm</h2> <p>The application under test is a very simple toy application that re-creates the <a href="http://tachyons.io/">Tachyons</a> <a href="http://tachyons.io/components/layout/full-screen-centered-title/index.html">Full Screen Centered Title component documentation page</a>, but adds a dropdown menu to change the language of the message on screen, and in the browser title.</p> <p><img src="/assets/images/2021-10-06/tachyons-elm.gif" alt="Tachyons App" title="Animated GIF of Tachyons page implemented in Elm"/></p> <blockquote> <p>The application codebases, and their companion blog posts, can be found at the following locations:</p> <table style="display: inline-table;"> <thead> <tr> <th style="text-align: left">Language</th> <th style="text-align: left">Application Codebase</th> <th style="text-align: left">Companion Blog Post</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Elixir/Phoenix</td> <td style="text-align: left"><a href="https://github.com/paulfioravanti/phx_i18n_example">Phoenix LiveView I18n Example</a></td> <td style="text-align: left"><em><a href="https://www.paulfioravanti.com/blog/internationalisation-phoenix-liveview/">Internationalisation with Phoenix LiveView</a></em></td> </tr> <tr> <td style="text-align: left">Elm</td> <td style="text-align: left"><a href="https://github.com/paulfioravanti/elm-i18n-example">Elm I18n Example</a></td> <td style="text-align: left"><em><a href="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/">Runtime Language Switching in Elm</a></em></td> </tr> </tbody> </table> </blockquote> <p>The entire feature set consists of the following use cases:</p> <ol> <li><strong>Initial language setting</strong> <ul> <li>When the application has a language setting, it displays a message and title in that language.</li> <li>When the language setting is set to an unknown language, or is left blank, English is displayed.</li> </ul> </li> <li><strong>The language menu</strong> <ul> <li>The default state for the menu is closed.</li> <li>If you click the current language, the menu opens.</li> <li>When the menu is open: <ul> <li>if you click the current language, the menu closes</li> <li>if you click anywhere else on the page, the menu closes</li> <li>if you click another language, the menu closes</li> </ul> </li> </ul> </li> <li><strong>Changing language</strong> <ul> <li>For any language selectable in the dropdown menu, when you click that language, the display of the page will change to that language</li> </ul> </li> <li><strong>Language setting storage</strong> <ul> <li>If you change the application language and refresh the browser, the application will remember that change and still display in your chosen language</li> </ul> </li> </ol> <p>These use cases will form the blueprint for creating some <a href="http://mochajs.org/">Mocha</a> and <a href="http://chaijs.com/">Chai</a>-based tests in Cypress.</p> <p>We will start off with the third scenario, changing languages, since it will introduce us to some building blocks of Cypress testing. Initially, we will also focus on testing a single application, the Elm one.</p> <p>Once we have some passing tests, we will leverage some of Cypress’ features to do some refactoring, make sure that the same test can exercise both the Elm and Elixir applications at the same time, and then build on our knowledge by moving on to the other scenarios</p> <blockquote> <p>Feel free to follow along with the finished application, located at the <a href="https://github.com/paulfioravanti/cypress-i18n-example">Cypress I18n Example</a> Github repository.</p> </blockquote> <h2 id="changing-language">Changing Language</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-june-july-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, mid June - 2 July 1889"/> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, mid June - 2 July 1889 </figcaption> </figure> </div> <p>After <a href="https://docs.npmjs.com/cli/init/">initialising a new Node JS application</a>, <a href="https://docs.cypress.io/guides/getting-started/installing-cypress">installing Cypress</a>, and making sure the Elm application is running, let’s create our first test to make sure we can switch language to Italian.</p> <blockquote> <p><a href="https://docs.cypress.io/api/table-of-contents">Cypress’ API documentation</a> is very user-friendly, so I will defer to you to reference it for any detailed explanations of Cypress-related functions you may see in the example code. I will only focus my commentary on application-specific logic, and any Cypress functionality I want to highlight.</p> </blockquote> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">Italiano</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>A few notes about this test:</p> <ul> <li>Since no language is initially set in this scenario, the application defaults to display in English</li> <li>An Elm application runs at <code class="language-plaintext highlighter-rouge">http://localhost:3000</code> by default</li> <li>Since we are testing a bare-bones toy application, many <a href="https://en.wikipedia.org/wiki/HTML">HTML</a> tags represent unique elements on a page (eg <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> for language menu), so we are able to target them by simply using commands like <a href="https://docs.cypress.io/api/commands/get"><code class="language-plaintext highlighter-rouge">cy.get()</code></a>, rather than needing more granular targets like <a href="https://www.w3schools.com/html/html_classes.asp">classes</a> or <a href="https://www.w3schools.com/html/html_id.asp">IDs</a>.</li> </ul> <p>Running the test within Cypress will look something like the following (but just note it has been slowed down significantly via <a href="https://github.com/cypress-io/cypress/issues/249#issuecomment-670028947">this technique</a>):</p> <figure> <img src="/assets/images/2021-10-06/change-language-italian-cypress.gif" alt="Change language to Italian passing test in Cypress"/> </figure> <p>Great! We have our first passing test, and a baseline case to create tests for the other scenarios. Thanks to this, testing for changing the language to Japanese is, for the most part, a reproduction job:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">日本語</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Elmにおける多言語化</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">CSSで垂直センタリングは簡単だよ！</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>The test for changing the language to English, though, will be slightly more involved, since we have to change the application language to be non-English before the test runs.</p> <p>The Elm application attempts to set the initial language by first checking <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code class="language-plaintext highlighter-rouge">localStorage</code></a> for a specific key/value pair. Since Cypress tests are run in a browser, we have direct access to <code class="language-plaintext highlighter-rouge">localStorage</code>, as well as other browser-related functionality.</p> <p>We can leverage that, and the Cypress <code class="language-plaintext highlighter-rouge">before()</code> <a href="https://docs.cypress.io/guides/core-concepts/writing-and-organizing-tests#Hooks">hook</a>, to make sure we can set the initial language within a nested test, even before the top level <code class="language-plaintext highlighter-rouge">beforeEach()</code> hook visits the application URL:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>
  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Start in a non-English language.</span>
      <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ja</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Okay, that’s our test suite for the use case done! Let’s run the tests!</p> <figure> <img src="/assets/images/2021-10-06/change-language-all-cypress.gif" alt="Changing languages passing test suite in Cypress"/> </figure> <p>Looks like they all pass, which is good, but looking at the test code, it does seem to look quite repetitive…</p> <p>It might be nice to clean them up by extracting out the logic involved to perform core testing actions, and explicitly giving those extractions names, like “click language menu” or “displays Japanese” etc.</p> <h2 id="custom-commands">Custom Commands</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-early-september-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, Early September 1889"/> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, Early September 1889 </figcaption> </figure> </div> <p>Using <a href="https://docs.cypress.io/api/cypress-api/custom-commands">Custom Commands</a>, we can define our own methods to use in the same way that Cypress uses its own API. When we set up Cypress, it provided us a file to put them in, so let’s fill it up with some methods to clean up the tests!</p> <p>We will start with some commands that wrap around logic related to the language menu:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickLanguageMenu</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">English</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickItalian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">Italiano</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickJapanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="dl">"</span><span class="s2">日本語</span><span class="dl">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">clickMenuLabel</span><span class="p">(</span><span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">).</span><span class="nx">contains</span><span class="p">(</span><span class="nx">label</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div> <p>The first argument in each of the commands is the name of the command that will become available to us in the tests, so let’s see how that looks:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickItalian</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>

  <span class="c1">// ...</span>
<span class="p">})</span>
</code></pre></div></div> <p>This looks okay for a first refactor, so let’s go ahead and add some other commands to deal with language display, and, while we are at it, language storage:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysItalian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Multilingualizzazione in Elm</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Centrare verticalmente con css è facile!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysJapanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Elmにおける多言語化</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">CSSで垂直センタリングは簡単だよ！</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="kd">function</span> <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="nx">title</span><span class="p">().</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">eq</span><span class="dl">"</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">).</span><span class="nx">should</span><span class="p">(</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">storeLanguage</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">"</span><span class="s2">elm-i18n-example-language</span><span class="dl">"</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div> <p>Back in the test file, here is an example of how we can use these commands, inside the test that changes the language to English:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">describe</span><span class="p">(</span><span class="dl">"</span><span class="s2">Changing language</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://localhost:3000</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
  <span class="p">})</span>

  <span class="c1">// ...</span>

  <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Start in a non-English language.</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">storeLanguage</span><span class="p">(</span><span class="dl">"</span><span class="s2">ja</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">})</span>

    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickEnglish</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysEnglish</span><span class="p">()</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Not bad…for tests that only need to deal with the Elm application. But, the aim is to be lazy and re-use these tests for the Elixir application as well!</p> <p>The Phoenix server runs by default on port <code class="language-plaintext highlighter-rouge">4000</code>, rather than <code class="language-plaintext highlighter-rouge">3000</code>, and it is application-specific information like this that we will need to dynamically inject into the tests in order to enable maximum laziness.</p> <p>It would be handy to define this kind of information somewhere outside the test suite, where it can be referenced when needed. Luckily, Cypress has just the place for it.</p> <h2 id="cypress-environment-variables">Cypress Environment Variables</h2> <p>Cypress offers a few different options to define <a href="https://docs.cypress.io/guides/guides/environment-variables">environment variables</a>.</p> <p>The one we will use is defining an application root-level <a href="https://docs.cypress.io/guides/guides/environment-variables#Option-2-cypress-env-json"><code class="language-plaintext highlighter-rouge">cypress.env.json</code></a> file, which will contain static information about each application, as well as the language codes common across both applications:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress.env.json</code></strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"ENGLISH_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ITALIAN_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"it"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"JAPANESE_LANGUAGE"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ja"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"APPLICATIONS"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elm-i18n-example"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:3000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"storageKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elm-i18n-example-language"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phx_i18n_example"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:4000"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"storageKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phxi18nexamplelanguage"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>As well as the <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">storageKey</code> for each application, we have added an application <code class="language-plaintext highlighter-rouge">name</code> identifier, as there are some test commands that will need to know which application is currently under test in order to correctly perform some action.</p> <p>Variables defined in <code class="language-plaintext highlighter-rouge">cypress.env.json</code> can be accessed via <a href="https://docs.cypress.io/api/cypress-api/env"><code class="language-plaintext highlighter-rouge">Cypress.env</code></a>, so let’s see how the changing language test file we have been working on changes in order to accommodate multiple applications:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/integration/changing_language.spec.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">APPLICATIONS</span><span class="p">,</span> <span class="nx">JAPANESE_LANGUAGE</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">()</span>

<span class="nx">APPLICATIONS</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">url</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">describe</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">name</span><span class="p">}</span><span class="s2">: changing language`</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
      <span class="nx">cy</span><span class="p">.</span><span class="nx">clickLanguageMenu</span><span class="p">()</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickItalian</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Italian</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysItalian</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickJapanese</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays Japanese</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysJapanese</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>

    <span class="nx">context</span><span class="p">(</span><span class="dl">"</span><span class="s2">to English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">before</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Start in a non-English language.</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">storeLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">JAPANESE_LANGUAGE</span><span class="p">)</span>
      <span class="p">})</span>

      <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">clickEnglish</span><span class="p">()</span>
      <span class="p">})</span>

      <span class="nx">it</span><span class="p">(</span><span class="dl">"</span><span class="s2">displays English</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nx">displaysEnglish</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>And, we now have a passing set of tests that cover both applications!</p> <figure> <img src="/assets/images/2021-10-06/change-language-all-apps-cypress.gif" alt="Changing languages passing test suite in Cypress for both apps"/> </figure> <p>Note how the address in the browser changes from the Elm application on port <code class="language-plaintext highlighter-rouge">3000</code>, to the Phoenix application on port <code class="language-plaintext highlighter-rouge">4000</code>.</p> <p>While we did not need to make any changes regarding the way that the language menu and language options are clicked between the applications, there are slight differences in how each application displays messages for a language, and how it remembers a language choice.</p> <p>As mentioned above, this has resulted in the need for some custom commands to accept the <code class="language-plaintext highlighter-rouge">name</code> parameter from the config, so let’s see how it is being used.</p> <h2 id="application-dependent-commands">Application-Dependent Commands</h2> <p>First up are the “displays language” set of commands. They have all changed in the same way, so we will just have a look at <code class="language-plaintext highlighter-rouge">displaysEnglish</code> as an example (check the application codebase for details of the other commands):</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">ELM_APP_NAME</span> <span class="p">}]</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="dl">"</span><span class="s2">APPLICATIONS</span><span class="dl">"</span><span class="p">)</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">displaysEnglish</span><span class="dl">"</span><span class="p">,</span> <span class="nx">appName</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span>
    <span class="nx">appName</span> <span class="o">===</span> <span class="nx">ELM_APP_NAME</span>
      <span class="p">?</span> <span class="dl">"</span><span class="s2">Multilingualisation in Elm</span><span class="dl">"</span>
      <span class="p">:</span> <span class="dl">"</span><span class="s2">Multilingualisation in Phoenix</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Vertically centering things in css is easy!</span><span class="dl">"</span>
  <span class="nx">displays</span><span class="p">(</span><span class="nx">title</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div> <p>The only display difference between the two applications is the page title content, so we do a simple <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Conditional_Operator">ternary expression</a> to decide which title to use.</p> <p>How about storing the language for future reference? Although I used <code class="language-plaintext highlighter-rouge">localStorage</code> for the Elm application, I opted to instead use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies">cookies</a> in the Phoenix application, so that I could keep as much logic as possible in Elixir, and not have to write any Javascript in <a href="https://hexdocs.pm/phoenix_live_view/js-interop.html#client-hooks">LiveView Hooks</a>.</p> <p>Cypress has an easy-to-use <a href="https://docs.cypress.io/api/commands/setcookie"><code class="language-plaintext highlighter-rouge">setCookie</code></a> API, and so adapting the <code class="language-plaintext highlighter-rouge">storeLanguage</code> custom command to handle the Phoenix application was very straightforward:</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="nx">ELM_APP_NAME</span><span class="p">,</span> <span class="na">storageKey</span><span class="p">:</span> <span class="nx">ELM_STORAGE_KEY</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">storageKey</span><span class="p">:</span> <span class="nx">PHX_STORAGE_KEY</span> <span class="p">}</span>
<span class="p">]</span> <span class="o">=</span> <span class="nx">Cypress</span><span class="p">.</span><span class="nx">env</span><span class="p">(</span><span class="dl">"</span><span class="s2">APPLICATIONS</span><span class="dl">"</span><span class="p">)</span>

<span class="c1">// ...</span>

<span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">storeLanguage</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">appName</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">appName</span> <span class="o">===</span> <span class="nx">ELM_APP_NAME</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">ELM_STORAGE_KEY</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nx">setCookie</span><span class="p">(</span><span class="nx">PHX_STORAGE_KEY</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div> <p>I did end up doing some further refactoring of the commands, like splitting them out into different files by functionality, and extracting static string values into their own file. If you are interested in those changes, see the <a href="https://github.com/paulfioravanti/cypress-i18n-example/tree/main/cypress/support"><code class="language-plaintext highlighter-rouge">support</code> directory</a> of the <a href="https://github.com/paulfioravanti/cypress-i18n-example">Cypress I18n Example</a> application.</p> <h2 id="all-green">All Green</h2> <p>Most of the other tests in the suite are quite similar in format to <code class="language-plaintext highlighter-rouge">changing_language.spec.js</code>, and build off of functionality that we have already seen. So, I will leave it to any interested parties to have a look at the rest of the test suite in detail.</p> <p>Suffice to say, that all the tests do pass, and you should be able to see below a test for every feature described in the use case set towards the top of this post:</p> <div> <figure> <img src="/assets/images/2021-10-06/full-test-suite-all-apps-cypress.gif" alt="Full passing test suite in Cypress for both apps"/> </figure> </div> <p>There is one <a href="https://www.merriam-webster.com/dictionary/gotcha">gotcha</a>, though, that is worth bringing up: the applications would seem to sometimes inexplicably fail to register clicks on the language menu when the suite ran at full speed. This resulted in tests randomly failing, and much frustration and confusion on my part.</p> <p>Trawling through the <a href="https://github.com/cypress-io/cypress">Cypress GitHub repository</a> surfaced <a href="https://github.com/cypress-io/cypress/issues/1847">this issue</a>, seemingly indicating that there was a time where clicks were not being registered properly due to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseover_event"><code class="language-plaintext highlighter-rouge">mouseover</code> events</a> not being fired. <a href="https://github.com/cypress-io/cypress/issues/1847#issuecomment-447996153">The workaround</a> was to manually fire the event before clicking using <code class="language-plaintext highlighter-rouge">.trigger("mouseover").click()</code>.</p> <p><a href="https://github.com/cypress-io/cypress/pull/3030">This pull request</a> introduced automatic firing of <code class="language-plaintext highlighter-rouge">mouseover</code> events for clicks, but only for clickable input tags like <code class="language-plaintext highlighter-rouge">&lt;button&gt;</code>s. The language menu in our application is a <code class="language-plaintext highlighter-rouge">&lt;p&gt;</code> tag, so it does not benefit from auto-firing <code class="language-plaintext highlighter-rouge">mouseover</code> events, but manually adding that to the <code class="language-plaintext highlighter-rouge">clickLanguageMenu</code> command fixed the issue (and gave me a new rule-of-thumb for clicking elements in Cypress):</p> <p><strong><code class="language-plaintext highlighter-rouge">cypress/support/commands.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Cypress</span><span class="p">.</span><span class="nx">Commands</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">clickLanguageMenu</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">cy</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">p</span><span class="dl">"</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="dl">"</span><span class="s2">mouseover</span><span class="dl">"</span><span class="p">).</span><span class="nx">click</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div> <h2 id="cypress-vs-phoenix-tests-vs-elm-tests">Cypress vs Phoenix Tests vs Elm Tests</h2> <div class="centered-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-10-06/van-gogh-wheatfield-with-cypresses-late-september-1889.jpg" alt="A Wheatfield with Cypresses, Vincent Van Gogh, Late September 1889"/> <figcaption> "A Wheatfield with Cypresses", Vincent Van Gogh, Late September 1889 </figcaption> </figure> </div> <p>Remember when I said that the reason for creating the Cypress test suite was that “I am too lazy to write a separate test suite in each application’s language”?</p> <p>Well, writing this blog post ended up baiting me into writing them anyway.</p> <p>I wanted to see how much of the Cypress tests I could actually replicate in the respective application languages. You can find the tests in their Github repositories:</p> <ul> <li><a href="https://github.com/paulfioravanti/phx_i18n_example/tree/master/test/phx_i18n_example_web/integration">Phoenix LiveView integration tests</a></li> <li><a href="https://github.com/paulfioravanti/elm-i18n-example/tree/master/tests">Elm integration tests</a></li> </ul> <p>So, how do each of these test suites fare? Let’s take a look at each language’s equivalent of the “displays English” test from <code class="language-plaintext highlighter-rouge">changing_language.spec.js</code> and do a bit of compare and contrast.</p> <h3 id="phoenix-liveview-tests">Phoenix LiveView Tests</h3> <p>Since the Phoenix application uses <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html">LiveView</a>, which “enables rich, real-time user experiences with server-rendered HTML”, we leverage the <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html"><code class="language-plaintext highlighter-rouge">Phoenix.LiveViewTest</code></a> module to create our tests.</p> <p>Unlike Cypress, Phoenix tests are not run in a browser (<a href="https://github.com/elixir-wallaby/wallaby">Wallaby</a> is the tool for that in Elixir-land). Rather, we start off with a socket connection (<code class="language-plaintext highlighter-rouge">conn</code>, a <a href="https://hexdocs.pm/plug/Plug.Conn.html"><code class="language-plaintext highlighter-rouge">Plug.Conn</code></a>), and use <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html#live/2"><code class="language-plaintext highlighter-rouge">live/2</code></a> to spawn a stateful LiveView process (<code class="language-plaintext highlighter-rouge">view</code>), that we can then interact with like we would a web page:</p> <p><strong><code class="language-plaintext highlighter-rouge">test/phx_i18n_example_web/integration/changing_language_test.exs</code></strong></p> <div class="language-elixir highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">defmodule</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">ChangingLanguageTest</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="no">PhxI18nExampleWeb</span><span class="o">.</span><span class="no">ConnCase</span>
  <span class="kn">import</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">ConnTest</span>
  <span class="kn">import</span> <span class="no">Phoenix</span><span class="o">.</span><span class="no">LiveViewTest</span>

  <span class="n">setup</span> <span class="p">%{</span><span class="ss">conn:</span> <span class="n">conn</span><span class="p">,</span> <span class="ss">language:</span> <span class="n">language</span><span class="p">,</span> <span class="ss">cookie:</span> <span class="n">cookie</span><span class="p">}</span> <span class="k">do</span>
    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">_html</span><span class="p">}</span> <span class="o">=</span>
      <span class="n">conn</span>
      <span class="o">|&gt;</span> <span class="n">put_req_cookie</span><span class="p">(</span><span class="s2">"phxi18nexamplelanguage"</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="n">live</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>

    <span class="n">view</span>
    <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"p"</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">render_click</span><span class="p">()</span>

    <span class="n">view</span>
    <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"li"</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">render_click</span><span class="p">()</span>

    <span class="n">heading</span> <span class="o">=</span>
      <span class="n">view</span>
      <span class="o">|&gt;</span> <span class="n">element</span><span class="p">(</span><span class="s2">"h1"</span><span class="p">)</span>
      <span class="o">|&gt;</span> <span class="n">render</span><span class="p">()</span>

    <span class="p">{</span><span class="ss">:ok</span><span class="p">,</span> <span class="p">[</span><span class="ss">heading:</span> <span class="n">heading</span><span class="p">,</span> <span class="ss">title:</span> <span class="n">page_title</span><span class="p">(</span><span class="n">view</span><span class="p">)]}</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>

  <span class="nv">@tag</span> <span class="ss">cookie:</span> <span class="s2">"ja"</span>
  <span class="nv">@tag</span> <span class="ss">language:</span> <span class="s2">"English"</span>
  <span class="n">test</span> <span class="s2">"displays English when language changed to English"</span><span class="p">,</span>
       <span class="p">%{</span><span class="ss">heading:</span> <span class="n">heading</span><span class="p">,</span> <span class="ss">title:</span> <span class="n">title</span><span class="p">}</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="n">heading</span> <span class="o">=~</span> <span class="s2">"Vertically centering things in css is easy!"</span>
    <span class="n">assert</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">"Multilingualisation in Phoenix"</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Since we are not working with a browser, we have to inject the language cookie value directly into the raw connection, using <a href="https://hexdocs.pm/plug/Plug.Test.html#put_req_cookie/3"><code class="language-plaintext highlighter-rouge">put_req_cookie/3</code></a>, in order to change the LiveView’s <code class="language-plaintext highlighter-rouge">language</code> (passed up to <code class="language-plaintext highlighter-rouge">setup</code> from the <code class="language-plaintext highlighter-rouge">@tag</code> attribute on the test) to English.</p> <p>From there, we perform <a href="https://hexdocs.pm/phoenix_live_view/Phoenix.LiveViewTest.html#render_click/1"><code class="language-plaintext highlighter-rouge">render_click/1</code></a> actions to open the language dropdown menu, select a language, and then extract the LiveView page title and heading to send into the test itself.</p> <p>For testing LiveViews in isolation, I think these kinds of tests are absolutely fine. However, where I think Cypress does get an upper hand in this use case, and some others in the application, is, as you may expect, related to its tests being run in a browser:</p> <ul> <li>No manual injection of cookies are needed into the application; Cypress can set cookie values directly in the browser, which the application can then read in and use</li> <li>Once the language is set, Cypress is able to <a href="https://docs.cypress.io/api/commands/reload"><code class="language-plaintext highlighter-rouge">cy.reload()</code></a> the browser to confirm that the new language is set in the cookies (check the Github repo for that test), but doing something like checking whether a cookie value has been changed in a <code class="language-plaintext highlighter-rouge">conn</code> is not feasible, and LiveViews cannot be “reloaded”</li> </ul> <h3 id="elm-tests">Elm Tests</h3> <p><a href="https://guide.elm-lang.org/architecture/">The Elm Architecture</a> (TEA) breaks Elm applications up into three parts:</p> <ul> <li>Model — the state of your application</li> <li>View — a way to turn your state into HTML</li> <li>Update — a way to update your state based on messages</li> </ul> <p>When attempting to write an “integration test” in Elm, you are able to initialise a model and pass it into a view to render.</p> <p>However, unlike a LiveView, it is not possible to trigger multiple events on a view (eg click language dropdown, <em>and then</em> select a language) that then updates the state of a model, or the view itself, so that assertions can be made on it.</p> <p>It is not even possible to do this for a single event: the only assertions we can make based off of an event being triggered are <em>that</em> a certain type of message gets generated.</p> <p>For example, in the test below we:</p> <ul> <li>Initialise a model using <code class="language-plaintext highlighter-rouge">Main.init</code></li> <li>Change the model values to indicate that the language menu should be open (<code class="language-plaintext highlighter-rouge">showAvailableLanguages = True</code>), and that the current language is Italian ( the <code class="language-plaintext highlighter-rouge">Translations.It</code> type)</li> <li>Render the model in the view and find <code class="language-plaintext highlighter-rouge">"English"</code> from the language dropdown menu</li> <li><a href="https://package.elm-lang.org/packages/elm-explorations/test/latest/Test-Html-Event#simulate"><code class="language-plaintext highlighter-rouge">Event.Simulate</code></a> a <code class="language-plaintext highlighter-rouge">click</code></li> <li>Assert that a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.En</code> message gets generated</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">tests/ChangingLanguageTest.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ChangingLanguageTest</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">all</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Html</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">null</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Main</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Test</span><span class="o">,</span> <span class="n">describe</span><span class="o">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Event</span> <span class="k">as</span> <span class="kt">Event</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">click</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Query</span> <span class="k">as</span> <span class="kt">Query</span>
<span class="k">import</span> <span class="kt">Test</span><span class="o">.</span><span class="kt">Html</span><span class="o">.</span><span class="kt">Selector</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">containing</span><span class="o">,</span> <span class="n">tag</span><span class="o">,</span> <span class="n">text</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span>
<span class="k">import</span> <span class="kt">View</span>


<span class="n">all</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">all</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="n">_</span> <span class="p">)</span> <span class="o">=</span>
            <span class="kt">Main</span><span class="o">.</span><span class="n">init</span> <span class="p">{</span> <span class="n">language</span> <span class="o">=</span> <span class="n">null</span> <span class="p">}</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Changing language"</span>
        <span class="p">[</span> <span class="c1">-- ...</span>
        <span class="o">,</span> <span class="n">changeLanguageToEnglishTest</span> <span class="n">model</span>
        <span class="p">]</span>


<span class="c1">-- ...</span>


<span class="n">changeLanguageToEnglishTest</span> <span class="p">:</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Test</span>
<span class="n">changeLanguageToEnglishTest</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">initModel</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">initModel</span> <span class="o">=</span>
            <span class="p">{</span> <span class="n">model</span>
                <span class="o">|</span> <span class="n">showAvailableLanguages</span> <span class="o">=</span> <span class="kt">True</span>
                <span class="o">,</span> <span class="n">currentLanguage</span> <span class="o">=</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>
            <span class="p">}</span>

        <span class="n">html</span> <span class="p">:</span> <span class="kt">Html</span> <span class="kt">Msg</span>
        <span class="n">html</span> <span class="o">=</span>
            <span class="n">initModel</span>
                <span class="o">|&gt;</span> <span class="kt">View</span><span class="o">.</span><span class="n">view</span>
                <span class="o">|&gt;</span> <span class="o">.</span><span class="n">body</span>
                <span class="o">|&gt;</span> <span class="kt">List</span><span class="o">.</span><span class="n">head</span>
                <span class="o">|&gt;</span> <span class="kt">Maybe</span><span class="o">.</span><span class="n">withDefault</span> <span class="p">(</span><span class="kt">Html</span><span class="o">.</span><span class="n">text</span> <span class="s">"</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">changing the language to English"</span>
        <span class="p">[</span> <span class="n">test</span> <span class="s">"</span><span class="s2">sends a message to change the language to English"</span> <span class="o">&lt;|</span>
            <span class="o">\</span><span class="p">()</span> <span class="o">-&gt;</span>
                <span class="n">html</span>
                    <span class="o">|&gt;</span> <span class="kt">Query</span><span class="o">.</span><span class="n">fromHtml</span>
                    <span class="o">|&gt;</span> <span class="kt">Query</span><span class="o">.</span><span class="n">find</span> <span class="p">[</span> <span class="n">tag</span> <span class="s">"</span><span class="s2">li"</span><span class="o">,</span> <span class="n">containing</span> <span class="p">[</span> <span class="n">text</span> <span class="s">"</span><span class="s2">English"</span> <span class="p">]</span> <span class="p">]</span>
                    <span class="o">|&gt;</span> <span class="kt">Event</span><span class="o">.</span><span class="n">simulate</span> <span class="n">click</span>
                    <span class="o">|&gt;</span> <span class="kt">Event</span><span class="o">.</span><span class="n">expect</span> <span class="p">(</span><span class="kt">Msg</span><span class="o">.</span><span class="kt">ChangeLanguage</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">En</span><span class="p">)</span>
        <span class="p">]</span>
</code></pre></div></div> <p>From here, if we want to find out what should happen when Elm receives a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.En</code> message, we need to write a specific Update-focused test which:</p> <ul> <li>Initialises a model with its language setting as English (<code class="language-plaintext highlighter-rouge">Translations.En</code>)</li> <li>Initialises a <code class="language-plaintext highlighter-rouge">Msg.ChangeLanguage Translations.It</code> message</li> <li>Passes the model and message into the Update function</li> <li>Asserts that the language in the model has changed from Italian to English</li> </ul> <p><strong><code class="language-plaintext highlighter-rouge">tests/UpdateTest.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">UpdateTest</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">all</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Expect</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Test</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Test</span><span class="o">,</span> <span class="n">describe</span><span class="o">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Translations</span>
<span class="k">import</span> <span class="kt">Update</span>


<span class="n">all</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">all</span> <span class="o">=</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Update"</span>
        <span class="p">[</span> <span class="n">changeLanguageTest</span>
        <span class="o">,</span> <span class="c1">-- ...</span>
        <span class="p">]</span>


<span class="n">changeLanguageTest</span> <span class="p">:</span> <span class="kt">Test</span>
<span class="n">changeLanguageTest</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">msg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="n">msg</span> <span class="o">=</span>
            <span class="kt">Msg</span><span class="o">.</span><span class="kt">ChangeLanguage</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>

        <span class="n">model</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">model</span> <span class="o">=</span>
            <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">En</span>

        <span class="p">(</span> <span class="n">actualModel</span><span class="o">,</span> <span class="n">_</span> <span class="p">)</span> <span class="o">=</span>
            <span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">msg</span> <span class="n">model</span>

        <span class="n">expectedModel</span> <span class="p">:</span> <span class="kt">Model</span>
        <span class="n">expectedModel</span> <span class="o">=</span>
            <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="kt">Translations</span><span class="o">.</span><span class="kt">It</span>
    <span class="k">in</span>
    <span class="n">describe</span> <span class="s">"</span><span class="s2">Msg.ChangeLanguage"</span>
        <span class="p">[</span> <span class="n">test</span> <span class="s">"</span><span class="s2">updates the model to the specified language"</span> <span class="o">&lt;|</span>
            <span class="o">\</span><span class="p">()</span> <span class="o">-&gt;</span>
                <span class="kt">Expect</span><span class="o">.</span><span class="n">equal</span> <span class="n">expectedModel</span> <span class="n">actualModel</span>
        <span class="p">]</span>
</code></pre></div></div> <p>Similar to my opinions about the Elixir tests, I think these tests are totally fine for testing parts of an Elm application in isolation.</p> <p>There are some other Elm options to enable testing programs as more complete units, negating the need to divide up tests, like <a href="https://github.com/avh4/elm-program-test">elm-program-test</a> (does not drive a web browser), or <a href="https://github.com/justgook/elm-webdriver">Elm-WebDriver</a> (drives a web browser), so there are other options outside of Elm’s default testing paradigms.</p> <p>However, for similar reasons as the Elixir tests, I think there is a strong case for involving Cypress’ power and flexibility in the testing mix for Elm applications.</p> <h2 id="an-aside-testing-internationalisation">An Aside: Testing Internationalisation</h2> <p>The purpose of the Phoenix and Elm I18n example applications are just that: to be toy applications that provide example implementations of using internationalisation in those languages.</p> <p>Showing that text changes on a screen as a result of a language setting changing is their key functionality, and this is reflected in how the tests are written.</p> <p>For a real application containing many translated text entries in different locations in multiple languages, the string-based testing used in these test suites is not really feasible. The burden of having to update tests whenever translations are updated will get tiresome quickly; translations and tests are best being able to change independent of each other.</p> <p>Instead, it is much more helpful to have some kind of external tool that can run over your codebase and translation files to inform you on whether:</p> <ul> <li>you have any missing translations in certain languages</li> <li>you have translations for strings that are not referenced in the application anymore (ie they are obsolete)</li> </ul> <p>My favourite local developer tool I have used in the past to do this has actually been a <a href="https://www.ruby-lang.org/en/">Ruby</a> gem, <a href="https://glebm.github.io/i18n-tasks/">i18n-tasks</a>. If you do <a href="https://rubyonrails.org/">Ruby on Rails</a> development with internationalisation, definitely add it to your toolbox.</p> <p>There does not seem to be quite as robust a tool in the Phoenix or Elm ecosystems as of this writing, but there are other options available.</p> <p>For a Phoenix application, it would seem that you can “verify that your <a href="https://en.wikipedia.org/wiki/Gettext#Programming">POT files</a> are up to date with the current state of the codebase” with a <a href="https://hexdocs.pm/gettext/Mix.Tasks.Gettext.Extract.html#content"><code class="language-plaintext highlighter-rouge">mix gettext.extract</code></a> task:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix gettext.extract <span class="nt">--check-up-to-date</span>
</code></pre></div></div> <blockquote> <p>This task is in the <a href="https://github.com/elixir-gettext/gettext/blob/becf0585b12762bddb6dd04a9f0a307c8768fa1a/lib/mix/tasks/gettext.extract.ex#L23">Elixir Gettext <code class="language-plaintext highlighter-rouge">master</code> branch</a> as of this writing, so by the time you read this, it may have been released on <a href="https://hex.pm/">Hex</a>.</p> </blockquote> <p>For Elm, the situation is a bit more complex (that I go into in much more detail in <em><a href="https://www.paulfioravanti.com/blog/runtime-language-switching-elm/">Runtime Language Switching in Elm</a></em>) but I would currently recommend <a href="https://github.com/ChristophP/elm-i18n-module-generator">Elm i18n Gen</a> to give some type safety to your translations.</p> <h2 id="paint-some-cypress-tests">Paint some Cypress tests</h2> <p>I have found writing and running integration tests with Cypress to be lots of fun, and think there is definitely a place for them alongside more unit-focused tests in your programming language of choice.</p> <p>The visual feedback Cypress can provide for high-value application workflows like account sign-up, or making a payment, make the tests something that can also be shared with non-technical areas of your team or business.</p> <p>If you have not used Cypress already, I would encourage you to give it a shot, and walk through your application in the shoes of your end users!</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="javascript"/><category term="mocha"/><category term="chai"/><category term="cypress"/><category term="elixir"/><category term="phoenix"/><category term="elm"/><category term="testing"/><category term="i18n"/><summary type="html"><![CDATA["I have a canvas of Cypress tests with apps of Elm, some Elixir, a browser like a preview of executed commands"]]></summary></entry><entry><title type="html">Plover For the Record</title><link href="https://www.paulfioravanti.com/blog/plover-for-the-record/" rel="alternate" type="text/html" title="Plover For the Record"/><published>2021-09-04T16:00:00+10:00</published><updated>2022-03-25T17:00:00+11:00</updated><id>https://www.paulfioravanti.com/blog/plover-for-the-record</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/plover-for-the-record/"><![CDATA[<p>Dictation testing involving cross-examination of a witness by lawyers in a courtroom is known colloquially in the <a href="https://en.wikipedia.org/wiki/Court_reporter">court reporting</a> profession as “<a href="http://ilovesteno.com/2014/02/03/the-different-types-of-q-a/">Q&amp;A</a>” (Question and Answer).</p> <p>With <a href="http://www.openstenoproject.org/">Plover</a> open source <a href="https://en.wikipedia.org/wiki/Stenotype">stenography</a>, you can <a href="https://en.wikipedia.org/wiki/Cosplay">cosplay</a> as a court reporter, show off your ability to track the communication threads of multiple participants in a courtroom conversation, and present them in official-looking transcripts of testimony.</p> <p>So, put on your power suit and pack your briefcase, cause we’re going to go and act like we belong in the halls of justice!</p> <h3 id="caveat-lector"><em><a href="https://en.wikipedia.org/wiki/Caveat_emptor#Caveat_lector">Caveat Lector</a></em></h3> <p>I am not a lawyer, a court reporter, nor involved in the legal profession whatsoever. I am just a stenography enthusiast who learned about the concept of Q&amp;A while studying <a href="https://platinumsteno.com/">Platinum Steno</a>’s (PS) <a href="https://www.youtube.com/playlist?list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU">video theory lessons</a> (more about that in my other blog post, <em><a href="https://www.paulfioravanti.com/blog/going-platinum/">Going Platinum</a></em>), and what is presented here is just my interpretation of what I discovered. Consequently, there is definitely a chance that I have gotten some things wrong, and if I have, please reach out via public comment below, or to me directly.</p> <p>Plover theory itself does not contain any <a href="https://sites.google.com/site/learnplover/glossary">outlines</a> related to Q&amp;A like the ones that would seem to be contained in PS’s custom software, and are taught in their <a href="https://www.youtube.com/watch?v=tEgaJ7hWIvg&amp;list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU&amp;index=61">Q&amp;A lessons</a>. So, in order to actively engage in those lessons, I wondered if I could attempt to recreate PS’s Q&amp;A outline entries (including their formatting conventions and rules, which may be specific to them, and differ between courts in different hierarchies/states/jurisdictions/countries etc) in a custom dictionary that would work with Plover.</p> <p>I think I was able to, and have presented the result <em><a href="https://en.wikipedia.org/wiki/Pro_bono">pro bono publico</a></em> in the form of:</p> <p>:sparkles: <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/q-and-a.json">My custom Q&amp;A dictionary</a> :sparkles:</p> <p>Feel free to incorporate it into your own Plover dictionaries and give the Q&amp;A lessons a shot, or just use it to follow along with the examples in this post!</p> <p>Armed with a dictionary to use, let’s learn how to use it, while getting an introduction to Q&amp;A itself!</p> <h2 id="ab-initio"><em><a href="https://en.wikipedia.org/wiki/Ab_initio">Ab Initio</a></em></h2> <p>There are, broadly, two different types of Q&amp;A testing:</p> <ul> <li><strong>2-Voice</strong>: an interrogative conversation between two participants: a lawyer and a witness. The lawyer can be either for the <a href="https://en.wikipedia.org/wiki/Plaintiff">plaintiff</a>/prosecution, or for the defense, but this detail is usually not relevant to the scope of the conversation.</li> <li><strong>4-Voice</strong>: a cross-examination involving lawyers from each opposing party, a witness, and the courtroom judge. Handling multiple lawyers in either party is possible, so it can technically be “4-to-6-Voice”, but there are typically only four participants.</li> </ul> <p>2-Voice transcripts typically read like a simple back-and-forth question and answer session, while 4-Voice builds on this by including added complexity like:</p> <ul> <li>marking a lawyer’s “ownership” of a line of questioning</li> <li>transcribing objections raised by lawyers, and subsequent guidance by the judge</li> <li>specific transcribing conventions for when interruptions occur during a lawyer’s line of questioning, causing it to veer off its original path, and then the subsequent “steering” of the record back to original line of questioning once the detour has ended</li> </ul> <p>We will start off with a deep dive into using Plover for 2-Voice, and then up ante with 4-Voice.</p> <h2 id="2-voice">2-Voice</h2> <div class="plover-for-the-record-image"> <figure> <img src="/assets/images/2021-09-04/phoenix-and-maya.jpg" alt="Phoenix Wright and Maya cosplay"/> <figcaption> Photo by <a href="https://www.deviantart.com/vivienovo"> VivianOVO </a> on <a href="https://www.deviantart.com/vivienovo/art/Ace-Attorney-Maya-Fey-347872629"> Deviant Art </a> </figcaption> </figure> </div> <p>During Q&amp;A, whenever someone starts speaking, you indicate this by “signing them in”, either by name, or marking them as the asker or answerer of a question.</p> <p>For 2-Voice, names are not important, and we only care about marking the question and its answer. Questioners and answerers are “signed in” using special outlines known as question and answer “banks”, which PS defines as follows:</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> </tr> </thead> <tr> <td>Question Bank</td> <td class="steno-outline"> <span>STKPWHR</span> </td> <td class="steno-font"> <span>STKPWHR</span> </td> </tr> <tr> <td>Answer Bank</td> <td class="steno-outline"> <span>-FRPBLGTS</span> </td> <td class="steno-font"> <span>-FRPBLGTS</span> </td> </tr> </table> <p>These outlines, like nearly all Q&amp;A-related outlines, are not meant to be <a href="https://en.wikipedia.org/wiki/Phonetics">phonetic</a> (indicative of how the word sounds), nor <a href="https://en.wikipedia.org/wiki/Orthography">orthographic</a> (indicative of how the word is spelled). So, I find it easiest to remember their form, or pattern, kind of like <a href="https://en.wikipedia.org/wiki/Tetris">Tetris</a> blocks. Hence, I would wager the rectangular chunks here are meant to evoke an image of land masses along the side of the middle <code class="language-plaintext highlighter-rouge">*</code>-key river that divides them.</p> <p>Using these outlines, a simple question and answer could display as something like the following:</p> <p class="steno-transcript"> &nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;&nbsp;Where were you on the night of January 16?<br/> &nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;I was at home, practicing steno. </p> <p>This formatting obeys the following rules:</p> <ul> <li>Questions are marked with a simple “<span class="steno-transcript">Q</span>”, and answers with an “<span class="steno-transcript">A</span>” (no following colons or periods)</li> <li><span class="steno-transcript">Q</span> and <span class="steno-transcript">A</span> have a <a href="https://en.wikipedia.org/wiki/Tab_key">tab</a> character on either side of them</li> <li>Both questions and answers start with capital letters</li> </ul> <p>Court transcripts would seem to be written using a <span class="steno-transcript"><a href="https://en.wikipedia.org/wiki/Monospaced_font">monospaced font</a></span>, so we will adopt that convention as well, using the widely-available <span class="steno-transcript">Courier New</span> font.</p> <h3 id="ending-punctuation">Ending Punctuation</h3> <p>The one thing that is not apparent just by looking at the example above is the convention around a speaker’s <em>final sentence</em> punctuation before another speaker starts talking.</p> <p>Apparently, in Q&amp;A, the addition of an ending question mark (<span class="steno-transcript">?</span>) or period (<span class="steno-transcript">.</span>) to the <em>final sentence</em> spoken before the speaker changes is meant to be handled by the outline that signs in the next speaker.</p> <p>For example, when you switch from a question to an answer by stroking <code class="language-plaintext highlighter-rouge">-FRPBLGTS</code>, that outline is expected to:</p> <ul> <li>Finish the question with a “<span class="steno-transcript">?</span>”</li> <li>Perform a <a href="https://en.wikipedia.org/wiki/Newline">line break</a></li> <li>insert a tab</li> <li>type <span class="steno-transcript">A</span></li> <li>insert another tab</li> <li>make sure the next word will start with a capital letter</li> </ul> <p>The rule is the same when switching from an answer back to a question, but with an ending “<span class="steno-transcript">.</span>” and a beginning <span class="steno-transcript">Q</span>.</p> <p>Regarding this ending punctuation rule, PS says that the (presumably custom) software they use on their steno machines makes some kind of automatic determination about whether a question was asked or an answer given, and adds in appropriate question/answer punctuation as it deems appropriate.</p> <p>PS does say that this determination is not perfect, and hence you may end up with question marks at the end of answers, or periods that the end of questions (which may be correct for the sentence sometimes since lawyers can make statements, and witnesses can ask questions). The workaround to this issue, it would seem, is to just fix the punctuation <em><a href="https://en.wikipedia.org/wiki/Post_hoc">post-hoc</a></em> when you proofread your transcript.</p> <p>Plover itself has no built-in knowledge of any kind of “Q&amp;A-related ending punctuation automatic determination functionality”, so I attempted to mostly replicate the PS software logic into my custom Q&amp;A dictionary, but also make a few quality-of-life improvements. The aim was to provide sensible defaults for ending punctuation, but also allow for manual overriding for when you want to explicitly specify what they should be.</p> <p>With that in mind, here is a set of outlines I came up with to perform 2-Voice in a more flexible way:</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Notes</th> </tr> </thead> <tr> <td>Default Question Bank</td> <td class="steno-outline"> <span>STKPWHR</span> </td> <td class="steno-font"> <span>STKPWHR</span> </td> <td> Ends previous witness sentence with "<span class="steno-transcript">.</span>" </td> </tr> <tr> <td>Initial Question Bank</td> <td class="steno-outline"> <span>STKPWHR*</span> </td> <td class="steno-font"> <span>STKPWHR*</span> </td> <td> Question is the first line of transcript; no previous sentence punctuation needed. </td> </tr> <tr> <td>Question Bank following question</td> <td class="steno-outline"> <span>STKPWHR-F</span> </td> <td class="steno-font"> <span>STKPWHR-F</span> </td> <td> Ends previous witness sentence with "<span class="steno-transcript">?</span>", for when witness asks a question. </td> </tr> <tr> <td>Interrupting Question Bank</td> <td class="steno-outline"> <span>STKPWHR-RB</span> </td> <td class="steno-font"> <span>STKPWHR-RB</span> </td> <td> Ends previous witness sentence with "<span class="steno-transcript">--</span>" for when lawyer interrupts witness. </td> </tr> <tr> <td>Question Bank following statement</td> <td class="steno-outline"> <span>STKPWHR-R</span> </td> <td class="steno-font"> <span>STKPWHR-R</span> </td> <td> Ends previous witness sentence with "<span class="steno-transcript">.</span>" (same as Default Question Bank, added for completeness' sake) </td> </tr> <tr> <td>Default Answer Bank</td> <td class="steno-outline"> <span>-FRPBLGTS</span> </td> <td class="steno-font"> <span>-FRPBLGTS</span> </td> <td> Ends previous lawyer sentence with "<span class="steno-transcript">?</span>" </td> </tr> <tr> <td>Answer Bank following statement</td> <td class="steno-outline"> <span>R-FRPBLGTS</span> </td> <td class="steno-font"> <span>R-FRPBLGTS</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">.</span>", for when lawyer makes a statement. </td> </tr> <tr> <td>Interrupting Answer Bank</td> <td class="steno-outline"> <span>WR-FRPBLGTS</span> </td> <td class="steno-font"> <span>WR-FRPBLGTS</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">--</span>" for when witness interrupts lawyer. </td> </tr> <tr> <td>Answer Bank following question</td> <td class="steno-outline"> <span>H-FRPBLGTS</span> </td> <td class="steno-font"> <span>H-FRPBLGTS</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">?</span>" (same as Default Answer Bank, added for completeness' sake) </td> </tr> </table> <p>Some further notes on this set of outlines:</p> <ul> <li>In Q&amp;A, sentences would seem to only ever end in question marks, periods, or dashes. No exclamation marks, or any other type of punctuation, would seem to be used, so I did not create any outlines using them</li> <li>I chose the <code class="language-plaintext highlighter-rouge">H-</code> and <code class="language-plaintext highlighter-rouge">-F</code> keys to delineate ending questions since they are on the higher steno row, indicating the typical upward voice inflection of a spoken question, and vice versa for the <code class="language-plaintext highlighter-rouge">R-</code> and <code class="language-plaintext highlighter-rouge">-R</code> keys for statements</li> <li>I chose <code class="language-plaintext highlighter-rouge">-RB</code> for an ending dash as it marks the “sh” sound in the Plover “dash” outline (<code class="language-plaintext highlighter-rouge">TK-RB</code>), and use of <code class="language-plaintext highlighter-rouge">WR-</code> is just a mirror reflection of that</li> <li>No Initial Answer Bank outline was created since it would seem that there are never answers given without a question in Q&amp;A</li> <li> <p>If you are following along with <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/q-and-a.json">my custom Q&amp;A dictionary</a>, you may notice that tabs and newline characters in the entries use the special <code class="language-plaintext highlighter-rouge">\t</code> and <code class="language-plaintext highlighter-rouge">\n</code> characters, rather than <a href="https://github.com/openstenoproject/plover/wiki/Dictionary-Format#keyboard-shortcuts">Plover keyboard shortcuts</a> like <code class="language-plaintext highlighter-rouge">{#tab}</code> and <code class="language-plaintext highlighter-rouge">{#return}</code>. For example, the entry for the Default Question Bank:</p> <p><code class="language-plaintext highlighter-rouge">"STKPWHR": "{.}{^\n\t^}{^Q^}{^\t^}{-|}"</code></p> <p>This is done simply to enable undoing the entire entry in one keystroke. Using Plover keyboard shortcuts makes what the <code class="language-plaintext highlighter-rouge">*</code> key can undo significantly less predictable.</p> <p>More details about the reasons behind this can be found in Plover’s documentation on <a href="https://github.com/openstenoproject/plover/wiki/Dictionary-Format#undoable-line-breaks-and-tabs">Undoable Line Breaks and Tabs</a>, and more details about all those other characters in the entry can be found in <a href="https://github.com/openstenoproject/plover/wiki/Dictionary-Format">Plover’s Dictionary Format</a> documentation.</p> </li> </ul> <h3 id="2-voice-demos">2-Voice Demos</h3> <p>In order to show my Q&amp;A dictionary in action, I have recorded a few videos of myself attempting to transcribe some of PS’s initial Q&amp;A lessons. Don’t expect stellar steno speeds (or much competence at all) in the videos below as I am still learning :sweat_smile:</p> <p>The letters on the light board behind the instructor indicate who is currently speaking:</p> <ul> <li><strong>P</strong>: Plaintiff/Prosecution</li> <li><strong>W</strong>: Witness</li> <li><strong>C</strong>: The Court (the Judge)</li> <li><strong>D</strong>: Defense</li> </ul> <p>There will be more variation in these lights once we get into 4-Voice.</p> <p>The following video is of PS’s very first Q&amp;A lesson, so the conversation is quite straightforward and slow. One thing to note, though, is that it begins with the questioner making a statement, necessitating use of the <code class="language-plaintext highlighter-rouge">R-FRPBLGTS</code> outline.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/xpJNxsOjFZs" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1JymsW65Q2joKCSJxNd5HS4mOX6TznrN77fGRnJKrM6o/edit?usp=sharing"> Platinum Steno Theory Lesson 27 Q&amp;A #1 </a> </figcaption> </div> <blockquote> <p>See <a href="#appendix-a-formatting-the-record">Appendix A: Formatting the Record</a> for how I set up <a href="https://docs.google.com/">Google Docs</a> to produce official-looking(?) court transcripts.</p> </blockquote> <p>This next video is more of the same, but note that when the witness is asked to spell their name, a technique called “stitching” is used. As apposed to <a href="https://www.artofchording.com/sounds/fingerspelling.html#fingerspelling-alphabet">fingerspelling</a>, stitching deliberately separates letters with dashes to indicate that a speaker is verbally spelling out a word letter by letter.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/y-RBNZCvQLM" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1NGcSJzptb7JiIB0VYg-Cv-zCHtONjtdJDgtXsMNY2J4/edit?usp=sharing"> Platinum Steno Theory Lesson 28 Q&amp;A #2 </a> </figcaption> </div> <blockquote> <p>See <a href="#appendix-b-stitching">Appendix B: Stitching</a> for more about stitching, and the custom dictionary I created for it.</p> </blockquote> <p>In the next video, note the use of the <code class="language-plaintext highlighter-rouge">STKPWHR-F</code> outline when the witness asks the lawyer a question, and <code class="language-plaintext highlighter-rouge">R-FRPBLGTS</code> for when the lawyer answers.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/xl7xyRHTErY" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1AFuxkNO26ooOVC4zEnDHsi_CWlkOfcPuVp5nyZ8CQJY/edit?usp=sharing"> Platinum Steno Theory Lesson 29 Q&amp;A #3 </a> </figcaption> </div> <p>In the final 2-Voice demo, note the use of the <code class="language-plaintext highlighter-rouge">STKPWHR-RB</code> outline when the lawyer interrupts the witness.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/6MwMO76V_zA" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1cTU4qt0HjiGPXOBd4eN-u9nkMpJAw1CWCaa53MXucn8/edit?usp=sharing"> Platinum Steno Theory Lesson 30 Q&amp;A #4 </a> </figcaption> </div> <p>Now that we have gotten the general rules of questioning and answering down, it is time to up the ante and introduce more <em><a href="https://en.wikipedia.org/wiki/Dramatis_personae">dramatis personae</a></em> to the conversation.</p> <h2 id="4-voice">4-Voice</h2> <div class="plover-for-the-record-image" style="width: 90%;"> <figure> <img src="/assets/images/2021-09-04/ace-attorney-courtroom-judge.jpg" alt="Phoenix, Franziska, and Judge"/> <figcaption> Photo by <a href="https://www.deviantart.com/mandyneko"> MandyNeko </a> on <a href="https://www.deviantart.com/mandyneko/art/Phoenix-Wright-Case-3-5-210215863"> Deviant Art </a> </figcaption> </figure> </div> <p>Courtroom cross-examination of a witness involves more than just a single legal team, but also the opposing side’s legal team, and the court itself. We are now beyond being able to sign in a speaker with just <span class="steno-transcript">Q</span> and <span class="steno-transcript">A</span>: we need to give the speakers names.</p> <p>So, let’s introduce the expanded cast of characters in our courtroom drama with their designated outlines:</p> <table class="steno-table"> <thead> <tr> <th>Person</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Output</th> <th class="limited-width-heading">Notes</th> </tr> </thead> <tr> <td>Plaintiff Lawyer 1</td> <td class="steno-outline"> <span>STPHAO</span> </td> <td class="steno-font"> <span>STPHAO</span> </td> <td> <span class="steno-transcript">MR. STPHAO</span> </td> <td> Known as "Mr. Snoo" </td> </tr> <tr> <td>Plaintiff Lawyer 2</td> <td class="steno-outline"> <span>SKWRAO</span> </td> <td class="steno-font"> <span>SKWRAO</span> </td> <td> <span class="steno-transcript">MR. SKWRAO</span> </td> <td> Known as "Mr. Screw" </td> </tr> <tr> <td>The Court</td> <td class="steno-outline"> <span>STPHAOEUFPLT</span> </td> <td class="steno-font"> <span>STPHAOEUFPLT</span> </td> <td> <span class="steno-transcript">THE COURT</span> </td> <td> </td> </tr> <tr> <td>Defense Lawyer 1</td> <td class="steno-outline"> <span>EUFPLT</span> </td> <td class="steno-font"> <span>EUFPLT</span> </td> <td> <span class="steno-transcript">MR. EUFPLT</span> </td> <td> Known as "Mr. Ifpelt" </td> </tr> <tr> <td>Defense Lawyer 2</td> <td class="steno-outline"> <span>EURBGS</span> </td> <td class="steno-font"> <span>EURBGS</span> </td> <td> <span class="steno-transcript">MR. EURBGS</span> </td> <td> Known as "Mr. Irbs" </td> </tr> <tr> <td>Witness</td> <td class="steno-outline"> <span>W-PBS/W-PBS</span> </td> <td class="steno-font"> <span>W-PBS W-PBS</span> </td> <td> <span class="steno-transcript">THE WITNESS</span> </td> <td> This is PS's designated outline </td> </tr> <tr> <td>Witness</td> <td class="steno-outline"> <span>SKWRAOEURBGS</span> </td> <td class="steno-font"> <span>SKWRAOEURBGS</span> </td> <td> <span class="steno-transcript">THE WITNESS</span> </td> <td> This is my personal alternative outline </td> </tr> </table> <p>Some further notes on this set of outlines:</p> <ul> <li>The pronounced “names” for each of the lawyers (“Mr. Snoo” etc) come from PS, and would seem to indicate the colloquial way they are referred to based on the literal steno pronunciation of the outline</li> <li>In Q&amp;A, it is apparently rare to have multiple lawyers on any legal team, so you will mostly be using “Mr. Snoo” and “Mr. Ifpelt”, but the full set of outlines is included in the custom Q&amp;A dictionary for completeness’ sake</li> <li>Since lawyers are humans, and humans typically have names that are not <span class="steno-transcript">MR. STPHAO</span>, the output of the lawyer outlines can be considered placeholders. Before a Q&amp;A exercise starts, if you are given the lawyer names, you can just do a simple text find-and-replace in the Q&amp;A dictionary to change <span class="steno-transcript">MR. STPHAO</span> to <span class="steno-transcript">MS. WEXLER</span> etc where appropriate. The outlines for the judge and witness are never given specific names</li> <li>The formatting for the output of all of these outlines is uppercase. What is not shown above, but will be shown in an extract below, is that a tab is output before the name, and then a colon and a space is output following the name</li> <li>Plover theory has already assigned the word “irks” to Defense Lawyer 2’s <code class="language-plaintext highlighter-rouge">EURBGS</code> outline. So, <em><a href="https://definitions.uslegal.com/c/caveat-utilitor">Caveat Utilitor</a></em> that if you use the Q&amp;A outline, you will be mildly inconvenienced by needing to stroke the word “irks” as <code class="language-plaintext highlighter-rouge">EURBG/-S</code> or <code class="language-plaintext highlighter-rouge">EURBG/-Z</code></li> <li>PS’s witness outline of <code class="language-plaintext highlighter-rouge">W-PBS/W-PBS</code> felt a bit awkward to me, given the shapes of the other outlines, and having to stroke the same outline twice. The “lower row version” of The Court outline, <code class="language-plaintext highlighter-rouge">SKWRAOEURBGS</code>, was not assigned to anything in Plover, so it made sense to me to assign it to the witness: the judge sits on the “high” bench, and the witness sits in the “low” dock. Both sets of outlines are included in the custom Q&amp;A dictionary, so feel free to use whichever outline works for you</li> <li>Like the question and answer bank outlines, each outlines above comes with a set of variations that marks it as the first line of the transcript, or ends the previous sentence with a period, question mark, or dash. Check out the custom dictionary itself for all those details</li> </ul> <p>This is quite a lot to take in, so let’s have a look at an example that uses the new outlines above, the question/answer ones we have already seen, and one we will have a look at later:</p> <p class="steno-transcript"> BY MR. CHAMBERS:<br/> &nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;&nbsp;All right. Miss Smith, where do you currently live?<br/> &nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;1892 Spring Drive in Riverside.<br/> &nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;&nbsp;Did you live at that address in July of 2018?<br/> &nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;Yes, sir.<br/> &nbsp;&nbsp;&nbsp;&nbsp;MR. DUGO: Your Honor, I am having a difficult time hearing the witness.<br/> &nbsp;&nbsp;&nbsp;&nbsp;THE COURT: Miss Smith, I know it is tough, but have got to keep your voice up a little bit. It is hard to hear in this courtroom, okay?<br/> &nbsp;&nbsp;&nbsp;&nbsp;THE WITNESS: Yes, your Honor. </p> <ul> <li>The first line, <span class="steno-transcript">BY MR. CHAMBERS</span>, is a byline, and indicates that the lawyer Mr. Chambers is in charge of, or owns, the current line of questioning: his questions are marked by <span class="steno-transcript">Q</span> and the witness’s answers are marked by <span class="steno-transcript">A</span>. We will look more at bylines next up</li> <li>The next few lines are standard Q&amp;A that we have seen before, which use the question and answer bank outlines</li> <li>On line 6, the opposing lawyer, Mr. Dugo, interrupts the line of questioning. Mr. Dugo does not own the line of questioning, so he does not get a byline, but instead his statement is recorded inline. From this point, we have veered off the current line of questioning</li> <li>On line 7, the judge addresses the witness, with the question also recorded inline</li> <li>On line 8, the witness answers the question. An answer sign-in using <span class="steno-transcript">A</span> only occurs when the witness answers a question posed by the lawyer who owns the current line of questioning. Since the witness is answering the judge’s question, and not a question posed by Mr. Chambers, it is recorded inline as <span class="steno-transcript">THE WITNESS</span>. Whenever a witness talks out of turn without being asked a question, or is not directing an answer at the lawyer who owns the line of questioning (like at the judge here, or at the opposing lawyer), witness statements are recorded in this way</li> </ul> <h3 id="bylines">Bylines</h3> <div class="plover-for-the-record-image" style="width: 70%;"> <figure> <img src="/assets/images/2021-09-04/briefcase-battle.jpg" alt="Phoenix Wright and Miles Edgeworth briefcase battle cosplay"/> <figcaption> Photo by <a href="https://www.deviantart.com/kazzu"> KaZzu </a> on <a href="https://www.deviantart.com/kazzu/art/Briefcase-Battle-80339570"> Deviant Art </a> </figcaption> </figure> </div> <p>Bylines are used to indicate the lawyer that owns, or is in charge of, the current line of questioning to a witness. The outline that signs in a lawyer outputs in the following format:</p> <p class="steno-transcript"> BY &lt;TITLE&gt;. &lt;SURNAME&gt;:<br/> &nbsp;&nbsp;&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;&nbsp;&lt;cursor&gt; </p> <p>It would seem that the convention is to output the lawyer’s title and surname, all in capital letters, and then output a question bank to kick off cross-examination. Like specific naming in outlines mentioned earlier, witnesses and judges also do not get bylines.</p> <p>Whenever the lawyer begins questioning, they are signed in with a byline. If they finish questioning, and a lawyer from the opposing legal team begins questioning, they are signed in separately. If, as you saw in the transcript above, a line of questioning is interrupted, when it re-begins again, the same lawyer gets re-signed in.</p> <p>Here is a set of outlines that can be used for the bylines of Plaintiff Lawyer 1 and Defense Lawyer 1 (check the custom Q&amp;A dictionary for details of the other lawyers, but they follow the same pattern):</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Notes</th> </tr> </thead> <tr> <td>Plaintiff Lawyer 1 Initial Byline</td> <td class="steno-outline"> <span>STPHAO*</span> </td> <td class="steno-font"> <span>STPHAO*</span> </td> <td> Byline is the first line of transcript; no previous sentence punctuation needed. </td> </tr> <tr> <td>Plaintiff Lawyer 1 Byline following question</td> <td class="steno-outline"> <span>STPHAO*F</span> </td> <td class="steno-font"> <span>STPHAO*F</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">?</span>" </td> </tr> <tr> <td>Plaintiff Lawyer 1 Byline following statement</td> <td class="steno-outline"> <span>STPHAO*R</span> </td> <td class="steno-font"> <span>STPHAO*R</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">.</span>" </td> </tr> <tr> <td>Plaintiff Lawyer 1 Byline following interruption</td> <td class="steno-outline"> <span>STPHAO*RB</span> </td> <td class="steno-font"> <span>STPHAO*RB</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">--</span>" </td> </tr> <tr> <td>Defense Lawyer 1 Initial Byline</td> <td class="steno-outline"> <span>*EUFPLT</span> </td> <td class="steno-font"> <span>*EUFPLT</span> </td> <td> Byline is the first line of transcript; no previous sentence punctuation needed. </td> </tr> <tr> <td>Defense Lawyer 1 Byline following question</td> <td class="steno-outline"> <span>H*EUFPLT</span> </td> <td class="steno-font"> <span>H*EUFPLT</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">?</span>" </td> </tr> <tr> <td>Defense Lawyer 1 Byline following statement</td> <td class="steno-outline"> <span>R*EUFPLT</span> </td> <td class="steno-font"> <span>R*EUFPLT</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">.</span>" </td> </tr> <tr> <td>Defense Lawyer 1 Byline following interruption</td> <td class="steno-outline"> <span>WR*EUFPLT</span> </td> <td class="steno-font"> <span>WR*EUFPLT</span> </td> <td> Ends previous sentence with "<span class="steno-transcript">--</span>" </td> </tr> </table> <h2 id="4-voice-demos">4-Voice Demos</h2> <p>Now that you have been formally introduced to the cast of characters in our courtroom drama, and how they interact with each other, let’s see how that all plays out in some video demos.</p> <p>The first demo shows a basic 4-Voice example using the lawyer name placeholders. Typically, you are given the lawyer names before beginning Q&amp;A so you can substitute them in.</p> <p>Note the switching of bylines as each lawyer begins and ends their lines of questioning. Also note that when the lawyers indicate that they have no further questions, since that statement is not a question directed at the witness, it is not transcribed with a <span class="steno-transcript">Q</span>, but as a named statement under their own byline.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/vdQXdKy0im8" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1ggOzm94IAh5IRKLo14qdsvLnCHoBXoislsZitnF4xEQ/edit?usp=sharing"> Platinum Steno Theory Lesson 31 Q&amp;A #5 </a> </figcaption> </div> <p>The next video is more of the same, but actually using human names for the lawyers.</p> <div class="steno-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/ccxfO0W96wA" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> <figcaption> Transcript: <a href="https://docs.google.com/document/d/1gcfaP6JoHuu5u08zlapQqnDLA0aASk3iazaLQX0Rqko/edit?usp=sharing"> Platinum Steno Theory Lesson 32 Q&amp;A #6 </a> </figcaption> </div> <h2 id="adjournment-sine-die"><a href="https://en.wikipedia.org/wiki/Adjournment_sine_die">Adjournment <em>sine die</em></a></h2> <p>There is more to learn about Q&amp;A than I have been able to cover here, so if you are interested in delving even deeper, I would highly recommend checking out the following videos specifically from the <a href="https://www.youtube.com/playlist?list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU">Platinum Steno Theory playlist</a>:</p> <ul> <li><a href="https://www.youtube.com/watch?v=tEgaJ7hWIvg&amp;list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU&amp;index=61">Lesson 27 QA</a></li> <li><a href="https://www.youtube.com/watch?v=ABd5JcmOmg0&amp;list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU&amp;index=70">Lesson 31</a></li> </ul> <p>The entire set of theory lessons is great, but if you want more information specifically on Q&amp;A, then I think these are the main two you want to watch.</p> <p>Even if you are not planning on becoming a court reporter, I think that doing these kinds of Q&amp;A exercises is great dictation practice in general, and I can see the ability to be able to manage conversation threads being applicable to captioning other kinds of conversational interactions: re-assign the outlines for lawyers, the judge, and the witness to panelists, an adjudicator, and the audience, and you can now transcribe a debate!</p> <p>If you end up giving it a try, and perhaps improve on the methods outlined here, be sure to reach out!</p> <blockquote> <p>Wondering where that cool steno keyboard font came from? Go get it from <a href="https://github.com/Kaoffie">Kathy</a>’s <a href="https://github.com/Kaoffie/steno_font">Steno Display Font Github repository</a>!</p> </blockquote> <h2 id="update-25-november-2021-immediate-responses">UPDATE 25 November 2021: Immediate Responses</h2> <p>I am now at the stage where I have completed PS’s <a href="https://www.youtube.com/playlist?list=PL85Y9t9lANyCGo0H6O5gSUlu3hT62XjrA">60WPM speed building video list</a> (it only took me <em>five</em> months, and I still do not think I am at 60WPM; the grind continues…), and during the Q&amp;A exercises there were enough repeated scenarios that came up that I felt a few new outlines were in order.</p> <p>They all revolve around providing immediate output for common responses to a <span class="steno-transcript">Q</span> or <span class="steno-transcript">A</span> upon switching speakers.</p> <h3 id="witnesses">Witnesses</h3> <p>Some common words and phrases that begin an answer from witnesses are:</p> <ul> <li>Affirmative statements: “Yes.”, “Yes, sir.”, “Yeah.”, “Correct.”, “Right.”, “Sure.”, “Uh-huh.”</li> <li>Negative statements: “No.”, “No, sir.”</li> <li>Unsure statements: “I don’t know.”</li> </ul> <p>Being able to immediately output any of these after an <span class="steno-transcript">A</span> would be really handy.</p> <blockquote> <p>Notice that all of the examples above are terminated with a period.</p> <p>According to PS, these initial statements in isolation are considered <em>the answer</em> to a question, with any further statements being extraneous information or just further elaborative context.</p> <p>So, where you may write “Yes, I did.” in standard English, in a legal transcript, this would instead be “Yes. I did.” (<a href="https://dictionary.cambridge.org/dictionary/english/ymmv">YMMV</a>)</p> </blockquote> <p>Given the examples above, here is the set of new outlines that I added to <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/q-and-a.json">my custom Q&amp;A dictionary</a> for use with a witness:</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Notes</th> </tr> </thead> <tr> <td>"Yes." and elaborate</td> <td class="steno-outline"> <span>KWR-FRPBLGTS</span> </td> <td class="steno-font"> <span>KWR-FRPBLGTS</span> </td> <td> Derived from the <code>KWR</code> outline for the letter "Y" for "yes", then the answer bank. </td> </tr> <tr> <td>"Yes, sir." and elaborate</td> <td class="steno-outline"> <span>SKWR-FRPBLGTS</span> </td> <td class="steno-font"> <span>SKWR-FRPBLGTS</span> </td> <td> Derived from <code>KWR</code> with an inverted <code>S</code> to make <code>YS</code> for "yes, sir", then the answer bank. </td> </tr> <tr> <td>"Yeah." and elaborate</td> <td class="steno-outline"> <span>KWREFRPBLGTS</span> </td> <td class="steno-font"> <span>KWREFRPBLGTS</span> </td> <td> Derived from Plover's <code>KWR*E</code> outline for "yeah", then the answer bank. </td> </tr> <tr> <td>"Correct." and elaborate</td> <td class="steno-outline"> <span>KR-FRPBLGTS</span> </td> <td class="steno-font"> <span>KR-FRPBLGTS</span> </td> <td> Derived from Plover's <code>KREBGT</code> outline for "correct", then the answer bank. </td> </tr> <tr> <td>"Right." and elaborate</td> <td class="steno-outline"> <span>TR-FRPBLGTS</span> </td> <td class="steno-font"> <span>TR-FRPBLGTS</span> </td> <td> Derived from a truncated and inverted version of Plover's <code>RAOEUT</code> outline for "right", then the answer bank. </td> </tr> <tr> <td>"Sure." and elaborate</td> <td class="steno-outline"> <span>SH-FRPBLGTS</span> </td> <td class="steno-font"> <span>SH-FRPBLGTS</span> </td> <td> Derived from a truncated version of Plover's <code>SHUR</code> outline for "sure", then the answer bank. </td> </tr> <tr> <td>"Uh-huh." and elaborate</td> <td class="steno-outline"> <span>HUFRPBLGTS</span> </td> <td class="steno-font"> <span>HUFRPBLGTS</span> </td> <td> Awkwardly derived from Plover's <code>*U/H*U</code> outline for "uh-huh", then the answer bank. </td> </tr> <tr> <td>"No.", and elaborate</td> <td class="steno-outline"> <span>TPH-FRPBLGTS</span> </td> <td class="steno-font"> <span>TPH-FRPBLGTS</span> </td> <td> Derived from the <code>TPH</code> outline for the letter "N" for "no", then the answer bank. </td> </tr> <tr> <td>"No, sir.", and elaborate</td> <td class="steno-outline"> <span>STPH-FRPBLGTS</span> </td> <td class="steno-font"> <span>STPH-FRPBLGTS</span> </td> <td> Derived from <code>TPH</code> with an inverted <code>S</code> to make <code>NS</code> for "no, sir", then the answer bank. </td> </tr> <tr> <td>"I don't know.", and elaborate</td> <td class="steno-outline"> <span>KWROEFRPBLGTS</span> </td> <td class="steno-font"> <span>KWROEFRPBLGTS</span> </td> <td> Derived partly from Plover's <code>KWROEPB</code> outline for "I don't know", then the answer bank. </td> </tr> </table> <p>Sometimes, the statements above are the only thing a witness says before the lawyer begins the next question.</p> <p>Therefore, I have also added complementary <code class="language-plaintext highlighter-rouge">*</code>-flagged outlines for each of the examples above that instantly yield control back to the questioner once the answer has been given, and output a new <span class="steno-transcript">Q</span>.</p> <p>Here is a sample:</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Notes</th> </tr> </thead> <tr> <td>"Yes." and yield control</td> <td class="steno-outline"> <span>KWR*FRPBLGTS</span> </td> <td class="steno-font"> <span>KWR*FRPBLGTS</span> </td> <td> <code>*</code>-flagged version of <code>KWR-FRPBLGTS</code>. </td> </tr> <tr> <td>"No.", and yield control</td> <td class="steno-outline"> <span>TPH*FRPBLGTS</span> </td> <td class="steno-font"> <span>TPH*FRPBLGTS</span> </td> <td> <code>*</code>-flagged version of <code>TPH-FRPBLGTS</code>. </td> </tr> </table> <p>See the Q&amp;A dictionary file for full set.</p> <h3 id="lawyers">Lawyers</h3> <p>For lawyers, things are a bit simpler. The only common phrases I have noticed said after a witness answers are:</p> <ul> <li>Answer acknowledgements: “Okay.”, “All right.”</li> <li>Question versions of those acknowledgements: “Okay?”, “All right?”</li> </ul> <p>The question versions, being questions, will immediately yield control over to the witness to answer. And so, here is a set of outlines for use with a lawyer:</p> <table class="steno-table"> <thead> <tr> <th>Stroke</th> <th class="centered-heading">Outline</th> <th class="centered-heading">Keymap</th> <th>Notes</th> </tr> </thead> <tr> <td>"Okay." and elaborate</td> <td class="steno-outline"> <span>STKPWHR-BG</span> </td> <td class="steno-font"> <span>STKPWHR-BG</span> </td> <td> Derived from the question bank, and then <code>-BG</code> for a "K" sound. </td> </tr> <tr> <td>"Okay?", and yield control</td> <td class="steno-outline"> <span>STKPWHR*BG</span> </td> <td class="steno-font"> <span>STKPWHR*BG</span> </td> <td> <code>*</code>-flagged version of <code>STKPWHR-BG</code>. </td> </tr> <tr> <td>"All right." and elaborate</td> <td class="steno-outline"> <span>STKPWHR-RT</span> </td> <td class="steno-font"> <span>STKPWHR-RT</span> </td> <td> Derived from the question bank, and then <code>-RT</code> for a truncated version of Plover's <code>RAOEUT</code> outline for "right". </td> </tr> <tr> <td>"All right?" and yield control</td> <td class="steno-outline"> <span>STKPWHR*RT</span> </td> <td class="steno-font"> <span>STKPWHR*RT</span> </td> <td> <code>*</code>-flagged version of <code>STKPWHR-RT</code>. </td> </tr> </table> <p>As before, see <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/q-and-a.json">my custom Q&amp;A dictionary</a> file for these details, and keep a periodic eye on it on Github as that is where I will make any updates if more come to mind.</p> <hr/> <h2 id="appendix-a-formatting-the-record">Appendix A: Formatting the Record</h2> <p>If I was going to attempt these Q&amp;A exercises, I figured that I should at least also make an effort to make the resulting transcriptions feel somewhat professional, and mimic the official-looking transcripts PS provides for reference.</p> <p>I chose <a href="https://docs.google.com/">Google Docs</a> to do this due to its accessibility to everyone, but I am sure that you could recreate something similar on your favourite text editor or word processor software if you wanted.</p> <p>Aside from the font and text-spacing formatting rules mentioned in the post, the court transcripts required for PS’s lessons also need to obey the following rules:</p> <ul> <li>Lines must be double-spaced</li> <li>There should be a header with the document name</li> <li>There should be a footer with the page number</li> <li>Line numbers must be visible on the page, with a maximum 25 lines per page</li> <li>Line numbers must restart on each page</li> <li>Line numbers must be added all the way to the end of the page, even if there is text only part-way through the page</li> </ul> <p>Fulfilling all the formatting requirements in Google Docs necessitated the following settings:</p> <ul> <li><strong>Line Spacing</strong>: Format Menu &gt; Line &amp; paragraph spacing &gt; Double</li> <li><strong>Font</strong> <ul> <li>Choose <span class="steno-transcript">Courier New</span> from the font dropdown menu</li> <li>Choose a size of 12.5 (this size and the line-spacing combination will, for the most part, ensure that you will have 25 lines per page)</li> </ul> </li> <li><strong>Header</strong>: <ul> <li>Insert Menu &gt; Headers and footers &gt; Header</li> <li>Manually type in the document name</li> </ul> </li> <li><strong>Footer</strong>: Insert Menu &gt; Page Numbers &gt; Choose visual option that puts the page number on the bottom right-hand side of the document</li> <li><strong>Indentations</strong>: Left Indent: 0.5cm, Right Indent: 15.5cm</li> <li><strong>Line Numbers</strong>: <ul> <li>Not built in to Google Docs, and hence requires the free <a href="https://linenumbers.app/#/?id=line-numbers-for-google-docs">Line Numbers for Google Docs plugin</a> (if the plugin is not available on the Google Chrome Store, follow <a href="https://github.com/Line-Numbers-for-Google-Docs/chrome-extension/issues/33#issuecomment-894842650">these instructions</a> to install it)</li> <li>Once installed, refresh your page and you should see its icon added to the top right section of your Google Docs page. Click on it to bring up the Line Numbering format menu</li> <li><strong>Numbering</strong>: <ul> <li>Check Show Numbering</li> <li>Check Restart Each Page</li> <li>Check Count by Blank Lines</li> </ul> </li> <li><strong>Style</strong>: <ul> <li>Size: 12</li> <li>Color: 000000</li> </ul> </li> </ul> </li> </ul> <p>Once you have done all of the above, you should have something approximating what I have in my documents. Feel free to further change and customise as you wish!</p> <h2 id="appendix-b-stitching">Appendix B: Stitching</h2> <p>When someone verbally spells words during Q&amp;A, like when they spell their name for the record, s-t-i-t-c-h-i-n-g the words is the way to show this.</p> <p><a href="https://raw.githubusercontent.com/openstenoproject/plover/master/plover/assets/main.json">Plover’s main dictionary</a> has some support for stitching via the following set of outlines (note that <code class="language-plaintext highlighter-rouge">&amp;</code> is the <a href="https://github.com/openstenoproject/plover/wiki/Dictionary-Format#glue-operator-numbers-fingerspelling">Plover glue operator</a> to allow the strokes to “stick together”):</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"AFPL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;a-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"PW-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;b-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KR-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;c-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TK-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;d-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"EFPL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;e-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TKPW-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;g-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"H-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;h-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SKWR-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;j-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"K-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;k-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"HR-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;l-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"PH-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;m-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TPH-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;n-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"OPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;o-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"P-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;p-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KW-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;q-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"R-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;r-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"S-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;s-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"T-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;t-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SR-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;v-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"W-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;w-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KP-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;x-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KWR-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;y-}"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>You may have noticed that there are a few letters absent here. I am not sure why they are missing, but I ended up adding some of the lost letters to my own <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/stitching.json">custom stitching dictionary</a> using the following outlines:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"A*EUPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;a-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AO*EUPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;i-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AO*UPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;u-}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"STKPW-PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;z-}"</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>A few notes about these entries:</p> <ul> <li>Yes, there is already an outline for <code class="language-plaintext highlighter-rouge">{&amp;a-}</code>, but I wanted one that followed the <code class="language-plaintext highlighter-rouge">-PLT</code> pattern like the rest. <code class="language-plaintext highlighter-rouge">APLT</code> was already taken for “amount”, so I used <code class="language-plaintext highlighter-rouge">A*EUPLT</code> with the long “a” sound instead</li> <li>For <code class="language-plaintext highlighter-rouge">{&amp;i-}</code> and <code class="language-plaintext highlighter-rouge">{&amp;u-}</code>, I wanted to use <code class="language-plaintext highlighter-rouge">EUPLT</code> and <code class="language-plaintext highlighter-rouge">UPLT</code>, but they were also already taken for “implement” and “ultimate”, respectively, so they, too, got elongated vowel versions of the outlines I originally wanted</li> </ul> <p>That still leaves <code class="language-plaintext highlighter-rouge">{&amp;f-}</code> missing, though. The outline I wanted to use was <code class="language-plaintext highlighter-rouge">TP-PLT</code>, to match the <code class="language-plaintext highlighter-rouge">-PLT</code> pattern of the other stitching outlines, but it was already reserved for the period (<code class="language-plaintext highlighter-rouge">{.}</code>). Now, Plover already assigns 32(!) outlines to <code class="language-plaintext highlighter-rouge">{.}</code>, so, I figured it wouldn’t miss the <code class="language-plaintext highlighter-rouge">TP-PLT</code> outline if I overrode it and gave it to <code class="language-plaintext highlighter-rouge">{&amp;f-}</code>.</p> <p>This ended up being the catalyst to create my <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/7191ce5a00/dictionaries/overrides/briefs.json">custom brief overrides dictionary</a>, for cases where I have a difference of opinion from Plover’s outline allocation, and want to assign an outline to some other word.</p> <p>For good measure, I also snuck in <code class="language-plaintext highlighter-rouge">"AO*EPLT": "{&amp;e-}"</code> to the overrides dictionary, just to make sure that <em>all</em> stitching entries would follow the <code class="language-plaintext highlighter-rouge">-PLT</code> pattern. Plover assigns <code class="language-plaintext highlighter-rouge">AO*EPLT</code> to “empty”, but since I do not associate the word “empty” with a long “e”, I was happy to re-assign the outline.</p> <h3 id="flipping-the-script">Flipping the Script</h3> <p>After using the stitching outlines above for a little while, I came across the following issue: whenever a speaker finished spelling their name, I would be left with a trailing hyphen (<code class="language-plaintext highlighter-rouge">-</code>) that I would have to manually delete. In some cases, it was just not possible to know in advance what the final letter of a name would be until it was said, and it would be too late to switch out the final letter with a standard fingerspelled letter.</p> <p>When it comes to spelling spoken words, we definitely know when the beginning is, but not necessarily when the end will be. So, I thought perhaps the stitching outlines could work in the same way: use a fingerspelled letter for the first letter, and use <em>backwards</em>-hyphened stitching for the rest of the letters, allowing a stitched word to finish at any time.</p> <p>So, I came up with the following set of outlines that use a <code class="language-plaintext highlighter-rouge">*PLT</code> suffix, which are spread across my custom stitching and brief overrides dictionaries, but are presented here as a single set for ease of viewing:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"A*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-a}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"PW*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-b}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KR*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-c}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TK*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-d}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"*EPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-e}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TP*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-f}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TKPW*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-g}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"H*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-h}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"*EUPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-i}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SKWR*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-j}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"K*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-k}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"HR*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-l}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"PH*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-m}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"TPH*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-n}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"O*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-o}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"P*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-p}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KW*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-q}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"R*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-r}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"S*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-s}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"T*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-t}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"*UPLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-u}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SR*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-v}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"W*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-w}"</span><span class="w">
  </span><span class="nl">"KP*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-x}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KWR*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-y}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"STKPW*PLT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{&amp;-z}"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>Which ever way you prefer to do steno stitching (if you even need to do it at all!), hopefully this has given you some food for thought on some potential options to get it working. If neither of these options suit your tastes, perhaps <a href="https://twitter.com/morinted">Ted Morin</a>’s <a href="https://github.com/morinted/plover_stitching">Plover Stitching Plugin</a> may provide a more viable option.</p> <p>G-o-o-d L-u-c-k!</p> <h2 id="update-5-december-2021-plover-stitching-plugin-recommended">UPDATE 5 December 2021: Plover Stitching Plugin Recommended</h2> <p>Forget the outlines in the dictionary above: it’s definitely better, and more straightforward, to use the <a href="https://github.com/morinted/plover_stitching">Plover Stitching Plugin</a>.</p> <p>You can see how I’ve leveraged it in my <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/stitching.json">custom stitching dictionary</a> and in my <a href="https://github.com/paulfioravanti/steno-dictionaries/tree/main/dictionaries/override">Plover overrides</a>.</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="plover"/><category term="stenography"/><category term="court-reporting"/><category term="q-and-a"/><category term="cosplay"/><category term="georgi"/><summary type="html"><![CDATA[Want to try recording legal testimony with just your computer keyboard? With Plover, court is in session.]]></summary></entry><entry><title type="html">Going Platinum</title><link href="https://www.paulfioravanti.com/blog/going-platinum/" rel="alternate" type="text/html" title="Going Platinum"/><published>2021-07-12T17:35:00+10:00</published><updated>2022-04-25T10:50:00+10:00</updated><id>https://www.paulfioravanti.com/blog/going-platinum</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/going-platinum/"><![CDATA[<div class="post-audio"> <div class="post-audio-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/qNJmV5mXzFA" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div class="spacer"></div> <div class="text"> :studio_microphone: This post has audio narration </div> </div> <p>It took nearly 4 months, but I finally finished <a href="https://platinumsteno.com/">Platinum Steno</a>’s <a href="https://www.youtube.com/playlist?list=PL85Y9t9lANyArY9uTBE_kmy2cT_ECSHvU">video theory lessons</a>.</p> <p>It was a tough marathon, and there were many times where I had to drag myself huffing and puffing through the motions to just get to the end of a lesson.</p> <p>Ultimately, though, I think it was <em>absolutely worth it</em>. So, I would like to spread the word about these great lessons, but also provide some commentary, from the point of view of a hobbyist, about where I think they best fit in a steno learner’s itinerary.</p> <h2 id="background">Background</h2> <p>Platinum Steno (PS) is (was?) a provider of paid educational and training material for <a href="https://en.wikipedia.org/wiki/Court_reporter">court reporters</a>. In February 2021, they released their entire catalogue of stenography theory and speed-building videos to <a href="https://www.youtube.com/c/platinumsteno">their YouTube channel</a>, and made the complementary lesson materials and worksheets freely available to download from their website (though you do need to go through a checkout process for $0 to get each lesson’s materials).</p> <p><a href="https://www.facebook.com/platinumsteno/posts/1390445521301220">This post</a> on <a href="https://www.facebook.com/platinumsteno">their Facebook page</a> would seem to explain some of the motivations for making their content widely available:</p> <blockquote> <p>This content should not be used to replace your existing school or program. Our intention in releasing this content was never to compete with existing programs. We decided to release this material because we felt that everyone could benefit from it, especially if it was free to the students. […] No matter where you are in your journey, we believe the content is valuable and can have a place in your practice sessions.</p> </blockquote> <p>Being a computer programmer that loves <a href="https://en.wikipedia.org/wiki/Open-source_software">open-source software</a>, and whose steno theory of choice is the free and open <a href="http://www.openstenoproject.org/">Plover</a> theory, I love this sentiment and can definitely get behind it! With regards to being able to use the content “no matter where you are in your journey”, though, I think there are a few caveats here that are worth making more explicit.</p> <h2 id="open-content-closed-theory">Open Content, Closed Theory</h2> <p>From what I understand from conversations on the <a href="https://discord.me/plover">Plover Discord</a>, the PS theory lessons use a “modified <a href="https://www.stenedsource.com/">StenEd</a>” theory (Plover also <a href="https://www.artofchording.com/introduction/theories-and-dictionaries.html#plover-theory">“has its roots in StenEd”</a>, so there is some overlap between it and PS).</p> <p>Looking on the StenEd website, you can see that there are lots of options to buy various books and audio material. If you are a beginner, and just want to try steno before making any big monetary investments, you may think you could bypass these purchases for now, and just start learning via the YouTube videos.</p> <p>However, you now have some new questions:</p> <ul> <li>Where will you get the StenEd dictionaries that map the steno outlines you find in PS’s worksheets to their English words? PS’s “modified” theory would seem to indicate there is a level of customisation to their dictionaries that would be unique to them (and hence may not be in any “official” StenEd dictionaries you could buy), and those dictionaries do not seem to have been released alongside their video lessons.</li> <li>Where will you get the software that will translate your chorded StenEd keyboard strokes into English output? The lessons make mention of special, presumably also custom, software, which, along with chord translation, handles specific situations like chording large numbers, currency, and legal Q&amp;A exercises (more about that later); this software also does not seem to have been released publicly.</li> <li>Even if you did find that software, will it run on your computer, or do you need an expensive <a href="https://en.wikipedia.org/wiki/Stenotype#Modern_hardware">stenotype machine</a> to run it?</li> </ul> <p>If you have made the plunge to formally enrol in a steno school which uses StenEd theory, then perhaps all of the issues outlined above are irrelevant, and you can, indeed, easily augment your studies with PS’s materials. This is fantastic! Definitely go for it (and feel free to ignore most of the rest of this post)!</p> <h2 id="delayed-gratification">Delayed Gratification</h2> <p>If you are going to go the open and free route with learning steno as a beginner, then Plover theory is currently your only viable choice. This is not a bad thing (I :heart: Plover!), and I think the theory that the PS lessons use is not really important compared to the value provided by their content.</p> <p>Although Plover theory and <a href="https://github.com/openstenoproject/plover/releases">its software</a>, can enable you to attempt the lessons without any upfront monetary cost (assuming you already have an <a href="https://en.wikipedia.org/wiki/Rollover_(key)#n-key_rollover"><em>N</em>-Key Rollover</a>-compatible keyboard), I believe a cost is borne in the <em>timing</em> that you can reasonably start studying them, which is not at the very beginning of your steno journey.</p> <p>Therefore, I would suggest <em>forgetting</em> PS for now, and instead focus on just learning Plover theory, to the point where you understand it intuitively.</p> <p>Read one or both of <a href="https://sites.google.com/site/learnplover/">Learn Plover!</a> and <a href="https://www.artofchording.com/">Art of Chording</a> (both recommended!), and get <em>lots</em> of steno practice in using applications like <a href="https://didoesdigital.com/typey-type/">Typey Type</a>, or any one of the many resources listed on <a href="https://github.com/openstenoproject/plover/wiki/Learning-Stenography">Plover’s Learning Resources Wiki page</a>.</p> <p>This will probably take you a few months at the very least, so go off and have fun learning! The rest of this post will happily wait for your return…</p> <div style="margin: auto; text-align: center; width: 90%;"> <figure style="display: block"> <img src="/assets/images/2021-07-12/scott-webb-habqOl7e_S8-unsplash.jpg" alt="woman looking on trees"/> <figcaption style="text-align: center;"> Photo by <a href="https://unsplash.com/@scottwebb?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Scott Webb </a> on <a href="https://unsplash.com/s/photos/platinum?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Unsplash </a> </figcaption> </figure> </div> <p>…Welcome back! You now have a high degree of fluency in Plover, and have had lots of practice chording keystrokes, right? Great! Time to re-consider looking at PS theory lessons!</p> <p>Wait, I’m recommending that you go <em>back</em> to theory? Didn’t you do all that already? Yes, you did! The core steno theory concepts in PS will end up just being revision for you, and the fact that they use StenEd theory will now not be a cause for any potential confusion thanks to your solid foundation in Plover! So, you will be able to focus more on the content that the PS theory lessons provide that I think is unique to them.</p> <h2 id="platinum-club-benefits">Platinum Club Benefits</h2> <p>The most important elements in determining the success of any educational courses are its delivery and content, and PS excels in both of these areas.</p> <h3 id="delivery">Delivery</h3> <p>Jill Paxton-Brumund, the teacher of the theory lessons, is absolutely fantastic!</p> <p>Jill’s kind-yet-no-nonsense approach made learning with her a pleasure. Her explanations of steno outlines, stories from the trenches of court reporting, and even the way she read dictation exercises to prompt you to recognise when you could use a stroke-saving brief, were all massively helpful and interesting.</p> <p>Learning steno is hard, and can be a grind, and Jill is unapologetic in telling you that if you are having trouble learning or remembering outlines, or chording particular keystrokes, to just go back and re-practice things multiple times until they sink in.</p> <p>I felt like Jill was my steno gym coach, encouraging me to do those extra repetitions to build up muscle memory, and rooting for me to succeed. Thank you, Jill!</p> <h3 id="content">Content</h3> <p>During the course of the lessons, I definitely got some value out of doing more in-depth revision of core steno concepts. More importantly, though, the lessons served as motivation for creating my own learning materials, and broadening my knowledge of steno:</p> <ul> <li>The lessons contained a lot of vocabulary, including <a href="https://en.wikipedia.org/wiki/Proper_and_common_nouns">proper nouns</a>, that I had not encountered in Plover learning materials, and in some cases were not contained in the default Plover dictionary. This became the catalyst for the creation of <a href="https://github.com/paulfioravanti/steno_dictionaries">my personal dictionaries</a>: to augment what Plover provided with outlines that made sense to me.<br/> I would either take outlines directly from the PS lessons that I liked and put them in my dictionaries, or just make up outlines for new words that felt “Plover-esque” to me (doing Plover theory first helped me gain the intuition and confidence to do that).</li> <li> <p>As I went through each lesson, I took the time to annotate each of the vocabulary outlines on the PS written materials with the Plover equivalents which blew out the time to finish each lesson significantly for me (feel free to do this mentally if you wish…). Sometimes, the outlines for StenEd and Plover would be the same, but when they were not, I used the following note style:</p> <p><img src="/assets/images/2021-07-12/theory-edits.jpg" alt="img theory-edits" style="width: 50%;"/></p> <ol> <li>An outline written as-is under a word would signify that the PS outline <em>cannot</em> be used in Plover, and the new outline must be used. In this case, <code class="language-plaintext highlighter-rouge">PWUT/ER</code> is not a valid outline for “butter” in Plover theory, so I chose my preferred Plover outline to put here: <code class="language-plaintext highlighter-rouge">PWAOURT</code> (though the <code class="language-plaintext highlighter-rouge">*</code>-flagged <code class="language-plaintext highlighter-rouge">PWUT/*ER</code> <em>is</em> valid in Plover).</li> <li>An outline written in parentheses, <code class="language-plaintext highlighter-rouge">()</code>, indicates that the PS outline is valid in Plover, but I personally prefer a different one. In this case, <code class="language-plaintext highlighter-rouge">TKEUPB/ER</code> also maps to “dinner” in Plover theory, but I prefer the single-stroke <code class="language-plaintext highlighter-rouge">TKEURPB</code>.</li> <li>An outline written in square-brackets, <code class="language-plaintext highlighter-rouge">[]</code>, indicates that the actual word does not exist in the default Plover dictionary, and so a custom outline was required to be created. As of this writing, Plover has no entry for “<a href="https://en.wikipedia.org/wiki/Dobermann">Doberman</a>”, and although I could have used the provided <code class="language-plaintext highlighter-rouge">TKOEB/ER/PHAPB</code> outline since it looks reasonable, I decided to create a new one to shave off a stroke: <code class="language-plaintext highlighter-rouge">TKOERB/PHAPB</code>.</li> </ol> </li> <li>There is a lot of emphasis in the PS lessons on being able to stroke basic multi-word briefs with a single chord (eg “I have”, “did you”, “that he was”, “do you have the” etc). As well as building muscle memory in areas that will assist in getting higher speeds, this led to the addition of over 150 new phrase briefs to my personal dictionaries, so I hope they’ll serve me well (and maybe even you?) in the future.</li> <li>I learned about the concept of <a href="https://www.youtube.com/watch?v=tEgaJ7hWIvg">Q&amp;A</a>, which took the form of dictation exercises involving legal cross-examination of witnesses by attorneys in a courtroom setting.<br/> I am not training to be a court reporter, but I had fun learning all about the conventions around writing up a legal record, including the formatting, how to “check in” attorneys with “by-lines” before they start questioning a witness, and just how the documentation of various participants in a conversation occurs (I have no idea how much commonality there is between different types of courts around the English-speaking world for legal record writing conventions).<br/> If, like me, you think of learning steno like learning another language, I think that the Q&amp;A parts of the PS lessons could be considered their “cultural studies”. You will rarely learn a human language in isolation from all the cultural elements that helped form and shape it, and I believe this to be the case with Q&amp;A as well, given steno’s long history with the legal profession.<br/> I also made a <a href="https://github.com/paulfioravanti/steno_dictionaries/blob/main/dictionaries/q-and-a.json">Q&amp;A dictionary</a> that, I believe, can help Plover mimic the software that PS uses for this. Hopefully it can be of assistance to any Plover users who also decide to learn some Q&amp;A!<br/> <strong>UPDATE 3 Oct 2021</strong>: I wrote in-depth about doing Q&amp;A with Plover in another blog post, <em><a href="https://www.paulfioravanti.com/blog/plover-for-the-record/">Plover for the Record</a></em>.</li> </ul> <h2 id="conclusion">Conclusion</h2> <p>If you are a Plover steno learner looking for more educational materials after working your way through other community-created texts, then you cannot go wrong with PS’s theory lessons, especially given that there is now no barrier to entry.</p> <p>Personally, I am still on the PS bandwagon, and have started going through their speed classes, starting at 60 words-per-minute. It is tough, even now, but I consider it to be just another stage of the marathon I am happily running as part of my steno journey.</p> <p>Thanks to Platinum Steno for providing such a great cache of material to budding learners of stenography, and I look forward to being able to gradually improve past my QWERTY speeds, and beyond!</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="plover"/><category term="stenography"/><summary type="html"><![CDATA[New to stenography and wondering if you should do the Platinum Steno theory courses? Here's how they can fit into your learning mix.]]></summary></entry><entry><title type="html">Coding Test Review: Sentia</title><link href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/" rel="alternate" type="text/html" title="Coding Test Review: Sentia"/><published>2021-05-09T17:50:00+10:00</published><updated>2021-08-03T15:30:00+10:00</updated><id>https://www.paulfioravanti.com/blog/coding-test-review-sentia</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/coding-test-review-sentia/"><![CDATA[<p>I actually quite like coding tests.</p> <p>Not whiteboard coding tests, or generic algorithm tests that read more like math problems (usually set by “tech recruiting platforms”, and performed under exam-like conditions), but “take-home” tests where you get to build something practical in a specific technology stack.</p> <p>They can be fun and stimulating in the same way as answering questions on <a href="https://stackoverflow.com/users/567863/paul-fioravanti">Stack Overflow</a>, or solving problems on learning platforms like <a href="https://exercism.io/profiles/paulfioravanti">Exercism</a>, and can also be good fodder for your <a href="https://github.com/paulfioravanti">online coding portfolio</a>. I find I nearly always learn something new, or a different way of doing something I may already know, that makes me re-think the way I have solved a problem.</p> <p>In this instance, a friend sent me <a href="https://www.sentia.com.au/">Sentia</a>’s coding test to check out, and simply because I felt like I had not begun a <a href="http://rubyonrails.org/">Ruby on Rails</a> application from scratch in a long time, I decided to take a crack at it. So, here is my review of that attempt.</p> <p>Here are the public links for the deployed application and codebase:</p> <ul> <li><a href="https://sentiacodingtest.herokuapp.com/">Sentia Coding Test application</a></li> <li><a href="https://github.com/paulfioravanti/sentia-coding-test">Sentia Coding Test codebase</a></li> </ul> <blockquote> <p>Disclaimer: I am not, nor have ever been, an employee of Sentia, nor have I ever applied for employment there, nor is this post some kind of attempt to get them to employ me; I just did their coding test for my own definition of “fun”.</p> <p>If you are applying there, or plan to in the future, you may want to stop reading, and consider pretending that this blog post (and <a href="https://github.com/search?l=Ruby&amp;p=1&amp;q=sentia&amp;type=Repositories">all the other solutions people have posted</a>) does not exist, so you can greet their coding test with fresh eyes (assuming this one is still being used…)</p> </blockquote> <h2 id="original-requirements">Original Requirements</h2> <p>You will be required to create a Ruby on Rails application with the following features below. The sample CSV data required for the test can be found <a href="https://github.com/paulfioravanti/sentia-coding-test/blob/main/test/fixtures/files/SentiaCodingTestData.csv">here</a>. This application can be built in 1 hour.</p> <p>Below is a list of user stories and requirements for each section of this application.</p> <h3 id="part-1">PART 1</h3> <p>As a user, I should be able to upload this sample CSV and import the data into a database.</p> <p>IMPORTER REQUIREMENTS</p> <ol> <li>The data needs to load into 3 tables. <strong>People</strong>, <strong>Locations</strong> and <strong>Affiliations</strong><br/></li> <li>A <strong>Person</strong> can belong to many <strong>Locations</strong><br/></li> <li>A <strong>Person</strong> can belong to many <strong>Affiliations</strong><br/></li> <li>A <strong>Person</strong> without an <strong>Affiliation</strong> should be skipped<br/></li> <li>A <strong>Person</strong> should have both a <em>first_name</em> and <em>last_name</em>. All fields need to be validated except for <em>last_name</em>, <em>weapon</em> and <em>vehicle</em> which are optional.<br/></li> <li>Names and Locations should all be titlecased</li> </ol> <h3 id="part-2">PART 2</h3> <ol> <li>As a user, I should be able to view these results from the importer in a table.</li> <li>As a user, I should be able to paginate through the results so that I can see a maximum of 10 results at a time.</li> <li>As a user, I want to type in a search box so that I can filter the results I want to see.</li> <li>As a user, I want to be able to click on a table column heading to reorder the visible results.</li> </ol> <p>Once the test has been completed. Please upload to Git Repo/Google Drive/DropBox or zip and email over back to <em>&lt;person&gt;</em> at <em>&lt;person’s email&gt;</em>. ∎</p> <p>The sample <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> file contains the following data from a galaxy far, far away….</p> <table> <thead> <tr> <th>Name</th> <th>Location</th> <th>Species</th> <th>Gender</th> <th>Affiliations</th> <th>Weapon</th> <th>Vehicle</th> </tr> </thead> <tbody> <tr> <td>Darth Vader</td> <td>Death Star, Tatooine</td> <td>Human</td> <td>Male</td> <td>Sith</td> <td>Lightsaber</td> <td>Tiefighter</td> </tr> <tr> <td>Chewbacca</td> <td>kashyyk</td> <td>Wookie</td> <td>m</td> <td>Rebel Alliance</td> <td>Bowcaster</td> <td>Millennium Falcon</td> </tr> <tr> <td>yoda</td> <td>Yoda’s Hutt</td> <td>Unknown</td> <td>Male</td> <td>Jedi Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Sheev Palpatine</td> <td>Naboo</td> <td>Human</td> <td>Male</td> <td>Galactic Republic</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Princess Leia</td> <td>Alderaan</td> <td>Human</td> <td>Female</td> <td>Rebel Alliance, Galactic Republic</td> <td>Blaster Pistol</td> <td> </td> </tr> <tr> <td>jabba the Hutt</td> <td>Tatooine</td> <td>Hutt</td> <td>Male</td> <td>Hutt Clan</td> <td> </td> <td>Jabba’s Sale Barge</td> </tr> <tr> <td>Kylo Ren</td> <td>chandrila</td> <td>Human</td> <td>Male</td> <td>First Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Obi-Wan Kenobi</td> <td>Stewjon</td> <td>Human</td> <td>M</td> <td>Jedi Order</td> <td>Lightsaber</td> <td>Jedi Starfighter</td> </tr> <tr> <td>luke skywalker</td> <td>Tatooine</td> <td>Human</td> <td>M</td> <td>Rebel Alliance, Jedi Order</td> <td>Lightsaber~!@@@</td> <td>X-wing Starfighter</td> </tr> <tr> <td>Jar Jar Binks</td> <td>Naboo</td> <td>Gungan</td> <td>Male</td> <td>Galactic Republic, Gungan Grand Army</td> <td>Energy Ball</td> <td>Gungan Bongo Submarine</td> </tr> <tr> <td>R2-D2</td> <td>Naboo</td> <td>Astromech Droid</td> <td>Other</td> <td>Rebel Alliance, Galactic Republic</td> <td> </td> <td>X-wing Starfighter</td> </tr> <tr> <td>Han Solo</td> <td>Corellia</td> <td>Human</td> <td>Male</td> <td>Rebel Alliance</td> <td>Blaster Pistol</td> <td>Millennium Falcon</td> </tr> <tr> <td>Boba Fett</td> <td>Kamino</td> <td>Human</td> <td>m</td> <td> </td> <td>Blaster</td> <td>Slave 1</td> </tr> <tr> <td>Rey</td> <td>Jakku</td> <td>Human</td> <td>f</td> <td>Jedi Order</td> <td>Lightsaber</td> <td>Rey’s Speeder</td> </tr> <tr> <td>padme amidala</td> <td>naboo</td> <td>Human</td> <td>Female</td> <td>Galactic Republic</td> <td> </td> <td>Naboo N-1 Starfigher</td> </tr> <tr> <td>C-3PO</td> <td>Tatooine</td> <td>Protocol Droid</td> <td>Other</td> <td>The Resistance</td> <td> </td> <td>-1</td> </tr> <tr> <td>Mace Windu</td> <td>Haruun Kal</td> <td>Human</td> <td>Male</td> <td>Jedi Order</td> <td>Lightsaber</td> <td> </td> </tr> <tr> <td>Lando calrissian</td> <td>Cloud City</td> <td>Human</td> <td>Male</td> <td>Rebel Alliance</td> <td>Blaster Pistol</td> <td>Millennium Falcon</td> </tr> </tbody> </table> <h2 id="elephant">:elephant:</h2> <p>First thing’s first: let’s address the <a href="https://en.wikipedia.org/wiki/Elephant_in_the_room">elephant in the requirements</a>:</p> <blockquote> <p>This application can be built in 1 hour.</p> </blockquote> <p>If this is true, then I am a <strong><em>terrible</em></strong> developer.</p> <p>It took me a fair bit longer than that to write working code as-per requirements, debug the requirements (more on that later…), get it deployed somewhere on the internet, and refactor the code to a state where I would be happy to submit it for public consumption and criticism (I was <em>still</em> refactoring it while writing this post).</p> <p>If the intention is for someone to complete as many of the requirements as they can <em>within</em> that fixed 1 hour time frame, with the end result considered through the lens of that artificial constraint, then that should be made explicit.</p> <p>Regardless, I think it would probably be for the best to just remove that line, and allow candidates attempting this test to just focus on submitting their best attempt, and keep <a href="https://en.wikipedia.org/wiki/Impostor_syndrome">imposter syndrome</a> at bay for that little bit longer.</p> <h2 id="general-approach">General Approach</h2> <p>Since the requirements around this application focus on it being a Ruby on Rails application, I decided to go as “vanilla” as possible with Rails.</p> <p>This meant no explicit addition by me of any custom <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">Javascript</a>, or any front-end frameworks that use it, to help out with things like filtering or sorting information.</p> <p>I also tried to add the least amount of third-party non-Rails-default gems as possible, only using:</p> <ul> <li><a href="https://github.com/alassek/activerecord-pg_enum">ActiveRecord::PGEnum</a>, due to its nice developer ergonomics in dealing with <a href="https://www.postgresql.org/docs/current/datatype-enum.html">Postgres Enumerated Types</a> (more about why they were even needed later…)</li> <li><a href="https://github.com/drapergem/draper">Draper</a> for <a href="https://en.wikipedia.org/wiki/Decorator_pattern">decorators</a>: I really do not like using <a href="https://api.rubyonrails.org/classes/ActionController/Helpers.html">Rails helpers</a> for <a href="https://en.wikipedia.org/wiki/Presentation_logic">presentation logic</a>, preferring instead to keep it attached to the object being rendered; raw data can come from the <a href="https://guides.rubyonrails.org/active_record_basics.html">Rails model</a> class, while transforming that data for display in a <a href="https://guides.rubyonrails.org/action_view_overview.html">Rails view</a> can come from a decorator</li> <li><a href="https://github.com/kaminari/kaminari">Kaminari</a> for <a href="https://en.wikipedia.org/wiki/Pagination">pagination</a>, as I think it is currently the best gem for it</li> </ul> <h2 id="user-interface">User Interface</h2> <p>Since interface design and making things pretty in general is a weak-point for me, I used this test as an excuse to give <a href="https://tailwindcss.com/">Tailwind CSS</a> a try in order to style everything on the page (I have used <a href="https://tachyons.io/">Tachyons</a> before on other toy projects, so I am generally positive to the <a href="https://tailwindcss.com/docs/utility-first">utility-first CSS</a> concept), as well as use <a href="https://tailwindui.com/">Tailwind UI</a> to (hopefully) grab ready-made code for certain types of components.</p> <p><img src="/assets/images/2021-05-09/screenshot.png" alt="Screenshot"/></p> <p>For the most part, this was true for the following parts of the app:</p> <ul> <li>data table</li> <li>upload button</li> <li>search bar</li> <li>pagination widget</li> </ul> <p>But, as would be expected, it was not all quite as simple as <a href="https://en.wikipedia.org/wiki/Plug_and_play">plug and play</a>. Integrating Tailwind into the Kaminari-generated pagination views probably took the most amount of time. But, I got there in the end, and am generally pleased with how it looks for the time spent on it.</p> <p>For the most part, I left any long Tailwind-mnemonic-filled class strings as they were in the Rails view files. However, when those strings became too long, and generally difficult to read, I extracted them into separate <a href="https://sass-lang.com/documentation/syntax">SCSS</a> files using Tailwind’s <a href="https://tailwindcss.com/docs/functions-and-directives#apply"><code class="language-plaintext highlighter-rouge">@apply</code></a> directive (see files under the <a href="https://github.com/paulfioravanti/sentia-coding-test/tree/main/app/javascript/stylesheets"><code class="language-plaintext highlighter-rouge">app/javascript/stylesheets/</code></a> directory). I think I will likely continue to use this kind of strategy in the future with Tailwind class strings.</p> <p>Overall, I am happy to have been able to stand on the Tailwind ecosystem’s shoulders to build out the user interface, and will definitely consider using it again in future projects.</p> <h2 id="data-issues">Data Issues</h2> <p>Turning our gaze towards the provided dataset that the application must be able to import, there is no doubt that the CSV file deliberately contains some corrupt/bad data that you are meant to be able to <a href="https://en.wikipedia.org/wiki/Defensive_programming">program defensively</a> against.</p> <p>My general intentions were to only <em>not</em> import an entry where the requirements specifically said not to (i.e. a person without an affiliation should be skipped), and where the data could not be <em>reasonably</em> <a href="https://en.wikipedia.org/wiki/Data_wrangling">munged</a> into an acceptable format.</p> <div style="margin: auto; text-align: center; width: 90%;"> <figure style="display: block"> <img src="/assets/images/2021-05-09/perhaps-archives-incomplete.jpg" alt="80sfy.com screenshot"/> </figure> </div> <h3 id="mis-spellings">Mis-spellings</h3> <p>So, this meant that <code class="language-plaintext highlighter-rouge">Lightsaber~!@@@</code> could just be stripped of non-alphanumeric characters and become a valid <code class="language-plaintext highlighter-rouge">Lightsaber</code> weapon, but there were also issues around mis-spellings in the data, where I needed to give the application more knowledge around what kind of values it could expect to find in the CSV file, and what those values actually <em>should</em> be.</p> <p>This occurred in the form of a <a href="https://ruby-doc.org/core/Hash.html">Hash</a> that maps values known to be found in the CSV file to their correct values:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/services/data_importer/enum_field_parser.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">MISSPELLINGS</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Yoda's Hutt"</span> <span class="o">=&gt;</span> <span class="s2">"Yoda's Hut"</span><span class="p">,</span>
  <span class="s2">"Naboo N-1 Starfigher"</span> <span class="o">=&gt;</span> <span class="s2">"Naboo N-1 Starfighter"</span><span class="p">,</span>
  <span class="s2">"Jabba's Sale Barge"</span> <span class="o">=&gt;</span> <span class="s2">"Jabba's Sail Barge"</span><span class="p">,</span>
  <span class="s2">"Tiefighter"</span> <span class="o">=&gt;</span> <span class="s2">"TIE Fighter"</span>
<span class="p">}.</span><span class="nf">freeze</span>
</code></pre></div></div> <p>I am pretty sure that <a href="https://en.wikipedia.org/wiki/Yoda">Yoda</a> does not own a pet <a href="https://en.wikipedia.org/wiki/Jabba_the_Hutt">Jabba</a>, nor is Jabba’s <a href="https://starwars.fandom.com/wiki/Sail_barge">mode of transport</a> a retail outlet.</p> <p>Anyway, it is not possible for me to tell whether the introduction of these mis-spellings was deliberate in order to see if a candidate picked up on them, but I am going to wager that these <em>were</em> actually just typos, and the necessity for this kind of handling was not intentional.</p> <h3 id="value-validity">Value Validity</h3> <p>Under <a href="https://en.wikipedia.org/wiki/C-3PO">C-3PO</a>’s entry, the value for the Vehicle is given as <code class="language-plaintext highlighter-rouge">-1</code>: an obvious ploy to make sure that you do not actually store this value in a Person’s vehicle field.</p> <p>However, if <code class="language-plaintext highlighter-rouge">-1</code> is not a valid entry, it then stands to reason that I cannot trust <em>any</em> of those values in the file, and, therefore, need to give the application advance knowledge on <em>what</em> vehicles it can accept as valid.</p> <p>This meant that for a Person entry, I ended up making <em>every value</em> provided for a non-name-related field an <a href="https://en.wikipedia.org/wiki/Enumerated_type">enumerated type</a>: both in the application, and at the database level.</p> <p>The fact that there was the spelling mistake for Yoda’s location also made me assign enumerated types for the names of Locations and Affiliations. The application really does have too much advance knowledge of the limited scope of valid values it could get from the CSV file, but I did not see any other way around this while still ensuring data correctness.</p> <h3 id="names">Names</h3> <p>The requirements assume that the name values in the CSV file can be split out into <em>first_name</em> and <em>last_name</em>, which, taken at face value, they certainly can.</p> <p>However, this leads to the issue of having a table that looks like this for some values:</p> <table> <thead> <tr> <th>First Name</th> <th>Last Name</th> </tr> </thead> <tbody> <tr> <td>Princess</td> <td>Leia</td> </tr> <tr> <td>Darth</td> <td>Vader</td> </tr> <tr> <td>Kylo</td> <td>Ren</td> </tr> <tr> <td>Jabba</td> <td>The Hutt</td> </tr> </tbody> </table> <p>Some nerds should have looked over this data before it went public because <em><a href="https://knowyourmeme.com/memes/ackchyually">ackchyually</a>…</em></p> <ul> <li>“Princess” is a title, not a name, and “Leia” is <a href="https://en.wikipedia.org/wiki/Princess_Leia">Leia Organa</a>’s first name</li> <li><a href="https://starwars.fandom.com/wiki/Darth">“Darth” is a title</a>, not a name, and “<a href="https://en.wikipedia.org/wiki/Darth_Vader">Vader</a>” is more like a first name</li> <li>“Ren” is not a last name, but is from <a href="https://starwars.fandom.com/wiki/Knights_of_Ren">Knights of Ren</a>, and <a href="https://en.wikipedia.org/wiki/Kylo_Ren">Kylo Ren</a> used it more like a title once he became the inheritor of Ren’s Knights</li> <li>“The Hutt” is not a last name, but refers to the <a href="https://starwars.fandom.com/wiki/Hutt">Hutt species</a></li> </ul> <p>So, although not part of the requirements, I figured that this meant the application really needed to deal with the concept of name prefixes (titles etc) and <a href="https://en.wikipedia.org/wiki/Suffix_(name)">suffixes</a> (you may have noticed their inclusion in the screenshot above).</p> <p>Also, for names like Jabba The Hutt and <a href="https://en.wikipedia.org/wiki/Jar_Jar_Binks">Jar Jar Binks</a>, without the application knowing in advance that “The Hutt” is a suffix, it would not be able to tell the which words in either of those names comprise the <em>first_name</em> or <em>last_name</em>.</p> <p>The ability to deal with the name situation was made a bit more straightforward thanks to Ruby 3.0’s <a href="https://docs.ruby-lang.org/en/3.0.0/doc/syntax/pattern_matching_rdoc.html">pattern matching</a> capabilities. The <code class="language-plaintext highlighter-rouge">parse_name</code> method below returns an array containing <code class="language-plaintext highlighter-rouge">[prefix, first_name, last_name, suffix]</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/services/data_importer/person_parser.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">parse_name</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
  <span class="n">name_parts</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">split</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:upcase_first</span><span class="p">)</span>

  <span class="k">case</span> <span class="n">name_parts</span>
  <span class="k">in</span> <span class="p">[</span><span class="nb">name</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="s2">"Darth"</span> <span class="o">|</span> <span class="s2">"Princess"</span> <span class="o">=&gt;</span> <span class="n">prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">]</span>
    <span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="s2">"Ren"</span> <span class="o">=&gt;</span> <span class="n">suffix</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">suffix</span><span class="p">]</span>
  <span class="k">in</span> <span class="p">[</span><span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="s2">"The"</span><span class="p">,</span> <span class="s2">"Hutt"</span><span class="p">]</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="kp">nil</span><span class="p">,</span> <span class="s2">"The Hutt"</span><span class="p">]</span>
  <span class="k">else</span>
    <span class="o">*</span><span class="n">first_names</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="n">name_parts</span>
    <span class="p">[</span><span class="kp">nil</span><span class="p">,</span> <span class="n">first_names</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="n">last_name</span><span class="p">,</span> <span class="kp">nil</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Something like the method above is, of course, doable without pattern matching, but I think the terseness above really helps in understanding how specific data shapes are pin-pointed, and then transformed into the desired output.</p> <h2 id="application-code">Application Code</h2> <p>Having spent more time with <a href="https://en.wikipedia.org/wiki/Functional_programming">functional</a> languages like <a href="https://elixir-lang.org/">Elixir</a> and <a href="https://elm-lang.org/">Elm</a> recently, I definitely found their influence creeping into the way I want to write <a href="https://www.ruby-lang.org/en/">Ruby</a>.</p> <p>I definitely do not consider this a bad thing, nor do I (subjectively) think that the code reads less Ruby/Rails-like as a result (though I have, happily, challenged some Rails conventions). But, let’s have a look at some examples of main the <code class="language-plaintext highlighter-rouge">Person</code>-related controller and model of the application and you can judge for yourself.</p> <h3 id="controller">Controller</h3> <p><strong><code class="language-plaintext highlighter-rouge">app/controllers/people_controller.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PeopleController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@people</span> <span class="o">=</span>
      <span class="no">Person</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:search</span><span class="p">])</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:sort_people</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:paginate_people</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:decorate_people</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">sort_people</span><span class="p">(</span><span class="n">people</span><span class="p">)</span>
    <span class="no">PeopleSorter</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">people</span><span class="p">,</span> <span class="n">sort_column</span><span class="p">,</span> <span class="n">sort_direction</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_column</span>
    <span class="vi">@sort_column</span> <span class="o">||=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">sort_column</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:sort</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">sort_direction</span>
    <span class="vi">@sort_direction</span> <span class="o">||=</span> <span class="no">SortDirection</span><span class="p">.</span><span class="nf">determine</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:direction</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">paginate_people</span><span class="p">(</span><span class="n">sorted_people</span><span class="p">)</span>
    <span class="no">Paginator</span><span class="p">.</span><span class="nf">paginate_array</span><span class="p">(</span><span class="n">sorted_people</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">decorate_people</span><span class="p">(</span><span class="n">paginated_people</span><span class="p">)</span>
    <span class="no">PersonDecorator</span><span class="p">.</span><span class="nf">decorate_collection</span><span class="p">(</span>
      <span class="n">paginated_people</span><span class="p">,</span>
      <span class="ss">context: </span><span class="p">{</span>
        <span class="ss">sort_column: </span><span class="n">sort_column</span><span class="p">,</span>
        <span class="ss">sort_columns: </span><span class="no">Person</span><span class="p">.</span><span class="nf">sort_columns</span><span class="p">,</span>
        <span class="ss">sort_direction: </span><span class="n">sort_direction</span><span class="p">,</span>
        <span class="ss">params: </span><span class="n">params</span>
      <span class="p">}</span>
    <span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>A few notes about this code:</p> <ul> <li>The code that assigns to the <code class="language-plaintext highlighter-rouge">@people</code> instance variable is written in a style mimicking the <a href="https://elixir-lang.org/getting-started/enumerables-and-streams.html#the-pipe-operator">Elixir pipeline operator</a>, through the use of Ruby’s <a href="https://ruby-doc.org/core/Kernel.html#method-i-then"><code class="language-plaintext highlighter-rouge">Kernel#then</code></a> method (aka <a href="https://ruby-doc.org/core/Kernel.html#method-i-yield_self"><code class="language-plaintext highlighter-rouge">Kernel#yield_self</code></a>). The collection of people that originally gets fetched from the database goes through a series of transformations (filtered via search -&gt; sorted -&gt; paginated -&gt; decorated) before being handed off to the view, so I thought this way of writing the main controller code would indicate that most clearly and explicitly.</li> <li>I would have liked to have had the database do the sorting for me, rather than do it in Ruby-land, but the fact that sorting needed to happen on values contained in a <code class="language-plaintext highlighter-rouge">Person</code>’s associations (locations and affiliations), made it untenable.<br/> <strong>UPDATE 3 August 2021</strong> <em>Narrator: <a href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/#update-3-august-2021-ordering-in-the-database">it wasn’t untenable</a></em></li> <li>I originally had the implementation code for <code class="language-plaintext highlighter-rouge">sort_direction</code> up in the <code class="language-plaintext highlighter-rouge">ApplicationController</code>, since it is not specific to a <code class="language-plaintext highlighter-rouge">Person</code>; putting it there would, I think, be considered Rails convention for code of that nature. But, rather than counting on someone looking at a method call, which has no local definition, and then <em>implicitly knowing</em> that its definition could come from a <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)#Subclasses_and_superclasses">superclass</a>, I decided to extract it into a small, named service module (<code class="language-plaintext highlighter-rouge">SortDirection</code>), so there is an <em>explicit</em> call-out (<code class="language-plaintext highlighter-rouge">SortDirection.determine</code>). I do not generally like using <a href="https://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)">inheritance</a>, and will try and avoid it where I can.</li> <li>I created a small <code class="language-plaintext highlighter-rouge">Paginator</code> service module with the intention of keeping knowledge about <code class="language-plaintext highlighter-rouge">Kaminari</code> restricted to it. Who knows, maybe I might want to change over to something like <a href="https://github.com/mislav/will_paginate">will_paginate</a> one day, and organising the code like this, using the <a href="https://en.wikipedia.org/wiki/Adapter_pattern">Adapter pattern</a>, will mean no changes will be required in the controller (yes, fine, guilty of <a href="https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it">YAGNI</a> since this just a coding test, but I have no regrets…).</li> <li>Both <code class="language-plaintext highlighter-rouge">sort_column</code> and <code class="language-plaintext highlighter-rouge">sort_direction</code> are needed in the view, as well as in the controller. I have seen many codebases use the <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">encapsulation</a>-busting <a href="https://api.rubyonrails.org/classes/AbstractController/Helpers/ClassMethods.html#method-i-helper_method"><code class="language-plaintext highlighter-rouge">helper_method</code></a> method to allow controllers and views to share methods (I even used it in earlier iterations of this code). However, since decorators are being used in this application, this can be avoided by explicitly passing in whatever extra controller information is needed in presentation logic via a <code class="language-plaintext highlighter-rouge">context</code> hash, that is only accessible within the confines of the decorator class.</li> </ul> <h3 id="model">Model</h3> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">PGEnum</span><span class="p">(</span>
    <span class="ss">species: </span><span class="no">Enum</span><span class="o">::</span><span class="no">SPECIES</span><span class="p">,</span>
    <span class="ss">gender: </span><span class="no">Enum</span><span class="o">::</span><span class="no">GENDERS</span><span class="p">,</span>
    <span class="ss">weapon: </span><span class="no">Enum</span><span class="o">::</span><span class="no">WEAPONS</span><span class="p">,</span>
    <span class="ss">vehicle: </span><span class="no">Enum</span><span class="o">::</span><span class="no">VEHICLES</span>
  <span class="p">)</span>

  <span class="n">has_many</span> <span class="ss">:loyalties</span>
  <span class="n">has_many</span> <span class="ss">:affiliations</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">},</span> <span class="ss">through: :loyalties</span>
  <span class="n">has_many</span> <span class="ss">:residences</span>
  <span class="n">has_many</span> <span class="ss">:locations</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">},</span> <span class="ss">through: :residences</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span>
      <span class="n">includes</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">references</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>

    <span class="n">search</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sort_column</span><span class="p">(</span><span class="n">sort_param</span><span class="p">)</span>
    <span class="no">Sort</span><span class="p">.</span><span class="nf">column</span><span class="p">(</span><span class="n">sort_param</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">sort_columns</span>
    <span class="no">Sort</span><span class="o">::</span><span class="no">SORT_COLUMNS</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">first_affiliation_name</span>
    <span class="n">affiliations</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">affiliation_names</span>
    <span class="n">affiliations</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">first_location_name</span>
    <span class="n">locations</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">name</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">location_names</span>
    <span class="n">locations</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>A few notes about this code:</p> <ul> <li>All methods return data only. Nothing here is responsible for returning formatted strings, or anything else that is meant for display purposes: that is strictly the job of the decorators.</li> <li> <p>For functionality related to things like searching or sorting people, for the basic implementations I have done, it would probably be considered Rails convention to have that code live in <a href="https://api.rubyonrails.org/classes/ActiveSupport/Concern.html">Rails concerns</a>, and <code class="language-plaintext highlighter-rouge">include</code> those modules in the <code class="language-plaintext highlighter-rouge">Person</code> class to make their methods available.<br/> Like inheritance, I really do not like using <a href="https://en.wikipedia.org/wiki/Object_composition">composition</a> in this way, as I feel that it is too implicit as well. Perhaps if Ruby had something akin to Elixir’s <a href="https://elixir-lang.org/getting-started/alias-require-and-import.html#import"><code class="language-plaintext highlighter-rouge">Kernel.SpecialForms.import/2</code></a>, where you could explicitly enumerate the methods to import (something like <code class="language-plaintext highlighter-rouge">include Search, only: :search_query</code>), then I would probably be more favourably inclined to them.<br/> So, instead, I opted for what I would consider a more Ruby-ish than Rails-ish way of separating the code, through the use of what is apparently called <a href="https://en.wikipedia.org/wiki/Class_(computer_programming)#Partial">partial classes</a> to achieve <a href="https://en.wikipedia.org/wiki/Separation_of_concerns">separation of concerns</a>: essentially, re-opening the <code class="language-plaintext highlighter-rouge">Person</code> class in separate files, and putting code in small <code class="language-plaintext highlighter-rouge">private</code> modules for <code class="language-plaintext highlighter-rouge">Search</code>, and <code class="language-plaintext highlighter-rouge">Sort</code>, and then have the model explicitly call them (eg <code class="language-plaintext highlighter-rouge">Search.query</code>, <code class="language-plaintext highlighter-rouge">Sort.column</code>). For example:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/search.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Search</span>
    <span class="no">SEARCH_QUERY</span> <span class="o">=</span>
      <span class="o">&lt;&lt;~</span><span class="no">SQL</span><span class="p">.</span><span class="nf">squish</span><span class="sh">
        prefix ILIKE :search
        OR first_name ILIKE :search
        OR last_name ILIKE :search
        OR suffix ILIKE :search
        OR locations.name::text ILIKE :search
        OR species::text ILIKE :search
        OR gender::text ILIKE :search
        OR affiliations.name::text ILIKE :search
        OR weapon::text ILIKE :search
        OR vehicle::text ILIKE :search
</span><span class="no">      SQL</span>
    <span class="n">private_constant</span> <span class="ss">:SEARCH_QUERY</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>
      <span class="n">query</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="no">SEARCH_QUERY</span><span class="p">,</span> <span class="ss">search: </span><span class="s2">"%</span><span class="si">#{</span><span class="n">search</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Search</span>
<span class="k">end</span>
</code></pre></div> </div> <p>This <code class="language-plaintext highlighter-rouge">module</code> could easily be copy and pasted back into <code class="language-plaintext highlighter-rouge">app/models/person.rb</code>, but having it here “removes the clutter” from the model class itself, while still being encapsulated within it. And yes, <a href="https://ruby-doc.org/core/Module.html#method-i-private_constant"><code class="language-plaintext highlighter-rouge">private_constant</code></a> can be used with a <code class="language-plaintext highlighter-rouge">module</code> to make sure that code like <code class="language-plaintext highlighter-rouge">Person::Search</code> cannot be used outside the <code class="language-plaintext highlighter-rouge">Person</code> class.</p> <p>See the <a href="https://github.com/paulfioravanti/sentia-coding-test/tree/main/app/models/person"><code class="language-plaintext highlighter-rouge">app/models/person/</code></a> directory for the other examples.</p> </li> </ul> <h2 id="conclusion">Conclusion</h2> <p>Although I do think there are areas where the coding test requirements could be improved, particularly in the data set, overall, I am left with an overall positive impression of it since it was the catalyst for me to:</p> <ul> <li>play with Tailwind, which I will definitely use again in the future</li> <li>re-think some of the ways I have been writing Rails controller and model code</li> <li>generally learn me some new things</li> </ul> <p>So, if you are looking to up your coding game whilst padding your online portfolio, I can definitely recommend using coding tests as a way to do so!</p> <h2 id="update-3-august-2021-ordering-in-the-database">UPDATE 3 August 2021: Ordering in the Database</h2> <p>My friend <a href="https://twitter.com/aarondeadman">Aaron</a> left <a href="https://www.paulfioravanti.com/blog/coding-test-review-sentia/#comment-5454123121">a comment</a> asking about my statement concerning ordering on associated records:</p> <blockquote> <p>“the fact that sorting needed to happen on values contained in a Person’s associations (locations and affiliations) made it [sorting using the database] untenable.”</p> <p><strong>Is this a limitation of ActiveRecord? It seems like Postgres should be able to handle this but I might be missing some of the nuance.</strong></p> </blockquote> <p>My rationale for not being able to sort the list of <code class="language-plaintext highlighter-rouge">Person</code> records based on values in their associations was that those values were essentially <em>unknowable</em> to the <code class="language-plaintext highlighter-rouge">Person</code> query: it would only be <em>after</em> its associations were fetched from the database that we would be able to loop over them, using Ruby in this case, to find out the exact values of the first affiliation and location names.</p> <p>But, was this rationale correct? I could not help myself, so I took the bait and dove down this rabbit hole to find out. First, though, a minor detour down a separate, but slightly shallower, rabbit hole.</p> <h3 id="ordering-was-broken-anyway">Ordering was broken anyway</h3> <p>On re-opening this codebase, I realised that in my haste to be done with it, I had failed to notice that the location and affiliation names were not <em>always</em> displaying in alphabetical order as expected.</p> <p>There did not seem to be an obvious reason as to why…until I went for a dive in Rails’ Github repo, where it became apparent that there is a <a href="https://github.com/rails/rails/issues/6769">very long-running issue</a> regarding ordering clauses on <code class="language-plaintext highlighter-rouge">has_many</code> relationships being ignored or lost when using an <a href="https://api.rubyonrails.org/classes/ActiveRecord/QueryMethods.html#method-i-includes"><code class="language-plaintext highlighter-rouge">includes</code></a> statement, which I definitely was in the <code class="language-plaintext highlighter-rouge">Person.search</code> method.</p> <p>Using <code class="language-plaintext highlighter-rouge">includes</code> would seem to <a href="https://stackoverflow.com/a/11947303/567863">delegate your query generation strategy to Rails itself</a> (ie let Rails decide whether to load association data in a separate query, or in one big join-based query), which is a probably a good rule-of-thumb, because who could just instinctively know that? (Not me). Anyway, it would seem that this ordering issue would require some manual intervention.</p> <p>Figuring out <a href="https://blog.arkency.com/2013/12/rails4-preloading/">which flavour of association preloading</a> would not cause an error, give me the output I expected, and not cause any N+1 issues, was mostly trial and error. I finally got to <a href="https://api.rubyonrails.org/classes/ActiveRecord/QueryMethods.html#method-i-preload"><code class="language-plaintext highlighter-rouge">preload</code></a>, and my house of cards gained a bit of stability with the following change:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">preload</span><span class="p">(</span><span class="ss">:locations</span><span class="p">,</span> <span class="ss">:affiliations</span><span class="p">)</span>
    <span class="n">search</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Great! Side quest over, and we are back to zero! Time to get back to the main mission!</p> <h3 id="lateral-support">Lateral Support</h3> <p>So, can <a href="https://www.postgresql.org/">Postgres</a> do something akin to what we have done with the current Ruby-based sorting code and essentially <a href="https://heap.io/blog/postgresqls-powerful-new-join-type-lateral">“loop over each entry in a result set and evaluate a subquery using that row as a parameter”</a>?</p> <p>It certainly can: with <a href="https://www.postgresql.org/docs/13/queries-table-expressions.html#QUERIES-LATERAL"><code class="language-plaintext highlighter-rouge">LATERAL</code> subqueries</a>, introduced back in Postgres version 9.3, so it seems like I have not been keeping up to date with improvements in the database world! Anyway, let’s see how we can leverage it to push more query logic out of Ruby-land and into database-land.</p> <h4 id="add-attributes">Add <code class="language-plaintext highlighter-rouge">attribute</code>s</h4> <p>First, though, since we are now planning for the database to give us a <code class="language-plaintext highlighter-rouge">Person</code>’s <code class="language-plaintext highlighter-rouge">first_affiliation_name</code> and <code class="language-plaintext highlighter-rouge">first_location_name</code>, we will be able to treat them just like any of <code class="language-plaintext highlighter-rouge">Person</code>’s other fields. Therefore, let’s add some virtual <a href="https://api.rubyonrails.org/classes/ActiveRecord/Attributes/ClassMethods.html#method-i-attribute"><code class="language-plaintext highlighter-rouge">attribute</code></a>s to the <code class="language-plaintext highlighter-rouge">Person</code> model to hold that information for when we receive it, and remove the original <code class="language-plaintext highlighter-rouge">first_x_name</code> methods:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="n">attribute</span> <span class="ss">:first_affiliation_name</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="n">attribute</span> <span class="ss">:first_location_name</span><span class="p">,</span> <span class="ss">:string</span>
<span class="k">end</span>
</code></pre></div></div> <h4 id="create-association-queries">Create association queries</h4> <p>Now, let’s create some queries that intend to populate those <code class="language-plaintext highlighter-rouge">attribute</code>s. Since both the queries will be similar in nature, let’s give them the same name on each model: <code class="language-plaintext highlighter-rouge">Affiliation.first_name</code> and <code class="language-plaintext highlighter-rouge">Location.first_name</code>. We will start with the <code class="language-plaintext highlighter-rouge">Affiliation</code> query, build it out, and then replicate the logic across to the <code class="language-plaintext highlighter-rouge">Location</code> query.</p> <p>For the first affiliation name of any given person, we want to:</p> <ul> <li>join the people table on the given person’s ID</li> <li>order the affiliations by their name</li> <li>limit the number of affiliations to 1 to get only the first one</li> <li>select only that affiliation’s name</li> </ul> <p>Here is what a first cut of that method might look like:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/affiliation.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Affiliation</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:people</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"people.id = ?"</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>Let’s give it a try in a Rails console with a <code class="language-plaintext highlighter-rouge">Person</code> whom we know has multiple affiliations, Leia Organa:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="p">.</span><span class="nf">find_by</span><span class="p">(</span><span class="ss">first_name: </span><span class="s2">"Leia"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Person:0x00007fd427581bc0</span>
<span class="o">...</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span><span class="p">(</span><span class="nb">p</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="p">[</span><span class="c1">#&lt;Affiliation:0x00007fd3f70afcf8 id: nil, name: "Galactic Republic"&gt;]</span>
</code></pre></div></div> <p>Okay, this looks like the correct information is at least being returned and populated, so it is a good start.</p> <p>The problem now is that we cannot use this method as-is moving forward: the database is not going to be able to execute this Ruby-land method, passing in an <code class="language-plaintext highlighter-rouge">id</code> parameter. We need to have the database fill it in during the course of a lateral join (which will make it <em>unknowable</em> to Ruby). Also, since the join is over a <code class="language-plaintext highlighter-rouge">has_many :through</code> relationship, we will have to change the <code class="language-plaintext highlighter-rouge">joins</code> target to be the join-table (in this case <code class="language-plaintext highlighter-rouge">loyalties</code>).</p> <p>Here is how the method will need to change:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/affiliation.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Affiliation</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:loyalties</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"loyalties.person_id = people.id"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">Affiliation.first_name</code> method can now <em>not</em> be run in isolation in Ruby-land, as there is no context on where <code class="language-plaintext highlighter-rouge">people.id</code> comes from:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span>
<span class="p">(</span><span class="no">Object</span> <span class="n">doesn</span><span class="err">'</span><span class="n">t</span> <span class="n">support</span> <span class="c1">#inspect)</span>
<span class="o">=&gt;</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">people.id</code> essentially stands in for a database-land local loop variable that will be “passed in” from some other (as-yet unknown) outer query that will laterally join with it, and provide the context for a <code class="language-plaintext highlighter-rouge">people</code> table.</p> <p>The query in <code class="language-plaintext highlighter-rouge">Location</code> will change in a similar way:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Location</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">first_name</span>
    <span class="n">joins</span><span class="p">(</span><span class="ss">:residences</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="s2">"residences.person_id = people.id"</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h4 id="lateral-joining">Lateral Joining</h4> <p>Now that we have our association subqueries created, let’s see how the <code class="language-plaintext highlighter-rouge">Person.search</code> code will change when it uses them:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="c1"># ...</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">search</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">direction</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span>
      <span class="n">preload</span><span class="p">(</span><span class="ss">:affiliations</span><span class="p">,</span> <span class="ss">:locations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="no">Lateral</span><span class="p">.</span><span class="nf">method</span><span class="p">(</span><span class="ss">:join_first_association_names</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">order</span><span class="p">(</span><span class="n">column</span> <span class="o">=&gt;</span> <span class="n">direction</span><span class="p">,</span> <span class="no">Sort</span><span class="o">::</span><span class="no">DEFAULT_SORT_COLUMN</span> <span class="o">=&gt;</span> <span class="n">direction</span><span class="p">)</span>

      <span class="n">search</span><span class="p">.</span><span class="nf">present?</span> <span class="p">?</span> <span class="no">Search</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span> <span class="p">:</span> <span class="n">query</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <p>After the <code class="language-plaintext highlighter-rouge">:affiliations</code> and <code class="language-plaintext highlighter-rouge">:locations</code> have been <code class="language-plaintext highlighter-rouge">preload</code>ed, the query is piped into a new method, <code class="language-plaintext highlighter-rouge">join_first_association_names</code>, inside of a new <code class="language-plaintext highlighter-rouge">Lateral</code> module (naming things is hard…) that is <code class="language-plaintext highlighter-rouge">private</code> to the <code class="language-plaintext highlighter-rouge">Person</code> model:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/lateral.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Lateral</span>
    <span class="no">FIRST_ASSOCIATION_NAME</span> <span class="o">=</span>
      <span class="nb">lambda</span> <span class="k">do</span> <span class="o">|</span><span class="n">query</span><span class="p">,</span> <span class="n">table_alias</span><span class="p">,</span> <span class="n">field</span><span class="o">|</span>
        <span class="o">&lt;&lt;~</span><span class="no">SQL</span><span class="p">.</span><span class="nf">squish</span><span class="sh">
          JOIN LATERAL (</span><span class="si">#{</span><span class="n">query</span><span class="p">.</span><span class="nf">to_sql</span><span class="si">}</span><span class="sh">)
          AS </span><span class="si">#{</span><span class="n">table_alias</span><span class="si">}</span><span class="sh">(</span><span class="si">#{</span><span class="n">field</span><span class="si">}</span><span class="sh">)
          ON true
</span><span class="no">        SQL</span>
      <span class="k">end</span>
    <span class="n">private_constant</span> <span class="ss">:FIRST_ASSOCIATION_NAME</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">join_first_association_names</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
      <span class="n">query</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="n">first_affiliation_name</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="n">first_location_name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="nb">private_class_method</span> <span class="k">def</span> <span class="nf">first_affiliation_name</span>
      <span class="no">FIRST_ASSOCIATION_NAME</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
        <span class="no">Affiliation</span><span class="p">.</span><span class="nf">first_name</span><span class="p">,</span>
        <span class="ss">:affiliation</span><span class="p">,</span>
        <span class="ss">:first_affiliation_name</span>
      <span class="p">)</span>
    <span class="k">end</span>

    <span class="nb">private_class_method</span> <span class="k">def</span> <span class="nf">first_location_name</span>
      <span class="no">FIRST_ASSOCIATION_NAME</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span>
        <span class="no">Location</span><span class="p">.</span><span class="nf">first_name</span><span class="p">,</span>
        <span class="ss">:location</span><span class="p">,</span>
        <span class="ss">:first_location_name</span>
      <span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Lateral</span>
<span class="k">end</span>
</code></pre></div></div> <p>There is currently no nice ActiveRecord database-agnostic API that wraps around lateral joins, so we need to resort to direct string interpolation in the <code class="language-plaintext highlighter-rouge">FIRST_ASSOCIATION_NAME</code> lambda, which generates the lateral join subquery. It does the following:</p> <ul> <li>Converts the <code class="language-plaintext highlighter-rouge">first_name</code> association queries we built earlier into SQL statements and marks it as the target for the lateral join</li> <li>Specifies the field name that the result of the query should be returned as. In this case, they have been named the same as the <code class="language-plaintext highlighter-rouge">attribute</code>s in the <code class="language-plaintext highlighter-rouge">Person</code> model where that information is intended to be stored: <code class="language-plaintext highlighter-rouge">first_affiliation_name</code> and <code class="language-plaintext highlighter-rouge">first_location_name</code></li> <li>Specifies a <a href="https://www.postgresql.org/docs/current/rowtypes.html#ROWTYPES-USAGE">table alias</a>, needed by the join to extract the returned <code class="language-plaintext highlighter-rouge">first_x_name</code> (otherwise it looks like the <a href="https://stackoverflow.com/q/67047907/567863">“lateral join is returning a value with parenthesis”</a>). The names given in the methods for the <code class="language-plaintext highlighter-rouge">table_alias</code> parameter have no special meaning. They could have been named <code class="language-plaintext highlighter-rouge">t1</code> and <code class="language-plaintext highlighter-rouge">t2</code>: they just need to be unique</li> <li>Indicates via the <code class="language-plaintext highlighter-rouge">ON true</code> clause that there is no filtering condition, and that the full result of the lateral join should be returned, which in this case is only that single name value.</li> </ul> <h4 id="fixing-search">Fixing Search</h4> <p>The final major change that now needs to happen to make everything work as expected is to update the <code class="language-plaintext highlighter-rouge">Search.query</code> method in the <code class="language-plaintext highlighter-rouge">Person</code> class with a <code class="language-plaintext highlighter-rouge">joins</code> and <code class="language-plaintext highlighter-rouge">group</code> clause, so that it can still perform searches on associated data, and is aware of the <code class="language-plaintext highlighter-rouge">Person</code>’s new <code class="language-plaintext highlighter-rouge">attribute</code>s:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/models/person/search.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="k">module</span> <span class="nn">Search</span>
    <span class="no">SEARCH_QUERY</span> <span class="o">=</span>
      <span class="c1"># ...</span>

    <span class="kp">module_function</span>

    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">search</span><span class="p">)</span>
      <span class="n">query</span>
        <span class="p">.</span><span class="nf">joins</span><span class="p">(</span><span class="ss">:affiliations</span><span class="p">,</span> <span class="ss">:locations</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="no">SEARCH_QUERY</span><span class="p">,</span> <span class="ss">search: </span><span class="s2">"%</span><span class="si">#{</span><span class="n">search</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="ss">:first_affiliation_name</span><span class="p">,</span> <span class="ss">:first_location_name</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">private_constant</span> <span class="ss">:Search</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="code-clean-up">Code Clean Up</h3> <p>Now that the database is doing the heavy lifting on ordering associations, a swath of related Ruby code can now be confidently deleted:</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">PeopleSorter</code> module now has no reason to exist, so it can be removed</li> <li>Since we are now paginating a <code class="language-plaintext highlighter-rouge">Person::ActiveRecord_Relation</code> now, rather than an array that got returned by the <code class="language-plaintext highlighter-rouge">PeopleSorter</code>, the <code class="language-plaintext highlighter-rouge">Paginator</code> module that was created to wrap around the <code class="language-plaintext highlighter-rouge">Kaminari.paginate_array</code> method, can also be removed</li> </ul> <p>These two changes have now reduced the <code class="language-plaintext highlighter-rouge">index</code> code in the <code class="language-plaintext highlighter-rouge">PeopleController</code> to be just:</p> <p><strong><code class="language-plaintext highlighter-rouge">app/controllers/people_controller.rb</code></strong></p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PeopleController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@people</span> <span class="o">=</span>
      <span class="no">Person</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:search</span><span class="p">],</span> <span class="n">sort_column</span><span class="p">,</span> <span class="n">sort_direction</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">page</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:page</span><span class="p">])</span>
        <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="o">&amp;</span><span class="nb">method</span><span class="p">(</span><span class="ss">:decorate_people</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="c1"># ...</span>
<span class="k">end</span>
</code></pre></div></div> <p>Less code, less to maintain! All these changes have been pushed up to the <a href="https://github.com/paulfioravanti/sentia-coding-test">Sentia Coding Test codebase</a>, so feel free to have a browse or run the code for yourself.</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="ruby"/><category term="rails"/><category term="coding-test"/><category term="star-wars"/><category term="data-parsing"/><category term="tailwind"/><category term="enum"/><category term="draper"/><category term="kaminari"/><category term="tachyons"/><category term="pattern-matching"/><category term="lateral-join"/><category term="preloading"/><summary type="html"><![CDATA[A long SQL query in a database far, far away....]]></summary></entry><entry><title type="html">░▒▓ＥＬＭＳＴＨＥＴＩＣＳ▓▒░</title><link href="https://www.paulfioravanti.com/blog/elmsthetics/" rel="alternate" type="text/html" title="░▒▓ＥＬＭＳＴＨＥＴＩＣＳ▓▒░"/><published>2021-05-02T13:40:00+10:00</published><updated>2021-05-02T13:40:00+10:00</updated><id>https://www.paulfioravanti.com/blog/elmsthetics</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/elmsthetics/"><![CDATA[<p><a href="http://www.80sfy.com/">80sfy.com</a>, by <a href="http://www.digitalbloc.com/">Art Sangurai</a>, is a pretty cool site if you love <a href="https://en.wikipedia.org/wiki/Synthwave">synthwave</a> music or the 1980s in general.</p> <p>It uses a <a href="https://soundcloud.com/">SoundCloud</a> and <a href="https://giphy.com/">Giphy</a> combination for maximum <span style="color: #ff2975; font-weight: bold;">ＡＥＳＴＨＥＴＩＣ</span> effect to make you <span style="color: #42c6ff; font-weight: bold">ＦＥＥＬ </span> all the nostalgias, which got it <a href="https://www.reddit.com/r/outrun/comments/5rdvks/my_boyfriend_made_a_website_that_plays_synthwave/">a lot of love on Reddit</a>.</p> <div style="margin: auto; text-align: center; width: 90%;"> <figure style="display: block"> <img src="/assets/images/2021-05-02/80sfy-screenshot.png" alt="80sfy.com screenshot"/> </figure> </div> <p>It is programmed primarily in <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">Javascript</a> with the <a href="https://reactjs.org/">React</a> library. So, I decided to re-create it using <a href="https://elm-lang.org/">Elm</a> because why not, but also just because…</p> <div style="margin: auto; text-align: center; width: 80%;"> <figure style="display: block"> <img src="/assets/images/2021-05-02/programming-in-elm-is-rad.jpg" alt="Programming in Elm is pretty rad!"/> <figcaption style="text-align: center;"> Retro Wave at <a href="https://photofunia.com/categories/all_effects/retro-wave">PhotoFunia</a> </figcaption> </figure> </div> <p>You can see the results of those efforts here:</p> <ul> <li><a href="https://www.paulfioravanti.com/80sfy/">Elm 80sfy Website</a></li> <li><a href="https://github.com/paulfioravanti/80sfy">Elm 80sfy Codebase</a></li> </ul> <p>If the technical details of coding with Elm aren’t your thing, you can stop reading here and just go and enjoy some <a href="https://www.paulfioravanti.com/80sfy/">ＯＵＴＲＵＮ beats</a>.</p> <p>Still here? Okay, man, let’s talk some Elm learnings. Open up the codebase and follow along.</p> <h2 id="first-you-gotta-do-the-random-shuffle">First, you gotta do the Random Shuffle</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/chunk-glitched.png" alt="Chunk from the Goonies"/> </figure> </div> <p>There are two scenarios in the 80sfy application where an element of randomness is required:</p> <ol> <li>Shuffling the order of tracks to be played in the SoundCloud playlist</li> <li>Getting a random animated <a href="https://en.wikipedia.org/wiki/GIF">GIF</a> URL from Giphy: the application supplies a random descriptive tag, and Giphy sends back a URL that is relevant to that tag</li> </ol> <p>Unlike many other programming languages, there is no <code class="language-plaintext highlighter-rouge">Math.random()</code> or equivalent function in Elm that allows you to summon random numbers and use them on the spot.</p> <p>Generating random numbers, or doing anything involving randomness like randomly shuffling or picking an item from a list, is the responsibility of the <a href="https://elmprogramming.com/elm-runtime.html">Elm Runtime</a>. In order get a random number, you need to:</p> <ul> <li>code up a <em>description</em> of the kind of random number you want to generate</li> <li>send that description off to the Elm Runtime as a <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform.Cmd"><code class="language-plaintext highlighter-rouge">Cmd</code></a> to have the number generated for you</li> <li>handle the resulting message you get returned from Elm Runtime containing the random number</li> </ul> <h3 id="creating-a-random-list-of-numbers">Creating a Random List of Numbers</h3> <p>Let’s have a look at a simplified-down example of the first scenario for randomising the order of tracks in a playlist. First though, a bit of context around how the SoundCloud <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe">IFrame</a> widget interacts with the Elm application.</p> <p>The <a href="https://developers.soundcloud.com/docs/api/html5-widget">SoundCloud Widget API</a> has a <code class="language-plaintext highlighter-rouge">getSounds(callback)</code> method that returns the list of sound objects in its playlist. In the Elm application, though, we do not need all of that information: as long as we can get the <em>length</em> of the widget’s playlist, we can build up our own list of integer track indexes to determine the order that tracks should play.</p> <p>When the Elm application wants to tell the SoundCloud player to play a track, it sends over an index number <span style="font-family: serif; font-style: italic; font-size: larger;"> n</span>, and the SoundCloud player “skips” over to track <span style="font-family: serif; font-style: italic; font-size: larger;">n </span> in its playlist.</p> <div style="margin: auto; text-align: center; width: 100%;"> <figure style="display: block"> <img src="/assets/images/2021-05-02/andy-organ-glitched.png" alt="The Goonies on the bone piano"/> </figure> </div> <p>So, let’s pick up our story at the point when an Elm <a href="https://package.elm-lang.org/packages/elm/core/latest/Platform.Sub"><code class="language-plaintext highlighter-rouge">Sub</code>scription</a> has:</p> <ul> <li>received the <code class="language-plaintext highlighter-rouge">playlistLength</code> via an incoming <a href="https://guide.elm-lang.org/interop/ports.html">Port</a> message from Javascript (much more to say about ports later…)</li> <li>wrapped it in a <code class="language-plaintext highlighter-rouge">PlaylistLengthFetched</code> message</li> <li>sent the message off to the Elm Runtime…</li> <li>…which is then handled in the <code class="language-plaintext highlighter-rouge">update</code> function for the <code class="language-plaintext highlighter-rouge">AudioPlayer</code></li> </ul> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">AudioPlayer</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">PlaylistLengthFetched</span> <span class="n">playlistLength</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="n">generatePlaylist</span> <span class="p">:</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
                <span class="n">generatePlaylist</span> <span class="o">=</span>
                    <span class="kt">Playlist</span><span class="o">.</span><span class="n">generate</span> <span class="n">playlistLength</span>
            <span class="k">in</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">audioPlayer</span> <span class="o">|</span> <span class="n">playlistLength</span> <span class="o">=</span> <span class="n">playlistLength</span> <span class="p">}</span>
            <span class="o">,</span> <span class="n">generatePlaylist</span>
            <span class="p">)</span>
</code></pre></div></div> <p>Here, the <code class="language-plaintext highlighter-rouge">playlistLength</code> value is passed off to a <code class="language-plaintext highlighter-rouge">Playlist.generate</code> function, which defines the generation of a shuffled list of track indexes, and returns a <code class="language-plaintext highlighter-rouge">Cmd</code> to get the Elm Runtime to do the work of actually generating the playlist. Let’s have a look at how that randomness is created:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Playlist</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="n">generate</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">Random</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Generator</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Random</span><span class="o">.</span><span class="kt">List</span>

<span class="c1">-- ...</span>

<span class="n">generate</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">generate</span> <span class="n">playlistLength</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">trackList</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Int</span>
        <span class="n">trackList</span> <span class="o">=</span>
            <span class="kt">List</span><span class="o">.</span><span class="n">range</span> <span class="mi">0</span> <span class="p">(</span><span class="n">playlistLength</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">generator</span> <span class="p">:</span> <span class="kt">Generator</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Int</span><span class="p">)</span> 
        <span class="n">generator</span> <span class="o">=</span>
            <span class="kt">Random</span><span class="o">.</span><span class="kt">List</span><span class="o">.</span><span class="n">shuffle</span> <span class="n">trackList</span>
    <span class="k">in</span>
    <span class="kt">Random</span><span class="o">.</span><span class="n">generate</span> <span class="kt">PlaylistGenerated</span> <span class="n">generator</span>
</code></pre></div></div> <p>Here, we specify that:</p> <ul> <li><code class="language-plaintext highlighter-rouge">List.range</code> should build a simple list of integers</li> <li>the <a href="https://package.elm-lang.org/packages/elm-community/random-extra/latest/Random-List#shuffle"><code class="language-plaintext highlighter-rouge">Random.List.shuffle</code></a> function from the <a href="https://package.elm-lang.org/packages/elm-community/random-extra/latest"><code class="language-plaintext highlighter-rouge">Random.Extra</code></a> package, which returns a <a href="https://package.elm-lang.org/packages/elm/random/latest/Random#Generator"><code class="language-plaintext highlighter-rouge">Generator</code></a> from the <a href="https://package.elm-lang.org/packages/elm/random/latest/Random"><code class="language-plaintext highlighter-rouge">Random</code></a> package, should shuffle the list</li> </ul> <p>We now have our recipe defined for the <code class="language-plaintext highlighter-rouge">generator</code> (<em>how</em> we want a random number generated), so we:</p> <ul> <li>specify that we want to have the generated playlist sent back to us from the Elm Runtime wrapped in a <code class="language-plaintext highlighter-rouge">PlaylistGenerated</code> message (defined as <code class="language-plaintext highlighter-rouge">PlaylistGenerated (List Int)</code> so the message has a place to hold the playlist)</li> <li>send it off to the Elm Runtime with the <a href="https://package.elm-lang.org/packages/elm/random/latest/Random#generate"><code class="language-plaintext highlighter-rouge">Random.generate</code></a> function</li> <li>handle the <code class="language-plaintext highlighter-rouge">PlaylistGenerated</code> message from the Elm Runtime in the <code class="language-plaintext highlighter-rouge">update</code> function</li> </ul> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">AudioPlayer</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">PlaylistGenerated</span> <span class="n">generatedPlaylist</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="p">(</span> <span class="n">playlist</span><span class="o">,</span> <span class="n">cmd</span> <span class="p">)</span> <span class="o">=</span>
                    <span class="kt">Playlist</span><span class="o">.</span><span class="n">handleNextTrackNumberRequest</span>
                        <span class="n">generatedPlaylist</span>
                        <span class="n">audioPlayer</span><span class="o">.</span><span class="n">playlistLength</span>
            <span class="k">in</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">audioPlayer</span> <span class="o">|</span> <span class="n">playlist</span> <span class="o">=</span> <span class="n">playlist</span> <span class="p">}</span><span class="o">,</span> <span class="n">cmd</span> <span class="p">)</span>
</code></pre></div></div> <p>The details of the <code class="language-plaintext highlighter-rouge">Playlist.handleNextTrackNumberRequest</code> function are not needed for this example, but it essentially pops off the first number in the randomised <code class="language-plaintext highlighter-rouge">generatedPlaylist</code>, tells the SoundCloud widget to play the track in its playlist located at that index, and stores the remaining <code class="language-plaintext highlighter-rouge">playlist</code> in the <code class="language-plaintext highlighter-rouge">audioPlayer</code> model.</p> <p>But, the main point here is that we have requested the Elm Runtime to generate a random list of integers for us, it has done so, and we have been able to store it in our model! If you want to dig deeper, check out <a href="https://github.com/paulfioravanti/80sfy/blob/master/src/AudioPlayer/Playlist.elm">the real <code class="language-plaintext highlighter-rouge">Playlist</code> code</a>.</p> <p>We have covered audio playlist generation, but in this application, you cannot have random tracks without random GIFs as well! This time though, rather than generate a list, we want to be able to randomly <em>pick</em> a tag from a static list and send it off to Giphy, so let’s see how to do that.</p> <h3 id="randomly-picking-from-a-list">Randomly Picking from a List</h3> <p>When the 80sfy application first starts, it goes and fetches a list of descriptive string tags from a local <code class="language-plaintext highlighter-rouge">tags.json</code> file, emitting a <code class="language-plaintext highlighter-rouge">TagsFetched</code> message once that has been attempted, which is then handled in the <code class="language-plaintext highlighter-rouge">update</code> function for the application’s <code class="language-plaintext highlighter-rouge">SecretConfig</code> model (have you found the application’s secret config yet…? :wink:) in a similar way to the following:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">SecretConfig</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Config</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">secretConfig</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">TagsFetched</span> <span class="p">(</span><span class="kt">Ok</span> <span class="n">tags</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="n">generateRandomTagForVideoPlayer</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
                <span class="n">generateRandomTagForVideoPlayer</span> <span class="n">videoPlayerId</span> <span class="o">=</span>
                    <span class="kt">Tag</span><span class="o">.</span><span class="n">generateRandomTag</span> <span class="n">videoPlayerId</span> <span class="n">tags</span>

                <span class="c1">-- ...</span>
            <span class="k">in</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">secretConfig</span> <span class="o">|</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span> <span class="p">}</span>
            <span class="o">,</span> <span class="kt">Cmd</span><span class="o">.</span><span class="n">batch</span>
                <span class="p">[</span> <span class="n">generateRandomTagForVideoPlayer</span> <span class="s">"</span><span class="s2">1"</span>
                <span class="o">,</span> <span class="n">generateRandomTagForVideoPlayer</span> <span class="s">"</span><span class="s2">2"</span>
                <span class="o">,</span> <span class="c1">-- ...</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="kt">TagsFetched</span> <span class="p">(</span><span class="kt">Err</span> <span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span>
            <span class="c1">-- ...</span>
</code></pre></div></div> <p>Once the tags have been read in, we store them in the <code class="language-plaintext highlighter-rouge">secretConfig</code> model, and then send out two <code class="language-plaintext highlighter-rouge">Cmd</code>s to generate random tags, one for each <code class="language-plaintext highlighter-rouge">videoPlayer</code> in the application (yes, there are two, which <a href="https://en.wikipedia.org/wiki/Dissolve_(filmmaking)">crossfade</a> between each other).</p> <p>Let’s take a closer look at the <code class="language-plaintext highlighter-rouge">Tag.generateRandomTag</code> function, that, like the <code class="language-plaintext highlighter-rouge">Playlist.generate</code> function earlier, is responsible for creating a random generator:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Tag</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="n">generateRandomTag</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">Random</span>
<span class="c1">-- ...</span>


<span class="n">generateRandomTag</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">List</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
<span class="n">generateRandomTag</span> <span class="n">videoPlayerId</span> <span class="n">tags</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">tagsLength</span> <span class="p">:</span> <span class="kt">Int</span>
        <span class="n">tagsLength</span> <span class="o">=</span>
            <span class="kt">List</span><span class="o">.</span><span class="n">length</span> <span class="n">tags</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">randomTagIndex</span> <span class="p">:</span> <span class="kt">Generator</span> <span class="kt">Int</span>
        <span class="n">randomTagIndex</span> <span class="o">=</span>
            <span class="kt">Random</span><span class="o">.</span><span class="n">int</span> <span class="mi">0</span> <span class="n">tagsLength</span>

        <span class="n">generator</span> <span class="p">:</span> <span class="kt">Generator</span> <span class="kt">String</span>
        <span class="n">generator</span> <span class="o">=</span>
            <span class="kt">Random</span><span class="o">.</span><span class="n">map</span> <span class="p">(</span><span class="n">atIndex</span> <span class="n">tags</span><span class="p">)</span> <span class="n">randomTagIndex</span>

        <span class="n">randomTagGeneratedMsg</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="n">randomTagGeneratedMsg</span> <span class="o">=</span>
            <span class="p">(</span><span class="kt">RandomTagGenerated</span> <span class="n">videoPlayerId</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="kt">Random</span><span class="o">.</span><span class="n">generate</span> <span class="n">randomTagGeneratedMsg</span> <span class="n">generator</span>


<span class="n">atIndex</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">atIndex</span> <span class="n">tags</span> <span class="n">index</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">defaultTag</span> <span class="p">:</span> <span class="kt">String</span>
        <span class="n">defaultTag</span> <span class="o">=</span>
            <span class="s">"</span><span class="s2">80s"</span>
    <span class="k">in</span>
    <span class="n">tags</span>
        <span class="o">|&gt;</span> <span class="kt">List</span><span class="o">.</span><span class="n">drop</span> <span class="n">index</span>
        <span class="o">|&gt;</span> <span class="kt">List</span><span class="o">.</span><span class="n">head</span>
        <span class="o">|&gt;</span> <span class="kt">Maybe</span><span class="o">.</span><span class="n">withDefault</span> <span class="n">defaultTag</span>
</code></pre></div></div> <p>It looks like randomly picking from a static list is a little bit more involved than generating a new random list. So, what’s going on?</p> <ul> <li>We specify that <a href="https://package.elm-lang.org/packages/elm/random/latest/Random#int"><code class="language-plaintext highlighter-rouge">Random.int</code></a> should generate a random index number between zero and the length of the <code class="language-plaintext highlighter-rouge">tags</code> list</li> <li>We then use <a href="https://package.elm-lang.org/packages/elm/random/latest/Random#map"><code class="language-plaintext highlighter-rouge">Random.map</code></a> to create the generator that transforms that random index into the tag at the <code class="language-plaintext highlighter-rouge">randomTagIndex</code> of the <code class="language-plaintext highlighter-rouge">tags</code> list. (All lists in Elm are <a href="https://en.wikipedia.org/wiki/Linked_list">linked lists</a>, with the potential to contain <code class="language-plaintext highlighter-rouge">Nothing</code> when we interrogate their contents, which explains the ceremony contained in the <code class="language-plaintext highlighter-rouge">atIndex</code> function, and why we cannot just write something like <code class="language-plaintext highlighter-rouge">tags[index]</code>)</li> <li>We then specify that we want to have the tag sent back to us wrapped in a <code class="language-plaintext highlighter-rouge">RandomTagGenerated</code> message (defined as <code class="language-plaintext highlighter-rouge">RandomTagGenerated String String</code> so the message has a place to hold both the <code class="language-plaintext highlighter-rouge">videoPlayerId</code> the tag is for, as well as the generated tag itself)</li> <li>Finally, like in the previous example, we call <a href="https://package.elm-lang.org/packages/elm/random/latest/Random#generate"><code class="language-plaintext highlighter-rouge">Random.generate</code></a> with the message to be handled in the <code class="language-plaintext highlighter-rouge">update</code> function, and the <code class="language-plaintext highlighter-rouge">generator</code> itself</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">RandomTagGenerated</code> message is then handled in the <code class="language-plaintext highlighter-rouge">update</code> function as follows:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">update</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Config</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Config</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">msg</span> <span class="n">config</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">RandomTagGenerated</span> <span class="n">videoPlayerId</span> <span class="n">tag</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="n">randomGifUrlFetchedMsg</span> <span class="p">:</span> <span class="kt">Result</span> <span class="kt">Error</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
                <span class="n">randomGifUrlFetchedMsg</span> <span class="o">=</span>
                    <span class="kt">RandomGifUrlFetched</span> <span class="n">videoPlayerId</span>

                <span class="n">fetchRandomGifUrl</span> <span class="p">:</span> <span class="kt">Cmd</span> <span class="kt">Msg</span>
                <span class="n">fetchRandomGifUrl</span> <span class="o">=</span>
                    <span class="kt">Gif</span><span class="o">.</span><span class="n">fetchRandomGifUrl</span>
                        <span class="n">randomGifUrlFetchedMsg</span>
                        <span class="n">config</span><span class="o">.</span><span class="n">giphyApiKey</span>
                        <span class="n">tag</span>
            <span class="k">in</span>
            <span class="p">(</span> <span class="n">config</span><span class="o">,</span> <span class="n">fetchRandomGifUrl</span> <span class="p">)</span>
</code></pre></div></div> <p>Once the Elm Runtime returns the randomly generated <code class="language-plaintext highlighter-rouge">tag</code> in the <code class="language-plaintext highlighter-rouge">RandomTagGenerated</code> message, along with the <code class="language-plaintext highlighter-rouge">videoPlayerId</code> we specified ourselves in the <code class="language-plaintext highlighter-rouge">generateRandomTag</code> function, we use a <code class="language-plaintext highlighter-rouge">Gif.fetchRandomGifUrl</code> function to make a HTTP call out to Giphy to request a GIF URL (details of which are available in <a href="https://github.com/paulfioravanti/80sfy">the codebase</a>, but check out the <a href="https://github.com/paulfioravanti/80sfy/blob/master/src/Tag.elm">the real <code class="language-plaintext highlighter-rouge">Tag</code> code</a> for the details on picking random tags).</p> <div style="margin: auto; text-align: center; width: 100%;"> <figure style="display: block"> <img src="/assets/images/2021-05-02/goonies-end-scene-glitched.png" alt="The Goonies looking out at the Inferno"/> </figure> </div> <p>For more information on random generators, see the <a href="https://guide.elm-lang.org/">The Elm Guide</a>’s <a href="https://guide.elm-lang.org/effects/random.html">Random section</a>. If these two examples were too scoff-inducing-ly simple and you want some Hard Mode in your randomness, go check out <a href="https://github.com/ckoster22">Charlie Koster</a>’s article <em><a href="https://ckoster22.medium.com/randomness-in-elm-8e977457bf1b">Randomness in Elm</a></em>, and let him bend your mind a bit.</p> <h2 id="i-am-a-msg-like-my-father-before-me">I am a Msg, like my Father before me</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/luke-skywalker-glitched.png" alt="I am a Jedi, like my father before me."/> </figure> </div> <p><a href="https://guide.elm-lang.org/">The Elm guide</a> is <a href="https://guide.elm-lang.org/webapps/structure.html">quite opinionated about Elm application structuring</a>. While it advocates less structure and longer files, I find that as an application grows, I definitely prefer more structure and smaller files.</p> <p>I like to have <em>thematically-related</em> functions grouped together, just to aid in my own understanding of the code at a glance, which seems to push me towards what would seem to be considered a React-style(?) “components” way of thinking, so I will often use that word when referring to what are essentially the different “parts” of the application.</p> <p>In my mind, the 80sfy application has a few “main” components in it:</p> <ul> <li><code class="language-plaintext highlighter-rouge">AudioPlayer</code></li> <li><code class="language-plaintext highlighter-rouge">VideoPlayer</code></li> <li><code class="language-plaintext highlighter-rouge">ControlPanel</code></li> <li><code class="language-plaintext highlighter-rouge">SecretConfig</code></li> </ul> <p>When you press the “Play” button on the control panel, you start playing the audio <em>and</em> start playing the GIF videos, so these different parts of the application need to be able to communicate with each other.</p> <p>Of course all of these messages can live at the “top level” of the application, and the handling for every one of those messages can live inside one big <code class="language-plaintext highlighter-rouge">update</code> function. However, there are times where I would rather have a separate <code class="language-plaintext highlighter-rouge">AudioPlayer.Update</code> “child” file, with its own <code class="language-plaintext highlighter-rouge">update</code> function, to handle thematically-similar messages specifically targeted at the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> from the “parent” <code class="language-plaintext highlighter-rouge">update</code> function, and a similar structure for the other components.</p> <p>The main <code class="language-plaintext highlighter-rouge">update</code> function can be the “trunk” of the application tree, which can handle its own top level messages, and each named component can have its own separate <code class="language-plaintext highlighter-rouge">update</code> function that “branches off” that trunk. Each component branch can emit messages that communicate back up to the parent trunk itself, or to other sibling branch components via the parent trunk.</p> <p>This kind of concept is explained in a way that resonated with me in <em><a href="https://medium.com/@alex.lew/the-translator-pattern-a-model-for-child-to-parent-communication-in-elm-f4bfaa1d3f98">The Translator Pattern: a model for Child-to-Parent Communication in Elm</a></em> by <a href="http://alexlew.net">Alex Lew</a>. The “translator”, in this context, refers to a function that uses a dictionary of parent-level message types to “translate” child-level messages into parent-level messages. The burden of performing a message “translation” lies with the parent <code class="language-plaintext highlighter-rouge">update</code> function, before it is able to send any <code class="language-plaintext highlighter-rouge">Cmd</code>s off to the Elm Runtime.</p> <p>I really liked the idea of some sort of parent-level message dictionary that child components could leverage when they generate <code class="language-plaintext highlighter-rouge">Cmd</code>s, but I found I needed to slightly tweak the way that parent-child <code class="language-plaintext highlighter-rouge">Msg</code>/<code class="language-plaintext highlighter-rouge">Cmd</code> communication occurred, compared to Alex’s blog post, to get it all making sense in my own head.</p> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/anakin-redeemed-glitched.png" alt="Anakin redeemed"/> </figure> </div> <p>So, let’s see how this way of thinking works in practice in the 80sfy application. I have adopted a naming convention of <code class="language-plaintext highlighter-rouge">Msgs</code> for the <code class="language-plaintext highlighter-rouge">type alias</code> that defines a record containing a list of all the top-level <code class="language-plaintext highlighter-rouge">Msg</code>s in the application, and <code class="language-plaintext highlighter-rouge">dictionary</code> for the function that returns the <code class="language-plaintext highlighter-rouge">Msgs</code> dictionary itself:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Msg.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">(</span><span class="o">..</span><span class="p">)</span><span class="o">,</span> <span class="kt">Msgs</span><span class="o">,</span> <span class="n">dictionary</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span>
<span class="k">import</span> <span class="kt">ControlPanel</span>
<span class="k">import</span> <span class="kt">Key</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Key</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span>
<span class="k">import</span> <span class="kt">SecretConfig</span>
<span class="k">import</span> <span class="kt">Time</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Posix</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">VideoPlayer</span>


<span class="k">type</span> <span class="kt">Msg</span>
    <span class="o">=</span> <span class="kt">AudioPlayer</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span>
    <span class="o">|</span> <span class="kt">ControlPanel</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">Msg</span>
    <span class="o">|</span> <span class="kt">CrossFadePlayers</span> <span class="kt">Posix</span>
    <span class="o">|</span> <span class="kt">KeyPressed</span> <span class="kt">Key</span>
    <span class="o">|</span> <span class="kt">NoOp</span>
    <span class="o">|</span> <span class="kt">Pause</span>
    <span class="o">|</span> <span class="kt">Ports</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span>
    <span class="o">|</span> <span class="kt">SecretConfig</span> <span class="kt">SecretConfig</span><span class="o">.</span><span class="kt">Msg</span>
    <span class="o">|</span> <span class="kt">ShowApplicationState</span>
    <span class="o">|</span> <span class="kt">VideoPlayer</span> <span class="kt">VideoPlayer</span><span class="o">.</span><span class="kt">Msg</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">controlPanelMsg</span> <span class="p">:</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">crossFadePlayersMsg</span> <span class="p">:</span> <span class="kt">Posix</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">keyPressedMsg</span> <span class="p">:</span> <span class="kt">Key</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">pauseMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">secretConfigMsg</span> <span class="p">:</span> <span class="kt">SecretConfig</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">showApplicationStateMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">videoPlayerMsg</span> <span class="p">:</span> <span class="kt">VideoPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="p">}</span>


<span class="n">dictionary</span> <span class="p">:</span> <span class="kt">Msgs</span>
<span class="n">dictionary</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">audioPlayerMsg</span> <span class="o">=</span> <span class="kt">AudioPlayer</span>
    <span class="o">,</span> <span class="n">controlPanelMsg</span> <span class="o">=</span> <span class="kt">ControlPanel</span>
    <span class="o">,</span> <span class="n">crossFadePlayersMsg</span> <span class="o">=</span> <span class="kt">CrossFadePlayers</span>
    <span class="o">,</span> <span class="n">keyPressedMsg</span> <span class="o">=</span> <span class="kt">KeyPressed</span>
    <span class="o">,</span> <span class="n">noOpMsg</span> <span class="o">=</span> <span class="kt">NoOp</span>
    <span class="o">,</span> <span class="n">pauseMsg</span> <span class="o">=</span> <span class="kt">Pause</span>
    <span class="o">,</span> <span class="n">portsMsg</span> <span class="o">=</span> <span class="kt">Ports</span>
    <span class="o">,</span> <span class="n">secretConfigMsg</span> <span class="o">=</span> <span class="kt">SecretConfig</span>
    <span class="o">,</span> <span class="n">showApplicationStateMsg</span> <span class="o">=</span> <span class="kt">ShowApplicationState</span>
    <span class="o">,</span> <span class="n">videoPlayerMsg</span> <span class="o">=</span> <span class="kt">VideoPlayer</span>
    <span class="p">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">Msgs</code> in the <code class="language-plaintext highlighter-rouge">dictionary</code> are a mix of “top-level”-only messages, like <code class="language-plaintext highlighter-rouge">CrossFadePlayers Posix</code> or <code class="language-plaintext highlighter-rouge">NoOp</code>, and messages like <code class="language-plaintext highlighter-rouge">AudioPlayer AudioPlayer.Msg</code>, where the “top-level” or “parent” part of the message is meant to indicate which component’s <code class="language-plaintext highlighter-rouge">update</code> function the message should be sent to (<code class="language-plaintext highlighter-rouge">AudioPlayer</code>), and the constructor parameter (<code class="language-plaintext highlighter-rouge">AudioPlayer.Msg</code>) is the specific message to be handled by the child component’s <code class="language-plaintext highlighter-rouge">update</code> function.</p> <p>The dictionary is initialised as soon as the application starts, in the <code class="language-plaintext highlighter-rouge">main</code> function, and is passed into every function that needs to send top-level messages (ie all of them):</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Main.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Main</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Browser</span>
<span class="k">import</span> <span class="kt">Flags</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Flags</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Model</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="o">,</span> <span class="kt">Msgs</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Subscriptions</span>
<span class="k">import</span> <span class="kt">Update</span>
<span class="k">import</span> <span class="kt">View</span>
<span class="c1">-- ...</span>


<span class="n">main</span> <span class="p">:</span> <span class="kt">Program</span> <span class="kt">Flags</span> <span class="kt">Model</span> <span class="kt">Msg</span>
<span class="n">main</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">msgs</span> <span class="p">:</span> <span class="kt">Msgs</span>
        <span class="n">msgs</span> <span class="o">=</span>
            <span class="kt">Msg</span><span class="o">.</span><span class="n">dictionary</span>
    <span class="k">in</span>
    <span class="kt">Browser</span><span class="o">.</span><span class="n">document</span>
        <span class="p">{</span> <span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="o">,</span> <span class="n">update</span> <span class="o">=</span> <span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">msgs</span>
        <span class="o">,</span> <span class="n">view</span> <span class="o">=</span> <span class="kt">View</span><span class="o">.</span><span class="n">view</span> <span class="n">msgs</span>
        <span class="o">,</span> <span class="n">subscriptions</span> <span class="o">=</span> <span class="kt">Subscriptions</span><span class="o">.</span><span class="n">subscriptions</span> <span class="n">msgs</span>
        <span class="p">}</span>

<span class="c1">-- ...</span>
</code></pre></div></div> <p>At this point, your <a href="https://en.wiktionary.org/wiki/Spidey-sense">spidey-sense</a> may be tingling regarding passing in a record of global context this large (I do not consider it “global state” as-such since the dictionary content will never be transformed or “changed”) to the three main sections of the application.</p> <p>Surely all ten <code class="language-plaintext highlighter-rouge">Msg</code> types in the dictionary are not needed in <em>every</em> section of the application, right…? Correct, and that’s why we are going to lean on Elm’s <a href="https://ckoster22.medium.com/advanced-types-in-elm-extensible-records-67e9d804030d">Extensible Records</a> types to help “filter” this dictionary down to the bare minimum of top-level messages that each part of the application needs to use.</p> <p>Let’s see what this looks like in the top-level <code class="language-plaintext highlighter-rouge">Update</code> function:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">pauseMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">secretConfigMsg</span> <span class="p">:</span> <span class="kt">SecretConfig</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">videoPlayerMsg</span> <span class="p">:</span> <span class="kt">VideoPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="p">}</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">Update</code> module essentially <em>re-defines</em> the type of the <code class="language-plaintext highlighter-rouge">Msgs</code> record that is passed to it, restricting its entries down to only those top-level messages that it needs to care about. This helps to keep the record content more focused, and feel a bit less heavy than the record with ten entries that was originally passed in.</p> <p>We got a 50% reduction in entries from the original record in the <code class="language-plaintext highlighter-rouge">Update</code> module, so let’s see how much of one we get in the <code class="language-plaintext highlighter-rouge">View</code> and <code class="language-plaintext highlighter-rouge">Subscriptions</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/View.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">View</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">view</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">controlPanelMsg</span> <span class="p">:</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">pauseMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">secretConfigMsg</span> <span class="p">:</span> <span class="kt">SecretConfig</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">showApplicationStateMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">videoPlayerMsg</span> <span class="p">:</span> <span class="kt">VideoPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="p">}</span>


<span class="n">view</span> <span class="p">:</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Document</span> <span class="kt">Msg</span>
<span class="n">view</span> <span class="n">msgs</span> <span class="n">model</span> <span class="o">=</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p><strong><code class="language-plaintext highlighter-rouge">src/Subscriptions.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Subscriptions</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">subscriptions</span><span class="p">)</span>

<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">controlPanelMsg</span> <span class="p">:</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">crossFadePlayersMsg</span> <span class="p">:</span> <span class="kt">Posix</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">keyPressedMsg</span> <span class="p">:</span> <span class="kt">Key</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="n">videoPlayerMsg</span> <span class="p">:</span> <span class="kt">VideoPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
    <span class="p">}</span>


<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="kt">Msg</span>
<span class="n">subscriptions</span> <span class="n">msgs</span> <span class="n">model</span> <span class="o">=</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p>The reduction in entries is not quite as great for these two modules, but at least there <em>is</em> a reduction, and the record can only get smaller as it gets passed down further into child components.</p> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/chewbacca-ewoks-glitched.png" alt="Chewbacca and Ewoks"/> </figure> </div> <p>As an example, let’s follow the journey of the <code class="language-plaintext highlighter-rouge">Msgs</code> record as it gets passed down into the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> child component from the <code class="language-plaintext highlighter-rouge">Update</code> module:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span>
<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">=</span>
    <span class="c1">-- ...</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="kt">Msg</span><span class="o">.</span><span class="kt">AudioPlayer</span> <span class="n">msgForAudioPlayer</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="p">(</span> <span class="n">audioPlayer</span><span class="o">,</span> <span class="n">cmd</span> <span class="p">)</span> <span class="o">=</span>
                    <span class="kt">AudioPlayer</span><span class="o">.</span><span class="n">update</span>
                        <span class="n">parentMsgs</span>
                        <span class="n">msgForAudioPlayer</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">audioPlayer</span>
            <span class="k">in</span>
            <span class="p">(</span> <span class="p">{</span> <span class="n">model</span> <span class="o">|</span> <span class="n">audioPlayer</span> <span class="o">=</span> <span class="n">audioPlayer</span> <span class="p">}</span><span class="o">,</span> <span class="n">cmd</span> <span class="p">)</span>
        <span class="c1">-- ...</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">parentMsgs</code> are passed into the <code class="language-plaintext highlighter-rouge">AudioPlayer.update</code> function, along with whatever <code class="language-plaintext highlighter-rouge">msgForAudioPlayer</code> needs to be handled there, as well as the <code class="language-plaintext highlighter-rouge">model.audioPlayer</code>, which for all intents and purposes becomes the “model” for the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> component.</p> <p>Let’s see how the type definition has changed for the <code class="language-plaintext highlighter-rouge">Msgs</code> in the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> component. The <code class="language-plaintext highlighter-rouge">AudioPlayer.elm</code> file acts as the gateway to all audio player-related functionality, with implementation details all hidden away in sub-modules (which we will talk about in more detail later on):</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">AudioPlayer</span>
    <span class="o">,</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">update</span>
    <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">as</span> <span class="kt">Model</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Update</span> <span class="k">as</span> <span class="kt">Update</span>
<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayer</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="kt">AudioPlayer</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msg</span> <span class="o">=</span>
    <span class="kt">Msg</span><span class="o">.</span><span class="kt">Msg</span>

<span class="c1">-- ...</span>

<span class="n">update</span> <span class="p">:</span> <span class="kt">Update</span><span class="o">.</span><span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">AudioPlayer</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="n">msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">audioPlayer</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">update</code> function simply calls the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>’s own internal <code class="language-plaintext highlighter-rouge">Update.update</code> function, but the thing to notice here, is that <code class="language-plaintext highlighter-rouge">parentMsgs</code> is now defined in terms of a <code class="language-plaintext highlighter-rouge">Update.ParentMsgs msgs msg</code> type: a further-filtered, child-component-defined record type that only contains the <code class="language-plaintext highlighter-rouge">parentMsgs</code> that the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>’s <code class="language-plaintext highlighter-rouge">update</code> function needs to use.</p> <p>Notice also that the <code class="language-plaintext highlighter-rouge">AudioPlayer.update</code> is returning a lower-cased <code class="language-plaintext highlighter-rouge">Cmd msg</code>, as apposed to the <code class="language-plaintext highlighter-rouge">Cmd Msg</code> in <code class="language-plaintext highlighter-rouge">Update.update</code>. The <code class="language-plaintext highlighter-rouge">msg</code> here is a <a href="https://guide.elm-lang.org/types/reading_types.html#type-variables">type variable</a> that can technically match any type, but in this case it <em>must</em> match one of the types contained in <code class="language-plaintext highlighter-rouge">parentMsgs</code>, hence the <code class="language-plaintext highlighter-rouge">msg</code> in the <code class="language-plaintext highlighter-rouge">Update.ParentMsgs msgs msg</code> declaration. The child component does not know the specifics about the parent messages: it just knows that it needs to return the type of message that the parent is expecting to get back.</p> <p>Let’s see what the <code class="language-plaintext highlighter-rouge">Update.ParentMsgs msgs msg</code> look like now:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ParentMsgs</span><span class="o">,</span> <span class="n">update</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">as</span> <span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">AudioPlayer</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="c1">-- ...</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span>
    <span class="p">}</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">AudioPlayer</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="n">msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="p">{</span> <span class="n">audioPlayerMsg</span> <span class="p">}</span> <span class="n">msg</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p>The record has been reduced down to a single entry, the <code class="language-plaintext highlighter-rouge">audioPlayerMsg</code>, which is defined from the child component’s perspective as being as a function that takes one of the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>’s own <code class="language-plaintext highlighter-rouge">Msg</code> types, and returns some kind of <code class="language-plaintext highlighter-rouge">msg</code> type from its parent that it does not know the details of.</p> <p>This declaration mirrors the same function from the parent <code class="language-plaintext highlighter-rouge">Update</code> module’s perspective, <code class="language-plaintext highlighter-rouge">AudioPlayer.Msg -&gt; Msg</code>, a function that takes in some message internal-to-<code class="language-plaintext highlighter-rouge">AudioPlayer</code>, returning a concrete <code class="language-plaintext highlighter-rouge">Msg</code> type.</p> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/leia-truth-glitched.png" alt="Leia learns the truth"/> </figure> </div> <p>The existence of the <code class="language-plaintext highlighter-rouge">Update.ParentMsgs</code> alias belies the existence of similar aliases for a child component’s <code class="language-plaintext highlighter-rouge">View</code> and <code class="language-plaintext highlighter-rouge">Subscriptions</code> functions. For example, staying with the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>, we find this definition for the <code class="language-plaintext highlighter-rouge">subscriptions</code> function:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">AudioPlayer</span>
    <span class="o">,</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="n">subscriptions</span>
    <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">as</span> <span class="kt">Model</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Subscriptions</span> <span class="k">as</span> <span class="kt">Subscriptions</span>
<span class="c1">-- ...</span>

<span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayer</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="kt">AudioPlayer</span>

<span class="c1">-- ...</span>

<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">Subscriptions</span><span class="o">.</span><span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
<span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Subscriptions</span><span class="o">.</span><span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span>
</code></pre></div></div> <p>And the <code class="language-plaintext highlighter-rouge">Subscriptions.ParentMsgs msgs msg</code> is defined as:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Subscriptions.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Subscriptions</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ParentMsgs</span><span class="o">,</span> <span class="n">subscriptions</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">AudioPlayer</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="c1">-- ...</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span>
        <span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">:</span> <span class="n">msg</span>
    <span class="p">}</span>


<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
<span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="c1">-- ...</span>
</code></pre></div></div> <p>Similar to <code class="language-plaintext highlighter-rouge">Update.ParentMsgs</code>, <code class="language-plaintext highlighter-rouge">Subscriptions.ParentMsgs</code> restricts the passed in <code class="language-plaintext highlighter-rouge">parentMsgs</code> record to only a small subset of entries, including the <code class="language-plaintext highlighter-rouge">noOpMsg</code>, which it only knows as some <code class="language-plaintext highlighter-rouge">msg</code> type variable, without knowing its specific details.</p> <p>All of the other child components in the 80sfy application handle the <code class="language-plaintext highlighter-rouge">Msgs</code> record in a similar way, concerning themselves only with the parent messages that they themselves use.</p> <p>With regards to how these parent messages are used inside of views, and how they wrap their child messages, let’s have a look at an example in the user interface code for the play/pause button in the <code class="language-plaintext highlighter-rouge">ControlPanel</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/ControlPanel/View/Controls.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">View</span><span class="o">.</span><span class="kt">Controls</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">view</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">AudioPlayer</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">ControlPanel</span><span class="o">.</span><span class="kt">View</span><span class="o">.</span><span class="kt">Styles</span> <span class="k">as</span> <span class="kt">Styles</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Styled</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Html</span><span class="o">,</span> <span class="n">div</span><span class="o">,</span> <span class="n">i</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Styled</span><span class="o">.</span><span class="kt">Attributes</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">attribute</span><span class="o">,</span> <span class="n">class</span><span class="o">,</span> <span class="n">css</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Html</span><span class="o">.</span><span class="kt">Styled</span><span class="o">.</span><span class="kt">Events</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">onClick</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span>
        <span class="o">,</span> <span class="n">pauseMsg</span> <span class="p">:</span> <span class="n">msg</span>
        <span class="o">,</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span>
    <span class="p">}</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Context</span> <span class="n">a</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">a</span> <span class="o">|</span> <span class="n">audioPlayer</span> <span class="p">:</span> <span class="kt">AudioPlayer</span> <span class="p">}</span>


<span class="n">view</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">Context</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">view</span> <span class="n">parentMsgs</span> <span class="p">{</span> <span class="n">audioPlayer</span> <span class="p">}</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="c1">-- ...</span>

        <span class="n">playing</span> <span class="p">:</span> <span class="kt">Bool</span>
        <span class="n">playing</span> <span class="o">=</span>
            <span class="kt">AudioPlayer</span><span class="o">.</span><span class="n">isPlaying</span> <span class="n">audioPlayer</span>
    <span class="k">in</span>
    <span class="n">div</span>
        <span class="p">[</span> <span class="n">css</span> <span class="p">[</span> <span class="kt">Styles</span><span class="o">.</span><span class="n">controls</span> <span class="p">]</span>
        <span class="o">,</span> <span class="n">attribute</span> <span class="s">"</span><span class="s2">data-name"</span> <span class="s">"</span><span class="s2">controls"</span>
        <span class="p">]</span>
        <span class="p">[</span> <span class="n">playPauseButton</span> <span class="n">parentMsgs</span> <span class="n">playing</span>
        <span class="c1">-- ...</span>
        <span class="p">]</span>

<span class="c1">-- ...</span>

<span class="n">playPauseButton</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="o">-&gt;</span> <span class="kt">Html</span> <span class="n">msg</span>
<span class="n">playPauseButton</span> <span class="p">{</span> <span class="n">pauseMsg</span><span class="o">,</span> <span class="n">portsMsg</span> <span class="p">}</span> <span class="n">playing</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="p">(</span> <span class="n">iconClass</span><span class="o">,</span> <span class="n">playPauseMsg</span> <span class="p">)</span> <span class="o">=</span>
            <span class="k">if</span> <span class="n">playing</span> <span class="k">then</span>
                <span class="p">(</span> <span class="s">"</span><span class="s2">fas fa-pause"</span><span class="o">,</span> <span class="n">pauseMsg</span> <span class="p">)</span>

            <span class="k">else</span>
                <span class="p">(</span> <span class="s">"</span><span class="s2">fas fa-play"</span><span class="o">,</span> <span class="n">portsMsg</span> <span class="kt">Ports</span><span class="o">.</span><span class="n">playMsg</span> <span class="p">)</span>
    <span class="k">in</span>
    <span class="n">div</span>
        <span class="p">[</span> <span class="n">css</span> <span class="p">[</span> <span class="kt">Styles</span><span class="o">.</span><span class="n">button</span> <span class="p">]</span>
        <span class="o">,</span> <span class="n">attribute</span> <span class="s">"</span><span class="s2">data-name"</span> <span class="s">"</span><span class="s2">play-pause"</span>
        <span class="o">,</span> <span class="n">onClick</span> <span class="n">playPauseMsg</span>
        <span class="p">]</span>
        <span class="p">[</span> <span class="n">div</span> <span class="p">[</span> <span class="n">css</span> <span class="p">[</span> <span class="kt">Styles</span><span class="o">.</span><span class="n">iconBackground</span> <span class="p">]</span> <span class="p">]</span> <span class="p">[]</span>
        <span class="o">,</span> <span class="n">i</span> <span class="p">[</span> <span class="n">css</span> <span class="p">[</span> <span class="kt">Styles</span><span class="o">.</span><span class="n">icon</span> <span class="p">]</span><span class="o">,</span> <span class="n">class</span> <span class="n">iconClass</span> <span class="p">]</span> <span class="p">[]</span>
        <span class="p">]</span>
</code></pre></div></div> <p>Looking specifically at the <code class="language-plaintext highlighter-rouge">playPauseButton</code> function, and the value that is supplied to the <code class="language-plaintext highlighter-rouge">onClick</code> function, we can see that:</p> <ul> <li>if the player is currently <code class="language-plaintext highlighter-rouge">playing</code>, the parameter-less parent message <code class="language-plaintext highlighter-rouge">pauseMsg</code> (read: <code class="language-plaintext highlighter-rouge">Pause</code>) gets sent as-is to be handled in the top-level <code class="language-plaintext highlighter-rouge">Update.update</code> function</li> <li>otherwise, if the player is stopped, we fetch the <code class="language-plaintext highlighter-rouge">Play</code> <code class="language-plaintext highlighter-rouge">Msg</code> from the <code class="language-plaintext highlighter-rouge">Ports</code> module (<code class="language-plaintext highlighter-rouge">Ports.playMsg</code>), give that as a parameter to the <code class="language-plaintext highlighter-rouge">portsMsg</code> message (read: <code class="language-plaintext highlighter-rouge">Ports Play</code>), and send that off to be handled in <code class="language-plaintext highlighter-rouge">Update.update</code> as a message to be forwarded off to the <code class="language-plaintext highlighter-rouge">Ports</code> “child component” for further handling (much more will be written about the <code class="language-plaintext highlighter-rouge">Ports</code> component later on…)</li> </ul> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/battle-of-endor-glitched.png" alt="Battle of Endor"/> </figure> </div> <p>As you can see, if you want to split your Elm application out into discrete parts/components, there is a potential complexity/maintenance cost associated with doing so.</p> <p>I am prepared to pay this cost since this way of doing things makes sense to me as an application grows. Given this subjective viewpoint, and the fact that the Elm Guide would seem to consider this way of doing things to be off the “golden path”, definitely consider whether this approach is right for you, your team, and your application.</p> <h2 id="say-hello-to-my-little-façade">Say “hello” to my little façade</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/say-hello-to-my-little-friend-glitched.png" alt="Say hello to my little friend"/> </figure> </div> <p>The <a href="https://en.wikipedia.org/wiki/Facade_pattern">façade pattern</a> is probably my favourite software-design pattern, and I try and use it wherever it makes sense to make interfaces to different parts of a system more straightforward.</p> <p>One of my software pet peeves is seeing one part of a system be able to break boundaries and reach down with impunity into the internals of another part of a system it has no business knowing about.</p> <blockquote> <p>There are no natural barriers to handing out this kind of impunity in Elm, but at least the <a href="https://package.elm-lang.org/packages/kress95/elm-review-indirect-internal/latest">elm-review-indirect-internal</a> rule, for use with the fantastic <a href="https://package.elm-lang.org/packages/jfmengels/elm-review/latest/">elm-review</a> tool, can slap you on the wrist if you attempt to try.</p> </blockquote> <p>In the previous section, you saw part of how I tried to put a “hard” interface in the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> module. Let’s go back and re-open up that file, but instead have a scan of its entire content. For our purposes here, what the functions do is not important.</p> <p>The main points are that there is no implementation code, all functions are simply one-line delegations out to sub-modules, and any other module in the application only needs to <code class="language-plaintext highlighter-rouge">import</code> the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> module to interface with its functionality:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">AudioPlayer</span>
    <span class="o">,</span> <span class="kt">AudioPlayerId</span>
    <span class="o">,</span> <span class="kt">AudioPlayerVolume</span>
    <span class="o">,</span> <span class="kt">Msg</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">as</span> <span class="kt">Model</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Playlist</span> <span class="k">as</span> <span class="kt">Playlist</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Status</span> <span class="k">as</span> <span class="kt">Status</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Status</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Subscriptions</span> <span class="k">as</span> <span class="kt">Subscriptions</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Task</span> <span class="k">as</span> <span class="kt">Task</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Update</span> <span class="k">as</span> <span class="kt">Update</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Volume</span> <span class="k">as</span> <span class="kt">Volume</span>
<span class="k">import</span> <span class="kt">Ports</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">SoundCloudWidgetPayload</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">SoundCloud</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">SoundCloudPlaylistUrl</span><span class="p">)</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayer</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="kt">AudioPlayer</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayerId</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="kt">AudioPlayerId</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayerVolume</span> <span class="o">=</span>
    <span class="kt">Volume</span><span class="o">.</span><span class="kt">AudioPlayerVolume</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msg</span> <span class="o">=</span>
    <span class="kt">Msg</span><span class="o">.</span><span class="kt">Msg</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">TrackIndex</span> <span class="o">=</span>
    <span class="kt">Playlist</span><span class="o">.</span><span class="kt">TrackIndex</span>


<span class="n">init</span> <span class="p">:</span> <span class="kt">SoundCloudPlaylistUrl</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span>
<span class="n">init</span> <span class="n">soundCloudPlaylistUrl</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="n">init</span> <span class="n">soundCloudPlaylistUrl</span>


<span class="n">adjustVolumeMsg</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="n">msg</span>
<span class="n">adjustVolumeMsg</span> <span class="n">audioPlayerMsg</span> <span class="n">sliderVolume</span> <span class="o">=</span>
    <span class="kt">Msg</span><span class="o">.</span><span class="n">adjustVolume</span> <span class="n">audioPlayerMsg</span> <span class="n">sliderVolume</span>


<span class="n">isMuted</span> <span class="p">:</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
<span class="n">isMuted</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Status</span><span class="o">.</span><span class="n">isMuted</span> <span class="n">audioPlayer</span><span class="o">.</span><span class="n">status</span>


<span class="n">isPlaying</span> <span class="p">:</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Bool</span>
<span class="n">isPlaying</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Status</span><span class="o">.</span><span class="n">isPlaying</span> <span class="n">audioPlayer</span><span class="o">.</span><span class="n">status</span>


<span class="n">nextTrackMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
<span class="n">nextTrackMsg</span> <span class="o">=</span>
    <span class="kt">Msg</span><span class="o">.</span><span class="kt">NextTrack</span>


<span class="n">performAudioPlayerReset</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">SoundCloudPlaylistUrl</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
<span class="n">performAudioPlayerReset</span> <span class="n">audioPlayerMsg</span> <span class="n">soundCloudPlaylistUrl</span> <span class="o">=</span>
    <span class="kt">Task</span><span class="o">.</span><span class="n">performAudioPlayerReset</span> <span class="n">audioPlayerMsg</span> <span class="n">soundCloudPlaylistUrl</span>


<span class="n">performNextTrackSelection</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
<span class="n">performNextTrackSelection</span> <span class="n">audioPlayerMsg</span> <span class="o">=</span>
    <span class="kt">Task</span><span class="o">.</span><span class="n">performNextTrackSelection</span> <span class="n">audioPlayerMsg</span>


<span class="n">performVolumeAdjustment</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
<span class="n">performVolumeAdjustment</span> <span class="n">audioPlayerMsg</span> <span class="n">sliderVolume</span> <span class="o">=</span>
    <span class="kt">Task</span><span class="o">.</span><span class="n">performVolumeAdjustment</span> <span class="n">audioPlayerMsg</span> <span class="n">sliderVolume</span>


<span class="n">rawId</span> <span class="p">:</span> <span class="kt">AudioPlayerId</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">rawId</span> <span class="n">audioPlayerId</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="n">rawId</span> <span class="n">audioPlayerId</span>


<span class="n">rawTrackIndex</span> <span class="p">:</span> <span class="kt">TrackIndex</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="n">rawTrackIndex</span> <span class="n">trackIndex</span> <span class="o">=</span>
    <span class="kt">Playlist</span><span class="o">.</span><span class="n">rawTrackIndex</span> <span class="n">trackIndex</span>


<span class="n">rawVolume</span> <span class="p">:</span> <span class="kt">AudioPlayerVolume</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="n">rawVolume</span> <span class="n">audioPlayerVolume</span> <span class="o">=</span>
    <span class="kt">Volume</span><span class="o">.</span><span class="n">rawVolume</span> <span class="n">audioPlayerVolume</span>


<span class="n">soundCloudWidgetPayload</span> <span class="p">:</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">SoundCloudWidgetPayload</span>
<span class="n">soundCloudWidgetPayload</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Model</span><span class="o">.</span><span class="n">soundCloudWidgetPayload</span> <span class="n">audioPlayer</span>


<span class="n">statusToString</span> <span class="p">:</span> <span class="kt">Status</span> <span class="o">-&gt;</span> <span class="kt">String</span>
<span class="n">statusToString</span> <span class="n">status</span> <span class="o">=</span>
    <span class="kt">Status</span><span class="o">.</span><span class="n">toString</span> <span class="n">status</span>


<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">Subscriptions</span><span class="o">.</span><span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
<span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Subscriptions</span><span class="o">.</span><span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span>


<span class="n">toggleMuteMsg</span> <span class="p">:</span> <span class="kt">Msg</span>
<span class="n">toggleMuteMsg</span> <span class="o">=</span>
    <span class="kt">Msg</span><span class="o">.</span><span class="kt">ToggleMute</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Update</span><span class="o">.</span><span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">AudioPlayer</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="n">msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Update</span><span class="o">.</span><span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">audioPlayer</span>
</code></pre></div></div> <p>It would be nice if Elm had built-in <a href="https://en.wikipedia.org/wiki/Syntactic_sugar">syntactic sugar</a> similar to, say, <a href="https://elixir-lang.org/">Elixir</a>’s <a href="https://hexdocs.pm/elixir/Kernel.html#defdelegate/2"><code class="language-plaintext highlighter-rouge">defdelegate(funs, opts)</code></a> function, in order to prevent the need to write function delegations “longhand”. But, leaving that aside, here are a few points worth bringing up regarding this file, as well as the general architecture of the application:</p> <ul> <li>Within the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> module, <code class="language-plaintext highlighter-rouge">import</code>ing sub-modules (<code class="language-plaintext highlighter-rouge">AudioPlayer.X</code> modules) is unrestricted, but content from any other named module is only accessible via its top-level module (eg no reaching into <code class="language-plaintext highlighter-rouge">Ports.Msg</code> from <code class="language-plaintext highlighter-rouge">AudioPlayer</code>)</li> <li>Types defined in sub-modules may be exposed via the top-level module as <code class="language-plaintext highlighter-rouge">type alias</code>es (eg <code class="language-plaintext highlighter-rouge">AudioPlayer</code>, <code class="language-plaintext highlighter-rouge">Msg</code> etc). So, as far as other top-level modules are concerned, if they import the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> type, the fact that the type is actually defined in <code class="language-plaintext highlighter-rouge">AudioPlayer.Model</code> is unknowable implementation detail behind the <a href="https://en.wikipedia.org/wiki/API">API</a> wall: they just see the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> type coming in from the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> module</li> <li>Wherever possible, I have tried to make <code class="language-plaintext highlighter-rouge">types</code> be <a href="https://ckoster22.medium.com/advanced-types-in-elm-opaque-types-ec5ec3b84ed2">Opaque Types</a> in order to hide their constructors, and further enforce boundaries on implementation details (even amongst sibling modules; see, for example, the <code class="language-plaintext highlighter-rouge">Status</code> type in <code class="language-plaintext highlighter-rouge">Audio.Status</code>).<br/> The major exception to this would be the <code class="language-plaintext highlighter-rouge">Msg</code> type, which, similar to every other <code class="language-plaintext highlighter-rouge">Msg</code> in the application, needed to be exposed as <code class="language-plaintext highlighter-rouge">Msg(..)</code> from <code class="language-plaintext highlighter-rouge">AudioPlayer.Msg</code> so it could be used specifically for pattern matching in <code class="language-plaintext highlighter-rouge">AudioPlayer.Update</code> files, and consequently referenced directly as return values in functions like <code class="language-plaintext highlighter-rouge">nextTrackMsg</code> and <code class="language-plaintext highlighter-rouge">toggleMuteMsg</code>. But, just like any other type defined in a sub-module, if the <code class="language-plaintext highlighter-rouge">Msg</code> is to be exposed via the top-level module, it must only be via a <code class="language-plaintext highlighter-rouge">type alias</code></li> </ul> <p>All of the other modules in the 80sfy application that have enough internal implementation details to split out into sub-modules follow these patterns.</p> <p>The Elm Guide would probably call all this façade-component application structuring a reflection of my programming “<a href="https://guide.elm-lang.org/webapps/structure.html#culture-shock">culture shock</a>”. I think the points made in that section of the guide are reasonable, but I honestly just cannot agree with its advice of big files and comment header delimiters. I just want my code to be legible (and hopefully not just to me), and I currently think that this kind of structure can help in that goal.</p> <h2 id="you-can-be-my-wrapped-type-anytime">You can be my wrapped type anytime</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/you-can-be-my-wingman-glitched.png" alt="You can be my wingman anytime"/> </figure> </div> <p>Writing this application got me to become a big fan of <a href="https://github.com/elm/compiler/blob/master/hints/comparing-custom-types.md#wrapped-types">Wrapped Custom Types</a>, not just for the extra type safety, but also for the clarity they help give record <code class="language-plaintext highlighter-rouge">type alias</code> and <code class="language-plaintext highlighter-rouge">Msg</code> constructor definitions.</p> <p>Before I knew about wrapped types, the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> model looked like the following:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Model.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayer</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">id</span> <span class="p">:</span> <span class="kt">String</span>
    <span class="o">,</span> <span class="n">playlist</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">Int</span>
    <span class="o">,</span> <span class="n">playlistLength</span> <span class="p">:</span> <span class="kt">Int</span>
    <span class="o">,</span> <span class="n">soundCloudIframeUrl</span> <span class="p">:</span> <span class="kt">String</span>
    <span class="o">,</span> <span class="n">status</span> <span class="p">:</span> <span class="kt">Status</span>
    <span class="o">,</span> <span class="n">volume</span> <span class="p">:</span> <span class="kt">Int</span>
    <span class="p">}</span>
</code></pre></div></div> <p>At face value, this could be considered reasonable, but is the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>’s <code class="language-plaintext highlighter-rouge">id</code> really the same kind of thing as its <code class="language-plaintext highlighter-rouge">soundCloudIframeUrl</code>? Are the <code class="language-plaintext highlighter-rouge">Int</code>s in the <code class="language-plaintext highlighter-rouge">playlist</code> really the same kind of <code class="language-plaintext highlighter-rouge">Int</code>s as the <code class="language-plaintext highlighter-rouge">volume</code>? Should they be…?</p> <p>After trying out creating some types to wrap the basic types, the <code class="language-plaintext highlighter-rouge">AudioPlayer</code> model was transformed into:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="k">alias</span> <span class="kt">AudioPlayer</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">id</span> <span class="p">:</span> <span class="kt">AudioPlayerId</span>
    <span class="o">,</span> <span class="n">playlist</span> <span class="p">:</span> <span class="kt">List</span> <span class="kt">TrackIndex</span>
    <span class="o">,</span> <span class="n">playlistLength</span> <span class="p">:</span> <span class="kt">Int</span>
    <span class="o">,</span> <span class="n">soundCloudIframeUrl</span> <span class="p">:</span> <span class="kt">SoundCloudIframeUrl</span>
    <span class="o">,</span> <span class="n">status</span> <span class="p">:</span> <span class="kt">Status</span>
    <span class="o">,</span> <span class="n">volume</span> <span class="p">:</span> <span class="kt">AudioPlayerVolume</span>
    <span class="p">}</span>
</code></pre></div></div> <p>I think that this model with wrapped types conveys more <em>meaning</em> than the one with just basic types. So, I pretty much went all around the application codebase and wrapped every type I could that made sense, resulting in a total of 12 wrapped types created for 80sfy.</p> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/maverick-thumbs-up-glitched.png" alt="Maverick thumbs up."/> </figure> </div> <p>In the land of wrapped types, though, conveying meaning does exert an overhead cost. For example, let’s have a look at the ceremony required to wrap and unwrap a <code class="language-plaintext highlighter-rouge">TrackIndex</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Playlist.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Playlist</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">TrackIndex</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="o">,</span> <span class="n">rawTrackIndex</span>
    <span class="o">,</span> <span class="n">trackIndex</span>
    <span class="p">)</span>


<span class="k">type</span> <span class="kt">TrackIndex</span>
    <span class="o">=</span> <span class="kt">TrackIndex</span> <span class="kt">Int</span>

<span class="c1">-- ...</span>

<span class="n">trackIndex</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">TrackIndex</span>
<span class="n">trackIndex</span> <span class="n">rawTrackIndexInt</span> <span class="o">=</span>
    <span class="kt">TrackIndex</span> <span class="n">rawTrackIndexInt</span>

<span class="n">rawTrackIndex</span> <span class="p">:</span> <span class="kt">TrackIndex</span> <span class="o">-&gt;</span> <span class="kt">Int</span>
<span class="n">rawTrackIndex</span> <span class="p">(</span><span class="kt">TrackIndex</span> <span class="n">rawTrackIndexInt</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">rawTrackIndexInt</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">AudioPlayer</code>’s <code class="language-plaintext highlighter-rouge">playlist</code> field must contain a <code class="language-plaintext highlighter-rouge">List TrackIndex</code>, therefore:</p> <ul> <li>every “raw” track index <code class="language-plaintext highlighter-rouge">Int</code> that goes into the list must first be wrapped by calling <code class="language-plaintext highlighter-rouge">Playlist.trackIndex rawTrackIndexInt</code>.</li> <li>if you ever want to do something with the “raw” <code class="language-plaintext highlighter-rouge">Int</code> value inside of a track index, then you have to unwrap it by calling <code class="language-plaintext highlighter-rouge">Playlist.rawTrackIndex trackIndex</code></li> </ul> <p>So, wouldn’t it be easier to just…not have wrapped types here? Yes, it would! But, this is the cost of adding (admittedly subjective) clarity to model types, and it is up to you to decide whether doing this is meaningful and worth the cost of admission.</p> <p>Since the above example acts like some kind of wardrobe for an <code class="language-plaintext highlighter-rouge">Int</code>, putting on and taking off a <code class="language-plaintext highlighter-rouge">TrackIndex</code>-coloured coat without any change to the underlying raw value, let’s have a look at some other scenarios where constraints or validation for the raw value are being added to the wrapping process.</p> <p>The <code class="language-plaintext highlighter-rouge">SecretConfig</code> model contains the following values that can be populated by user input:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/SecretConfig/Model.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="k">alias</span> <span class="kt">SecretConfig</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">gifDisplayIntervalSeconds</span> <span class="p">:</span> <span class="kt">GifDisplayIntervalSeconds</span>
    <span class="o">,</span> <span class="n">soundCloudPlaylistUrl</span> <span class="p">:</span> <span class="kt">SoundCloudPlaylistUrl</span>
    <span class="c1">-- ...</span>
    <span class="p">}</span>
</code></pre></div></div> <p>These types wrap around a <code class="language-plaintext highlighter-rouge">Float</code> and a <code class="language-plaintext highlighter-rouge">String</code> respectively, but because we cannot trust anything given to us by our hostile, power-suit-toting users, we need conditions on the raw values that serve as barriers to the wrapped types being created:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Gif.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Gif</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">GifDisplayIntervalSeconds</span>
    <span class="o">,</span> <span class="n">displayIntervalSeconds</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>


<span class="k">type</span> <span class="kt">GifDisplayIntervalSeconds</span>
    <span class="o">=</span> <span class="kt">GifDisplayIntervalSeconds</span> <span class="kt">Float</span>

<span class="c1">-- ...</span>

<span class="n">displayIntervalSeconds</span> <span class="p">:</span> <span class="kt">Float</span> <span class="o">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">GifDisplayIntervalSeconds</span>
<span class="n">displayIntervalSeconds</span> <span class="n">rawDisplayIntervalSecondsFloat</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">rawDisplayIntervalSecondsFloat</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">then</span>
        <span class="kt">Just</span> <span class="p">(</span><span class="kt">GifDisplayIntervalSeconds</span> <span class="n">rawDisplayIntervalSecondsFloat</span><span class="p">)</span>

    <span class="k">else</span>
        <span class="kt">Nothing</span>
</code></pre></div></div> <p>A non-positive display interval between animated GIFs does not make sense, so we only wrap positive values, and give malicious users <code class="language-plaintext highlighter-rouge">Nothing</code>.</p> <p>Assuming that this is the only function we create to return new <code class="language-plaintext highlighter-rouge">GifDisplayIntervalSeconds</code> types, we build in some guarantees around the validity of raw values wrapped in a <code class="language-plaintext highlighter-rouge">GifDisplayIntervalSeconds</code> type that we could not get if it was a basic <code class="language-plaintext highlighter-rouge">Float</code> type.</p> <p>Similarly, a <code class="language-plaintext highlighter-rouge">SoundCloudPlaylistUrl</code> isn’t just any kind of <code class="language-plaintext highlighter-rouge">String</code>: it must have a correct prefix. If the raw value does, it gets wrapped; if not, <code class="language-plaintext highlighter-rouge">Nothing</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/SoundCloud/Url.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">SoundCloud</span><span class="o">.</span><span class="kt">Url</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="kt">SoundCloudPlaylistUrl</span>
    <span class="o">,</span> <span class="n">playlistUrl</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>


<span class="k">type</span> <span class="kt">SoundCloudPlaylistUrl</span>
    <span class="o">=</span> <span class="kt">SoundCloudPlaylistUrl</span> <span class="kt">String</span>

<span class="c1">-- ...</span>

<span class="n">playlistUrl</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">SoundCloudPlaylistUrl</span>
<span class="n">playlistUrl</span> <span class="n">rawSoundCloudPlaylistUrlString</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="n">playlistUrlPrefix</span> <span class="p">:</span> <span class="kt">String</span>
        <span class="n">playlistUrlPrefix</span> <span class="o">=</span>
            <span class="s">"</span><span class="s2">https://api.soundcloud.com/"</span>

        <span class="n">isValidUrl</span> <span class="p">:</span> <span class="kt">Bool</span>
        <span class="n">isValidUrl</span> <span class="o">=</span>
            <span class="kt">String</span><span class="o">.</span><span class="n">startsWith</span> <span class="n">playlistUrlPrefix</span> <span class="n">rawSoundCloudPlaylistUrlString</span>
    <span class="k">in</span>
    <span class="k">if</span> <span class="n">isValidUrl</span> <span class="k">then</span>
        <span class="kt">Just</span> <span class="p">(</span><span class="kt">SoundCloudPlaylistUrl</span> <span class="n">rawSoundCloudPlaylistUrlString</span><span class="p">)</span>

    <span class="k">else</span>
        <span class="kt">Nothing</span>
</code></pre></div></div> <p>As you can see, Wrapped Types can provide more than just a fancy enclosure to a basic type. Aside from improvements in type readability, they can help assert the validity of the wrapped raw values, so I would highly recommend giving them a try in your own Elm codebases!</p> <h2 id="ports-where-were-going-we-dont-need-ports">Ports? Where we’re going we don’t need ports</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/we-dont-need-roads-glitched.png" alt="Roads? Where we're going we don't need roads"/> </figure> </div> <p>My usage of ports in Elm applications previous to 80sfy was essentially as remote function calls out to the impure badlands of Javascript.</p> <p>For every kind of operation I needed to leverage Javascript for, I would poke a port-shaped hole in the Elm application boundary, do the minimum amount of work in Javascript-land, and return control quickly to the pure, type-safe Elm application fortress.</p> <p>For example, previous iterations of port-related code for the <code class="language-plaintext highlighter-rouge">AudioPlayer</code>, where communications needed to be sent out to the SoundCloud widget iframe, looked like the following, with functions named in the <a href="https://en.wikipedia.org/wiki/Active_voice">active voice</a>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Ports.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Ports</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="n">pauseAudio</span>
    <span class="o">,</span> <span class="n">playAudio</span>
    <span class="o">,</span> <span class="n">skipToTrack</span>
    <span class="o">..</span> <span class="c1">---</span>
    <span class="p">)</span>


<span class="k">port</span> <span class="n">pauseAudio</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>


<span class="k">port</span> <span class="n">playAudio</span> <span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>


<span class="k">port</span> <span class="n">skipToTrack</span> <span class="p">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>


<span class="c1">-- and a bunch of other port declarations...</span>
</code></pre></div></div> <p>The Elm application would also need to know when the SoundCloud widget controls were used directly so it could update its own internal state. This occurred via subscriptions named in the <a href="https://en.wikipedia.org/wiki/Passive_voice">passive voice</a>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Subscriptions.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Subscriptions</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msgs</span><span class="o">,</span> <span class="n">subscriptions</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
<span class="c1">-- ...</span>


<span class="k">port</span> <span class="n">audioPaused</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Value</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>


<span class="k">port</span> <span class="n">audioPlaying</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Value</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>


<span class="k">port</span> <span class="n">nextTrackNumberRequested</span> <span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>


<span class="c1">-- ...</span>
</code></pre></div></div> <p>Soundcloud-specific details about the widget, and its events (and how to bind to them), can be found in the <a href="https://developers.soundcloud.com/docs/api/html5-widget">SoundCloud Widget API</a> documentation. However, the more pointed thing to note about the Javascript code below, is that there are six named Elm <code class="language-plaintext highlighter-rouge">app.ports</code> that are having <code class="language-plaintext highlighter-rouge">subscribe</code> and <code class="language-plaintext highlighter-rouge">send</code> called on them (and this is just a sample; I originally had <em>28</em>(!) named ports/subscriptions across the application):</p> <p><strong><code class="language-plaintext highlighter-rouge">src/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="kd">const</span> <span class="nx">scPlayer</span> <span class="o">=</span> <span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">(</span><span class="dl">"</span><span class="s2">track-player</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// initialise SoundCloud player</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">READY</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">initPlayAudio</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
    <span class="nx">initPauseAudio</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
    <span class="nx">initSkipToTrack</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
    <span class="nx">initTrackFinished</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
    <span class="c1">// other similar init functions...</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initPlayAudio</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Elm tells the SoundCloud widget to play audio</span>
  <span class="nx">ports</span><span class="p">.</span><span class="nx">playAudio</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
  <span class="p">})</span>
  <span class="c1">// The SoundCloud widget tells Elm its been told to play (non-Elm request)</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PLAY</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">audioPlaying</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">loadedProgress</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initPauseAudio</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Elm tells the SoundCloud widget to play audio</span>
  <span class="nx">ports</span><span class="p">.</span><span class="nx">pauseAudio</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span>
  <span class="p">})</span>
  <span class="c1">// The SoundCloud widget tells Elm its been told to pause (non-Elm request)</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">audioPaused</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">currentPosition</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initSkipToTrack</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Elm tells the SoundCloud widget to skip over to a specific track number</span>
  <span class="nx">ports</span><span class="p">.</span><span class="nx">skipToTrack</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">trackNumber</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="nx">trackNumber</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initTrackFinished</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// The SoundCloud widget tells Elm its finished playing an audio track</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">FINISH</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">nextTrackNumberRequested</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</code></pre></div></div> <p>I wrote the code like this because it was how I understood ports to work, and pretty much all the educational materials I read about ports implemented them essentially like remote function calls into Javascript.</p> <p>However, while re-reading the <a href="https://guide.elm-lang.org/interop/ports.html">Elm Guide’s Ports section</a>, I was greeted by this guidance buried down in the <a href="https://guide.elm-lang.org/interop/ports.html#notes">Notes section</a>:</p> <blockquote> <p>Definitely do not try to make a port for every JS function you need. You may really like Elm and want to do everything in Elm no matter the cost, but ports are not designed for that. Instead, focus on questions like “who owns the state?” and use one or two ports to send messages back and forth.</p> </blockquote> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/bttf2-newspaper-glitched.png" alt="Doc and Marty reading a newspaper"/> </figure> </div> <p>Okay, the Elm Guide and I may currently have our differences with regards to application architecture, but I am open to the idea of being completely wrong about how I have written ports.</p> <p>The next question was “are there examples of how to have all messages running through one or two ports?”. These were not easy to find, but I was able to find two references that dealt with this question, and helped me get to the implementation I ended up running with:</p> <ul> <li>The <a href="https://package.elm-lang.org/packages/hendore/elm-port-message/latest/">elm-port-message</a> library</li> <li>The elm-conf 2017 talk <a href="https://www.youtube.com/watch?v=P3pL85n9_5s">The Importance of Ports</a> by <a href="https://github.com/mrmurphy">Murphy Randle</a></li> </ul> <p>From elm-port-message, I stole the idea of a generic “tagged payload” to use for <em>all</em> the kinds of messages that would flow in and out of Javascript.</p> <p>From The Importance of Ports, I stole the idea of having all outbound port messages typed, and used in an <code class="language-plaintext highlighter-rouge">update</code>-style <code class="language-plaintext highlighter-rouge">case</code> statement that resulted in a <code class="language-plaintext highlighter-rouge">Cmd</code> being sent in a tagged payload through the single outbound application port.</p> <p>The concept of having a single inbound and a single outbound port for message payloads also made me re-consider where code dealing with ports (and, to a lesser extent, subscriptions), should live in the codebase.</p> <p>This resulted in a change of thinking about outbound ports themselves. From them just <em>belonging to</em> or being <em>a part of</em> a component (eg <code class="language-plaintext highlighter-rouge">AudioPlayer.Ports</code> above), to considering the Elm application boundary <em>itself</em>, where outbound port messages are sent to Javascript, being its own major component in the application, containing its own top-level module and <code class="language-plaintext highlighter-rouge">Msg</code> type:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Update.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Update</span> <span class="k">exposing</span> <span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span>
<span class="c1">-- ...</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">portsMsg</span> <span class="p">:</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Msg</span>
        <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">}</span>


<span class="n">update</span> <span class="p">:</span> <span class="kt">Msgs</span> <span class="n">msgs</span> <span class="o">-&gt;</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Model</span> <span class="o">-&gt;</span> <span class="p">(</span> <span class="kt">Model</span><span class="o">,</span> <span class="kt">Cmd</span> <span class="kt">Msg</span> <span class="p">)</span>
<span class="n">update</span> <span class="n">parentMsgs</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">Msg</span><span class="o">.</span><span class="kt">Ports</span> <span class="n">msgForPorts</span> <span class="o">-&gt;</span>
            <span class="p">(</span> <span class="n">model</span><span class="o">,</span> <span class="kt">Ports</span><span class="o">.</span><span class="n">cmd</span> <span class="n">msgForPorts</span> <span class="p">)</span>
        <span class="c1">-- ...</span>
</code></pre></div></div> <p>You may have noticed that the view code for the <code class="language-plaintext highlighter-rouge">ControlPanel</code>’s play/pause button in a previous section sends a <code class="language-plaintext highlighter-rouge">portsMsg Ports.playMsg</code> message when it is clicked. The code above is where that message, and others like it, end up being handled.</p> <p>There is no model to <code class="language-plaintext highlighter-rouge">update</code> for these messages, nor parent message to keep track of: just a <code class="language-plaintext highlighter-rouge">Cmd</code> to be sent to the Elm Runtime, whose generation is delegated to the <code class="language-plaintext highlighter-rouge">Ports.Cmd</code> module:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Ports/Cmd.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="k">module</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Cmd</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="n">cmd</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span> <span class="k">as</span> <span class="kt">Encode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Payload</span> <span class="k">as</span> <span class="kt">Payload</span>
<span class="c1">-- ...</span>


<span class="k">port</span> <span class="n">outbound</span> <span class="p">:</span> <span class="kt">Value</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>


<span class="n">cmd</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="kt">Cmd</span> <span class="n">msg</span>
<span class="n">cmd</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="k">case</span> <span class="n">msg</span> <span class="k">of</span>
        <span class="c1">-- ...</span>
        <span class="kt">Msg</span><span class="o">.</span><span class="kt">PauseAudio</span> <span class="o">-&gt;</span>
            <span class="n">outbound</span> <span class="p">(</span><span class="kt">Payload</span><span class="o">.</span><span class="n">withTag</span> <span class="s">"</span><span class="s2">PAUSE_AUDIO"</span><span class="p">)</span>

        <span class="kt">Msg</span><span class="o">.</span><span class="kt">PlayAudio</span> <span class="o">-&gt;</span>
            <span class="n">outbound</span> <span class="p">(</span><span class="kt">Payload</span><span class="o">.</span><span class="n">withTag</span> <span class="s">"</span><span class="s2">PLAY_AUDIO"</span><span class="p">)</span>

        <span class="kt">Msg</span><span class="o">.</span><span class="kt">SkipToTrack</span> <span class="n">trackNumber</span> <span class="o">-&gt;</span>
            <span class="k">let</span>
                <span class="n">data</span> <span class="p">:</span> <span class="kt">Value</span>
                <span class="n">data</span> <span class="o">=</span>
                    <span class="kt">Encode</span><span class="o">.</span><span class="n">object</span> <span class="p">[</span> <span class="p">(</span> <span class="s">"</span><span class="s2">trackNumber"</span><span class="o">,</span> <span class="kt">Encode</span><span class="o">.</span><span class="n">int</span> <span class="n">trackNumber</span> <span class="p">)</span> <span class="p">]</span>

                <span class="n">payload</span> <span class="p">:</span> <span class="kt">Value</span>
                <span class="n">payload</span> <span class="o">=</span>
                    <span class="kt">Payload</span><span class="o">.</span><span class="n">withTaggedData</span> <span class="p">(</span> <span class="s">"</span><span class="s2">SKIP_TO_TRACK"</span><span class="o">,</span> <span class="n">data</span> <span class="p">)</span>
            <span class="k">in</span>
            <span class="n">outbound</span> <span class="n">payload</span>
</code></pre></div></div> <p>Every typed <code class="language-plaintext highlighter-rouge">Ports.Msg</code> sends a tagged <code class="language-plaintext highlighter-rouge">Payload</code>, with or without some <code class="language-plaintext highlighter-rouge">data</code>, through a single <code class="language-plaintext highlighter-rouge">outbound</code> port. For the tag name convention, I decided to use <a href="https://redux.js.org/">Redux</a>’s original <a href="https://redux.js.org/style-guide/style-guide#priority-c-rules-recommended">action type naming convention of <code class="language-plaintext highlighter-rouge">"SCREAMING_SNAKE_CASE"</code></a> (Elm is <a href="https://redux.js.org/understanding/history-and-design/prior-art#elm">one of Redux’s inspirations</a>, after all).</p> <p>Code for the payload itself lives under <code class="language-plaintext highlighter-rouge">Ports.Payload</code>, and specifies a unified way of encoding and decoding a JSON <code class="language-plaintext highlighter-rouge">Value</code> for this purpose. Rather than send any raw Elm types as parameters to ports (eg the <code class="language-plaintext highlighter-rouge">Int</code> in <code class="language-plaintext highlighter-rouge">port skipToTrack : Int -&gt; Cmd msg</code>), we specify that <em>only</em> <code class="language-plaintext highlighter-rouge">Value</code>s can be sent and received via ports (which can also be enforced by the <a href="https://package.elm-lang.org/packages/sparksp/elm-review-ports/1.3.0/NoUnsafePorts"><code class="language-plaintext highlighter-rouge">NoUnsafePorts</code></a> rule in <a href="https://package.elm-lang.org/packages/sparksp/elm-review-ports/latest">elm-review-ports</a>):</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Ports/Payload.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">Ports</span><span class="o">.</span><span class="kt">Payload</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Payload</span><span class="o">,</span> <span class="n">decode</span><span class="o">,</span> <span class="n">withTag</span><span class="o">,</span> <span class="n">withTaggedData</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">as</span> <span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Decoder</span><span class="o">,</span> <span class="kt">Value</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span><span class="o">.</span><span class="kt">Pipeline</span> <span class="k">as</span> <span class="kt">Pipeline</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span> <span class="k">as</span> <span class="kt">Encode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">Payload</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">tag</span> <span class="p">:</span> <span class="kt">String</span>
    <span class="o">,</span> <span class="n">data</span> <span class="p">:</span> <span class="kt">Value</span>
    <span class="p">}</span>


<span class="n">decode</span> <span class="p">:</span> <span class="kt">Value</span> <span class="o">-&gt;</span> <span class="kt">Payload</span>
<span class="n">decode</span> <span class="n">value</span> <span class="o">=</span>
    <span class="n">value</span>
        <span class="o">|&gt;</span> <span class="kt">Decode</span><span class="o">.</span><span class="n">decodeValue</span> <span class="n">decoder</span>
        <span class="o">|&gt;</span> <span class="kt">Result</span><span class="o">.</span><span class="n">withDefault</span> <span class="p">(</span><span class="kt">Payload</span> <span class="s">"</span><span class="s2">"</span> <span class="kt">Encode</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>


<span class="n">withTag</span> <span class="p">:</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Value</span>
<span class="n">withTag</span> <span class="n">tag</span> <span class="o">=</span>
    <span class="n">withTaggedData</span> <span class="p">(</span> <span class="n">tag</span><span class="o">,</span> <span class="kt">Encode</span><span class="o">.</span><span class="n">null</span> <span class="p">)</span>


<span class="n">withTaggedData</span> <span class="p">:</span> <span class="p">(</span> <span class="kt">String</span><span class="o">,</span> <span class="kt">Value</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Value</span>
<span class="n">withTaggedData</span> <span class="p">(</span> <span class="n">tag</span><span class="o">,</span> <span class="n">data</span> <span class="p">)</span> <span class="o">=</span>
    <span class="kt">Encode</span><span class="o">.</span><span class="n">object</span>
        <span class="p">[</span> <span class="p">(</span> <span class="s">"</span><span class="s2">tag"</span><span class="o">,</span> <span class="kt">Encode</span><span class="o">.</span><span class="n">string</span> <span class="n">tag</span> <span class="p">)</span>
        <span class="o">,</span> <span class="p">(</span> <span class="s">"</span><span class="s2">data"</span><span class="o">,</span> <span class="n">data</span> <span class="p">)</span>
        <span class="p">]</span>



<span class="c1">-- PRIVATE</span>


<span class="n">decoder</span> <span class="p">:</span> <span class="kt">Decoder</span> <span class="kt">Payload</span>
<span class="n">decoder</span> <span class="o">=</span>
    <span class="kt">Decode</span><span class="o">.</span><span class="n">succeed</span> <span class="kt">Payload</span>
        <span class="o">|&gt;</span> <span class="kt">Pipeline</span><span class="o">.</span><span class="n">required</span> <span class="s">"</span><span class="s2">tag"</span> <span class="kt">Decode</span><span class="o">.</span><span class="n">string</span>
        <span class="o">|&gt;</span> <span class="kt">Pipeline</span><span class="o">.</span><span class="n">optional</span> <span class="s">"</span><span class="s2">data"</span> <span class="kt">Decode</span><span class="o">.</span><span class="n">value</span> <span class="kt">Encode</span><span class="o">.</span><span class="n">null</span>
</code></pre></div></div> <p>Now that we have outbound messages going out to Javascript via a single port, the Javascript code needs to change so that it can deal with these different types of tagged payloads, which is where we lean on our old friend <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/switch"><code class="language-plaintext highlighter-rouge">switch</code></a>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">scPlayer</span> <span class="o">=</span> <span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">(</span><span class="dl">"</span><span class="s2">track-player</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">READY</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="nx">initOutboundPortMessageHandling</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initOutboundPortMessageHandling</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ports</span><span class="p">.</span><span class="nx">outbound</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(({</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">PLAY_AUDIO</span><span class="dl">"</span><span class="p">:</span>
      <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
      <span class="k">break</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">PAUSE_AUDIO</span><span class="dl">"</span><span class="p">:</span>
      <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span>
      <span class="k">break</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">SKIP_TO_TRACK</span><span class="dl">"</span><span class="p">:</span>
      <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">trackNumber</span><span class="p">)</span>
      <span class="k">break</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/biffs-gang-glitched.png" alt="Biff's gang"/> </figure> </div> <p>So, that’s the first half of the story: Elm to Javascript. What about messages going from Javascript to Elm? Let’s follow the journey, starting from Javascript, focusing on the events generated from the SoundCloud widget:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>
<span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">scPlayer</span> <span class="o">=</span> <span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">(</span><span class="dl">"</span><span class="s2">track-player</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">READY</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="nx">bindSoundCloudWidgetEvents</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">bindSoundCloudWidgetEvents</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PLAY</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AUDIO_PLAYING</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">sound</span><span class="p">.</span><span class="nx">loadedProgress</span>
    <span class="p">})</span>
  <span class="p">})</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AUDIO_PAUSED</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">sound</span><span class="p">.</span><span class="nx">currentPosition</span>
    <span class="p">})</span>
  <span class="p">})</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">FINISH</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
      <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">NEXT_TRACK_NUMBER_REQUESTED</span><span class="dl">"</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div> <p>There’s not too much difference in the code here compared to the previous implementation, aside from:</p> <ul> <li>minor code re-structuring to put all the SoundCloud widget bindings together</li> <li>all messages now being sent via a single <code class="language-plaintext highlighter-rouge">inbound</code> port</li> <li>like the <code class="language-plaintext highlighter-rouge">outbound</code> messages, all <code class="language-plaintext highlighter-rouge">inbound</code> messages are <code class="language-plaintext highlighter-rouge">Payload</code>-shaped objects, rather than raw values</li> </ul> <p>Of particular note, at least for me, is the <code class="language-plaintext highlighter-rouge">"NEXT_TRACK_NUMBER_REQUESTED"</code> payload, which can contain only a <code class="language-plaintext highlighter-rouge">tag</code> and no <code class="language-plaintext highlighter-rouge">data</code> information, and still be valid: essentially just a message telling Elm that “the next track number has been requested”.</p> <blockquote> <p>I think that sending this <code class="language-plaintext highlighter-rouge">data</code>-less payload object is a preferable option to the original implementation, which explicitly required needing to <code class="language-plaintext highlighter-rouge">send</code> a <code class="language-plaintext highlighter-rouge">null</code> back to Elm, when the objective was really to call <code class="language-plaintext highlighter-rouge">send</code> <em>without</em> any parameters:</p> <p><strong>What I wanted to do in the original code:</strong></p> <p><em>JS</em>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">initTrackFinished</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">FINISH</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="c1">// Calling `send` on a port with no parameters is invalid, apparently...</span>
     <span class="nx">ports</span><span class="p">.</span><span class="nx">nextTrackNumberRequested</span><span class="p">.</span><span class="nx">send</span><span class="p">()</span>
   <span class="p">})</span>
 <span class="p">}</span>
</code></pre></div> </div> <p><em>Elm</em>:</p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">port</span> <span class="n">nextTrackNumberRequested</span> <span class="p">:</span> <span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
</code></pre></div> </div> <p>The port receives no parameters, so having <code class="language-plaintext highlighter-rouge">()</code> as the parameter is correct, right…? (Spoiler: Nope.)</p> <p><strong>What I ended up needing to do to make it go:</strong></p> <p><em>JS</em>:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">initTrackFinished</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">FINISH</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="c1">// Needing to send an explicit `null` seems a bit strange to me...</span>
     <span class="nx">ports</span><span class="p">.</span><span class="nx">nextTrackNumberRequested</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
   <span class="p">})</span>
 <span class="p">}</span>
</code></pre></div> </div> <p>The only documentation I could find regarding needing to do this was <a href="https://stackoverflow.com/questions/41679386/elm-define-subscription-port-with-no-parameters">this Stack Overflow answer</a>, so this information would be a nice addition to the Elm Guide.</p> <p>Anyway, using <code class="language-plaintext highlighter-rouge">Payload</code>s means this issue is now irrelevant, so let’s get back to Elm-land to see how messages coming through on the single <code class="language-plaintext highlighter-rouge">inbound</code> port are being handled.</p> </blockquote> <p>The <code class="language-plaintext highlighter-rouge">inbound</code> port definition lives in the top-level <code class="language-plaintext highlighter-rouge">Ports</code> module, making sure that knowledge about <code class="language-plaintext highlighter-rouge">port module</code>s (and hence the world outside of the Elm) are kept solely to the <code class="language-plaintext highlighter-rouge">Ports</code> and <code class="language-plaintext highlighter-rouge">Ports.Cmd</code> family of modules:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/Ports.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">port</span> <span class="k">module</span> <span class="kt">Ports</span> <span class="k">exposing</span>
    <span class="p">(</span> <span class="n">inbound</span>
    <span class="o">,</span> <span class="c1">-- ...</span>
    <span class="p">)</span>

<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Encode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
<span class="c1">-- ...</span>


<span class="k">port</span> <span class="n">inbound</span> <span class="p">:</span> <span class="p">(</span><span class="kt">Value</span> <span class="o">-&gt;</span> <span class="n">msg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
</code></pre></div></div> <p>Since the different <code class="language-plaintext highlighter-rouge">inbound</code> messages will only be relevant for specific parts of the application, code to handle subscriptions still lives as sub-modules of the components the messages are relevant to.</p> <p>For example, <code class="language-plaintext highlighter-rouge">AudioPlayer</code>-specific messages sent in the <code class="language-plaintext highlighter-rouge">bindSoundCloudWidgetEvents</code> function are handled in <code class="language-plaintext highlighter-rouge">AudioPlayer.Subscriptions</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/AudioPlayer/Subscriptions.elm</code></strong></p> <div class="language-elm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Subscriptions</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">ParentMsgs</span><span class="o">,</span> <span class="n">subscriptions</span><span class="p">)</span>

<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Model</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">AudioPlayer</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">AudioPlayer</span><span class="o">.</span><span class="kt">Msg</span> <span class="k">as</span> <span class="kt">Msg</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Msg</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Json</span><span class="o">.</span><span class="kt">Decode</span> <span class="k">exposing</span> <span class="p">(</span><span class="kt">Value</span><span class="p">)</span>
<span class="k">import</span> <span class="kt">Ports</span>
<span class="c1">-- ...</span>


<span class="k">type</span> <span class="k">alias</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">=</span>
    <span class="p">{</span> <span class="n">msgs</span>
        <span class="o">|</span> <span class="n">audioPlayerMsg</span> <span class="p">:</span> <span class="kt">Msg</span> <span class="o">-&gt;</span> <span class="n">msg</span>
        <span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">:</span> <span class="n">msg</span>
    <span class="p">}</span>


<span class="n">subscriptions</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Sub</span> <span class="n">msg</span>
<span class="n">subscriptions</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span> <span class="o">=</span>
    <span class="kt">Ports</span><span class="o">.</span><span class="n">inbound</span> <span class="p">(</span><span class="n">handlePortMessage</span> <span class="n">parentMsgs</span> <span class="n">audioPlayer</span><span class="p">)</span>



<span class="c1">-- PRIVATE</span>


<span class="n">handlePortMessage</span> <span class="p">:</span> <span class="kt">ParentMsgs</span> <span class="n">msgs</span> <span class="n">msg</span> <span class="o">-&gt;</span> <span class="kt">AudioPlayer</span> <span class="o">-&gt;</span> <span class="kt">Value</span> <span class="o">-&gt;</span> <span class="n">msg</span>
<span class="n">handlePortMessage</span> <span class="p">{</span> <span class="n">audioPlayerMsg</span><span class="o">,</span> <span class="n">noOpMsg</span> <span class="p">}</span> <span class="n">audioPlayer</span> <span class="n">payload</span> <span class="o">=</span>
    <span class="k">let</span>
        <span class="p">{</span> <span class="n">tag</span><span class="o">,</span> <span class="n">data</span> <span class="p">}</span> <span class="o">=</span>
            <span class="kt">Ports</span><span class="o">.</span><span class="n">decodePayload</span> <span class="n">payload</span>
    <span class="k">in</span>
    <span class="k">case</span> <span class="n">tag</span> <span class="k">of</span>
        <span class="s">"</span><span class="s2">AUDIO_PAUSED"</span> <span class="o">-&gt;</span>
            <span class="c1">-- Handle "AUDIO_PAUSED" messages</span>

        <span class="s">"</span><span class="s2">AUDIO_PLAYING"</span> <span class="o">-&gt;</span>
            <span class="c1">-- Handle "AUDIO_PLAYING" messages</span>

        <span class="s">"</span><span class="s2">NEXT_TRACK_NUMBER_REQUESTED"</span> <span class="o">-&gt;</span>
            <span class="c1">-- Handle "NEXT_TRACK_NUMBER_REQUESTED" messages</span>

        <span class="n">_</span> <span class="o">-&gt;</span>
            <span class="n">noOpMsg</span>
</code></pre></div></div> <p>Some notes about this module:</p> <ul> <li>Although stating this might be obvious for some, the <code class="language-plaintext highlighter-rouge">handlePortMessage</code> function is the <code class="language-plaintext highlighter-rouge">(Value -&gt; msg)</code> function in <code class="language-plaintext highlighter-rouge">port inbound (Value -&gt; msg) -&gt; Sub msg</code></li> <li><code class="language-plaintext highlighter-rouge">handlePortMessage</code> receives the <code class="language-plaintext highlighter-rouge">payload</code> from Javascript-land, and performs some action depending on the <code class="language-plaintext highlighter-rouge">tag</code> value, details of which are not important here, but they are, of course, available in the codebase</li> <li>Once it is known <em>how</em> the inbound message is to be handled, the work to generate the subscription is delegated off to the centralised <code class="language-plaintext highlighter-rouge">Ports.inbound</code> function</li> </ul> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/flying-delorean-glitched.png" alt="Flying DeLorean"/> </figure> </div> <p>So, while “where we’re going we did actually need ports”, I think that cutting down the number of those ports from 28 to 2 can be considered a win. I hope that the example above, and the 80sfy codebase, can at least serve as an example of how to do centralised port message sending if that is a path you are looking at going down for your own Elm application.</p> <h2 id="when-you-code-js-your-heart-dies">When you code JS your heart dies</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/your-heart-dies-glitched.png" alt="When you grow up your heart dies"/> </figure> </div> <p>My developer helmet got many dents on it as I repeatedly ran into walls while coding up the Javascript side of the 80sfy application.</p> <p>Some of these issues were due to browser peculiarities, or undocumented quirks of the <a href="https://developers.soundcloud.com/docs/api/html5-widget">SoundCloud Widget API</a>, which I am wagering has probably not received much love in a while. But, since all these issues occurred in Javascript-land, it did, however unfairly, became the target of my frustration.</p> <p>So, without further adieu, here is a random list of JS-land issues I came across and how they needed to be fixed, which will hopefully save you some time if you ever encounter similar issues.</p> <h3 id="soundcloud-iframe-loading-delays">SoundCloud iframe loading delays</h3> <p>In the 80sfy application, the first request that ends up being made to the SoundCloud widget is to return the list of its sound objects, so that list’s length can be sent back to Elm to form the basis of the shuffled playlist.</p> <p>However, the SoundCloud iframe seems to require a little bit of time to initialise before it can get its sounds, so in order to avoid any <code class="language-plaintext highlighter-rouge">"Uncaught Error: mediaPayload required."</code> errors displaying in the browser JS console, I needed to introduce a one-time delay using <a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout"><code class="language-plaintext highlighter-rouge">setTimeout()</code></a> before calling <code class="language-plaintext highlighter-rouge">scPlayer.getSounds()</code>:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">initAudioPlayer</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">volume</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">getSounds</span><span class="p">(</span><span class="nx">sounds</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">PLAYLIST_LENGTH_FETCHED</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">sounds</span><span class="p">.</span><span class="nx">length</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">},</span> <span class="mi">3000</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">3000</code> millisecond delay was the value gleaned from trial and error: values less than this did not seem to be long enough to make the error go away.</p> <h3 id="firefox-blur-event-issues">Firefox blur event issues</h3> <p><code class="language-plaintext highlighter-rouge">setTimeout()</code> ended up (bafflingly) being the solution to another completely different issue: this time related to <a href="https://www.mozilla.org/en-US/firefox/">Firefox</a> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/blur_event"><code class="language-plaintext highlighter-rouge">blur</code> events</a>.</p> <p>In the 80sfy application, if you switch to another browser tab or window, which fires off a <code class="language-plaintext highlighter-rouge">blur</code> event, the GIFs stop playing, saving unneeded Giphy API calls when the application is not the centre of attention.</p> <p>The issue is that, for Firefox <em>only</em>, if you click the SoundCloud widget iframe, it looks like Firefox considers it a different browser window, and fires off a blur event, stopping the GIFs unexpectedly. Scouring the internet for the cause of this issue led to <a href="https://gist.github.com/jaydson/1780598#gistcomment-2609301">this Gist comment</a>, where:</p> <blockquote> <p>For me, adding a 0 second timeout…made it work in Firefox. The problem seems to be that, at the time Firefox fires the blur event, it has not yet updated the <code class="language-plaintext highlighter-rouge">document.activeElement</code> [the iframe], so it evaluates to <code class="language-plaintext highlighter-rouge">false</code>.</p> </blockquote> <p>Trying that led to this code:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/videoPlayer.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">initWindowEventListeners</span><span class="p">(</span><span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">blur</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">activeElementId</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span><span class="p">.</span><span class="nx">id</span>
      <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">WINDOW_BLURRED</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">data</span><span class="p">:</span> <span class="nx">activeElementId</span>
      <span class="p">})</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>And…it worked. Same behaviour across browsers now. Go figure ¯\<em>(ツ)</em>/¯</p> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/breakfast-club-group-glitched.png" alt="The Breakfast Club"/> </figure> </div> <h3 id="skipping-tracks-un-pauses-soundcloud-player">Skipping tracks un-pauses SoundCloud player</h3> <p>Regardless of whether the SoundCloud iframe widget is paused or not, if you choose to skip to the next track in the playlist, it starts playing.</p> <p>This may be intended behaviour for the widget, but it was undesired behaviour for me: I wanted to be able to skip tracks while continuing to be in a paused state.</p> <p>So, since the call to <code class="language-plaintext highlighter-rouge">scPlayer.skip</code> forcably <em>un-pauses</em> the player, we need to check if the player was originally paused before the <code class="language-plaintext highlighter-rouge">skip</code> command was issued, and if so, keep the SoundCloud widget player paused by <em>re-pausing</em> it:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">initOutboundPortMessageHandling</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">ports</span><span class="p">.</span><span class="nx">outbound</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(({</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">case</span> <span class="dl">"</span><span class="s2">SKIP_TO_TRACK</span><span class="dl">"</span><span class="p">:</span>
      <span class="c1">// Get player's original paused state</span>
      <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">(</span><span class="nx">paused</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">trackNumber</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// *re-pause* player if it was originally paused but got *un-paused*</span>
          <span class="c1">// by the above call to `scPlayer.skip`.</span>
          <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">pause</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">})</span>
      <span class="k">break</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="only-tell-elm-about-real-pause-events">Only tell Elm about “real” pause events</h3> <p>The “re-pausing” problem above caused a bit of a cascade of issues back into Elm-land.</p> <p>There is code that binds to the <code class="language-plaintext highlighter-rouge">SC.Widget.Events.PAUSE</code> event, which sends a message to an <code class="language-plaintext highlighter-rouge">inbound</code> port to let Elm know that the SoundCloud player has been paused. The problem is that any “forced re-pausing” should not be considered a “real” pause event for Elm notification purposes.</p> <p>So, the issue now is how can we intercept and interrogate a SoundCloud <code class="language-plaintext highlighter-rouge">sound</code> object in the <code class="language-plaintext highlighter-rouge">PAUSE</code> event callback to make sure that Elm only gets a <code class="language-plaintext highlighter-rouge">"AUDIO_PAUSED"</code> message when a “real” pause occurs?</p> <p>The first thing we can do is something similar to the handling in the <code class="language-plaintext highlighter-rouge">"SKIP_TO_TRACK"</code> message, and only send the <code class="language-plaintext highlighter-rouge">"AUDIO_PAUSED"</code> message when the player has been <em>actively</em> paused:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">bindSoundCloudWidgetEvents</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">(</span><span class="nx">paused</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
          <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AUDIO_PAUSED</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">data</span><span class="p">:</span> <span class="nx">sound</span><span class="p">.</span><span class="nx">currentPosition</span>
        <span class="p">})</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">})</span>
</code></pre></div></div> <p>This code works as expected for track skips that happen while a track is playing (the <code class="language-plaintext highlighter-rouge">paused</code> value above will be <code class="language-plaintext highlighter-rouge">false</code> when you ask if <code class="language-plaintext highlighter-rouge">scPlayer.isPaused</code> while it is playing), but not when the player is in a paused state and a track is skipped (resulting in the forced re-pause), since that will still count as a “pause”! Argh!</p> <p>So, what needs to be done here is add a guard clause to check the state of the <code class="language-plaintext highlighter-rouge">sound.loadedProgress</code>. If it is <code class="language-plaintext highlighter-rouge">0</code>, that means that a “forced re-pause” has occurred after a track skip has happened to a new track, which has not started playing yet, and hence has not recorded any progression:</p> <p><strong><code class="language-plaintext highlighter-rouge">src/js/soundCloudWidget.js</code></strong></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">bindSoundCloudWidgetEvents</span><span class="p">(</span><span class="nx">scPlayer</span><span class="p">,</span> <span class="nx">ports</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">SC</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">Events</span><span class="p">.</span><span class="nx">PAUSE</span><span class="p">,</span> <span class="nx">sound</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sound</span><span class="p">.</span><span class="nx">loadedProgress</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span>
    <span class="p">}</span>

    <span class="nx">scPlayer</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">(</span><span class="nx">paused</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ports</span><span class="p">.</span><span class="nx">inbound</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
          <span class="na">tag</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AUDIO_PAUSED</span><span class="dl">"</span><span class="p">,</span>
          <span class="na">data</span><span class="p">:</span> <span class="nx">sound</span><span class="p">.</span><span class="nx">currentPosition</span>
        <span class="p">})</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">})</span>
</code></pre></div></div> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/breakfast-club-fist-pump-glitched.png" alt="Breakfast Club fist pump"/> </figure> </div> <p>Does all this sound confusing? It was! Please learn from my trial and error, and I hope you save yourself some time if you encounter similar issues!</p> <h2 id="all-this-code-will-be-lost-in-time-like-tears-in-rain">All this code will be lost in time, like tears in rain</h2> <div style="margin: auto; width: 95%;"> <figure style="display: block;"> <img src="/assets/images/2021-05-02/tears-in-rain-glitched.png" alt="All these moments will be lost in time. Like tears in rain."/> </figure> </div> <p>I spent more time than I intended on architecting, refactoring, re-writing, and polishing this application, but I feel like during this journey I learned significantly more about Elm than I had known before.</p> <p>It represents a conscientiously-written codebase to me now, but in the future, who knows? Maybe I will come around to the Elm Guide’s way of thinking and abandon my stubborn ideas about application structure, or maybe there is some food for thought in here for other Elm developers (reach out and let me know!).</p> <p>Anyway, it’s just an application that plays synthwave sounds to animated GIFs, man. Grab an <a href="https://drinkarizona.com/collections/drinks">ice tea</a>, don’t think about it too hard, and just <a href="https://www.paulfioravanti.com/80sfy/">ｒｅｌａｘ</a>.</p> <blockquote> <p>For anyone who is curious about the glitched images, I used <a href="https://photomosh.com/">Photo Mosh</a> to initially add scanlines and some other effects, and then <a href="https://snorpey.github.io/jpg-glitch/">Image Glitch Tool</a> for the glitching.</p> </blockquote>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="elm"/><category term="synthwave"/><category term="retrowave"/><category term="80s"/><category term="functional-programming"/><category term="soundcloud"/><category term="giphy"/><summary type="html"><![CDATA[Tech moves pretty fast. If you don't stop and do a side project once in a while, you could miss it.]]></summary></entry><entry><title type="html">Test-Driven Fairy Tale</title><link href="https://www.paulfioravanti.com/blog/test-driven-fairy-tale/" rel="alternate" type="text/html" title="Test-Driven Fairy Tale"/><published>2021-02-20T21:30:00+11:00</published><updated>2021-11-29T14:50:00+11:00</updated><id>https://www.paulfioravanti.com/blog/test-driven-fairy-tale</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/test-driven-fairy-tale/"><![CDATA[<div class="post-audio"> <div class="post-audio-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/Tw2QuzIErQ0" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div class="spacer"></div> <div class="text"> :studio_microphone: This post has audio narration </div> </div> <blockquote> <p><em>This story takes place when pigs spoke rhyme</em><br/> <em>And monkeys chewed tobacco,</em><br/> <em>And hens took snuff to make them tough,</em><br/> <em>And ducks went quack, quack, quack, O!</em><br/></p> </blockquote> <p>Have you ever told a story with your code?</p> <p>No, I don’t mean boring <em><a href="https://en.wikipedia.org/wiki/User_story">user stories</a></em>, I mean real, <em><a href="https://www.collinsdictionary.com/dictionary/english/make-believe">make-believe</a></em> stories!</p> <p>The story of <a href="https://en.wikipedia.org/wiki/The_Three_Little_Pigs">The Three Little Pigs</a> is a real story. A <a href="https://en.wikipedia.org/wiki/Fable">fable</a>, even!</p> <div style="display: block; text-align: center;"> <figure style="display: block; margin: 1em;"> <img src="/assets/images/2021-02-20/three-little-pigs.png" alt="The Three Little Pigs"/> <figcaption style="text-align: center;"> Illustration by <a href="https://www.leesheppard.com">Lee Sheppard</a>. </figcaption> </figure> </div> <p>It uses the <a href="https://en.wikipedia.org/wiki/Rule_of_three_(writing)">rule of three</a> to tell a simple story of pigs versus a wolf: each encounter sets up a scenario, which gets executed, results in a pay-off that affects the state of the story, and moves the plot forward.</p> <p>But, can it be coded? Can we then use its test suite to actually tell the story? I decided to try and find out!</p> <p>Nice stories deserve to be told using nice programming languages. So, I chose <a href="https://www.ruby-lang.org/en/">Ruby</a>, since <a href="https://en.wikipedia.org/wiki/Yukihiro_Matsumoto">Matz</a>, Ruby’s creator, <a href="https://en.wiktionary.org/wiki/MINASWAN">seems like a nice person</a>. For testing, I chose <a href="https://rspec.info/">RSpec</a>, a Ruby tool that uses expressive language to write tests: just what I needed to <code class="language-plaintext highlighter-rouge">describe</code> the progression of the story.</p> <p>You can find the Ruby code for my interpretation of the story at <a href="https://github.com/paulfioravanti/three_little_pigs">The Three Little Pigs Github repository</a>, but nothing beats having someone read you a story.</p> <p>So, gather round your monitors and devices, and let’s re-visit this classic fairy tale together, which begins Once Upon A Time…</p> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/4NrU1YMd1qE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""> </iframe>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="ruby"/><category term="rspec"/><category term="minitest"/><category term="testing"/><summary type="html"><![CDATA[Will the Big Bad Wolf thwart The Three Little Pigs from getting a passing test suite?]]></summary></entry><entry><title type="html">Stenography Numbers on a Georgi</title><link href="https://www.paulfioravanti.com/blog/steno-numbers-georgi/" rel="alternate" type="text/html" title="Stenography Numbers on a Georgi"/><published>2021-01-17T18:15:00+11:00</published><updated>2022-04-25T13:24:00+10:00</updated><id>https://www.paulfioravanti.com/blog/steno-numbers-georgi</id><content type="html" xml:base="https://www.paulfioravanti.com/blog/steno-numbers-georgi/"><![CDATA[<div class="post-audio"> <div class="post-audio-video"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/bdJtRvq7vvo" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div class="spacer"></div> <div class="text"> :studio_microphone: This post has audio narration </div> </div> <p>As a present to myself for <a href="https://www.paulfioravanti.com/blog/completed-typey-type/">“completing” Typey Type</a>, I picked up a <a href="https://www.gboards.ca/product/georgi">Georgi</a> keyboard, and since mid-July 2020, I have been using it as my daily driver for practising <a href="http://www.openstenoproject.org/">Plover stenography</a>.</p> <p>The Georgi’s <a href="http://www.kailh.com/en/Products/Ks/CS/">Kailh Choc Linear</a> key switches with <a href="https://www.spritdesigns.com/product-page/choc">12g ultra light springs</a> make <a href="https://www.artofchording.com/introduction/how-steno-works.html#chords">chording</a> a breeze. However, its compact form factor means it has a set of number (<code class="language-plaintext highlighter-rouge">#</code>) keys in the thumb clusters of both halves of the keyboard, rather than a <a href="https://sites.google.com/site/learnplover/lesson-8-numbers#TOC-The-Number-Bar">number bar</a> (or row of keys that effectively substitute for a number bar if you are using a traditional keyboard, rather than a <a href="https://en.wikipedia.org/wiki/Stenotype">stenotype machine</a>).</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/number-bar.png" alt="img number-bar" style="margin-right: 0.5rem; width: 45%;"/> <img src="/assets/images/2021-01-17/number-keys.png" alt="img number-keys" style="margin-left: 0.5rem; width: 45%"/></p> <p>This change does not interfere with the majority of how anyone would use a stenographic keyboard, since, in general, we tend to type numbers significantly less frequently than letters and words. However, if you do use numbers often, then some <a href="https://en.wikipedia.org/wiki/Muscle_memory">muscle memory</a> re-wiring will be in order to adapt to the number keys.</p> <p>In order to help with memorisation, specifically around which <code class="language-plaintext highlighter-rouge">#</code> key to press for a given <a href="https://sites.google.com/site/learnplover/glossary">outline</a>, I created a set of images indicating the chords pressed for each number from 0-99, and the set of hundreds numbers from 100-900, with the <code class="language-plaintext highlighter-rouge">#</code> key that <em>felt right for me</em>.</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/georgi-numbers-small.gif" alt="img georgi-numbers-small"/></p> <p>You can download a PDF containing all the images in the animated GIF above at the following link:</p> <ul> <li><a href="https://www.dropbox.com/s/5d7n1hix84mkrlz/georgi-numbers.pdf?dl=1">georgi-numbers.pdf</a></li> </ul> <p>Also, here are some compare and contrast videos of stroking Plover steno numbers on both a Georgi and an <a href="https://ergodox-ez.com/">Ergodox EZ</a> (which I originally <a href="https://www.paulfioravanti.com/blog/starting-stenography-ergodox/">started learning stenography</a> on):</p> <div style="display: flex;"> <div style="width: 50%; margin-left: 0.5rem;"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/Xz0aqwlIHvg" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> <div style="width: 50%; margin-left: 0.5rem;"> <div class="responsive-video-container"> <iframe src="https://www.youtube-nocookie.com/embed/Y1zQEEmivxc" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe> </div> </div> </div> <blockquote> <p>I am still learning, so I am definitely not fast. Also, these videos are not representative of my current accuracy: it took me tens of takes to record each video until I was able to not make any major mistakes (and even then, they are not perfect runs).</p> </blockquote> <h2 id="rules">Rules</h2> <p>After discovering which number chords “felt right”, I tried to see if I could summarise (read: reverse-engineer) my choices into a set of <em>subjective</em> rules. So, here is what I came up with:</p> <h3 id="general-rules">General Rules</h3> <ul> <li>Always use two hands to stroke the outline, even if it is possible to use only one hand. I do not want to have to remember whether a chord can be stroked with one hand or not, so just use two hands by default.</li> <li> <p>When the number outline is in <a href="https://sites.google.com/site/learnplover/lesson-2-steno-order#TOC-Steno-Order">steno order</a> (ie for a two-digit number, <strong>the first digit value is less than the last digit value</strong>: 13, 48 etc), the <code class="language-plaintext highlighter-rouge">#</code> key used should be on the <strong>opposite side</strong> of the keyboard from the key of the <strong>last digit</strong> stroked.</p> <p>So, for 13, the <code class="language-plaintext highlighter-rouge">P</code> key for “3” is on the left half of the keyboard, so the right <code class="language-plaintext highlighter-rouge">#</code> key should be used. Likewise, for 48, the <code class="language-plaintext highlighter-rouge">-L</code> key for “8” is on the right half of the keyboard, so the left <code class="language-plaintext highlighter-rouge">#</code> key should be used.</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/013-tiny.png" alt="img 013-tiny" style="margin-right: 0.5rem;"/> <img src="/assets/images/2021-01-17/048-tiny.png" alt="img 048-tiny" style="margin-left: 0.5rem;"/></p> </li> <li> <p>When the number outline is <em>not</em> in steno order (ie for a two-digit number, <strong>the first digit value is greater than the last digit value</strong>: 31, 84 etc), then the <code class="language-plaintext highlighter-rouge">#</code> key used is <strong>always on the left</strong> since the <code class="language-plaintext highlighter-rouge">EU</code> <a href="https://sites.google.com/site/learnplover/lesson-2-steno-order#TOC-Inversion">inversion</a> chord must be stroked, and a thumb cannot comfortably stroke all three keys in the thumb cluster at once.</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/031-tiny.png" alt="img 031-tiny" style="margin-right: 0.5rem;"/> <img src="/assets/images/2021-01-17/084-tiny.png" alt="img 084-tiny" style="margin-left: 0.5rem;"/></p> </li> <li>The thumb cluster rule: where a number outline requires non-<code class="language-plaintext highlighter-rouge">#</code> keys in the thumb clusters (ie <code class="language-plaintext highlighter-rouge">A</code>, <code class="language-plaintext highlighter-rouge">O</code>, <code class="language-plaintext highlighter-rouge">E</code>, <code class="language-plaintext highlighter-rouge">U</code>), wherever possible, aim to <em>only</em> use your thumbs to stroke those keys. This generally limits you to stroking the following adjacent keys for number outlines: <code class="language-plaintext highlighter-rouge">#A</code>, <code class="language-plaintext highlighter-rouge">AO</code>, and <code class="language-plaintext highlighter-rouge">EU</code>.</li> </ul> <h3 id="exceptions">Exceptions</h3> <ul> <li>When the number outline is in steno order, the <code class="language-plaintext highlighter-rouge">#</code> key used should be on the <strong>opposite side</strong> of the keyboard from the <strong>first digit</strong> stroked if that digit is: <ol> <li> <p>composed of two repeated instances of the same digit (22, 66 etc), requiring the <code class="language-plaintext highlighter-rouge">-D</code> key</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/022-tiny.png" alt="img 022-tiny" style="margin-right: 0.5rem;"/> <img src="/assets/images/2021-01-17/066-tiny.png" alt="img 066-tiny" style="margin-left: 0.5rem;"/></p> </li> <li> <p>a multiple of 100 under 1000 (100, 700 etc), requiring the <code class="language-plaintext highlighter-rouge">-Z</code> key</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/100-tiny.png" alt="img 100-tiny" style="margin-right: 0.5rem;"/> <img src="/assets/images/2021-01-17/700-tiny.png" alt="img 700-tiny" style="margin-left: 0.5rem;"/></p> </li> </ol> </li> <li> <p>For the thumb cluster rule above, there are unavoidable exceptions for numbers 60, 70, 80, and 90, where the left <a href="https://en.wikipedia.org/wiki/Ring_finger">ring finger</a> needs to be brought down into the left thumb cluster for stroking the <code class="language-plaintext highlighter-rouge">#</code> key in the <code class="language-plaintext highlighter-rouge">#O</code> chord.</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/060-tiny.png" alt="img 060-tiny" style="margin-right: 0.5rem;"/> <img src="/assets/images/2021-01-17/090-tiny.png" alt="img 090-tiny" style="margin-left: 0.5rem;"/></p> </li> <li> <p>Since stroking the number 900 requires the <code class="language-plaintext highlighter-rouge">-T</code> and <code class="language-plaintext highlighter-rouge">-Z</code> keys, and they are diagonal from each other, it is impossible to stroke naturally using standard steno hand positions. Therefore, stroking the outline for 900 requires a <a href="https://www.artofchording.com/layout/d-and-z.html#the-d-and-z-keys">“Philly shift”</a>, where your right ring finger strokes the <code class="language-plaintext highlighter-rouge">-T</code> key, rather than your right <a href="https://en.wikipedia.org/wiki/Little_finger">little finger</a>.</p> <p style="text-align: center;"><img src="/assets/images/2021-01-17/900-tiny.png" alt="img 900-tiny" style="margin-left: 0.5rem;"/></p> <p>Plover does offer the <code class="language-plaintext highlighter-rouge">#EUT</code> outline to avoid needing to perform a Philly shift, but I do not find the Philly shift <em>that</em> awkward to stroke given that the <code class="language-plaintext highlighter-rouge">#</code> keys are already moving my hands out of standard steno positions anyway, and I want keep building muscle memory on the <code class="language-plaintext highlighter-rouge">-Z</code> pattern and not have to remember this one potential exception to the 100s rule.</p> </li> </ul> <h2 id="all-that-just-for-numbers">All that just for numbers?</h2> <p>You may be reeling in horror at the need to remember so much just to chord two-digit numbers, and vow to just stroke digits individually, or temporarily switch to QWERTY mode to type numbers. I certainly could not argue with you!</p> <p>But, I personally find this set of number outlines comfortable enough to stroke, and plan to continue giving them a go moving forward. If you are also a student, or a practitioner, of Plover stenography, then I hope that the materials in this blog post serve as some reference, or at least as some amusement.</p> <p>If you do end up using the chords, or have any opinions on rule variations that you think would work better, please reach out to me or leave a comment!</p>]]></content><author><name>Paul Fioravanti</name><email>paul@paulfioravanti.com</email><uri>https://www.paulfioravanti.com</uri></author><category term="stenography"/><category term="georgi"/><category term="mechanical-keyboards"/><summary type="html"><![CDATA[Adapt your steno habits from using a number bar to a set of thumb cluster number keys.]]></summary></entry></feed>